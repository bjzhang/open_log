.LOG
13:27 2014-02-10
GTD
0, 10:00

1, today
1), xl snapshot coding.

09:56 2014-02-11
company, colleague
"Olaf Kirch"_email_"devel] Welcome Roger Zhou"
Dear all,

It is my pleasure to announce that today, Roger (Zhiqiang) Zhou had
his first day at SUSE, as the new manager of the Server Engineering Team
in Beijing. He is coming from WindRiver, where he headed a team of
people in the QA department. For the SLE department, this is a good
start of the Year of the Horse :-)

Please join me in welcoming Roger, and please support him in his new role
as much as you can.

Regards, and a happy new year!
Olaf
--
Wir schwimmen ja ab und zu im Chaosteich...        (N. Pieper)
--------------------------------------------
Olaf Kirch - Director SUSE Linux Enterprise; R&D (okir@suse.com)
SUSE LINUX Products GmbH, Maxfeldstr. 5, 90409 Nürnberg, Germany
GF: Jeff Hawn, Jennifer Guild, Felix Imendörffer, HRB 16746 (AG Nürnberg)

10:02 2014-02-11
virtualization, kvm, package
""Bruce Rogers" <brogers@suse.com>"_email_"[opensuse-virtual] Proposed KVM related packaging changes"_20140211_1747
All,

I proposed making some KVM related packaging changes.

Motivation: Certain aspects of KVM support have changed over
time, and we should adjust to better align to the current state of
affairs. Among these are:
- the KVM modules have been included with the base kernel for
   quite some time
- there is no longer a qemu / qemu-kvm code split upstream
   qemu handles KVM completely 
- on x86, since v3.7 the KVM kernel modules are auto loaded based
   on detection of the required hardware virtualization features 

Our current kvm package originally included the KVM kernel modules,
as well as the QEMU binaries which supported KVM acceleration. As
noted above conditions have changed to where a kvm package has
little of its original purpose. The qemu package now has the basic
support for using KVM, and about the only meaningful use of a kvm
package would be for KVM related configuration or deliverables which
would not be appropriate (for whatever reason) in the qemu package.

The current content of the kvm package in OBS Virtualization includes:
- dependency on qemu package
- a recommends for virt-utils
- the legacy qemu-kvm executable, which is simply a wrapper for the
   QEMU provided executable with the parameter added that enables KVM
   acceleration. I believe this wrapper still provides the useful feature of
   having an executable name, compatible with prior kvm enabled usage.
- man page for qemu-kvm (which maps to qemu)
- a udev rule to change permissions and group ownership of /dev/kvm
   to be compatible with current libvirt usage as well as non-libvirt based
   (ie QEMU command line) kvm group administration.
- a qemu-ifup script which I find useful for testing and creating simple
   usage scenarios
- a kvm_stat tool which allows for monitoring of the lower level KVM
   module activities of the running KVM guests
- in the case of the SLES version of the kvm package, a place for additional
   modprobing, and support documentation, which in effect, rounds out
   the complete base support for KVM.

I propose that we rename (essentially) the kvm package to be qemu-kvm.
This is partly to reduce the number of maintained packages, as I envision
this simply being a subpackage of qemu. This will also make versioning
simpler to maintain. This package will maintain a dependency on qemu.
I propose that the permissions and group ownership udev rule be moved
from qemu-kvm to the base qemu package so that libvirt and etc. can
function without the qemu-kvm package, providing for a slightly smaller
package set and simpler configuration. I propose that the recommends
dependency for virt-utils be removed.

If the additional features and documentation still remaining in qemu-kvm
(the qemu-kvm wrapper and man page, the sample qemu-ifup script, the
kvm_stat debug utility, possible scripts for modprobing of additional kernel
modules which enhance qemu-kvm usage (eg vhost-net), and the support
documentation) are desired, then that package may be installed, but it is not
considered essential for basic KVM support.

The virt-utils package currently provides little value. It was envisioned as a
place to collect generic utilities useful for either KVM or Xen virtualization,
but to date very little has been done there. QEMU based utilities are now in
qemu-tools, and the only utility in virt-utils is the unmaintained
vm-snapshot-disk. I propose that we eliminate this package, but if there is
objection, and someone relies on the vm-snapshot-disk feature, we can keep
it, but not have it be part of the default set of rpms installed by KVM Host
Server pattern.

If there are dependencies on the kvm package name which will take time to
remove, we could have that stripped down package simply require qemu-kvm
in the interim.

Comments on these proposed changes are of course welcome.

Thanks,

Bruce Rogers

10:19 2014-02-11
GTD
0, 9:40

1, today
1), 10:20-12:11 16:11-16:40 xl snapshot coding. see"10:20 2014-02-11"
2), 1h suse EVP. see"12:31 2014-2-11"
3), 1.5h suse all hands. see"14:07 2014-02-11"

10:20 2014-02-11
xl snapshot coding
1, TODO
vm-snapshot-disk? for what?
bamvor@laptop-work:log> rpm -ql virt-utils
/usr/bin/vm-snapshot-disk

i know this from Bruce email.

2, finish disk snapshot code: could snapshot all the disk for the specific domain.
not test yet.

3, flow about save and snapshot:
1), mine
stop
snapshot
save memory
2), read the qemu and xm code.

4, qemu flow
QEMUSnapshotInfo

12:31 2014-2-11
suse employee value proposition
David

13:12 2014-2-11
In order for JACK to work, your user needs to be added to the audio group for direct access to hardware.

usermod -a -G audio bamvor
laptop-work:/home/bamvor/log # cat /etc/group |grep audio
audio:x:17:pulse,bamvor

it is ok after this.

14:07 2014-02-11
suse, all hands
1,
suse 86% of plan.
total 93% of plan.

geo:
only EMEA 103% of plan. is over 100% of plan.

ref: "12:37 2013-10-29"3 for license, maintenance, service.

2, suse:
1), Q3
North American -22% of prior in Q3FY14.
Huawei is the top of transactions in APAC in Q3FY14.
2), Q4 forecast
oppotunity:
Deutsche Back $5.7M, UK.

3, Suse success Q3 AP: China UnionPay.
1),
up to 4000 servers.
2), response:
Strong alliance with hardware provider Sugon(曙光).
3), result:
SLES+xen.
over 600 SLES systems deployed.
addition 2000 systems expected over next two years.

4, 25years.
bruce and charles.

5, steady social media channel growth.
1), song
2), blog: kGraft: live kernel patching.

6, Strategy and Execution.

7, SUSE Cloud 3
HA: ETA: March 2014.
suse customer center.
ceph.

15:16 2014-02-11
software skill, mail, groupwise
1, referece Tim's blog:
http://ourobengr.com/2013/03/opensuse-12-3-lenovo-t430/
1), there is no need to install libXm.so.3 so as to libXm.so.4. according to Tim's blog. i installed the openmotif-libs(64bits), so i could prove that libXm.so.3 32bits is useless for me(i could start groupwise, open and send mail).
2), need install libpangox-1_0-0-32bit to avoid libwebrenderer crash.
JRE log(hs_err_pid5433.log):
# Problematic frame:
# C  [libwebrenderer.so+0xde3ff]  _ZN14WRSwingBrowser6WRInitEv+0x13f
#

2, about libpangox
Pango is a library for layout and rendering of text, with an emphasis
on internationalization. It can be used anywhere that text layout
is needed.
Pango forms the core of text and font handling for GTK+.
This is a compatibility library providing the obsolete pangox library
that is not shipped by Pango itself anymore.

09:05 2014-02-12
sync meeting
1, about virtualization team
16 engineer on virtualization.
Jason: virtualization manager from 2009.

2, Chunyan
1), talk about volume create.  qemu-img, qcow-create.
2), direct kernel boot.
upstream qemu is not good for this feature. need work.

3, xm snapshot fate
1), xen
(1), disk snapshot
(2), vm snapshot.

12:43 2014-02-12
GTD
0, 11:08

1, today
1), 12:43- 20:23 xl snapshot coding. see"12:43 2014-02-12".

12:43 2014-02-12
xl snapshot coding
1, continue reading the qemu and xm code.
1), how to manage the snapshot list?
2), do i need to write all the snapshot image to one file?
3), it seems that libxl will stop the domain during libxl_domain_suspend. which means i need to avoid to stop the domain during snapshot.
4), in xen hvm save, how to deal with qemu process? from the function name, libxl__domain_save_device_model should handle this. but i do not know how it works.
and in xen pv save, do i need to care about qemu?
5), discuss with Chunyan. Chunyan suggest me make the disk snapshot work at first.
Chunyan said that in the xen old snapshot. xen will check the qcow2 snapshot in qcow2 file.

2, reference the follow patch for how to add the qmp command
From bbe860104f0544d7863296606e042cc62bf7ab4b Mon Sep 17 00:00:00 2001
From: Wenchao Xia <xiawenc@linux.vnet.ibm.com>
Date: Wed, 11 Sep 2013 14:04:34 +0800
Subject: [PATCH] qmp: add internal snapshot support in qmp_transaction

From f323bc9e8b3b46ad28402995a9dcaaeff3eb5e03 Mon Sep 17 00:00:00 2001
From: Wenchao Xia <xiawenc@linux.vnet.ibm.com>
Date: Wed, 11 Sep 2013 14:04:35 +0800
Subject: [PATCH] qmp: add interface blockdev-snapshot-internal-sync

3, add blockdev-snapshot and blockdev-internal-snapshot. this should be easier than transaction.

15:59 2014-02-12
virtualization, doc, some info about qemu with xen
http://wiki.xen.org/wiki/QEMU_Upstream

Xen Qemu Trees
These can be found on xenbits in 'qemu-upstream-VERSION.git' e.g. qemu-upstream-unstable.git, qemu-upstream-4.3-testing.git.
By default the Xen build system will clone and build both versions of Qemu from the branches on xenbits.

Using a distribution supplied version of Qemu
    ./configure --with-system-qemu=/path/some/qemu-bin/

override the binary to be used via device_model_override field in your xl vm configuration (other toolstacks may or may not expose this option). For example:
    device_model_override = "/usr/bin/qemu-system-x86_64"
Note that it is you responsibility to ensure that 'device_model_version' is set to either 'qemu-xen-traditional' or 'qemu-xen' as appropriate when overriding the binary to use.

13:35 2014-02-13
virtualization, libvirt, libxl
http://jfehlig.wordpress.com/2014/01/05/libvirt-support-for-xens-new-libxenlight-toolstack/
two contribution are welcome according to Jim's blog
1, attach xl domain to libvirt.
2, support domain 0 in libvirt.

13:37 2014-02-13
GTD
1, today
1), 13:37-17:39 xl snapshot coding. see"13:38 2014-02-13"
2), Summary: 怎么也睡不够, 昨天至少11点就睡, 到下午两点咋就又困了!

13:38 2014-02-13
xl snapshot coding
1, compile the code and test the block device snapshot internal.
2, test disk internal snapshot ok.
# xl disk_snapshot_internal bjz_04_sles11_sp2 ide-hd2 snapshot_02131643
libxl: error: libxl_qmp.c:315:qmp_handle_error_response: received an error message from QMP server: Device 'ide-hd2' not found
# xl disk_snapshot_internal bjz_04_sles11_sp2 hdc snapshot_02131643
# xl disk_snapshot_internal bjz_04_sles11_sp2 hdc snapshot_02131643
libxl: error: libxl_qmp.c:315:qmp_handle_error_response: received an error message from QMP server: Snapshot with name 'snapshot_02131643' already exists on device 'hdc'

3, TODO
1), add query-block, delete disk internal snapshot.
2), try transaction.
3), save memory and snapshot.
4), think about revert snapshot.

11:17 2014-02-14
software skills, network, enable /etc/hosts
1, # /etc/init.d/network restart
redirecting to "systemctl  restart network.service"
2, flush iptables?

11:25 2014-02-14
GTD
1, today
1), 11:26-11:36 xl snapshot coding. see"11:27 2014-02-14"

11:27 2014-02-14
xl snapshot coding
1), add query-block, delete disk internal snapshot.

11:34 2014-02-14
software skills, editor, vim, disable auto indent when paste
1, http://stackoverflow.com/questions/2514445/turning-off-auto-indent-when-pasting-text-into-vim

Pavel Shved:
To turn off autoindent when you paste code, there's a special "paste" mode.

Type

:set paste
Then paste your code. Note that the text in the tooltip now says -- INSERT (paste) --.

After you pasted your code, turn off the paste-mode, so that auto-indenting when you type works correctly again.

:set nopaste

2, vim help
http://vim.wikia.com/wiki/Toggle_auto-indenting_for_code_paste

15:19 2014-02-14
Xia Li
1, system crash
1), libvirtd
38 14:48:48.981: 2866: warning : qemuDomainObjTaint:1110 : Domain id=23 name='opensuse131rc-1' uuid=e18155a8-44a1-b5a3-bada-0a48324bd70b is taint    ed: high-privileges
39 14:49:13.455: 2863: error : daemonStreamHandleAbort:590 : stream aborted at client request
40 14:49:17.439: 2863: error : daemonStreamHandleAbort:590 : stream aborted at client request
41 14:49:23.767: 2863: error : virNetSocketReadWire:904 : Cannot recv data: Connection reset by peer
42 14:49:49.351: 2867: error : remoteDispatchSupportsFeature:11603 : internal error connection not open
43 14:58:34.241: 2865: warning : qemuDomainObjTaint:1110 : Domain id=24 name='opensuse131rc-1' uuid=e18155a8-44a1-b5a3-bada-0a48324bd70b is taint    ed: high-privileges
44 14:59:25.875: 2863: error : virNetSocketReadWire:904 : Cannot recv data: Connection reset by peer
45 14:59:31.137: 2867: error : remoteDispatchSupportsFeature:11603 : internal error connection not open
46 15:00:55.102: 2867: warning : qemuDomainObjTaint:1110 : Domain id=25 name='opensuse131rc-1' uuid=e18155a8-44a1-b5a3-bada-0a48324bd70b is taint    ed: high-privileges
47 15:01:55.540: 2863: error : virNetSocketReadWire:904 : Cannot recv data: Connection reset by peer
48 15:02:31.044: 2868: error : remoteDispatchSupportsFeature:11603 : internal error connection not open
49 15:02:32.052: 2863: error : virNetSocketReadWire:912 : End of file while reading data: Input/output error
2), qemu, opensuse131rc-1
204 2014-02-14 15:00:55.102: starting up
205 LC_ALL=C PATH=/sbin:/usr/sbin:/usr/local/sbin:/root/bin:/usr/local/bin:/usr/bin:/bin:/usr/bin/X11:/usr/X11R6/bin:/usr/games:/opt/kde3/bin:/usr    /lib64/jvm/jre/bin:/usr/lib/mit/bin:/usr/lib/mit/sbin:/opt/novell/iprint/bin HOME=/root USER=root LOGNAME=root TMPDIR=/tmp QEMU_AUDIO_DRV=none     /usr/bin/qemu-kvm -S -M pc-0.15 -enable-kvm -m 1024 -smp 2,sockets=2,cores=1,threads=1 -name opensuse131rc-1 -uuid e18155a8-44a1-b5a3-bada-0a    48324bd70b -nodefconfig -nodefaults -chardev socket,id=charmonitor,path=/var/lib/libvirt/qemu/opensuse131rc-1.monitor,server,nowait -mon chard    ev=charmonitor,id=monitor,mode=control -rtc base=utc -no-shutdown -drive file=/mnt/vmdisk/images/opensuse131rc-1/disk0.raw,if=none,id=drive-id    e0-0-0,format=raw -device ide-drive,bus=ide.0,unit=0,drive=drive-ide0-0-0,id=ide0-0-0,bootindex=1 -netdev tap,fd=25,id=hostnet0 -device rtl813    9,netdev=hostnet0,id=net0,mac=52:54:00:3e:9b:8d,bus=pci.0,multifunction=on,addr=0x3.0x0 -chardev pty,id=charserial0 -device isa-serial,chardev    =charserial0,id=serial0 -usb -vnc 127.0.0.1:5 -vga cirrus -device AC97,id=sound0,bus=pci.0,multifunction=on,addr=0x4.0x0 -device virtio-balloo    n-pci,id=balloon0,bus=pci.0,multifunction=on,addr=0x5.0x0
206 Domain id=25 is tainted: high-privileges
207 char device redirected to /dev/pts/10
208 qemu: terminating on signal 15 from pid 2863
209 2014-02-14 15:02:31.648: shutting down

2,
1), it seems that the disk is crash. we could not mount the disk image from host.
2), TODO: check about taint.
Chunyan: vm taint should be 0 in ProcessStop.

