libxl VM Snapshot HOWTO
--------

Author:
   Bamvor Jian Zhang <bjzhang@suse.com>

* Overview:
    Two levels of snapshot: disk snapshot and VM snapshot
    Four types of snapshot operations: create, delete, list and revert.

    * disk snapshot
        Disk snapshot is crash-consistent if the domain is running. It could be
        "internal" (like in qcow2 format, snapshot and delta are both in one
        image file), or "external" (snapshot in one file, delta in another).

    * VM snapshot
        VM snapshot includes disk snapshots and domain state saving. VM could
        be resumed to very state when the snapshot was created. This kind of
        snapshot is also referred to as a domain checkpoint or system checkpoint.

        "VM snapshot create" means saving domain state and doing disk snapshots.
        Before creating VM snapshot, it will check whether it is snapshotable.

        "VM snapshot revert" means rolling back to the state of indicated
        snapshot.

* VM Snapshot

    * Create Snapshot:

        User could create internal or external snapshot with or without config
        file. Refer to xl.snapshot.5 ( RFC Doc 5/5) for details of config file.

        User cases:
        1), create an internal snapshot with default name (autogenerated name:
            epoch second from 1, Jan 1970). Internal snapshot is only supported
            by qcow2 format.
            e.g.:
                #xl snapshot-create your_domain

        2), create an internal snapshot with specific snapshot name.
            e.g.:
                #xl snapshot-create -n domain_snapshot_name your_domain

        3), create an external snapshot
            To create an external snapshot, you must specify a config file, in
            which you could specify external path and type of the snapshot in
            'disk'.
            e.g.:
                #xl snapshot-create your_domain config_file

            #cat snapshot_external_config_file
            name = "1397207577"
            description="Snapshot after OS installation. External snapshot"
            memory="yes"
            disk=['hda=/var/lib/xen/snapshots/<domain_uuid>/disk_hda.qcow2,type=qcow2',
                  'hdc=/var/lib/xen/snapshots/<domain_uuid>/disk_hdc.qcow2,type=qcow2']

        4), create disk-only snapshot, which means no memory state will be saved
            in this snapshot. Could be internal and external.
            e.g.:
                (internal)
                #xl snapshot-create --disk-only your_domain

                (external)
                #xl snapshot-create your_domain config_file

            disk-only snapshot can be done to part but not all disks by providing
            specific config file (to indicate which disks to be snapshotted).

    * List Snapshot:

        User Cases:

        1), list short information of all snapshots for specific domain. Short
            information include snapshot name, creation time, the domain
            state when create snapshot, whether it is a disk only snapshot.
            e.g.:
                #xl snapshot-list your_domain

        2), list full information of one snapshot for specific domain
            e.g.:
                #xl snapshot-list -l your_domain domain_snapshot_name

        3), list full information of all snapshots for specific domain.
            e.g.:
                #xl snapshot-list -l your_domain

    * Delete snapshot:

        User Cases:

        1), delete a snapshot for specific domain.
            This operation will delete all files relative to this snapshot
            include the disk snapshot state, saved memory image, domain
            snapshot configuraiton in libxl-json format.
            e.g.:
               #xl snapshot-delete -n domain_snapshot_name your_domain

    * Revert snapshot:

        User Cases:

        Curently, only internal snapshot revert is supportted.
        Following command will revert an internal disk snapshot and memory state.
        e.g.:
            #xl snapshot-revert -n domain_snapshot_name your_domain

