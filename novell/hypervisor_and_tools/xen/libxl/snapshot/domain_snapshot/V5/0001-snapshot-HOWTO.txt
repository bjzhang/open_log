snapshot
--------

Author:
   Bamvor Jian Zhang <bjzhang@suse.com>
   Chunyan Liu <cyliu@suse.com>

Overview:
there are two types of snapshots supported by libxl: disk snapshot and domain
snapshot and four types of operations: create, delete, list and revert.

Disk snapshot will only be crash-consistent if the domain is running. Disk
snapshots can also be internal (qcow2) or external (snapshot in one file, delta
in another).

Domain snapshots include disk snapshots and domain state, allowing to resume
the domain from the same state when the snapshot was created. This type of
snapshot is also referred to as a domain checkpoint or system checkpoint.

Domain snapshot create means save domain state and do disk snapshots.
At the beginning of domain snapshot create, it will check whether it is
snapshotable.

Domain snapshot revert means rollback the current snapshot state.

1, Create Snapshot:
user could create internal or external snapshot with or without config
file. reference xl.snapshot.5 for(patch 0005) for details of this config
file.

1), create an internal snapshot with default name(epoch second from 1, Jan
1970). only qcow2 is supported for internal snapshot.
xl snapshot-create your_domain

2), create an internal snapshot with specific snapshot name.
xl snapshot-create -n domain_snapshot_name your_domain

3), create an internal disk snapshot by config file. which mean no memory
state is saved in this snapshot.
# cat snapshot_internal
name = "internal_snapshot_after_installation"
description="a snapshot after OS installation. internal snapshot example"
creationtime="1397207580"
type="internal"

# xl snapshot-create your_domain snapshot_internal

4), create a external snapshot
cat snapshot_external
name = "1397207577"
description="a snapshot after OS installation. external snapshot example"
creationtime="1397207577"
memory="yes"
disk=[ 'hda=/var/lib/xen/snapshots/<domain_uuid>/disk_hda.qcow2,type=qcow2', 'hdc=/var/lib/xen/snapshots/<domain_uuid>/disk_hdc.qcow2,type=qcow2']

2, List snapshot:
1), list all the domain snapshot short information for specific domain.
short information include snapshot name, creation time, the domain state
when create snapshot, whether it is a disk only snapshot.
xl snapshot-list your_domain
2), list full information for one domain snapshot for specific domain
xl snapshot-list -l your_domain domain_snapshot_name
3), list full information for all domian snapshot for specific domain.
xl snapshot-list -l your_domain

3, Delete snapshot:
1), delete one snapshot for specific domain. this operation will delete
all the file relative to this snapshot include the disk snapshot state,
saved memory image, domain snapshot configuraiton in libxl-json format.
xl snapshot-delete -n domain_snapshot_name your_domain

4, Revert snapshot:
curently, only internal snapshot revert is supportted. the following
command will revert the internal disk snapshot and memory state.
xl snapshot-revert -n domain_snapshot_name your_domain

