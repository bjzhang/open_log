--- wireshark-1.0.16.orig/epan/dissectors/packet-ansi_a.c	2010-08-30 06:01:28.000000000 +0800
+++ wireshark-1.0.16/epan/dissectors/packet-ansi_a.c	2012-06-06 18:40:58.000000000 +0800
@@ -44,6 +44,7 @@
 #include <epan/tap.h>
 #include <epan/strutil.h>
 #include <epan/emem.h>
+#include <epan/expert.h>
 
 #include "packet-bssap.h"
 #include "packet-ansi_a.h"
@@ -781,6 +782,16 @@ my_dgt_tbcd_unpack(
 	curr_offset += ((edc_len) - (edc_max_len)); \
     }
 
+#define EXTRANEOUS_DATA_CHECK_EXPERT(edc_len, edc_max_len) \
+    if ((edc_len) > (edc_max_len)) \
+    { \
+        proto_item *expert_item; \
+        expert_item = proto_tree_add_text(tree, tvb, \
+            curr_offset, (edc_len) - (edc_max_len), "Extraneous Data, dissector bug or later version spec(report to wireshark.org)"); \
+        expert_add_info_format(pinfo, expert_item, PI_PROTOCOL, PI_NOTE, "Extraneous Data, dissector bug or later version spec(report to wireshark.org)"); \
+        curr_offset += ((edc_len) - (edc_max_len)); \
+    }
+
 #define	SHORT_DATA_CHECK(sdc_len, sdc_min_len) \
     if ((sdc_len) < (sdc_min_len)) \
     { \
@@ -2548,7 +2559,7 @@ static guint8
 elem_cell_id_list(tvbuff_t *tvb, proto_tree *tree, guint32 offset, guint len, gchar *add_string, int string_len)
 {
     guint8	oct;
-    guint8	consumed;
+    guint16	consumed;
     guint8	num_cells;
     guint32	curr_offset;
     proto_item	*item = NULL;
@@ -2770,7 +2781,7 @@ elem_downlink_re_aux(tvbuff_t *tvb, prot
 {
     guint8	oct;
     guint8	disc;
-    guint8	consumed;
+    guint16	consumed;
     guint8	num_cells;
     guint8	curr_cell;
     guint32	value;
@@ -2898,7 +2909,7 @@ elem_downlink_re(tvbuff_t *tvb, proto_tr
 static guint8
 elem_downlink_re_list(tvbuff_t *tvb, proto_tree *tree, guint32 offset, guint len, gchar *add_string, int string_len)
 {
-    guint8	consumed;
+    guint16	consumed;
     guint8	num_envs;
     guint8	oct_len;
     guint32	curr_offset;
@@ -3020,7 +3031,7 @@ static guint8
 elem_ho_pow_lev(tvbuff_t *tvb, proto_tree *tree, guint32 offset, guint len, gchar *add_string, int string_len)
 {
     guint8	oct;
-    guint8	consumed;
+    guint16	consumed;
     guint8	num_cells;
     proto_item	*item = NULL;
     proto_tree	*subtree = NULL;
@@ -5401,7 +5412,7 @@ elem_is2000_scr(tvbuff_t *tvb, proto_tre
 
     curr_offset += len - (curr_offset - offset);
 
-    EXTRANEOUS_DATA_CHECK(len, curr_offset - offset);
+    EXTRANEOUS_DATA_CHECK_EXPERT(len, curr_offset - offset);
 
     return(curr_offset - offset);
 }
@@ -8049,11 +8060,11 @@ static guint8 (*elem_1_fcn[])(tvbuff_t *
 /*
  * Type Length Value (TLV) element dissector
  */
-static guint8
+static guint16
 elem_tlv(tvbuff_t *tvb, proto_tree *tree, elem_idx_t idx, guint32 offset, guint len, const gchar *name_add)
 {
     guint8	oct, parm_len;
-    guint8	consumed;
+    guint16	consumed;
     guint32	curr_offset;
     proto_tree	*subtree;
     proto_item	*item;
@@ -8131,11 +8142,11 @@ elem_tlv(tvbuff_t *tvb, proto_tree *tree
  * Length cannot be used in these functions, big problem if a element dissector
  * is not defined for these.
  */
-static guint8
+static guint16
 elem_tv(tvbuff_t *tvb, proto_tree *tree, elem_idx_t idx, guint32 offset, const gchar *name_add)
 {
     guint8	oct;
-    guint8	consumed;
+    guint16	consumed;
     guint32	curr_offset;
     proto_tree	*subtree;
     proto_item	*item;
@@ -8207,12 +8218,12 @@ elem_tv(tvbuff_t *tvb, proto_tree *tree,
  * Length cannot be used in these functions, big problem if a element dissector
  * is not defined for these.
  */
-static guint8
+static guint16
 elem_t(tvbuff_t *tvb, proto_tree *tree, elem_idx_t idx, guint32 offset, const gchar *name_add)
 {
     guint8	oct;
     guint32	curr_offset;
-    guint8	consumed;
+    guint16	consumed;
 
 
     curr_offset = offset;
@@ -8241,11 +8252,11 @@ elem_t(tvbuff_t *tvb, proto_tree *tree,
 /*
  * Length Value (LV) element dissector
  */
-static guint8
+static guint16
 elem_lv(tvbuff_t *tvb, proto_tree *tree, elem_idx_t idx, guint32 offset, guint len _U_, const gchar *name_add)
 {
     guint8	parm_len;
-    guint8	consumed;
+    guint16	consumed;
     guint32	curr_offset;
     proto_tree	*subtree;
     proto_item	*item;
@@ -8312,10 +8323,10 @@ elem_lv(tvbuff_t *tvb, proto_tree *tree,
  * Length cannot be used in these functions, big problem if a element dissector
  * is not defined for these.
  */
-static guint8
+static guint16
 elem_v(tvbuff_t *tvb, proto_tree *tree, elem_idx_t idx, guint32 offset)
 {
-    guint8	consumed;
+    guint16	consumed;
     guint32	curr_offset;
     gint	dec_idx;
 
@@ -8457,7 +8468,7 @@ elem_v(tvbuff_t *tvb, proto_tree *tree,
 static void
 bsmap_cl3_info(tvbuff_t *tvb, proto_tree *tree, guint32 offset, guint len)
 {
-    guint8	consumed;
+    guint16	consumed;
     guint32	curr_offset;
     guint	curr_len;
 
@@ -8814,7 +8825,7 @@ dtap_srvc_release_complete(tvbuff_t *tvb
 static void
 bsmap_ass_req(tvbuff_t *tvb, proto_tree *tree, guint32 offset, guint len)
 {
-    guint8	consumed;
+    guint16	consumed;
     guint32	curr_offset;
     guint	curr_len;
 
@@ -8867,7 +8878,7 @@ bsmap_ass_req(tvbuff_t *tvb, proto_tree
 static void
 bsmap_ass_complete(tvbuff_t *tvb, proto_tree *tree, guint32 offset, guint len)
 {
-    guint8	consumed;
+    guint16	consumed;
     guint32	curr_offset;
     guint	curr_len;
 
@@ -8902,7 +8913,7 @@ bsmap_ass_complete(tvbuff_t *tvb, proto_
 static void
 bsmap_ass_failure(tvbuff_t *tvb, proto_tree *tree, guint32 offset, guint len)
 {
-    guint8	consumed;
+    guint16	consumed;
     guint32	curr_offset;
     guint	curr_len;
 
@@ -8922,7 +8933,7 @@ bsmap_ass_failure(tvbuff_t *tvb, proto_t
 static void
 bsmap_clr_req(tvbuff_t *tvb, proto_tree *tree, guint32 offset, guint len)
 {
-    guint8	consumed;
+    guint16	consumed;
     guint32	curr_offset;
     guint	curr_len;
 
@@ -8942,7 +8953,7 @@ bsmap_clr_req(tvbuff_t *tvb, proto_tree
 static void
 bsmap_clr_command(tvbuff_t *tvb, proto_tree *tree, guint32 offset, guint len)
 {
-    guint8	consumed;
+    guint16	consumed;
     guint32	curr_offset;
     guint	curr_len;
 
@@ -8962,7 +8973,7 @@ bsmap_clr_command(tvbuff_t *tvb, proto_t
 static void
 bsmap_clr_complete(tvbuff_t *tvb, proto_tree *tree, guint32 offset, guint len)
 {
-    guint8	consumed;
+    guint16	consumed;
     guint32	curr_offset;
     guint	curr_len;
 
