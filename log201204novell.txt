.LOG
13:53 2012-04-01
GTD
1, today
1), setting up network, but do not know how to setup dd-wrt powered router.
2), libvirt libxl driver, pick a function to write. see"14:25 2012-04-01"

14:25 2012-04-01
suse, virtualization, libvirt, qemu, xen, libvirt libxl driver, write a API, compile libvirt; build service, obs, osc
1, compile libvirt 
1), libxml2
http://holy2010.blog.51cto.com/1086044/448630
bamvor@linux-bvirt:libxml2-2.7.6> autoreconf --force --install
libtoolize: putting auxiliary files in `.'.
libtoolize: copying file `./ltmain.sh'
libtoolize: Consider adding `AC_CONFIG_MACRO_DIR([m4])' to configure.in and
libtoolize: rerunning libtoolize, to keep the correct libtool macros in-tree.
libtoolize: Consider adding `-I m4' to ACLOCAL_AMFLAGS in Makefile.am.
autoheader: WARNING: Using auxiliary files such as `acconfig.h', `config.h.bot'
autoheader: WARNING: and `config.h.top', to define templates for `config.h.in'
autoheader: WARNING: is deprecated and discouraged.
autoheader: 
autoheader: WARNING: Using the third argument of `AC_DEFINE' and
autoheader: WARNING: `AC_DEFINE_UNQUOTED' allows one to define a template without
autoheader: WARNING: `acconfig.h':
autoheader: 
autoheader: WARNING:   AC_DEFINE([NEED_FUNC_MAIN], 1,
autoheader: 		[Define if a function `main' is needed.])
autoheader: 
autoheader: WARNING: More sophisticated templates can also be produced, see the
autoheader: WARNING: documentation.
bamvor@linux-bvirt:libxml2-2.7.6> libtoolize --automake --force
bamvor@linux-bvirt:libxml2-2.7.6> automake --force --add-missing

not work. 

2), http://blog.csdn.net/bluephper/article/details/5642421
delete the following line:
$RM "$cfgfile"

configure pass.

2, it is hard to compile libvirt with the bad network. 
try to use the ibs or obs.
1), 这个好像是自己搭建obs的，对我来说没什么用。
安装 OBS (openSUSE Build Service) 
http://jianlee.ylinux.org/Computer/%E6%9C%8D%E5%8A%A1%E5%99%A8/obs_install.html
2), build service client
http://en.opensuse.org/openSUSE:Build_Service_Clients
Build Service Clients
The architecture based on a REST API allows to write different clients easily. That gives us the chance to address the needs of users with different experience. The clients can put different emphases on different usecases.
Web Client
The Web-based client for the openSUSE Build Service provides easy access to the Build Service.
Command Line Clients
The OSC commandline client gives access to most functions of the Build Service. It is the recommended tool for the daily packaging work.
The build service REST API can also be directly used with your tools, or for example with curl. The API is documented in the OBS source and at https://api.opensuse.org/apidocs/ (same credentials as for logging in to https://build.opensuse.org). You can also use OSC with the -d option to see the API requests issued for a given osc command. 
Desktop Rich Clients
There has been a Google Summer of Code project that started to implement a KDE Rich Client (discontinued).

3, osc
1), osc co home:bjzhang
server returned an error: http error 401: authorization required
2), correct the passwd
bamvor@linux-bvirt:osc> osc co home:bjzhang
Server returned an error: HTTP Error 400: Bad Request
Error getting meta for project 'osc' package 'home:bjzhang'
invalid package name 'home:bjzhang'

4, obs tutorial
1), http://en.opensuse.org/openSUSE:Build_Service_Tutorial 
2), http://linuxtoy.org/archives/learn-obs-with-marguerite-1.html

17:07 2012-04-01
suse, virtualization, libvirt, qemu, xen, libvirt libxl driver, write a API, domainOpenConsole, read code
1, qemu
global lock
get domain by uuid
get console chr from dev_name
if (virFDStreamOpenFile(st, chr->source.data.file.path,
		    0, 0, O_RDWR) < 0)

2, libxl
1), copy function from qemu to libxl
2), 
2, libxl
1), copy function from qemu to libxl
2), driver
    struct qemud_driver *driver = dom->conn->privateData;
    libxlDriverPrivatePtr driver = dom->conn->privateData;
3), driver lock
    qemuDriverLock(driver);
    qemuDriverUnlock(driver);
    libxlDriverLock(driver);
    libxlDriverUnlock(driver);
4), pirnt
    qemuReportError(VIR_ERR_NO_DOMAIN,
        _("no domain with matching uuid '%s'"), uuidstr);
    libxlError(VIR_ERR_NO_DOMAIN,
        _("Invalid parameter '%s'"), uuidstr);

11:46 2012-04-05
GTD
0, 10:25

1, today
1), network setting. 
2), mail. see"11:47 2012-04-05", "12:01 2012-04-05".

11:47 2012-04-05
company, fiscal year; english
1, "Jeff Hawn <jeff.hawn@attachmate.com>"email"	Welcome to Fiscal Year 2013"_20120405_0156
All,
Just a short note to welcome everyone to our new Fiscal Year 2013.  Over the coming days and weeks, there will be a series of communications on our Fiscal Year 2012 results and go-forward plans for our new fiscal year.
Later this week, you will be hearing from Bob, Jay, and Nils on BU sales results for the quarter and fiscal year.  And in a couple of weeks, once Charles and the Finance team have completed a full accounting of our results, I will communicate our overall results and the bonus payment percentages for the year.  So yes, while we have not yet determined the percentage amount, The Attachmate Group had a sufficiently strong finish to the year that we have exceeded the financial thresholds that trigger bonus payments.  This is the 8th consecutive year that we have achieved financial results sufficient to pay bonuses (every year since the original 2004 acquisition and mergers).  We should all take great pride in that fact.  Stay tuned for details on our Fiscal Year 2013 objectives, which we will be unveiling at our Sales Kickoffs in late-April.
Our fiscal year 2012 was certainly a year of change for The Attachmate Group.  While this change has certainly been positive for our company and our customers, it brought many new challenges to all of us.  Let me thank you for your relentless focus on meeting these challenges, overcoming them, and not ever losing sight of our main objective:  taking care of our customers.  That focus has led to the company's success, the fruits of which we look forward to sharing with each of you in the coming weeks.

Thanks,
Jeff

2, English study
1), fiscal
http://dict.bing.com.cn/?FORM=BNGCN#fiscal
fiscal US: [ˈfɪsk(ə)l] 
adj.
1.  relating to money and financial matters, especially taxes
2.  relating to how an organization plans to spend money during a particular period
n.
1.  in some countries, a public prosecutor(=lawyer for the government)
2), fiscal year
n.
1.  a period of twelve months that a business uses to calculate how much profit it has made and how much tax it owes

12:01 2012-04-05
company, network, email, imap 
1, "Marcus Rueckert <mrueckert@suse.de>"email"[Research] Certificate exchange on imap.suse.de"_20120405_0110
imap.suse.de has a new certificate for imaps, pop3s and https:
The fingerprint of the new certificate is:

Signed with security@suse.de key:
pub   2048R/3D25D3D9 1999-03-06
uid                  SuSE Security Team

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

SHA1 Fingerprint=38:0A:8B:21:73:2B:72:1B:94:97:B0:E2:4D:CC:DE:3C:FC:CF:03:E9
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.12 (GNU/Linux)

iQEVAwUBT3x+aney5gA9JdPZAQLeagf/fevfrgGnwwLwJleXaQs0wUDP6pxFh3aA
Z+ezwDIyyg49DW5qTIAcmKm0Ml13nKLnI8bjfolxjzhl8rxz3yPzGlf4K+ruAZ98
4PB8dM80CLJkJxZK5ZdpZLGcFsTQr/rkefMc+1U2J/TU0yh/oWgTInhkGlvyHBIt
AtEAG7CA2MDQ2kN3K9XgoY2qiaglZrwJF2PBMf2YNlSalLQW9KUjxsatAWMGSvDi
7k+sFvU1NxCSFC0bMj5GqiPS1CCuUSOAJVgyT27ry7H33h4eCzHnN0V3H3jofN9X
akGrfBxuEiA0U1Rac4j/ZS/ejsb00jARnrplk1MJ+CR+oMYdGniaHA==
=nxqx
-----END PGP SIGNATURE-----


Please follow the documentation from the getting started guide on:
   http://ca.nue.suse.com/gettingstarted/
and ping us via rd-adm@suse.de in case of problems.

With kind regards,

   Your OPS Services Team

-- 
         openSUSE - SUSE Linux is my linux
             openSUSE is good for you
                 www.opensuse.org

12:27 2012-04-05
company, openSUSE, OBS
"Jos Poortvliet <jos@opensuse.org>"email"[opensuse-project] Open Build Service Brings Website Integration"_20120404_0959

12:29 2012-04-05
GSoC, rating
1, "Vincent Untz"email"Re: [gsoc-mentors] Handling students & proposals"
Hey,

Le mercredi 28 mars 2012, à 08:22 +0200, Matt Barringer a écrit :
> But the discussion I'd like to open up is - how should we decide
> what rating to assign to a proposal?  Google deliberately leaves it
> up to each organization, so to have some consistancy in how we
> handle it, I would suggest this to start with:
>
> * Mentors should post a private comment for each proposal their
> project gets.  Just write a bit about what you think of the proposal
> and the student.  This helps other mentors rate the proposal, and
> will also help me send out the "sorry you weren't accepted" mails to
> rejected students.
>
> * Mentors should try to rate as many proposals as possible.  0 stars
> means "no opinion" and doesn't count as a for or against vote.
>
> * When considering a proposal, think about how well it would answer
> a few questions:
>   - Would this project be good for openSUSE?
>   - Would this project be good for open source in general?
>     - For example, the fdisk redesign isn't openSUSE-specific, but would
>       be beneficial to other open source platforms
>   - Does the student seem like they're just in it for the money?
>
> * Make good use of the commenting system.  If you don't see the
> merits in a project or proposal or student, leave a private comment
> so we can at least be transparent amongst ourselves.  Likewise,
> public comments should be used to help a promising student improve
> or clarify their proposal.
>
> So what are your thoughts?  I don't want to make this too
> bureaucratic or time consuming, but at the same time, we all have a
> responsibility to get the best students for the best projects as a
> group.

For reference, in GNOME, we'll use these meanings for the ratings:

5 = rockstar proposal, the student is very experienced and will excel
4 = strong proposal, the student will do a good job
3 = reasonable proposal, but the student is somewhat inexperienced
2 = marginal proposal, the student is unlikely to do a good job
1 = poor proposal, the student is not a good candidate

I see that some other org suggested this (in the GSoC list):

5 = high quality. A sure thing, depending on competition and resources
4 = good quality. A solid application, definitely in the running.
3 = low quality. Acceptable, but very low priority. Needs work.
2 = unacceptable as is. It would need a lot of additional work to be considered.
1 = spam or equivalent. Don't even bother reading it.
0 = no one has read this application. If you have time and the topic is relevant to you, be the first!

This is similar. I think we should adopt something similar.

Cheers,

Vincent

-- 
Les gens heureux ne sont pas pressés.

12:32 2012-04-05
company, IRC server
1, "Marcus Rückert<mrueckert@suse.de>"email"[Research] IRC server changes"_20120403_0801
The DNS entry for irc.suse.de is already moved to the new machine. We would appreciate if you can reconnect your clients, this should move you to new server.

15:41 2012-04-05
GSOC
1, "Ashish Agarwal <ashish.a77777@gmail.com>"email_20120401_0537
Dear sir,

I was working on the proposal for the project and I have some questions. I found the link to the list of To Do features on the wiki -  http://wiki.libvirt.org/page/Todo  and it has a comprehensive list of items that need to be completed. In the proposal, should I concentrate only on the libxl driver or on everything ? Also is there a link which describes the work that needs to be done on the libxl driver, so that I can understand the project a little better and also write a good proposal ?

Thank you,

Ashish

2, reply
Hi, Ashish

I was on vacation in recent days. 

> I was working on the proposal for the project and I have some questions. 
Great. looking forward your application. 
> I found the link to the list of To Do features on the wiki -  
> http://wiki.libvirt.org/page/Todo  and it has a comprehensive list of items 
> that need to be completed. In the proposal, should I concentrate only on the 
> libxl driver or on everything ? 
As u saw in libvirt TODO, there are lots of work. Even if concentrace on the whole libxl driver.
> Also is there a link which describes the work that needs to be done on the 
> slibxl driver, so that I can understand the project a little better and also 
> write a good proposal ?
Unfounately, there isn't. 

I am online from UTC2 to UTC11. we can have a talk tommorrow if u need. 

best wishes
bamvor

8:29 2012-4-6
company, virtualization, suse, xen, regular meeting: US / China Virtualization Sync, meeting
0, jiaju attend this meeting today. 

1, cobe
qemu

2, bo yang
kvm network. 

11:18 2012-04-06
suse, virtualization, domainOpenConsole
1, compile and test it on openSUSE12.1
1), 
linux-bhi8:/etc/xen/vm # virsh version
WARNING: no socket to connect to
Compiled against library: libvir 0.9.6
Using library: libvir 0.9.6
Using API: Xen 0.9.6
Running hypervisor: Xen 4.1.0

16:44 2012-04-06
suse, build service, obs
1, try obs
1), obs co
(1), fail
bamvor@linux-bvirt:osc> osc -d --verbose co home:bjzhang
makeurl: https://api.opensuse.org ['source', 'osc', 'home:bjzhang', '_meta'] {}
GET https://api.opensuse.org/source/osc/home:bjzhang/_meta
Server returned an error: HTTP Error 400: Bad Request
Error getting meta for project 'osc' package 'home:bjzhang'
Date: Fri, 06 Apr 2012 08:40:03 GMT
Server: Apache/2.2.12 (Linux/SUSE)
X-Powered-By: Phusion Passenger (mod_rails/mod_rack) 3.0.8
X-Opensuse-Errorcode: invalid_package_name
X-Opensuse-APIVersion: 2.3.0.git201203301545
X-Runtime: 7
Cache-Control: no-cache
Content-Length: 165
Status: 400
Content-Type: application/xml; charset=utf-8
Connection: close

<?xml version="1.0" encoding="UTF-8"?>
<status code="invalid_package_name">
  <summary>invalid package name 'home:bjzhang'</summary>
  <details></details>
</status>

invalid package name 'home:bjzhang'

(2), successful after add package name(libvirt_sp2)
bamvor@linux-bvirt:osc> osc -d --verbose co home:bjzhang libvirt_sp2
makeurl: https://api.opensuse.org ['source', 'home:bjzhang', 'libvirt_sp2', '_meta'] {}
GET https://api.opensuse.org/source/home:bjzhang/libvirt_sp2/_meta
makeurl: https://api.opensuse.org ['source', 'home:bjzhang', 'libvirt_sp2'] {'rev': 'latest'}
GET https://api.opensuse.org/source/home:bjzhang/libvirt_sp2?rev=latest
A    home:bjzhang
makeurl: https://api.opensuse.org ['source', 'home:bjzhang'] {}
GET https://api.opensuse.org/source/home:bjzhang
A    home:bjzhang/libvirt_sp2
makeurl: https://api.opensuse.org ['source', 'home:bjzhang'] {}
GET https://api.opensuse.org/source/home:bjzhang
makeurl: https://api.opensuse.org ['source', 'home:bjzhang', 'libvirt_sp2'] {'rev': 'latest'}
GET https://api.opensuse.org/source/home:bjzhang/libvirt_sp2?rev=latest
makeurl: https://api.opensuse.org ['source', 'home:bjzhang', 'libvirt_sp2', 'libxl_driver.c'] {'rev': '10'}
GET https://api.opensuse.org/source/home:bjzhang/libvirt_sp2/libxl_driver.c?rev=10
A    home:bjzhang/libvirt_sp2/libxl_driver.c
makeurl: https://api.opensuse.org ['source', 'home:bjzhang', 'libvirt_sp2', '_meta'] {}
GET https://api.opensuse.org/source/home:bjzhang/libvirt_sp2/_meta
At revision 10.

2), 

16:27 2012-4-7
suse, openSUSE12.1 x64, xen, libvirt, try domainOpenConsole
1, virsh version fail on openSUSE12.1 x64(vmware)
localhost:/home/bamvor # virsh version
error: Failed to reconnect to the hypervisor
error: no valid connection
error: internal error libxenlight state driver is not active
2, but after compile the libvirt souce(install by zypper si libvirt), it works right. I do not know why.
3, fail while domainOpenConsole
localhost:/home/bamvor # virsh version
Compiled against library: libvir 0.9.6
Using library: libvir 0.9.6
Using API: xenlight 0.9.6
Running hypervisor: xenlight 4.1.0

localhost:/home/bamvor # virsh console 2
Connected to domain opensuse_12_1_pv_1
Escape character is ^]
error: internal error cannot find character device (null)
1), dev_name is null, why?

13:54 2012-4-8
suse, openSUSE12.1 x64, xen, libvirt, try domainOpenConsole, cont1, try qemu domainOpenConsole
1, virsh connect to qemu hypervisor
ref: http://bbs.xmws.cn/thread-1342-1-1.html
1), virsh -c qemu:///system
localhost:/home/bamvor # virsh -c qemu:///system
Welcome to virsh, the virtualization interactive terminal.

Type:  'help' for help with commands
       'quit' to quit

virsh # list
 Id Name                 State
----------------------------------

virsh # version
Compiled against library: libvir 0.9.6
Using library: libvir 0.9.6
Using API: QEMU 0.9.6
error: failed to get the hypervisor version
error: internal error Cannot find suitable emulator for x86_64

2), this error is raised by "qemuCapsExtractVersion".
it is ok after restart libvirtd by "rclibvirtd restart"
localhost:/home/bamvor # rclibvirtd restart
redirecting to systemctl
localhost:/home/bamvor # virsh -c qemu:///system
Welcome to virsh, the virtualization interactive terminal.

Type:  'help' for help with commands
       'quit' to quit

virsh # version
Compiled against library: libvir 0.9.6
Using library: libvir 0.9.6
Using API: QEMU 0.9.6
Running hypervisor: QEMU 0.14.1

2, try to create qemu emulator
1), run qemu standalone
(1), downloads testsuite from "http://wiki.qemu.org/Testing". 
ref command: http://blog.csdn.net/woshixingaaa/article/details/7339114
(2), 

2:52 2012-4-9
(14:57 2012-04-12)
company, package, network, maintainer, wireshark, bridge-utils
1, Chun Yan Liu  (2012-3-27 11:01:24): And when you have time, could you access pdb.suse.de, and add you to the maintainer of wireshark package? Thanks! (That will send email to you whenever there is a bug about wireshark.)
2, bridge-utils is maintained by lidongyang@novell.com

14:07 2012-04-09
sles11 sp2, xen, libvirt, source
1, zypper si libvirt
libxml2-devel is not provided. 
after install:
There are some running programs that use files deleted by recent upgrade. You may wish to restart some of them. Run 'zypper ps' to list these programs.

2, linux-bvirt:/home/bamvor # zypper ps
The following running processes use deleted files:

PID  | PPID | UID | Login | Command            | Service | Files
-----+------+-----+-------+--------------------+---------+-----------------------------------
3542 | 1    | 0   | root  | sshd               | sshd    | /lib64/libaudit.so.0.0.0
3567 | 1    | 0   | root  | xenstored          |         | /usr/sbin/xenstored (deleted)
     |      |     |       |                    |         | /usr/lib64/libxenctrl.so.4.2.0
3574 | 1    | 0   | root  | xenconsoled        |         | /usr/sbin/xenconsoled (deleted)
     |      |     |       |                    |         | /usr/lib64/libxenctrl.so.4.2.0
     |      |     |       |                    |         | /usr/lib64/libxenstore.so.3.0.0
3596 | 1    | 0   | root  | blktapctrl         |         | /usr/lib64/libblktap.so.3.0.0
     |      |     |       |                    |         | /usr/lib64/libxenctrl.so.4.2.0
     |      |     |       |                    |         | /usr/sbin/blktapctrl (deleted)
     |      |     |       |                    |         | /usr/lib64/libxenstore.so.3.0.0
3677 | 1    | 0   | root  | cupsd              | cups    | /lib64/libaudit.so.0.0.0
3813 | 3795 | 0   | root  | gdm-simple-slave   |         | /lib64/libaudit.so.0.0.0
3829 | 1    | 0   | root  | cron               | cron    | /lib64/libaudit.so.0.0.0
4424 | 3813 | 0   | root  | gdm-session-worker |         | /lib64/libaudit.so.0.0.0
4685 | 4678 | 0   | root  | su                 |         | /lib64/libaudit.so.0.0.0
4754 | 4748 | 0   | root  | su                 |         | /lib64/libaudit.so.0.0.0
4803 | 1    | 0   | root  | qemu-dm            |         | /usr/lib64/libblktap.so.3.0.0
     |      |     |       |                    |         | /lib64/libpci.so.3.0.1
     |      |     |       |                    |         | /usr/lib64/libxenctrl.so.4.2.0
     |      |     |       |                    |         | /usr/lib64/libxenguest.so.4.2.0
     |      |     |       |                    |         | /usr/lib64/libxenstore.so.3.0.0
     |      |     |       |                    |         | /usr/lib/xen/bin/qemu-dm (deleted)
5151 | 5143 | 0   | root  | su                 |         | /lib64/libaudit.so.0.0.0

You may wish to restart these processes.
See 'man zypper' for information about the meaning of values in the above table.

3, try to install libxml2 srcpackage
zypper si libxml2
Problem: nothing provides zlib-devel needed by libxml2-2.7.6-0.13.1.src

4, try to install zlib-devel, but zlib-devel is not found. 
enable repos(sles11 sp2 x86_64, sle 11 sp2 x86_64 sdk_dvd1) in 147.2.207.240. 
"zypper si libvirt" successful.

14:27 2012-04-09
GTD
0, -20:40

1, today
1), fix my physical machine registration, see"13:38 2012-03-16"5. 

19:19 2012-04-09
suse, virtualization, libvirt, qemu, xen, libvirt libxl driver, write a API, domainOpenConsole, cont1, debug
1, debug virsh and libvirtd
1), when call the virDomainOpenConsole
(1), relative function 
(gdb) break virStreamNew
Breakpoint 6 at 0x7fd545992620
(gdb) break virDomainOpenConsole
Breakpoint 7 at 0x7fd545995bd0
(gdb) break virEventAddHandle
Breakpoint 8 at 0x7fd545913fa0
these functions in the libvirt.so: 
Breakpoint 6, 0x00007fd545992620 in virStreamNew () from /usr/lib64/libvirt.so.0
(gdb) n
Single stepping until exit from function virStreamNew,
which has no line number information.
vshRunConsole (dom=0x763ae0, dev_name=0x0) at console.c:331
(gdb) s

Breakpoint 7, 0x00007fd545995bd0 in virDomainOpenConsole () from /usr/lib64/libvirt.so.0

2), dev_name is null while call virRunConsole. 

(gdb) p *def->console
$8 = {deviceType = 2, targetType = 1, target = {port = 0, addr = 0x0, 
    name = 0x0}, source = {type = 2, data = {file = {
        path = 0x759c40 "/dev/pts/2"}, tcp = {host = 0x759c40 "/dev/pts/2", 
        service = 0x0, listen = false, protocol = 0}, udp = {
        bindHost = 0x759c40 "/dev/pts/2", bindService = 0x0, 
        connectHost = 0x0, connectService = 0x0}, nix = {
        path = 0x759c40 "/dev/pts/2", listen = false}, spicevmc = 7707712}}, 
  info = {alias = 0x0, type = 0, addr = {pci = {domain = 0, bus = 0, slot = 0, 
        function = 0}, drive = {controller = 0, bus = 0, unit = 0}, 
      vioserial = {controller = 0, bus = 0, port = 0}, ccid = {controller = 0, 
        slot = 0}, usb = {bus = 0, port = 0x0}}, mastertype = 0, master = {
      usb = {startport = 0}}}}

3, xenlight
(gdb) p *conn
$1 = {magic = 1327750829, flags = 0, uri = 0x6a3db0, driver = 0x7f7906d7a980, networkDriver = 0x7f7906d7ade0, interfaceDriver = 0x7f7906d7ae80, 
  storageDriver = 0x7f7906d7af20, deviceMonitor = 0x7f7906d7b060, secretDriver = 0x7f7906d7b0c0, nwfilterDriver = 0x7f7906d7b120, privateData = 0x6a4450, 
  networkPrivateData = 0x6a4450, interfacePrivateData = 0x6a4450, storagePrivateData = 0x6a4450, devMonPrivateData = 0x6a4450, secretPrivateData = 0x6a4450, 
  nwfilterPrivateData = 0x6a4450, lock = {lock = {__data = {__lock = 0, __count = 0, __owner = 0, __nusers = 0, __kind = 0, __spins = 0, __list = {
          __prev = 0x0, __next = 0x0}}, __size = '\000' <repeats 39 times>, __align = 0}}, err = {code = 0, domain = 0, message = 0x0, level = VIR_ERR_NONE, 
    conn = 0x0, dom = 0x0, str1 = 0x0, str2 = 0x0, str3 = 0x0, int1 = 0, int2 = 0, net = 0x0}, handler = 0, userData = 0x0, refs = 3}

driver name is remote: 
name = 0x7f7906b195af "remote"
why? 

14:46 2012-04-10
GTD
1, today
1), work report, see"14:46 2012-04-10". 
2), libxlDomainOpenConsole, see"15:02 2012-04-10"

14:46 2012-04-10
work report - week 14
1, bamvor jian zhang work report
[devel-server] work report - week 14
[green]
continue studing libvirt libxl driver: add libxlDomainOpenConsole into libivirt libxl driver, compile pass but test fail. 
Listen to engineering all-hands replay.
(Apr 2 - Apr 4 were public holidays in China.)

15:02 2012-04-10
suse, virtualization, libvirt, qemu, xen, libvirt libxl driver, write a API, domainOpenConsole, cont2, continue debugging, remote
1, read code about remote.
1), install kvm in openSUSE12_1. print trace while domainOpenConsole
2), virt-install
linux-bvirt:/home/bamvor # virt-install --connect=qemu:///system  -n qemu_test -r 512 -f Downloads/linux-0.2.img --virt-type=qemu --boot hd
WARNING  KVM acceleration not available, using 'qemu'

Starting install...
ERROR    internal error Unknown failure during hook execution
Domain installation does not appear to have been successful.
If it was, you can restart your domain by running:
  virsh --connect qemu:///system start qemu_test
otherwise, please restart your installation.

2, libvirt qemu remote connection failed:
1), ssh login to linux-bhi8 from linux-bvirt. 
2), virsh list
linux-bhi8:/home/bamvor # virsh list
WARNING: no socket to connect to
 Id Name                 State
----------------------------------
3), but if i direct using "virsh list" on linux-bhi8, it is successful. 

3, install qemu vm by vm-install
fail install opensuse12.1 x86_64, it looks like missing net driver in initrd. 

14:28 2012-04-11
GTD
1, today
1), 20' help guangliang zhao for network configuration and qemu-kvm vm install. 
2), 14:25-14:47 libvirt doc reading. see"14:31 2012-04-11"
3), 30' read libvirt source code. see"15:25 2012-04-11"
4), system font setting. see"16:04 2012-04-11".

14:29 2012-04-11
suse, virtualization, libvirt, qemu, xen, libvirt driver, read document
1, libvirt qemu driver
http://libvirt.org/drvqemu.html
1), qemu and libivrt config convert
The virsh domxml-from-native provides a way to convert an existing set of QEMU args into a guest description using libvirt Domain XML that can then be used by libvirt.
The virsh domxml-to-native provides a way to convert a guest description using libvirt Domain XML, into a set of QEMU args that can be run manually. 
2), Pass-through of arbitrary qemu commands
The library provides two API: virDomainQemuMonitorCommand, for sending an arbitrary monitor command (in either HMP or QMP format) to a qemu guest (Since 0.8.3), and virDomainQemuAttach, for registering a qemu domain that was manually started so that it can then be managed by libvirtd (Since 0.9.4). 
2, libvirt tools
http://libvirt.org/apps.html
1), virt-top
like xen top, using campl, i cannot compile it on sles11 sp2. \TODO: try it later. 

15:25 2012-04-11
suse, virtualization, libvirt, qemu, xen, read source code
1, libvirtd
daemonStateInit create pthread daemonRunStateInit. 
virsh also create pthead while cmdMigrate. 
2, thread
1), list all libvirtd thread
bamvor@linux-bvirt:~> ps aux -eL | grep libvirt
dnsmasq  14240 14240  0.0    1  0.0  12544   668 ?        S    Apr09   0:00 /usr/sbin/dnsmasq --strict-order --bind-interfaces --pid-file=/var/run/libvirt/network/default.pid --conf-file= --except-interface lo --listen-address 192.168.122.1 --dhcp-range 192.168.122.2,192.168.122.254 --dhcp-leasefile=/var/lib/libvirt/dnsmasq/default.leases --dhcp-lease-max=253 --dhcp-no-override
root     16745 16745  0.0   13  0.1 339252 21776 ?        SLl  Apr09   0:01 /usr/sbin/libvirtd -d -l
root     16745 16746  0.0   13  0.1 339252 21776 ?        SLl  Apr09   0:08 /usr/sbin/libvirtd -d -l
root     16745 16747  0.0   13  0.1 339252 21776 ?        SLl  Apr09   0:08 /usr/sbin/libvirtd -d -l
root     16745 16748  0.0   13  0.1 339252 21776 ?        SLl  Apr09   0:00 /usr/sbin/libvirtd -d -l
root     16745 16749  0.0   13  0.1 339252 21776 ?        SLl  Apr09   0:00 /usr/sbin/libvirtd -d -l
root     16745 16750  0.0   13  0.1 339252 21776 ?        SLl  Apr09   0:00 /usr/sbin/libvirtd -d -l
root     16745 16751  0.0   13  0.1 339252 21776 ?        SLl  Apr09   0:00 /usr/sbin/libvirtd -d -l
root     16745 16752  0.0   13  0.1 339252 21776 ?        SLl  Apr09   0:00 /usr/sbin/libvirtd -d -l
root     16745 16753  0.0   13  0.1 339252 21776 ?        SLl  Apr09   0:00 /usr/sbin/libvirtd -d -l
root     16745 16754  0.0   13  0.1 339252 21776 ?        SLl  Apr09   0:00 /usr/sbin/libvirtd -d -l
root     16745 16755  0.0   13  0.1 339252 21776 ?        SLl  Apr09   0:00 /usr/sbin/libvirtd -d -l
root     16745 23534  0.0   13  0.1 339252 21776 ?        SLl  Apr10   0:00 /usr/sbin/libvirtd -d -l
root     16745 25775  0.0   13  0.1 339252 21776 ?        SLl  Apr10   0:00 /usr/sbin/libvirtd -d -l
2), bamvor@linux-bvirt:~> ps aux -eL | grep xen
root        39    39  0.0    1  0.0      0     0 ?        S    Apr09   0:00 [xenwatch]
root        40    40  0.0    1  0.0      0     0 ?        S    Apr09   0:00 [xenbus]
root      3567  3567  0.0    1  0.0  10624  1132 ?        SL   Apr09   0:02 xenstored --pid-file=/var/run/xenstored.pid
root      3574  3574  0.0    2  0.0  98796  1036 ?        SLl  Apr09   0:00 xenconsoled --pid-file=/var/run/xenconsoled.pid
root      3574  3576  0.0    2  0.0  98796  1036 ?        SLl  Apr09   0:00 xenconsoled --pid-file=/var/run/xenconsoled.pid
root     25755 25755  0.1    2  0.0  82432  7340 ?        Ssl  Apr10   2:32 qemu-dm -d 9 -domain-name sles11_pv_6 -vnc 127.0.0.1:2 -M xenpv
root     25755 25759  0.0    2  0.0  82432  7340 ?        Ssl  Apr10   0:00 qemu-dm -d 9 -domain-name sles11_pv_6 -vnc 127.0.0.1:2 -M xenpv

16:12 2012-04-11
maillist, devel-server, work report
1, Danny Kukawka
 SUSE LINUX Products GmbH
  Maxfeldstrasse 5, D-90409 Nuremberg, Germany
  GF: Jeff Hawn,Jennifer Guild,Felix Imendörffer,HRB16746 (AG Nürnberg)
1), filesystem, ceph developer. 
2, Holger Macht <hmacht@suse.de>
filesystem: ceph/RADOS
3, Tim Serong <tserong@suse.com>
OpenStack

16:04 2012-04-11
software, skill, linux, font, wenquanyi(文泉驿); how to install fonts on Linux
1, font
http://www.deepin.org/thread-1895281-1-1.html
http://e-pup.5d6d.com/thread-1153-1-1.html
2, wenquanyi
1), ref
http://wenq.org/index.cgi?ZenHei
http://wenq.org/forum/index.php?sid=d170fa022dd345efb0e6e4049b68b068
2), install
3.1 Installation for all users
First, extract the font files with
   tar zxvf wqy-microhei*.tar.gz
Then, change to root user, move the extracted folder, "wqy-microhei" 
under /usr/share/fonts/wenquanyi/ (If this dir does not exist, use 
mkdir -p /usr/share/fonts/wenquanyi/ to create it first.)

Then edit /etc/X11/xorg.conf or /etc/X11/XF86Config-4
and find the section with FontPath. Append 
   FontPath /usr/share/fonts/wenquanyi/wqy-microhei
under any of the FontPath line, save this file.

Then, if your system has /etc/fonts/fonts.conf, edit
it and append 
  <dir>/usr/share/fonts/wenquanyi/wqy-microhei/</dir>
before </fontconfig>
Restart X server and you should be able to use this font.

3, after install wenquanyi ZenHei, select it in groupwise mail client. it is beautiful, but it is not clear about bold and non-bold. 
try other wenquanyi fonts. 
using wenquanyi microhei or microhei light got the same result. 
after i change the system font as wenquanyi micro hei light, except window title font as WenQuanYi Micro Hei Mono Bold. The look and feel in groupwise mailbox client is good. 
notes: system font can be changed in the gnome-appearance-properties(in gnome-2.28.2). 
or gnome-tweak-tool in gnome-3.2.1

4, (11:43 2012-04-18)
notes: there is no /etc/X11/xorg.conf. maybe add to /etc/X11/fs/config is usefull, I am not suse. because there is font dir in the "/etc/fonts/fonts.conf":
<dir>/usr/share/fonts</dir>

bamvor@linux-bhi8:fs> pwd
/etc/X11/fs
bamvor@linux-bhi8:fs> diff config config.orig
65,66c65
<           /usr/share/fonts/hellas/Type1,
<           /usr/share/fonts/wenquanyi/wqy-microhei
---
>           /usr/share/fonts/hellas/Type1

10:45 2012-04-12
GTD
1, today
1), mail, read today email. see"10:46 2012-04-12".
2), GSoC: register with bjzhang@suse.com
3), change the maintainer of wireshark and bridge-utils. see"2:52 2012-4-9"
4), 15:00-19:31 read libvirt source code. see"15:00 2012-04-12"


10:46 2012-04-12
maillist, sales and marketing
1, SM
"Sen Ming Chang"mail"转发： Thanks for a Great Q5"_20120412_0130_from"Peter Man"_20120410_1814
SM talk about the total revenue in Q5. 
Peter's mail:
Hi All, 
After all final adjustments, I am please to announce that Greater South China (Hong Kong, Macau and South China) delivered an impressive result of USD 3.389M of total revenue in Q5 of 2012 (HK: 2.243M, SC: 1.146M).  It is 116% against our budgets and both Hong Kong and South China over-achieved on their respectively budgets as well.  Thank you very much for everyone's contribution. 
I would like to point out one thing that, when I review forecast this two weeks for Q1, I realized that South China is doing better every quarter.  This is the results of all the hard work and leadership of Stanley and the passion and energy he brought to the team.  And I look forward to see South China and Hong Kong to contribute similar share of revenues for Greater South China in FY13. 
I know it's tough work we are doing here everyday.  I will fight for the best of interests for everyone here to make our time spent paid off. 
Peter 

15:00 2012-04-12
suse, virtualization, libvirt, qemu, xen, read source code, cont1, read remote relative code.
1, read virsh and libvirt.so code, ref libvirtd log 
1), dmidecode(need root to run it)
(1), dmidecode  is  a  tool for dumping a computer's DMI (some say SMBIOS) table contents in a human-readable format. This table contains a description of the system's hardware components, as well as other useful pieces of information such as serial numbers and BIOS revision. Thanks to this table, you can retrieve this information without having to probe for the actual hardware.  While this is a good point in terms of report speed and safeness, this also makes the presented information possibly unreliable.
(2), some of system infomation printed into libvirtd is generated this dmidecode. 
2, libxl will be disable while xend is running 
libxlStartup()(src/libxl/libxl_driver.c):
    /* Disable driver if legacy xen toolstack (xend) is in use */
    cmd = virCommandNewArgList("/usr/sbin/xend", "status", NULL);
    if (virCommandRun(cmd, &status) == 0 && status == 0) {
        VIR_INFO("Legacy xen tool stack seems to be in use, disabling "
                  "libxenlight driver.");
        virCommandFree(cmd);
        return 0;
    }
    virCommandFree(cmd);

16:48 2012-04-12
oprofile
1, oprofile
1), ref
http://oprofile.sourceforge.net/doc/overview.html
Before you can use OProfile, you must set it up. The minimum setup required for this is to tell OProfile where the vmlinux file corresponding to the running kernel is, for example :
opcontrol --vmlinux=/boot/vmlinux-`uname -r`
If you don't want to profile the kernel itself, you can tell OProfile you don't have a vmlinux file :
opcontrol --no-vmlinux
2, try
1), 
linux-bvirt:/home/bamvor # opcontrol --init
linux-bvirt:/home/bamvor # opcontrol --dump
Unable to complete dump of oprofile data: is the oprofile daemon running?
2), run oprofiled
linux-bvirt:/home/bamvor # oprofiled 
oprofiled: no vmlinux specified.
linux-bvirt:/home/bamvor # oprofiled --no-vmlinux
oprofiled: no events specified.
linux-bvirt:/home/bamvor # oprofiled --no-vmlinux --events=default
oprofiled: malformed events passed on the command line
3), oprofiled is not started. run oprofile directly: 
linux-bvirt:/home/bamvor # opcontrol --dump
Unable to complete dump of oprofile data: is the oprofile daemon running?
linux-bvirt:/home/bamvor # opcontrol --start
Using default event: CPU_CLK_UNHALTED:100000:0:1:1
Using 2.6+ OProfile kernel interface.
Using log file /var/lib/oprofile/samples/oprofiled.log
Daemon started.
Profiler running.
linux-bvirt:/home/bamvor # virsh 
Welcome to virsh, the virtualization interactive terminal.

Type:  'help' for help with commands
       'quit' to quit

virsh # list
 Id Name                 State
----------------------------------

virsh # quit

linux-bvirt:/home/bamvor # opcontrol --stop
Stopping profiling.
linux-bvirt:/home/bamvor # opcontrol --shutdown
Killing daemon.
linux-bvirt:/home/bamvor # 

3, debug virsh
1), create
linux-bvirt:/etc/xen/vm # virsh
Welcome to virsh, the virtualization interactive terminal.

Type:  'help' for help with commands
       'quit' to quit

virsh # create sles11_pv_6.xml
(1), virsh and libvirt.so
communicate with libvirtd through "trans_unix"
(gdb) where
#0  doRemoteOpen (conn=0x6a4070, priv=0x6a3ca0, auth=0x7f704cd91100, flags=0)
    at remote/remote_driver.c:576
#1  0x00007f704ca057a4 in remoteOpen (conn=0x6a4070, auth=0x7f704cd91100, 
    flags=<optimized out>) at remote/remote_driver.c:828
#2  0x00007f704c9d285c in do_open (name=0x0, auth=0x7f704cd91100, flags=0)
    at libvirt.c:1072
#3  0x00007f704c9d3406 in virConnectOpenAuth (name=0x0, auth=0x7f704cd91100, 
    flags=0) at libvirt.c:1298
#4  0x000000000041a3a1 in vshReconnect (ctl=0x7fff68f89650) at virsh.c:607
#5  0x000000000041a5f8 in vshCommandRun (ctl=0x7fff68f89650, cmd=0x668e80)
    at virsh.c:14775
#6  0x00000000004274ec in main (argc=<optimized out>, argv=<optimized out>)
    at virsh.c:16243
(2), libvirtd
(gdb) where
#0  virEventPollRunOnce () at util/event_poll.c:595
#1  0x00007f83173b30a5 in virEventRunDefaultImpl () at util/event.c:247
#2  0x000000000044b61d in virNetServerRun (srv=0x79b7a0)
    at rpc/virnetserver.c:701
#3  0x0000000000423e52 in main (argc=<optimized out>, argv=<optimized out>)
    at libvirtd.c:1574
(3), stop at
(gdb) n
doRemoteOpen (conn=0x6a4070, priv=0x6a3ca0, auth=0x7f704cd91100, flags=0)
    at remote/remote_driver.c:636

  |648         VIR_DEBUG("Trying authentication");                            │
 >│649         if (remoteAuthenticate(conn, priv, auth, authtype) == -1)      │
  │650             goto failed;      

waiting for libvirtd: 
  │701             if (virEventRunDefaultImpl() < 0) {   

2), console
(1), 
(gdb) cont
Continuing.

Breakpoint 5, remoteDomainOpenConsole (dom=0x6a4010, dev_name=0x0, 
    st=0x6a4690, flags=0) at remote/remote_client_bodies.h:1419
(gdb) n
virDomainOpenConsole (dom=0x6a4010, dev_name=0x0, st=0x6a4690, flags=0)
    at libvirt.c:16355
vshRunConsole (dom=0x6a4010, dev_name=0x0) at console.c:361
cmdRunConsole (ctl=0x7fff68f89650, dom=0x6a4010, name=0x0) at virsh.c:816
cmdConsole (ctl=<optimized out>, cmd=0x66a7d0) at virsh.c:839
vshCommandRun (ctl=0x7fff68f89650, cmd=0x66a7d0) at virsh.c:14785
main (argc=<optimized out>, argv=<optimized out>) at virsh.c:16245
(2), libxlDomainOpenConsole(in libvirtd).
((1)), virsh
(gdb) where
#0  0x00007f70499bd4bf in poll () from /lib64/libc.so.6
#1  0x00007f704ca12fe7 in virNetClientIOEventLoop (client=0x7f704cdd4010, 
    thiscall=0x6a3e60) at rpc/virnetclient.c:899
#2  0x00007f704ca136ec in virNetClientIO (thiscall=<optimized out>, 
    client=<optimized out>) at rpc/virnetclient.c:1136
#3  virNetClientSend (client=0x7f704cdd4010, msg=0x742050, expectReply=true)
    at rpc/virnetclient.c:1218
#4  0x00007f704ca15056 in virNetClientProgramCall (prog=0x6a3ec0, 
    client=0x7f704cdd4010, serial=36, proc=201, 
    args_filter=0x7f704ca0fb20 <xdr_remote_domain_open_console_args>, 
    args=0x7fff68f89340, ret_filter=0x7f70499f1200 <xdr_void_internal>, 
    ret=0x0) at rpc/virnetclientprogram.c:291
#5  0x00007f704c9f39a7 in call (conn=<optimized out>, priv=0x6a3ca0, 
    flags=<optimized out>, proc_nr=201, 
    args_filter=0x7f704ca0fb20 <xdr_remote_domain_open_console_args>, 
    args=0x7fff68f89340 "\220\313f", 
    ret_filter=0x7f70499f1200 <xdr_void_internal>, ret=0x0)
    at remote/remote_driver.c:4122
#6  0x00007f704c9f8fb7 in remoteDomainOpenConsole (dom=0x6a4010, dev_name=0x0, 
    st=0x693c80, flags=0) at remote/remote_client_bodies.h:1441
#7  0x00007f704c9d4eb4 in virDomainOpenConsole (dom=0x6a4010, dev_name=0x0, 
    st=0x693c80, flags=0) at libvirt.c:16354
#8  0x000000000040a2e5 in vshRunConsole (dom=0x6a4010, dev_name=0x0)
    at console.c:334
#9  0x000000000041eab3 in cmdRunConsole (ctl=0x7fff68f89650, dom=0x6a4010, 
    name=0x0) at virsh.c:810
#10 0x000000000041ee7d in cmdConsole (ctl=0x7fff68f89650, cmd=0x668e80)
    at virsh.c:836
#11 0x000000000041a4f8 in vshCommandRun (ctl=0x7fff68f89650, cmd=0x668e80)
    at virsh.c:14780
#12 0x00000000004274ec in main (argc=<optimized out>, argv=<optimized out>)
    at virsh.c:16243

((2)), libvirtd
it is a thread created by libvirtd. 
#0  libxlDomainOpenConsole (dom=0x7dfac0, dev_name=0x0, st=0x7dfc40, flags=0)
    at libxl/libxl_driver.c:3883
#1  0x00007f8317443eb4 in virDomainOpenConsole (dom=0x7dfac0, dev_name=0x0, 
    st=0x7dfc40, flags=0) at libvirt.c:16354
#2  0x0000000000429633 in remoteDispatchDomainOpenConsole (
    args=<optimized out>, rerr=<optimized out>, hdr=<optimized out>, 
    client=<optimized out>, server=<optimized out>) at remote_dispatch.h:3394
#3  remoteDispatchDomainOpenConsoleHelper (server=<optimized out>, 
    client=0x7f8304000ba0, hdr=0x7f83040411f8, rerr=0x7f83102c4be0, 
    args=0x7dfc00, ret=<optimized out>) at remote_dispatch.h:3361
#4  0x0000000000448c6f in virNetServerProgramDispatchCall (
    msg=<optimized out>, client=<optimized out>, server=<optimized out>, 
    prog=<optimized out>) at rpc/virnetserverprogram.c:401
    msg=<optimized out>, client=<optimized out>, server=<optimized out>, 
    prog=<optimized out>) at rpc/virnetserverprogram.c:401
#5  virNetServerProgramDispatch (prog=0x79b160, server=0x79b7a0, 
    client=0x7f8304000ba0, msg=0x7f83040011e0) at rpc/virnetserverprogram.c:287
#6  0x000000000044c1ac in virNetServerHandleJob (jobOpaque=<optimized out>, 
    opaque=0x79b7a0) at rpc/virnetserver.c:136
#7  0x00007f83173cc1f6 in virThreadPoolWorker (opaque=<optimized out>)
    at util/threadpool.c:144
#8  0x00007f83173cb8a2 in virThreadHelper (data=0x4c4ad0)
    at util/threads-pthread.c:157
#9  0x00007f831378c7b6 in start_thread () from /lib64/libpthread.so.0
#10 0x00007f83132e49cd in clone () from /lib64/libc.so.6
#11 0x0000000000000000 in ?? ()

((3)), qemu fails either. 
according to the some article, i should configure console before using console command. 
http://ubuntuforums.org/showthread.php?t=1159220
https://www.redhat.com/archives/libvirt-users/2011-February/msg00006.html

11:10 2012-04-13
GTD
0, 11:05-18:43

1, today
2), read libvirt source code. see"16:24 2012-04-13".

11:24 2012-04-13
company, mail, suse, openstack, Platinum memter
1, "Nils Brauckmann"mail"SUSE Commits to Join OpenStack Foundation as a Platinum Member"
The creation of this foundation will ensure the long-term viability of the project, attract more contributors and nurture the philosophy of open collaboration that is essential to its success. As a Platinum member, SUSE will participate in drafting the foundation's by-laws and receive a seat on its board of directors.

11:27 2012-04-13
GSoC
1, "Vincent Untz"mail"[gsoc-mentors] Slot allocation"
Hey hey,
We're getting 12 slots this year.
So don't miss the meeting where we'll select the projects; it's next
Wednesday in #opensuse-soc at 12:00 UTC (14:00 CET).
Cheers,
Vincent
-- 
Les gens heureux ne sont pas pressés.
2, bamvor: CST 20:00

11:35 2012-04-13
maillist, mail, research@suse.de; software, skill, using semicolon display difference information at the same time, 
1, "Thomas Fehr <fehr@suse.de>"mail"Re: [Research] Storage minimum for SLES install"
1), On Thu, Apr 12, Thorsten Kukuk wrote:
> On Wed, Apr 11, Dirk Müller wrote:
> 
> > On Wednesday 11 April 2012, Thorsten Kukuk wrote:
> 
> > > But yes, the minimal installation needs about 750 MB.
> > 
> > According to YaST, the minimal installation needs 845.3MB (x86_64). In 
> > reality, after finishing installation, I have 38MB of disk space available. 
> > The good part is that it finishes installation successfully.
> 
> 850MB are the Base-System, not the Minimal System. The Minimal
> System according to YaST needs 490MB on x86-64. If you use reiserfs, 
> 750MB are more than enough, I had enough servers running in that
> configuration (but ok, with SP1...).
> With ext3: ext3 is really wasting disk space, but I don't know how
> much more it needs.

I installed minimal SLES11 SP2 in a 1Gig partition and this looks more
or less usable:

g212:~ # (df -h ; mount) | grep sda1
/dev/sda1       988M  620M  318M  67% /
/dev/sda1 on / type ext3 (rw,acl,user_xattr)

Tschuess, 
	Thomas Fehr
-- 
  Thomas Fehr, SuSE Linux Products GmbH, Maxfeldstr. 5, 90409 Nuernberg, Germany
  GF: Jeff Hawn, Jennifer Guild, Felix Imendörffer, HRB 16746 (AG Nürnberg)
  Tel: +49-911-74053-0,  Fax: +49-911-74053-482,  Email: fehr@suse.de
  GPG public key available.
2), bamvor, this is very useful listing the specific partition mount point and space. 
bamvor@linux-bvirt:~> (df -h ; mount) | grep "\/" -w 
/dev/sda7                                 301G   60G  231G  21% /
/dev/sda7 on / type btrfs (rw)

13:30 2012-04-13
GSoC
hi, Vincent

This is Bamvor Jian Zhang from SUSE Beijing office. 
i am confused about how to apply as mentor and rank the proprosal. 

I had add a idea "Upstream Xen Support for Libvirt" in the opensuse GSoC 2012 idea list in last month. and apply to be a mentor of opensuse in GSoC 2012 website. 
I also read the email from you and Matt. But i could not find weather i am mentor in opensuse GSoC 2012. and i do not know where can i read the proposal about my idea. 
I guess the reason is i am not the mentor in opensuse GSoC 2012. 
Could u give me a hand to help me how to be a mentor? 

thanks lot.

16:24 2012-04-13
suse, virtualization, libvirt, qemu, xen, read source code, cont1, read remote relative code, libxlDomainOpenConsole
1, continue
1), ref libvirt XML document add console in the sles11_pv_6.xml
      <console type='pty'>
        <source path='/dev/pts/6'/>
        <target port='0'/>
      </console>
2), but the path in the vm->def->console is null. 
(gdb) p *vm->def->console
$4 = {deviceType = 2, targetType = 1, target = {port = 0, addr = 0x0, 
    name = 0x0}, source = {type = 2, data = {file = {path = 0x0}, tcp = {
        host = 0x0, service = 0x0, listen = false, protocol = 0}, udp = {
        bindHost = 0x0, bindService = 0x0, connectHost = 0x0, 
        connectService = 0x0}, nix = {path = 0x0, listen = false}, 
      spicevmc = 0}}, info = {alias = 0x0, type = 0, addr = {pci = {
        domain = 0, bus = 0, slot = 0, function = 0}, drive = {controller = 0, 
        bus = 0, unit = 0}, vioserial = {controller = 0, bus = 0, port = 0}, 
      ccid = {controller = 0, slot = 0}, usb = {bus = 0, port = 0x0}}, 
    mastertype = 0, master = {usb = {startport = 0}}}}
2, test it in qemu

21:16 2012-4-14
suse, virtualization, libvirt, qemu, remote connection
1), qemu remote
(1), pass
virsh -c qemu+unix:///system?socket=/var/run/libvirt/libvirt-sock
(2), fail
linux-bvirt:~ # virsh -c qemu+unix://147.2.207.77/system?socket=/var/run/libvirt/libvirt-sock
error: invalid argument: using unix socket and remote server '147.2.207.77' is not supported.
error: failed to connect to the hypervisor

10:51 2012-04-15
suse, virtualization, libvirt, qemu, xen, read source code, cont1, read qemu/libxl console code
1, search qemu console relative code
1), qemuProcessFindCharDevicePTYs
(1), backtrace in virsh
#0  0x00007fe57cb583e8 in poll () from /lib64/libc.so.6
#1  0x00007fe57fe75635 in virNetClientIOEventLoop (client=0x7fe580241010,
    thiscall=0x65c920) at rpc/virnetclient.c:899
#2  0x00007fe57fe76da4 in virNetClientIO (thiscall=0x65c920,
    client=0x7fe580241010) at rpc/virnetclient.c:1136
#3  virNetClientSend (client=0x7fe580241010, msg=<optimized out>,
    expectReply=true) at rpc/virnetclient.c:1218
#4  0x00007fe57fe77675 in virNetClientProgramCall (prog=0x65ed20,
    client=0x7fe580241010, serial=3, proc=10,
    args_filter=0x7fe57fe6d440 <xdr_remote_domain_create_xml_args>,
    args=0x7fffdaab3c70,
    ret_filter=0x7fe57fe6d4b0 <xdr_remote_domain_create_xml_ret>,
    ret=0x7fffdaab3c80) at rpc/virnetclientprogram.c:291
#5  0x00007fe57fe58cc9 in call (priv=0x670830, flags=<optimized out>,
    proc_nr=10,
    args_filter=0x7fe57fe6d440 <xdr_remote_domain_create_xml_args>,
    args=<optimized out>, ret_filter=<optimized out>, ret=0x7fffdaab3c80 "",
    conn=<optimized out>) at remote/remote_driver.c:4122
#6  0x00007fe57fe65104 in remoteDomainCreateXML (conn=0x670710,
    xml_desc=<optimized out>, flags=<optimized out>)
    at remote/remote_client_bodies.h:328
#7  0x00007fe57fe2966d in virDomainCreateXML (conn=0x670710,
    xmlDesc=0x671e90 "<domain type='qemu'>\n  <name>opensuse12_qemu_9</name>\n
<uuid>55c53a6e-49f6-adea-6b3b-d162f3c80ab4</uuid>\n  <memory>524288</memory>\n
<currentMemory>524288</currentMemory>\n  <vcpu>1</vcpu>\n  <os>\n    "...,
    flags=0) at libvirt.c:1852
#8  0x000000000041beb1 in cmdCreate (ctl=0x7fffdaab3e00, cmd=0x6551e0)
    at virsh.c:1845
#9  0x000000000040d82c in vshCommandRun (ctl=0x7fffdaab3e00, cmd=0x6551e0)
    at virsh.c:14780
#10 0x000000000040aa91 in main (argc=<optimized out>, argv=0x7fffdaab4208)
    at virsh.c:16215
(2), backtrace in libvirtd
[Switching to Thread 0x7fbacfb1e700 (LWP 25772)]

Breakpoint 1, qemuProcessFindCharDevicePTYs (vm=0x7fbac40131d0,
    output=0x7fbab000b360 "", fd=20) at qemu/qemu_process.c:1122
#0  qemuProcessFindCharDevicePTYs (vm=0x7fbac40131d0,
    output=0x7fbab000b360 "", fd=20) at qemu/qemu_process.c:1122
#1  0x0000000000492b82 in qemuProcessReadLogOutput (buf=0x7fbab000b360 "",
    fd=20, vm=0x7fbac40131d0, buflen=<optimized out>, func=<optimized out>,
    what=<optimized out>, timeout=<optimized out>) at qemu/qemu_process.c:928
#2  qemuProcessWaitForMonitor (driver=0x7fbac4008ce0, vm=0x7fbac40131d0,
    qemuCaps=0x7fbab000e250, pos=4599) at qemu/qemu_process.c:1215
#3  0x0000000000495bfa in qemuProcessStart (conn=0x7fbaa80009a0,
    driver=0x7fbac4008ce0, vm=0x7fbac40131d0, migrateFrom=0x0,
    start_paused=false, autodestroy=false, stdin_fd=-1, stdin_path=0x0,
    snapshot=0x0, vmop=VIR_VM_OP_CREATE) at qemu/qemu_process.c:3127
#4  0x000000000046e7ae in qemudDomainCreate (conn=0x7fbaa80009a0,
    xml=<optimized out>, flags=<optimized out>) at qemu/qemu_driver.c:1315
#5  0x00007fbad8c7c66d in virDomainCreateXML (conn=0x7fbaa80009a0,
    xmlDesc=0x7fbab0000a60 "<domain type='qemu'>\n <name>opensuse12_qemu_9</name>\n <uuid>55c53a6e-49f6-adea-6b3b-d162f3c80ab4</uuid>\n <memory>524288</memory>\n <currentMemory>524288</currentMemory>\n <vcpu>1</vcpu>\n <os>\n    "..., flags=0) at libvirt.c:1852
#6  0x000000000043a17f in remoteDispatchDomainCreateXML (ret=0x7fbab0000970,
    args=0x7fbab0000910, rerr=0x7fbacfb1dc60, client=0x7810a0,
    server=<optimized out>, hdr=<optimized out>) at remote_dispatch.h:848
#7  remoteDispatchDomainCreateXMLHelper (server=<optimized out>,
    client=0x7810a0, hdr=<optimized out>, rerr=0x7fbacfb1dc60,
    args=0x7fbab0000910, ret=0x7fbab0000970) at remote_dispatch.h:828
#8  0x0000000000446ade in virNetServerProgramDispatchCall (msg=0x7c5ba0,
    client=0x7810a0, server=0x77b2e0, prog=0x77b2b0)
    at rpc/virnetserverprogram.c:401
#9  virNetServerProgramDispatch (prog=0x77b2b0, server=0x77b2e0,
    client=0x7810a0, msg=0x7c5ba0) at rpc/virnetserverprogram.c:287
#10 0x00000000004495cc in virNetServerHandleJob (jobOpaque=<optimized out>,
    opaque=0x77b2e0) at rpc/virnetserver.c:136
#11 0x00007fbad8c192de in virThreadPoolWorker (opaque=<optimized out>
    at util/threadpool.c:144
#12 0x00007fbad8c189a1 in virThreadHelper (data=<optimized out>)
    at util/threads-pthread.c:157
#13 0x00007fbad4df4f05 in start_thread () from /lib64/libpthread.so.0
#14 0x00007fbad493353d in clone () from /lib64/libc.so.6

(3), so
"virsh create" -> "virDomainCreateXML" -> "remoteDomainCreateXML" -> "qemudDomainCreate" -> 

2), qemuProcessFindCharDevicePTYsMonitor
(1), 
qemuProcessFindCharDevicePTYsMonitor(virDomainObjPtr vm,
                                     virBitmapPtr qemuCaps,
                                     virHashTablePtr paths)
...
    if (vm->def->console &&
        qemuProcessLookupPTYs(&vm->def->console, 1, paths, chardevfmt) < 0)
        return -1;
...
(2), 
qemuProcessAttach -> qemuProcessWaitForMonitor
qemuProcessStart  -> qemuProcessWaitForMonitor
qemuProcessWaitForMonitor -> qemuProcessFindCharDevicePTYsMonitor -> qemuProcessLookupPTYs
(3), compare to libxl driver, it looks like the console config is parsed by libxlBuildDomainConfig. 

2, libxl driver
1), libxlMakeDeviceModelInfo
(1), in hvm
if (def->serials &&
    (libxlMakeChrdevStr(def->serials[0], &dm_info->serial) < 0)) 
    goto error;
(2), no support in pv. 
(3), who use libxl hvm serials? 
((1)), search in libvirt upstream in order to find out who add this hvm serials code. 
git clone git://libvirt.org/libvirt.git

2), accoring to the currrent status. 
two things i need to do. 
(1), try hvm console.
(2), implement libvirt libxl pv console driver by libxl api. 

09:53 2012-04-16
GSoC
1, "Robert Schweikert <rjschwei@suse.com>"mail"[opensuse-project] GSoC mentors"20120413_1005
If you have not already registered, please register as mentor.

1.) Goto http://www.google-melange.com/ and login
2.) Click on the "Register" button under "Mentors: .....".
3.) Enter your personal info
4.) Logout and return to http://www.google-melange.com/ and login agin
5.) Click on the "Apply" button under "Mentors: .....".
6.) Select openSUSE from the list
7.) click submit

You have to be registered to review proposals, applications, and accept 
applications. The deadline for acceptance is next week Friday (April 20).

Later,
Robert

-- 
Robert Schweikert                           MAY THE SOURCE BE WITH YOU
SUSE-IBM Software Integration Center                   LINUX
Tech Lead
rjschwei@suse.com
rschweik@ca.ibm.com
781-464-8147
-- 
To unsubscribe, e-mail: opensuse-project+unsubscribe@opensuse.org
To contact the owner, email: opensuse-project+owner@opensuse.org

09:59 2012-04-16
GTD
1, today
1), work report.
2), libxlDomainOpenConsole. see"10:33 2012-04-16". 
3), wireshark bug fix. see"12:32 2012-04-16". 

10:02 2012-04-16
work report - week 15
1, bamvor jian zhang work report
[devel-server] work report - week 15
[green]
continue studing libvirt libxl driver: 
1), libxlDomainOpenConsole still not work. try to add some initial code while libxl start up. 

10:27 2012-04-16
suse, virtualization, vm-install, bug
1, i found that when i choose vm-install install hvm vm with hard disk(2G) and cdrom(2.8G), the sles11_sp1 installer will choose cdrom as harddisk and install sles on it. 
Maybe it is because the installer choose the bigger harddisk to install. 

10:33 2012-04-16
suse, virtualization, libvirt, qemu, xen, read source code, cont1, libxlDomainOpenConsole; read initialization and configuration code
1, if i force pass path to virFDStreamOpenFile, it works. 
bamvor@linux-bvirt:libxl> diff libxl_driver.c.force_path libxl_driver.c
3941c3941
<     if (virFDStreamOpenFile(st, "/dev/pts/6",
---
>     if (virFDStreamOpenFile(st, chr->source.data.file.path,

2, So, I need to know how libvirt and libxl driver parse the configuration. 
1), function relationship
virDomainObjListInit -> virHashCreate
virDomainAssignDef -> virHashAddEntry
virDomainLoadStatus -> virHashAddEntry

domainStartup(qemudStartup/libxlStartup) -> virDomainLoadAllConfigs -> virDomainLoadStatus
                                                                    -> virDomainLoadConfig -> virDomainAssignDef 
cmdCreate -> virDomainCreateXML -> domainCreateXML(qemudDomainCreate, libxlDomainCreateXML) -> virDomainAssignDef 
cmdStart -> virDomainCreate -> domainCreate

2), virDomainAssignDef: 
if uuid is not defined, create virDomainObjPtr by virDomainObjNew, then add domain into hash table(doms->objs, virDomainObjListPtr doms)

12:32 2012-04-16
company, network, wireshark, fix 4 bugs from upstream 
1, bug
1), https://bugzilla.novell.com/show_bug.cgi?id=754474
1.4.12
2), https://bugzilla.novell.com/show_bug.cgi?id=754475
Versions affected: 1.6.0 to 1.6.5
Fixed in: 1.6.6 
3), https://bugzilla.novell.com/show_bug.cgi?id=754476
1.4.12
4), https://bugzilla.novell.com/show_bug.cgi?id=754477
1.4.12

2, 之前Chunyan来公司和我交接wireshark时，应该当时就在chunyan改过的patch上实验一次，否则也不会现在这么被动。都需要现学。

3, 看ibs上chunyan的project，看看需要提交那些文件，需要修改的文件。
1), search wireshark package on ibs
https://build.suse.de/search/search
sles11 sp1 update test:
https://build.suse.de/project/show?project=home%3Acyliu%3Abranches%3ASUSE%3ASLE-11-SP1%3AUpdate%3ATest
select wireshark package in it, list file
https://build.suse.de/package/files?package=wireshark&project=home%3Acyliu%3Abranches%3ASUSE%3ASLE-11-SP1%3AUpdate%3ATest
2), file need to be commit
wireshark.spec 	6.2 KB 	2 months ago 	Download
wireshark.changes 	49.2 KB 	2 months ago 	Download
wireshark-1.4.4-disable-warning-dialog.patch 	1.9 KB 	13 months ago 	Download
wireshark-1.4.4-desktop.patch 	516 Bytes 	5 months ago 	Download
wireshark-1.4.11.tar.bz2 	19.7 MB 	2 months ago 	Download
include.filelist 	650 Bytes 	44 months ago 	Download
_link 	155 Bytes 	2 months ago 	Download
3), there are two files in the above list need to be modified. 
(1), wireshark.spec
Version:        1.4.11
(2), wireshark.changes
compare chunyan's branch, it includes(take wireshark 1.4.11 as example):
((1)), header
-------------------------------------------------------------------
Mon Jan 16 04:03:51 UTC 2012 - cyliu@suse.com

- update to 1.4.11
((2)), bug fix for suse
  - fix bnc#741187, bnc#741188, bnc#741190 (fixed upstream)
((3)), release notes:
1.4.11(chunyan add it to the wireshark.changes)
http://www.wireshark.org/lists/wireshark-announce/201201/msg00000.html
1.4.12(which should be add in my update)
http://www.wireshark.org/lists/wireshark-announce/201203/msg00001.html
(3), include.filelist? \TODO: i don't know why need this file, just ignore it. 
4), if the update is not affected by the 1.4.x, mark as INVALID. it will closed by colleague
ref: https://bugzilla.novell.com/show_bug.cgi?id=727718
Matthias Weckbecker 2011-11-23 15:03:05 UTC

Was this bug fixed as well with the last update? I guess it wasn't.

[reply] [-]
Private
Comment 4 Chun Yan Liu 2011-11-24 07:00:23 UTC

(In reply to comment #3)
> Was this bug fixed as well with the last update? I guess it wasn't.

1.4.X version doesn't support CSN.1 dissector. It only exists in 1.6.X version.
Since wireshark version we are using is 1.4.10, it's not affected by this CVE,
so we can simply set it to be "INVALID" and close.

[reply] [-]
Private
Comment 5 Matthias Weckbecker 2011-11-25 09:32:35 UTC

CLOSED/INVALID, see previous comment.

4, 看chunyan修改的bug
https://bugzilla.novell.com/show_bug.cgi?id=742815
https://bugzilla.novell.com/show_bug.cgi?id=741187
提交方法，每次chunyan都是把request id commit到bugzilla.

search bug wireshark
https://bugzilla.novell.com/buglist.cgi?content=wireshark&field0-0-0=content&field0-0-1=short_desc&field1-0-0=content&field1-0-1=short_desc&field2-0-0=content&field2-0-1=short_desc&product=&query_format=specific&type0-0-0=matches&type0-0-1=allwords&type1-0-0=matches&type1-0-1=allwords&type2-0-0=matches&type2-0-1=allwords&value0-0-0=wireshark&value0-0-1=wireshark&value1-0-0=wireshark&value1-0-1=wireshark&value2-0-0=wireshark&value2-0-1=wireshark&order=assigned_to%2Cbug_id&query_based_on=

5, checkout wireshark upstream
1), check out lastest version of wireshark
bamvor@linux-bvirt:wireshark-1.4> svn co http://anonsvn.wireshark.org/wireshark/trunk-1.4/ wireshark-1.4
2), switch to version 1.4.12
bamvor@linux-bvirt:wireshark-1.4> svn log | grep 1.4.12 -A 2 -B 2
r41804 | gerald | 2012-03-27 23:56:41 +0800 (Tue, 27 Mar 2012) | 2 lines

Build 1.4.12.

------------------------------------------------------------------------
^Csvn: Caught signal

bamvor@linux-bvirt:wireshark-1.4> svn update -r r41804
U    tools/win64-setup.sh
U    manuf
U    version.conf
U    docbook/release-notes.xml
U    configure.in
U    dumpcap.c
U    debian/changelog
U    epan/enterprise-numbers
U    config.nmake
U    services
U    wiretap/k12.c
	Updated to revision 41804.
3), verity status
bamvor@linux-bvirt:wireshark-1.4> svn info
Path: .
URL: http://anonsvn.wireshark.org/wireshark/trunk-1.4
Repository Root: http://anonsvn.wireshark.org/wireshark
Repository UUID: f5534014-38df-0310-8fa8-9805f1628bb7
Revision: 41804
Node Kind: directory
Schedule: normal
Last Changed Author: gerald
Last Changed Rev: 41804
Last Changed Date: 2012-03-27 23:56:41 +0800 (Tue, 27 Mar 2012)
4), download 1.4.12 release version standalone package
http://wiresharkdownloads.riverbed.com/wireshark/src/wireshark-1.4.12.tar.bz2

5, create branch
1), sles
(1), modify "~/.oscrc"
bamvor@linux-bvirt:~> diff ~/.oscrc ~/.oscrc~
4c4
< apiurl = https://api.suse.de
---
> apiurl = https://api.opensuse.org
105,107d104
< [https://api.suse.de]
< user = bjzhang
< pass = 9271I75
119d115

notes: 
((1)), allow different user and password for differnece api url, e.g.
[https://api.suse.de]
user = bjzhang
pass = 9271I75

for https://api.suse.de

while 
[https://api.opensuse.org]
user = bjzhang
pass = 9271I75

for https://api.opensuse.org
((2)), but there is only on the general api url. 
use -A choose another api url, e.g.
see log for opensuse wireshark "10-1)".

(2), branch and checkout
(1), sles10, sles11
bamvor@linux-bvirt:wireshark> pwd
/home/bamvor/work/wireshark
bamvor@linux-bvirt:wireshark> osc branch SUSE:SLE-11-SP2:Update:Test wireshark home:bjzhang:branches:SUSE:SLE-11-SP2:Update:Test wireshark
bamvor@linux-bvirt:wireshark> osc co home:bjzhang:branches:SUSE:SLE-11-SP2:Update:Test/wireshark
(2), sles9
bamvor@linux-bvirt:wireshark> osc branch SUSE:SLE-9-SP3:Update:Teradata:Test wireshark home:bjzhang:branches:SUSE:SLE-9-SP3:Update:Teradata:Test wireshark
A working copy of the branched package can be checked out with:

osc co home:bjzhang:branches:SUSE:SLE-9-SP3:Update:Teradata:Test/wireshark
bamvor@linux-bvirt:wireshark> osc co home:bjzhang:branches:SUSE:SLE-9-SP3:Update:Teradata:Test/wireshark

7, osc commit and try build. 
1), update wireshark.changes, wireshark.spec, delete wireshark-1.4.11.tar.bz2, add wireshark-1.4.12.tar.bz2
osc add wireshark-1.4.12.tar.bz2
osc delete wireshark-1.4.11.tar.bz2

bamvor@linux-bvirt:wireshark> osc status
D    wireshark-1.4.11.tar.bz2
A    wireshark-1.4.12.tar.bz2
M    wireshark.changes
M    wireshark.spec

2), commit
bamvor@linux-bvirt:wireshark> osc commit -m "fix bnc#754474, bnc#754476, bnc#754477(fixed upstream)"
Deleting    wireshark-1.4.11.tar.bz2
Sending    wireshark.changes
Sending    wireshark.spec
Sending    wireshark-1.4.12.tar.bz2
Transmitting file data .
3), check result
(1), after commit, service will auto build. using "osc results" to check result
bamvor@linux-bvirt:wireshark> osc results
standard             ia64       building
standard             ppc64      building
standard             ppc        succeeded
standard             s390       building
standard             s390x      building
standard             x86_64     succeeded
standard             i586       succeeded
(2), but i can not get the rpm from "Go to download repository": 
http://download.suse.de/ibs/home:/bjzhang:/branches:/SUSE:/SLE-11-SP1:/Update:/Test/standard
the "osc reults" is unpublished. 
bamvor@linux-bvirt:home:bjzhang:branches:SUSE:SLE-11-SP1:Update:Test> osc results
 wireshark
 .  standard i586 (unpublished)
 f  standard ia64 (building)
 .  standard ppc (unpublished)
 %  standard ppc64 (building)
 .  standard s390 (unpublished)
 f  standard s390x (building)
 .  standard x86_64 (unpublished)

 Legend:
  s scheduled           
  S signing             
    disabled            
  B broken              
  f finished            
  b blocked             
  % building            
  L locked              
  . succeeded           
  U unresolvable        
  d dispatching         
  F failed              
  x excluded            
  ? buildstatus not available (only new packages)
(3), i can download rpm from "Detailed Information" page. 
(4), test: wireshark need to run with root privilege. select network interface and capture the packages.
(16:02 2012-05-19)
fix unpublished flags: ref: "12:26 2012-05-14". 
"16:02 2012-05-19"end

8, check repo need to be update while wait for compiling
1), sles9 sp3, sles10 sp3 sp4, sles11 sp1 sp2, opensuse11.3, opensuse11.4, opensuse12.1
notes: sles10 do not need to ppc64 arch.
2), ref: https://bugzilla.novell.com/show_bug.cgi?id=718032
Swamp Workflow Management 2011-10-17 09:35:22 UTC

Update released for: wireshark, wireshark-debuginfo, wireshark-debugsource,
wireshark-devel
Products:
openSUSE 11.3 (debug, i586, x86_64)
openSUSE 11.4 (debug, i586, x86_64)

[reply] [-]
Private
Comment 7 Sebastian Krahmer 2011-10-17 09:39:53 UTC

Do we need sles9-sp3-teradata submits? E.g. is it affected there?

[reply] [-]
Private
Comment 8 Swamp Workflow Management 2011-10-17 13:28:26 UTC

Update released for: wireshark, wireshark-debuginfo, wireshark-debugsource,
wireshark-devel
Products:
SLE-DEBUGINFO 11-SP1 (i386, ia64, ppc64, s390x, x86_64)
SLE-DESKTOP 11-SP1 (i386, x86_64)
SLE-SDK 11-SP1 (i386, ia64, ppc64, s390x, x86_64)
SLE-SERVER 11-SP1 (i386, ia64, ppc64, s390x, x86_64)
SLE-SERVER 11-SP1-TERADATA (x86_64)
SLES4VMWARE 11-SP1 (i386, x86_64)

[reply] [-]
Private
Comment 9 Swamp Workflow Management 2011-10-17 15:59:52 UTC

Update released for: wireshark, wireshark-debuginfo, wireshark-devel
Products:
SLE-DESKTOP 10-SP4 (i386, x86_64)
SLE-SDK 10-SP4 (i386, ia64, ppc, s390x, x86_64)
SLE-SERVER 10-SP4 (i386, ia64, ppc, s390x, x86_64)

[reply] [-]
Private
Comment 10 Swamp Workflow Management 2011-10-17 17:04:04 UTC

Update released for: wireshark, wireshark-debuginfo, wireshark-devel
Products:
SLE-SAP-APL 10-SP3 (x86_64)
SLE-SDK 10-SP3 (i386, ia64, ppc, s390x, x86_64)
SLE-SERVER 10-SP3 (i386, ia64, ppc, s390x, x86_64)
SLE-SERVER 10-SP3-TERADATA (x86_64)

9, submitrequest
1), sles10 sp3
bamvor@linux-bvirt:wireshark> pwd
/home/bamvor/work/wireshark/home:bjzhang:branches:SUSE:SLE-10-SP3:Update:Test/wireshark
bamvor@linux-bvirt:wireshark> osc sr -m "update to 1.4.12: fix bnc#754474, bnc#754476, bnc#754477(fixed upstream)"
created request id 18546
2), sles10 sp4
bamvor@linux-bvirt:wireshark> pwd
/home/bamvor/work/wireshark/home:bjzhang:branches:SUSE:SLE-10-SP4:Update:Test/wireshark
bamvor@linux-bvirt:wireshark> osc sr -m "update to 1.4.12: fix bnc#754474, bnc#754476, bnc#754477(fixed upstream)"
created request id 18547
3), sles11 sp1
bamvor@linux-bvirt:wireshark> pwd
/home/bamvor/work/wireshark/home:bjzhang:branches:SUSE:SLE-11-SP1:Update:Test/wireshark
bamvor@linux-bvirt:wireshark> osc sr -m "update to 1.4.12: fix bnc#754474, bnc#754476, bnc#754477(fixed upstream)"
created request id 18548
4), sles11 sp2
bamvor@linux-bvirt:wireshark> pwd
/home/bamvor/work/wireshark/home:bjzhang:branches:SUSE:SLE-11-SP2:Update:Test/wireshark
bamvor@linux-bvirt:wireshark> osc sr -m "update to 1.4.12: fix bnc#754474, bnc#754476, bnc#754477(fixed upstream)"
created request id 18549

10, for opensuse
(1), create banch and checkout
bamvor@linux-bvirt:wireshark> osc -A https://api.opensuse.org branch openSUSE:12.1:Update wireshark home:bjzhang:branches:openSUSE:12.1:Update wireshark
A working copy of the branched package can be checked out with:

osc -A https://api.opensuse.org co home:bjzhang:branches:openSUSE:12.1:Update/wireshark
bamvor@linux-bvirt:wireshark> osc -A https://api.opensuse.org co home:bjzhang:branches:openSUSE:12.1:Update/wireshark
A    home:bjzhang:branches:openSUSE:12.1:Update
A    home:bjzhang:branches:openSUSE:12.1:Update/wireshark
A    home:bjzhang:branches:openSUSE:12.1:Update/wireshark/include.filelist
A    home:bjzhang:branches:openSUSE:12.1:Update/wireshark/wireshark-1.2.0-disable-warning-dialog.patch
A    home:bjzhang:branches:openSUSE:12.1:Update/wireshark/wireshark-1.2.0-geoip.patch
A    home:bjzhang:branches:openSUSE:12.1:Update/wireshark/wireshark-1.2.4-enable_lua.patch
A    home:bjzhang:branches:openSUSE:12.1:Update/wireshark/wireshark-1.4.11.tar.bz2
A    home:bjzhang:branches:openSUSE:12.1:Update/wireshark/wireshark-corosync-packet-dissector.patch
A    home:bjzhang:branches:openSUSE:12.1:Update/wireshark/wireshark-nfsv4-opts.patch
A    home:bjzhang:branches:openSUSE:12.1:Update/wireshark/wireshark.changes
A    home:bjzhang:branches:openSUSE:12.1:Update/wireshark/wireshark.spec
At revision 2de590cce028cc7c56ba075e0ac62e4c.
(2), 11.3 does not exist
bamvor@linux-bvirt:wireshark> osc -A https://api.opensuse.org branch openSUSE:11.3:Update wireshark home:bjzhang:branches:openSUSE:11.3:Update wiresharkServer returned an error: HTTP Error 404: Not Found
openSUSE:11.3:Update
(3), commit error in opensuse12.1
bamvor@linux-bvirt:wireshark> osc -A https://api.opensuse.org ci -m "fix bnc#754474, bnc#754476, bnc#754477(fixed upstream)"
*** Error: Package obs-service-format_spec_file is required for this operation
((1)), add repo
sudo zypper ar -f -c http://download.opensuse.org/repositories/openSUSE:/Tools/SLE_11_SP2/ tools_from_obs
sudo zypper refresh tools_from_obs
((2)), install
bamvor@linux-bvirt:wireshark> sudo zypper in obs-service-format_spec_file
((3)), after install, commit successful.
(4), submit request
((1)), opensuse12.1
bamvor@linux-bvirt:wireshark> osc -A https://api.opensuse.org sr -m "update wireshark to 1.4.12: fix bnc#754474, bnc#754476, bnc#754477(fixed upstream)"
WARNING:
WARNING: Project does not accept submit request, request to open a NEW maintenance incident instead
WARNING:
created request id Request: #113879

  maintenance_incident: home:bjzhang:branches:openSUSE:12.1:Update/wireshark -> openSUSE:Maintenance (release in openSUSE:12.1:Update)


Message:
update wireshark to 1.4.12: fix bnc#754474, bnc#754476, bnc#754477(fixed upstream)

State:   new        2012-04-16T14:51:06 bjzhang
Comment: <no comment>
((2)), during opensuse11.4, i submit "Request maint. update"(Request Maintenance Incident) in website, there is no warning during request. and the result is same as the opensuse12.1
((3)), request id
opensuse12.1 Request 113879
opensuse11.4 Request 113884

11, reassign bug to 
update wireshark to 1.4.12 to fix this bug. 
This bug was fixed by following request
https://build.suse.de/request/show/18547 sles10 / wireshark
https://build.suse.de/request/show/18549 sles11 / wireshark
https://build.opensuse.org/request/show/113879 12.1 / wireshark
https://build.opensuse.org/request/show/113894 11.4 / wireshark

12, check the bug about sles9 sp3. do not affect. 
https://bugzilla.novell.com/show_bug.cgi?id=754474
https://bugzilla.novell.com/show_bug.cgi?id=754475
https://bugzilla.novell.com/show_bug.cgi?id=754476
https://bugzilla.novell.com/show_bug.cgi?id=754477

17:19 2012-04-16
GSoC
1), Re: Re: Google Summer of Code (still not work)
	
Hi, Matt

thanks. 

i have received the invitation of google summer of code.
According to the email, I need to click the following link to fill in the necessary information and accept the invitation.
link: http://www.google-melange.com/gsoc/invitation/google/gsoc2012/bamvor/1001

But, I got permission error while i click that link: 
You are logged in as bjzhang@suse.com [link_id: bamvor_jian_zhang]. (Not you?)
You need to be a organization administrator for openSUSE to access this page.

could u do me a favor to help me fix this? or I need to contact GSoC administrator? 

thanks your help. 

best wishes
bamvor 

 >>>Matt Barringer <mbarringer@suse.de> wrote: 
> On Sun, 15 Apr 2012, Bamvor Jian Zhang wrote: 
>  
> > thanks your help. 
> > I want to request but withdraw it by mistake. 
> > And after withdraw, there is no apply button for me. it say "You have  
> already applied to be a mentor for this organization" 
> > how can i send the request again? 
>  
> I just sent you a mentor invitation.  Hopefully that works - Google  
> Melange has some bugs there. 
>  
> -- 
> Matt Barringer, Software Engineer 
> SUSE Linux Products GmbH, Maxfeldstr. 5, 90409 Nürnberg, DE 
> GF: Jeff Hawn, Jennifer Guild, Felix Imendörffer, HRB 16746 (AG Nürnberg) 

20:29 2012-04-16
maillist, devel-sever, work report
1, work report 15
1). jiaju zhang: openstack and HA relative works. 
- Investigate HA related topic for openstack, especially
  for the competitive solutions.
  Looking forward to see the result of openstack summit,
  hope there would be some agreement on how to achieve
  HA in openstack.
- Beijing local managers meeting

09:30 2012-04-17
GTD
0, 9:20-19:00

1, today
1), 1h audio editor. 
2), 10:44-10:56 check email. attachmate group FY12. "SUSE Q4 and FY12 Results". see"10:44 2012-04-17". 
3), 20' 15:30-17:30 18:26-19:00 libvirt qemu configuration. see"10:57 2012-04-17".
4), 13:00-13:47 check wireshark response. need add CVE id for each bnc. see"13:07 2012-04-17". 

10:44 2012-04-17
company, Attachmate group, suse, fiscal year, FY12
1, attachmate group fy12
https://innerweb.novell.com/news/articles/?p=1430
2, suse FY12
"Nils Brauckmann"email"SUSE Q4 and FY12 Results"_20120416_2138

 16/April/2012

 suse.com + <http://www.suse.com/>
( http://www.suse.com/) 

Nils Brauckmann
President and General Manager
SUSE 				   

 SUSE news + <https://innerweb.novell.com/news/articles/?cat=42>
( https://innerweb.novell.com/news/articles/?cat=42) 

SUSE Team,
The lights turned “green” in Q4!
Bookings results for SUSE in Q4 are available and we were very successful.
Let me share with you some of the highlights:
The positive momentum in our business, which started to build during the first quarters of FY12, peaked in Q4. Subsequently Q4 was again a very strong quarter for SUSE and we further increased our bookings growth rate.
SUSE total bookings in Q4 came in at 46,253,000 US$ which is 117.5% of our Q4 bookings plan number and represents a strong growth of +40% over Q4FY11.
FY12 showed good bookings performance and promising growth!

Ultimately the growth momentum of the last couple of months and the strong Q4 results also led us to a pretty good FY12 overall. Total bookings for FY12 came in at 178,199,000 US$ or 98% of the plan number and represent a growth of +15.2% over the previous fiscal year. While we all certainly would have preferred to finish the year above 100% of the bookings plan number, this is a respectable result, especially when we consider the somewhat slow start into the fiscal year due to the uncertainties and open question our customers had about the SUSE future following the acquisition.
Highlights from the global geographies:
All 4 global regions (APAC, EMEA, LA and NA) had a strong finish in Q4, came in significantly above the forecast and significantly grew their business compared to Q4 last fiscal year. 
The EMEA team under the leadership of Ronald de Jong showed the best performance against plan and finished the fiscal year at 74,059,000 US$ or 101% of plan and showed a growth +15% year over year.
The North American team under the leadership of Terri Hall came in at a strong 73,785,000 US$ or 100% of plan and showed +12% growth year over year.
The APAC team under the leadership of Boris Ivancic took the lead with showing the strongest growth of all regions with +31% compared to FY11 and finished the year at 27,466,000 US$ or 92% of plan.

Some other positive news includes our growth rate for the SLES business, which grew by +16% and our bookings for SUSE Manager, which ramped up from zero to almost 2,000,000 US$ in just one year. SUSE is also proud of its healthy alliance partner and OEM relationships, and in this context it is noteworthy that our OEM related bookings showed a healthy growth of +24% under the leadership of Michael Miller, Mark Longwell and team.
FY12 was an exciting and successful year for all colleagues working for or being aligned with the SUSE BU. We established a focused BU dedicated 100% to the SUSE brand and the SUSE solutions. We achieved great continuity maintaining or even extending our high level of quality in engineering and in technical services, successful and timely releases of SUSE Studio 1.2 and SLES 11 SP2 just being examples of that. In addition we managed to build focused, SUSE dedicated and well enabled sales and marketing teams during the course of the year, which are a foundation for our current and future success.
This continuity in our areas of strength combined with increased focus on SUSE solutions and the SUSE brand, an improved organizational setup in the BU as well as a relentless focus on our customers and on execution in our core business functions, allows us to make progress and create momentum, which will lead us to an even better new fiscal year.
Speaking of "new fiscal year": I welcome you all to the new FY13 and I am looking forward to seeing us all working together as a truly engaged and aligned team, shaping a bright SUSE future. In a couple of weeks you will hear more about our business goals for FY13 and about the specifics of our execution strategy. Stay tuned.
In the meantime I conclude with thanking all of you who work so hard and smart on supporting and growing the SUSE business and I wish you good luck and success in the future.
Nils Brauckmann
President and General Manager
SUSE

For internal use only. 

10:57 2012-04-17
suse, virtualization, libvirt, qemu, xen, read source code, cont2, read initialization and configuration code
1, how to get domain info.
1), 
cmdConsole -> vshCommandOptDomain -> vshCommandOptDomainBy -> virDomainLookupByUUIDString -> virDomainLookupByUUID -> domainLookupByUUID

domainLookupByUUID(libxlDomainLookupByUUID) -> virDomainFindByUUID
                                            -> virGetDomain
can also lookup by name or id. 
2), virDomainObjPtr->virDomainDefPtr 

2, search how to set domain console
virDomainDefParseXML -> virDomainChrDefParseXML -> virDomainChrSourceDefParseXML

    .getCapabilities = qemudGetCapabilities, /* 0.2.1 */
    .getCapabilities = libxlGetCapabilities, /* 0.9.0 */

3, libxl: after virDomainDefParseXML the path is null in console. test it in qemu. 
1), virDomainDefParseXML is called twice(?) while qemu vm create. another path:
qemuProcessStart -> virDomainObjSetDefTransient -> virDomainDefParse -> virDomainDefParseNode -> virDomainDefParseXML -> virDomainChrDefParseXML
virDomainChrDefParseXML will be called three times for parallel, serial and console. 
I need to check the chr and path after virDomainDefParseNode check console node. path is null either after virDomainChrDefParseXML:
(gdb) p *chr
$50 = {deviceType = 1, targetType = 0, target = {port = 0, addr = 0x0,
    name = 0x0}, source = {type = 2, data = {file = {path = 0x0}, tcp = {
        host = 0x0, service = 0x0, listen = false, protocol = 0}, udp = {
        bindHost = 0x0, bindService = 0x0, connectHost = 0x0,
        connectService = 0x0}, nix = {path = 0x0, listen = false},
      spicevmc = 0}}, info = {alias = 0x0, type = 0, addr = {pci = {
        domain = 0, bus = 0, slot = 0, function = 0}, drive = {controller = 0,
        bus = 0, unit = 0}, vioserial = {controller = 0, bus = 0, port = 0},
      ccid = {controller = 0, slot = 0}, usb = {bus = 0, port = 0x0}},
    mastertype = 0, master = {usb = {startport = 0}}}}
2), i found virDomainChrDefForeach function.
qemuProcessStart -> virDomainObjSetDefTransient 
                 -> virDomainChrDefForeach 

(gdb) p iter
$58 = (int (*)(virDomainDefPtr, virDomainChrDefPtr,
    void *)) 0x491270 <qemuProcessPrepareChardevDevice>

\TODO: check whether libxl call virDomainChrDefForeach or not. 

3), print qemu cmd in function virCommandRun
(gdb) p *cmd->args@cmd->nargs
$82 = {0x7fbaac0021d0 "/usr/bin/qemu", 0x7fbaac0021f0 "-S",
  0x7fbaac0021b0 "-M", 0x7fbaac001d40 "pc-0.14", 0x7fbaac002230 "-m",
  0x7fbaac0022c0 "512", 0x7fbaac0022e0 "-smp",
  0x7fbaac000f80 "1,sockets=1,cores=1,threads=1", 0x7fbaac002300 "-name",
  0x7fbaac002320 "opensuse12_qemu_9", 0x7fbaac002340 "-uuid",
  0x7fbaac00e3c0 "55c53a6e-49f6-adea-6b3b-d162f3c80ab4",
  0x7fbaac002360 "-nodefconfig", 0x7fbaac002380 "-nodefaults",
  0x7fbaac0023a0 "-chardev",
  0x7fbaac00ea50 "socket,id=charmonitor,path=/var/lib/libvirt/qemu/opensuse12_qe
mu_9.monitor,server,nowait", 0x7fbaac0023c0 "-mon",
  0x7fbaac00ae50 "chardev=charmonitor,id=monitor,mode=control",
  0x7fbaac0023e0 "-rtc", 0x7fbaac00abd0 "base=utc",
  0x7fbaac002400 "-no-shutdown", 0x7fbaac002420 "-drive",
  0x7fbaac002250 "file=/var/lib/qemu/images/opensuse11_qemu_9/disk0.raw,if=none,
id=drive-virtio-disk0,format=raw", 0x7fbaac002550 "-device",
  0x7fbaac00a2d0 "virtio-blk-pci,bus=pci.0,multifunction=on,addr=0x5.0x0,drive=d
rive-virtio-disk0,id=virtio-disk0,bootindex=1", 0x7fbaac002620 "-netdev",
  0x7fbaac002570 "tap,fd=21,id=hostnet0", 0x7fbaac0009c0 "-device",
  0x7fbaac0025b0 "virtio-net-pci,netdev=hostnet0,id=net0,mac=52:54:00:1b:f6:14,b
us=pci.0,multifunction=on,addr=0x3.0x0", 0x7fbaac00e520 "-chardev",
  0x7fbaac00a100 "pty,id=charserial0", 0x7fbaac001a70 "-device",
  0x7fbaac00a520 "isa-serial,chardev=charserial0,id=serial0",
  0x7fbaac001a90 "-usb", 0x7fbaac00a590 "-vnc", 0x7fbaac0027d0 "127.0.0.1:0",
  0x7fbaac00a260 "-vga", 0x7fbaac00a280 "cirrus", 0x7fbaac009ec0 "-device",
  0x7fbaac009e50 "AC97,id=sound0,bus=pci.0,multifunction=on,addr=0x4.0x0",
  0x7fbaac009ee0 "-device",
  0x7fbaac00a040 "virtio-balloon-pci,id=balloon0,bus=pci.0,multifunction=on,addr
=0x6.0x0"}
notes: software skills, print array in GDB. see"16:59 2012-04-17". 
4), yet another path about console. 
virDomainCreateXML -> qemudDomainCreate -> qemuProcessStart -> qemuProcessWaitForMonitor -> qemuProcessReadLogOutput -> qemuProcessFindCharDevicePTYs -> qemuProcessExtractTTYPath
in function qemuProcessReadLogOutput: 
func_ret = func(vm, buf, fd);
where fd is 21. check this file in proc libvirtd "cat /proc/25770/fd/21", this file record earch vm status(start, shutdown time), each qemu environment variable and arguments, char device. 

linux-bhi8:/proc/25770 # cat /proc/`ps -e | grep libvirtd | sed "s/^\ *//g" | cut -d \  -f 1`/fd/21 | grep "\(pts\)\|\(Domain id\)"
Domain id=6 is tainted: high-privileges
Domain id=7 is tainted: high-privileges
Domain id=8 is tainted: high-privileges
char device redirected to /dev/pts/11
Domain id=9 is tainted: high-privileges
char device redirected to /dev/pts/5
Domain id=10 is tainted: high-privileges
char device redirected to /dev/pts/5
Domain id=11 is tainted: high-privileges
char device redirected to /dev/pts/5
Domain id=12 is tainted: high-privileges
char device redirected to /dev/pts/5
Domain id=13 is tainted: high-privileges
char device redirected to /dev/pts/5

5), let me find out when "char device redirected to /dev/pts/5" is printed. 
fd is opened by qemuDomainOpenLogHelper.
(1), 
qemuProcessWaitForMonitor -> qemuDomainOpenLog -> qemuDomainOpenLogHelper
                          -> qemuProcessReadLogOutput
(2), qemuProcessReadLogOutput: filename is get from driver->logDir(/var/log/libvirt/qemu), vm->def->name(opensuse12_qemu_9). 
So, /proc/25770/fs/21 is "/var/log/libvirt/qemu/opensuse12_qemu_9.xml".
(3). find out the cmd or function relative to write qemu vm log. 
qemuProcessStart -> virFileMakePath: create log path
                 -> qemuDomainCreateLog: return logfd
                 -> write timestamp and start up message to log 
                 -> write arg to log
                 -> obj check taint(? what does taint mean?) and write to log
                 -> virCommandRun: write "char device redirected to xxx" to log
                 -> qemuProcessWaitForMonitor
but i do not know who write "char device redirected to /dev/pts/x".
re-run "virsh create opensuse12_qemu_9.xml"
(4), 
(gdb) break virCommandHandshakeNotify
Breakpoint 17 at 0x7fbad8bf8d40: file util/command.c, line 2388.

after execute virCommandHandshakeNotify, "char device .." line print. I guess it is print by qemu. 
So, maybe qemu and xen alloc pty by their own. 

13:07 2012-04-17
company, network, wireshark, fix 4 bugs from upstream, cont1, add CVE id
1, bugzilla, NEEDINFO
--- Comment #6 from Sebastian Krahmer <krahmer@suse.com> 2012-04-16 13:40:22 UTC ---
*** THIS IS A PRIVATE COMMENT ***
could you add the CVE numbers to the changelog?

for each item which is security relevant, add CVE id and
bugzilla id. if a fix is non-security, just add the bugzilla id

2, i do not know what does CVE mean.
1), seach on google, got 
http://cve.mitre.org/
CVE® International in scope and free for public use, CVE is a dictionary of publicly known information security vulnerabilities and exposures.
CVE’s common identifiers enable data exchange between security products and provide a baseline index point for evaluating coverage of tools and services.
2), enter "CVE Search on NVD" from "CVE List Main Page"
Full database functionality for the CVE List is provided through MITRE’s partnership with the U.S. National Vulnerability Database (NVD).
3), from this web(http://web.nvd.nist.gov/view/vuln/search?execution=e2s1), i can get more information for CVE id.

3, now, I just add CVE number into wireshark.changes from bugzilla.
bnc754476(CVE-2012-1595)
bnc754477(CVE-2012-1593)
bnc754474(CVE-2012-1596)

4, commit and submit new request
bamvor@linux-bvirt:wireshark> vim wireshark.changes
bamvor@linux-bvirt:wireshark> osc diff wireshark.changes
Index: wireshark.changes
===================================================================
--- wireshark.changes	(revision 490197c3fe0cbfa346d8bf8aaad91544)
+++ wireshark.changes	(working copy)
@@ -2,7 +2,7 @@
 Mon Apr 16 07:16:00 UTC 2012 - bjzhang@suse.com
 
 - update to 1.4.12
-  - fix bnc#754474, bnc#754476, bnc#754477(fixed upstream)
+  - fix bnc#754474(CVE-2012-1596), bnc#754476(CVE-2012-1593), bnc#754477(CVE-2012-1595)(fixed upstream)
   - Security fixes:
     - wnpa-sec-2012-04 The ANSI A dissector could dereference a NULL pointer 
       and crash. (Bug 6823)
bamvor@linux-bvirt:wireshark> osc ci -m "add CVE id for each bnc#xxx"
Sending    wireshark.changes
Transmitting file data .
Committed revision 4.
bamvor@linux-bvirt:wireshark> osc sr -m "update to 1.4.12 cont: add CVE id for each bnc#xxx" -s 18547
created request id 18565
notes: "-s" for supercede the old request. 

5, for opensuse, error:
bamvor@linux-bvirt:wireshark> osc sr -m "update to 1.4.12 cont: add CVE id for each bnc#xxx" -s 113884
WARNING:
WARNING: Project does not accept submit request, request to open a NEW maintenance incident instead
WARNING:
Server returned an error: HTTP Error 403: Forbidden
change state from an accepted state is not allowed.

but the new request has been create:
bamvor@linux-bvirt:wireshark> osc -A https://api.opensuse.org my sr
113969  State:new        By:bjzhang      When:2012-04-17T07:40:38
        maintenance_incident: home:bjzhang:branches:openSUSE:12.1:Update/wireshark -> openSUSE:Maintenance (release in openSUSE:12.1:Update)
        Descr: update to 1.4.12 cont: add CVE id for each bnc#xxx

Maybe, the "-s" is not need for which request has been accepted. 

16:59 2012-04-17
software, skill, debugging, gcc, gdb, array, how to print array in GDB
0, init
1), example array
struct _virCommand {
	//...
	char **args;
	size_t nargs;
	//...
};
2), ref
1), http://www.chemie.fu-berlin.de/chemnet/use/info/gdb/gdb_9.html
Examining Data -> artificial arrays

1, print *array@len
p *cmd->args@cmd->nargs
(gdb) p *cmd->args@cmd->nargs
$82 = {0x7fbaac0021d0 "/usr/bin/qemu", 0x7fbaac0021f0 "-S",
  0x7fbaac0021b0 "-M", 0x7fbaac001d40 "pc-0.14", 0x7fbaac002230 "-m",
  0x7fbaac0022c0 "512", 0x7fbaac0022e0 "-smp",
  0x7fbaac000f80 "1,sockets=1,cores=1,threads=1", 0x7fbaac002300 "-name",
....

2, use convenience variables
(gdb) set $i=0
(gdb) p cmd->args[$i++]
$139 = 0x7fbaac0021d0 "/usr/bin/qemu" //press Enter once will print one line arg
$140 = 0x7fbaac0021f0 "-S"
$141 = 0x7fbaac0021b0 "-M"
$142 = 0x7fbaac001d40 "pc-0.14"
$143 = 0x7fbaac002230 "-m"
$144 = 0x7fbaac0022c0 "512"
$145 = 0x7fbaac0022e0 "-smp"
$146 = 0x7fbaac000f80 "1,sockets=1,cores=1,threads=1"
$147 = 0x7fbaac002300 "-name"

22:02 2012-4-17
suse, virtualization, virsh usage, 之前opensuse virsh list的错误可能是权限问题
1, under opensuse12.1
不使用root权限是, virsh list遇到的错误和之前在公司远程连接后遇到的virsh错误类似.
bamvor@localhost:~> virsh list
error: Failed to reconnect to the hypervisor
error: no valid connection
error: Failed to connect socket to '/var/run/libvirt/libvirt-sock': No such file or directory

bamvor@localhost:~> su
Password:
localhost:/home/bamvor # virsh list
 Id Name                 State
----------------------------------
  0 Domain-0             running

11:54 2012-04-18
GTD
1, today
1), study pushd and popd. see"10:34 2012-04-18". 
2), set wenquanyi font in openSUSE12.1, see"16:04 2012-04-11"4.
3), 10:00-12:52 14:21-18:20 qemu startup and configuration. see"12:02 2012-04-18".
30' interrupt by sleep

12:02 2012-04-18
suse, virtualization, libvirt, qemu, xen, read source code, cont3, read initialization and configuration code
1, install qemu code. 
1), quilt push -a 
Applying patch patches/0025-add-syscall-numbers-from-2.6.39.2.patch
patching file linux-user/alpha/syscall_nr.h
Hunk #1 FAILED at 411.
1 out of 1 hunk FAILED -- rejects in file linux-user/alpha/syscall_nr.h
...
Patch patches/0025-add-syscall-numbers-from-2.6.39.2.patch does not apply (enforce with -f)
2), patch 0025 look not conflict with linux-user/alpha/syscall_nr.h.
(1), redo patch 0025
linux-bhi8:/usr/src/packages/SOURCES/qemu-0.14.1 # patch -p1 < patches/0025-add-syscall-numbers-from-2.6.39.2.patch 
patching file linux-user/alpha/syscall_nr.h
Hunk #1 FAILED at 411.
1 out of 1 hunk FAILED -- saving rejects to file linux-user/alpha/syscall_nr.h.rej
patching file linux-user/arm/syscall_nr.h
patching file linux-user/cris/syscall_nr.h
patching file linux-user/i386/syscall_nr.h
patching file linux-user/m68k/syscall_nr.h
patching file linux-user/main.c
Hunk #1 succeeded at 1922 (offset -63 lines).
patching file linux-user/microblaze/syscall_nr.h
patching file linux-user/mips/syscall_nr.h
patching file linux-user/mips64/syscall_nr.h
patching file linux-user/mipsn32/syscall_nr.h
patching file linux-user/ppc/syscall_nr.h
patching file linux-user/sh4/syscall_nr.h
patching file linux-user/sparc/syscall_nr.h
patching file linux-user/sparc64/syscall_nr.h
patching file linux-user/x86_64/syscall_nr.h
(2), i do not know why, manaully patch.

2, search "char device redirect" and find out the call trace.
1), call trace
main -> serial_parse -> qemu_chr_open
     -> parallel_parse -> qemu_chr_open
     -> virtcon_parse -> qemu_chr_open
     -> debugcon_parse -> qemu_chr_open

qemu_chr_open -> qemu_chr_open_opts -> backend_table[i].open(opts)(qemu_chr_open_pty) -> openpty
      -> fprintf(stderr, "char device redirected to %s\n", q_ptsname(s->fd));
2), go back to qemu args saved yestoday. 
-chardev pty,id=charserial0
So, qemu will assign a pts device while qemu user using "-chardev" to define a char pty device. 
Racall the analysis in xm/xend, it looks like qemu do the same thing like qemu. 

4, Next
1), Find out the exact way how libvirt qemu driver read the pts console number from qemu. libvirt libxl driver should do the same thing. 
2), Find out how to add device console in xenlight. 

5, (14:21 2012-04-18)
1), the relationship among create, define and start. 
virsh cmd       libvirt cmd     libvirt api                 vm driver
create    ->                    virDomainCreateXML      ->  qemudDomainCreate
          ->    cmdRunConsole
define    ->                    virDomainDefineXML      ->  qemudDomainDefine
start     ->                    virDomainCreate         ->  qemuDomainStart
          ->    cmdRunConsole
(11:33 2012-04-24)
qemudDomainCreate -> qemuProcessStart
qemuDomainStart -> qemuDomainStartWithFlags -> qemuDomainObjStart -> qemuProcessStart
"11:34 2012-04-24"end

to simple create = define + start
notes: virDomainCreate maybe replaced by virDomainCreateWithFlags.

2), libvirt qemu driver 
qemuProcessStart -> virCommandRun: write "char device redirected to xxx" to log
                 -> qemuProcessWaitForMonitor: get char device from log and 
                 set into vm ptr. 

3), libvirt xen driver
xenDaemonDomainFetch -> xenStoreDomainGetConsolePath ->  virDomainDoStoreQuery -> xs_read

4), xm console command
xm console -> xm_console -> console.execConsole -> xen.util.auxbin.execute(XENCONSOLE, [str(domin), "--num", str(num)])
XENCONSOLE = "xenconsole"
execute -> os.execv(exepath, a)

\TODO: xl looks same, direct call xenconsole, but xenconsole does not exist in the "/usr/lib/xen/bin". 

5), read xs_read in xenstore in order to find out how it works. 
xs_read communicate xenstore through socket. 

6), ref xen-devel
http://www.gossamer-threads.com/lists/xen/devel/241781?do=post_view_threaded
read libxl console relative code. 

libxlDomainCreateXML -> libxlVmStart -> libxl_domain_create_new -> do_domain_create -> libxl_run_bootloader -> open_xenconsoled_pty -> openpty

(1), details for open_xenconsoled_pty
    /*
     * We need to present the bootloader's tty as a pty slave that xenconsole
     * can access.  Since the bootloader itself needs a pty slave,
     * we end up with a connection like this:
     *
     * xenconsole -- (slave pty1 master) <-> (master pty2 slave) -- bootloader
     *
     * where we copy characters between the two master fds, as well as
     * listening on the bootloader's fifo for the results.
     */
    ret = open_xenconsoled_pty(&xenconsoled_fd, &xenconsoled_slave,
                               &dom_console_slave_tty_path[0],
                               sizeof(dom_console_slave_tty_path));
(2), "man openpty": The  openpty()  function  finds an available pseudoterminal and returns file descriptors for the master and slave in amaster  and  aslave.
(3), So, qemu, xen, xenlight use openpty.
xen and xenlight use openpty during bootloader. Does they use this pty after bootloader? 
master fd: 31, slave fd 32 in XendBootloader.pty:87
but device is "/dev/pty/17".
(15:16 2012-04-23)
notes: ttyname_r get pts name from slave fd. see"10:43 2012-04-23"3-2).
libxl_run_bootloader is called while pv and bootloader is not defined. 

09:59 2012-04-19
GTD
0, -19:00

1, today
1), 20' install opensuse12.1 x86_64 on my rd pc. 
2), 20' vim study, mark and jump. see"11:24 2012-04-19". 
3), 1h install opensuse12.1, but display with dual monitor still tearing. 
4), 3h xenstore and xen console, see"10:00 2012-04-19". 

10:00 2012-04-19
suse, virtualization, libvirt, qemu, xen, read source code, cont4, read initialization and configuration code, read xen console relative code
1, summarize
1), qemu
domainCreate -> qemudDomainCreate -> qemuProcessStart -> qemuProcessWaitForMonitor -> qemuProcessReadLogOutput -> qemuProcessFindCharDevicePTYs -> qemuProcessExtractTTYPath
2), xen
domainOpenConsole -> xenUnifiedDomainOpenConsole -> xenDaemonDomainFetch -> xenStoreDomainGetConsolePath ->  virDomainDoStoreQuery -> xs_read
3), qemu get pty while domain create, xen get pty while need to use it during open console. 
xenlight should use the qemu way. 
4), So, i have already finished the task in "12:02 2012-04-18"4-1). Do 4-2) in next step. 

2, how to get console in xenlight. 
1), read xl.c relative code. 
do_domain_create -> libxl_device_console_add
                 -> libxl_device_console_destroy

2), read "xl console id" relative code.
xenconsole located at "/usr/lib64/xen/bin/xenconsole". 
"xl console" call "xenconsole" do the work.

3, just skip xenlight, direct using xenstore
1), command
linux-bvirt:/home/bamvor # xenstore
linux-bvirt:/home/bamvor # virsh list
 Id Name                 State
----------------------------------
  3 sles11_pv_6          running
  4 sles11_hvm_10        running

linux-bvirt:/home/bamvor # xenstore-read /local/domain/3/console/tty
/dev/pts/2
linux-bvirt:/home/bamvor # xenstore-read /local/domain/4/console/tty
/dev/pts/3
linux-bvirt:/home/bamvor # xenstore-ls /local/domain/3/console
backend = "/local/domain/0/backend/console/3/0"
backend-id = "0"
limit = "1048576"
type = "ioemu"
output = "pty"
port = "2"
ring-ref = "1146476"
tty = "/dev/pts/2"
vnc-port = "5903"
vnc-listen = "127.0.0.1"
2), add xenstore-read command into libvirt libxl driver. try it.

4, read libxl code again
libxl_get_event
libxl_vncviewer_exec

11:24 2012-04-19
software, skill, text editor, vim, moving around, mark and jump
1, ":help mark". 
1), 
1. With ` (backtick):	  The cursor is positioned at the specified location
			  and the motion is |exclusive|.
2. With ' (single quote): The cursor is positioned on the first non-blank
			  character in the line of the specified location and
			  the motion is linewise.
2), 
						*m'* *m`*
m{a-zA-Z}		Set mark {a-zA-Z} at cursor position (does not move
                        the cursor, this is not a motion command).

						*'* *'a* *`* *`a*
'{a-z}  `{a-z}		Jump to the mark {a-z} in the current buffer.

						*'A* *'0* *`A* *`0*
'{A-Z0-9}  `{A-Z0-9}	To the mark {A-Z0-9} in the file where it was set (not
			a motion command when in another file).  {not in Vi}
						*:marks*
:marks			List all the current marks (not a motion command).
			The |'(|, |')|, |'{| and |'}| marks are not listed.
			The first column has number zero.
			{not in Vi}

2, example
type "ma" in current place. then move the cursor to "11:24 2012-04-19", type"mb". 
i can using "'a"("`a") or "'b"("`b") to jump between these two place. 
":marks" will list all the marks:
:marks
mark line  col file/text
 '   2056    0 character in the line of the specified location and
 a   2022   52 3), vim study, mark and jump. see"11:24 2012-04-19".
 b   2049    0 11:24 2012-04-19
 j   2060    0 m{a-zA-Z}^I^ISet mark {a-zA-Z} at cursor position (does not move
 k   1065   19 #4  0x000000000046e7ae in qemudDomainCreate (conn=0x7fbaa80009a0,
 m   1041    0 <currentMemory>524288</currentMemory>\n  <vcpu>1</vcpu>\n  <os>\n    "...,
 n      1    0 .LOG
 0     31    7 /usr/src/packages/SOURCES/xen-4.1.2-testing/tools/python/xen/xend/XendBootloader.py
 1    983   28 /usr/src/packages/SOURCES/qemu-0.14.1/qemu-char.c
 2   4199    5 ~/sda3/home/novell/log/log201202novell.txt
 3    103    6 /usr/src/packages/SOURCES/xen-4.1.2-testing/tools/libxl/libxl_xshelp.c
 4     31   17 /usr/src/packages/SOURCES/xen-4.1.2-testing/tools/xenstore/xs.c
 5      1    0 /usr/src/packages/SOURCES/xen-4.1.2-testing/tools/xenstore/xc.c
 6      5    0 /usr/src/packages/SOURCES/xen-4.1.2-testing/tools/xenstore/README
 7    419    0 /usr/src/packages/SOURCES/xen-4.1.2-testing/tools/xenstore/xs.c
 8    116   19 /usr/src/packages/SOURCES/libvirt-0.9.6/src/xen/xs_internal.c
 9   1739   26 /usr/src/packages/SOURCES/qemu-0.14.1/vl.c
 "   1036   19 xml_desc=<optimized out>, flags=<optimized out>)
 [      1    0 .LOG
 ]   2079    0
 ^   2079    0
 .   2078   32 ":mark" will list all the marks:
 <   2060    0 m{a-zA-Z}^I^ISet mark {a-zA-Z} at cursor position (does not move
 >   2062    0

11:36 2012-04-19
software, skill, nfs, nfs client mount error 
1, mount nfs error 
mount.nfs: rpc.statd is not running but is required for remote locking.
mount.nfs: Either use '-o nolock' to keep locks local, or start statd.
mount.nfs: an incorrect mount option was specified
2, ref: http://www.linux-archive.org/red-hat-linux/634495-mount-nfs-rpc-statd-not-running-but-required-remote-locking.html

17:30 2012-04-19
software, skill, virtualization, xen, libvirt, useful path
libxl configure file while using libvirt: /etc/libvirt/libxl

12:49 2012-04-20
GTD
1, today
1), morning: study gdb and vim; surf web about arm development board. 
2), 20' read libxl code. see"13:01 2012-04-20"
3), 1h libvirt qemu usage. see"14:53 2012-04-20". 

13:01 2012-04-20
suse, virtualization, libvirt, qemu, xen, read source code, cont4, read initialization and configuration code, read xen console relative code, cont1
1, read libxl code again
continue from "10:00 2012-04-19". 
1), libxl_get_event: get event from libxl, type is defined in libxl_event_type
2), libxl_vncviewer_exec: read vnc paramter from xenstore, and launch vnc through libxl__exec -> execvp.
3), libxl_primary_console_exec: launch console. read xenconsole client. 
4), libxl_device_console_add
5), libxl_cpuid_parse_config
6), libxl_xen_console_read_start, libxl_xen_console_read_line, libxl_xen_console_read_finish

2, ref how virt-viewer work, how do it get vncviwer id from xl. 
1), "virsh vncdisplay" could get vnc port from xml, which is not exist in user xml
linux-bvirt:/etc/xen/vm # virsh dumpxml sles11_pv_6 | grep graphic
    <graphics type='vnc' port='5903' autoport='yes'/>
linux-bvirt:/etc/xen/vm # cat sles11_pv_6.xml | grep graphic
      <graphics type='vnc'/>
2), search libvirt libxl driver code, where set it?
libxlMakeVfb:
    if (l_vfb->data.vnc.autoport) {
        port = libxlNextFreeVncPort(driver, LIBXL_VNC_PORT_MIN);
        if (port < 0) {
            libxlError(VIR_ERR_INTERNAL_ERROR,
                        "%s", _("Unable to find an unused VNC port"));
            return -1;
        }
        l_vfb->data.vnc.port = port;
    }
    x_vfb->vncdisplay = l_vfb->data.vnc.port - LIBXL_VNC_PORT_MIN;
libxlNextFreeVncPort get vnc port through socket and bind. 

3, xenconsole: get pty from xs_read

4, libxl_device_console_add
1), add debug message in libxl__device_generic_add, but it is not print. 
debug step by step. 
(1), 
(gdb) break libxl__device_generic_add 
Breakpoint 1 at 0x7fb64026ab00

(gdb) symbol-file /usr/src/packages/SOURCES/xen-4.1.2-testing/tools/libxl/libxenlight.so.1.0.0
Load new symbol table from "/usr/src/packages/SOURCES/xen-4.1.2-testing/tools/libxl/libxenlight.so.1.0.0"? (y or n) y
Reading symbols from /usr/src/packages/SOURCES/xen-4.1.2-testing/tools/libxl/libxenlight.so.1.0.0...(no debugging symbols found)...done.
Error in re-setting breakpoint 1: Cannot access memory at address 0x1ab00
(gdb) break libxl__device_generic_add 
Cannot access memory at address 0x1ab00

So, offset is 0x7fb64026ab00 - 0x1ab00 = 0x7fb640250000 
(gdb) add-symbol-file /usr/src/packages/SOURCES/xen-4.1.2-testing/tools/libxl/libxenlight.so.1.0.0 0x7fb640250000
add symbol table from file "/usr/src/packages/SOURCES/xen-4.1.2-testing/tools/libxl/libxenlight.so.1.0.0" at
	.text_addr = 0x7fb640250000
(y or n) y
Reading symbols from /usr/src/packages/SOURCES/xen-4.1.2-testing/tools/libxl/libxenlight.so.1.0.0...(no debugging symbols found)...done.
(gdb) break libxl__device_generic_add 
Note: breakpoint 1 (disabled) also set at pc 0x7fb640262d30.
Breakpoint 2 at 0x7fb640262d30

\TODO: i need to find out which address the so file is loaded. 

4, \TODO: where can i get the full domain info in xen? 

14:53 2012-04-20
(14:15 2012-05-17)
virtualization, libvirt, virsh, console, qemu/kvm, xen, xenlight; doc, FAQ; \TODO: summarise
this is a weblink collection about how a use "virsh console" commands connect to qemu or qemu-kvm virtual machine(vm). for libvirt xen, just need modify the xml, do not need to update "/etc/inittab". for libvirt xenlight, my patch is not commit. using "/usr/lib64/xen/bin/xenconsole domainID" for work around. 
notes: test successful on guangliang zhao and my PC. 
1, basic
1), main doc
http://ubuntuforums.org/showthread.php?t=1159220
http://rwmj.wordpress.com/2011/07/08/setting-up-a-serial-console-in-qemu-and-libvirt/
backup ref: 
http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=507650
2), configure
(1), add for qemu/kvm
    <console type='pty'>
      <source path='/dev/pts/1'/>
      <target port='0'/>
    </console>
(2), modify /etc/inittab and grub menu.lst
((1)), inittab
0:2345:respawn:/sbin/mingetty ttyS0
((2)), add to kernel arguments
console=ttyS0,115200 console=tty0

2, how to fix "respawning too fast" error while system boot
1), bamvor for me because mingetty do not support my parameters. 
http://www.unixresources.net/linux/clf/linuxK/archive/00/00/32/76/327631.html
2), another ref: 
http://www.unixguide.net/linux/faq/09.24.shtml

16:45 2012-04-22
suse, virtualization, libvirt, qemu, xen, fix virsh startup warning
1, virsh startup warning
WARNING: no socket to connect to

2, output debug log
localhost:/home/bamvor # VIRSH_DEBUG=0 LIBVIRT_DEBUG=1 virsh 2>&1 | tee log.txt

16:46:24.006: 3163: info : libvirt version: 0.9.6
16:46:24.006: 3163: debug : virInitialize:422 : 
WARNING: no socket to connect to
16:46:24.009: 3163: debug : virInitialize:425 : register drivers
16:46:24.009: 3163: debug : virRegisterDriver:786 : driver=0x7f449a7b92a0 name=Test
16:46:24.009: 3163: debug : virRegisterDriver:810 : registering Test as driver 0
16:46:24.009: 3163: debug : virRegisterNetworkDriver:603 : registering Test as network driver 0
16:46:24.009: 3163: debug : virRegisterInterfaceDriver:636 : registering Test as interface driver 0
16:46:24.009: 3163: debug : virRegisterStorageDriver:669 : registering Test as storage driver 0
16:46:24.009: 3163: debug : virRegisterDeviceMonitor:702 : registering Test as device driver 0
16:46:24.009: 3163: debug : virRegisterSecretDriver:735 : registering Test as secret driver 0
16:46:24.009: 3163: debug : virRegisterNWFilterDriver:768 : registering Test as network filter driver 0
16:46:24.009: 3163: debug : xenHypervisorInit:2078 : Using new hypervisor call: 40001
16:46:24.010: 3163: debug : xenHypervisorInit:2194 : Using hypervisor call v2, sys ver8 dom ver8
16:46:24.010: 3163: debug : virRegisterDriver:786 : driver=0x7f449a7ba580 name=Xen
16:46:24.010: 3163: debug : virRegisterDriver:810 : registering Xen as driver 1
16:46:24.010: 3163: debug : virRegisterDriver:786 : driver=0x7f449a7bad60 name=OPENVZ
16:46:24.010: 3163: debug : virRegisterDriver:810 : registering OPENVZ as driver 2
16:46:24.010: 3163: debug : virRegisterDriver:786 : driver=0x7f449a7bb1c0 name=VMWARE
16:46:24.010: 3163: debug : virRegisterDriver:810 : registering VMWARE as driver 3
16:46:24.010: 3163: debug : vboxRegister:130 : VBoxCGlueInit failed, using dummy driver
16:46:24.010: 3163: debug : virRegisterDriver:786 : driver=0x7f449a7bb620 name=VBOX
16:46:24.010: 3163: debug : virRegisterDriver:810 : registering VBOX as driver 4
16:46:24.010: 3163: debug : virRegisterNetworkDriver:603 : registering VBOX as network driver 1
16:46:24.010: 3163: debug : virRegisterStorageDriver:669 : registering VBOX as storage driver 1
16:46:24.011: 3163: debug : virRegisterDriver:786 : driver=0x7f449a7bd9c0 name=ESX
16:46:24.011: 3163: debug : virRegisterDriver:810 : registering ESX as driver 5
16:46:24.011: 3163: debug : virRegisterInterfaceDriver:636 : registering ESX as interface driver 1
16:46:24.011: 3163: debug : virRegisterNetworkDriver:603 : registering ESX as network driver 2
16:46:24.011: 3163: debug : virRegisterStorageDriver:669 : registering ESX as storage driver 2
16:46:24.011: 3163: debug : virRegisterDeviceMonitor:702 : registering ESX as device driver 1
16:46:24.011: 3163: debug : virRegisterSecretDriver:735 : registering ESX as secret driver 1
16:46:24.011: 3163: debug : virRegisterNWFilterDriver:768 : registering ESX as network filter driver 1
16:46:24.011: 3163: debug : virRegisterDriver:786 : driver=0x7f449a7b9aa0 name=remote
16:46:24.011: 3163: debug : virRegisterDriver:810 : registering remote as driver 6
16:46:24.011: 3163: debug : virRegisterNetworkDriver:603 : registering remote as network driver 3
16:46:24.011: 3163: debug : virRegisterInterfaceDriver:636 : registering remote as interface driver 2
16:46:24.011: 3163: debug : virRegisterStorageDriver:669 : registering remote as storage driver 3
16:46:24.011: 3163: debug : virRegisterDeviceMonitor:702 : registering remote as device driver 2
16:46:24.011: 3163: debug : virRegisterSecretDriver:735 : registering remote as secret driver 2
16:46:24.011: 3163: debug : virRegisterNWFilterDriver:768 : registering remote as network filter driver 2
16:46:24.011: 3163: debug : virEventRegisterDefaultImpl:204 : registering default event implementation
16:46:24.011: 3163: debug : virEventPollAddHandle:112 : Add handle fd=4 events=1 cb=0x7f449a36a8c0 opaque=(nil)
16:46:24.011: 3163: debug : virEventPollAddHandle:116 : Used 0 handle slots, adding at least 10 more
16:46:24.011: 3163: debug : virEventPollInterruptLocked:676 : Skip interrupt, 0 0
16:46:24.011: 3163: debug : virEventRegisterImpl:177 : addHandle=0x7f449a36b490 updateHandle=0x7f449a36b360 removeHandle=0x7f449a36ad20 addTimeout=0x7f449a36ae80 updateTimeout=0x7f449a36b040 removeTimeout=0x7f449a36b170
Welcome to virsh, the virtualization interactive terminal.

Type:  'help' for help with commands
       'quit' to quit

virsh # quit

3, this log is print in function virNetTLSInit. 
virNetTLSInit -> gnutls_global_init

4, add debug info and soruce code for libgnutls
1), zypper in libgnutls //update to 3.0.3-5.3.1
zypper si libgnutls
2), try set breakpoint
Make breakpoint pending on future shared library load? (y or n)  

Breakpoint 1 (gnutls_global_init) pending.

breakpoint is valid but no source code.
3), install gnutls and set source code directory for libgnutls
(1), zypper si gnutls
(2), add dir in gdb
(gdb) dir /usr/src/packages/SOURCES/gnutls-3.0.3/lib
Source directories searched: /usr/src/packages/SOURCES/gnutls-3.0.3/lib:$cdir:$c
wd
ref: http://davis.lbl.gov/Manuals/GDB/gdb_8.html#SEC49
"7. Examining Source Files" -> "7.3 Specifying source directories"
(3), can not find that warning in gnutls source code either. 
(4), break gnutls_pkcs11_init
(5), write .gdbinit for convinience:
((1)), ref: http://stackoverflow.com/questions/100444/gdb-how-to-set-breakpoints-on-future-shared-libraries-with-a-command-flag
((2)), .gdbinit
localhost:/usr/src/packages/SOURCES/libvirt-0.9.6 # cat .gdbinit
dir /usr/src/packages/SOURCES/gnutls-3.0.3/lib
set breakpoint pending on
break gnutls_global_init
break gnutls_pkcs11_init
((3)), 
localhost:/usr/src/packages/SOURCES/libvirt-0.9.6 # gdb virsh 
GNU gdb (GDB) SUSE (7.3-41.1.2)
Copyright (C) 2011 Free Software Foundation, Inc.
License GPLv3+: GNU GPL version 3 or later <http://gnu.org/licenses/gpl.html>
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.  Type "show copying"
and "show warranty" for details.
This GDB was configured as "x86_64-suse-linux".
For bug reporting instructions, please see:
<http://www.gnu.org/software/gdb/bugs/>...
Reading symbols from /usr/bin/virsh...done.
Function "gnutls_global_init" not defined.
Breakpoint 1 (gnutls_global_init) pending.
Function "gnutls_pkcs11_init" not defined.
Breakpoint 2 (gnutls_pkcs11_init) pending.
(gdb) info break
Num     Type           Disp Enb Address    What
1       breakpoint     keep y   <PENDING>  gnutls_global_init
2       breakpoint     keep y   <PENDING>  gnutls_pkcs11_init
(gdb) 
(6), that warning message is printed by gnutls_pkcs11_init
Breakpoint 1, gnutls_global_init () at gnutls_global.c:207
207     {
(gdb) cont
Continuing.

Breakpoint 2, gnutls_pkcs11_init (flags=1, deprecated_config_file=0x0)
at pkcs11.c:541
541     {
(gdb) finish
Run till exit from #0  gnutls_pkcs11_init (flags=1, deprecated_config_file=0x0)
at pkcs11.c:541
Missing separate debuginfo for /usr/lib64/pkcs11/gnome-keyring-pkcs11.so
Try: zypper install -C "debuginfo(build-id)=1281a61d7a8b9c5bc19c5bdc2d40f10460124da7"
WARNING: no socket to connect to
gnutls_global_init () at gnutls_global.c:276
276       _gnutls_cryptodev_init ();
Value returned is $1 = -59
(gdb) 
(7), more details
Breakpoint 2, gnutls_pkcs11_init (flags=1, deprecated_config_file=0x0)
at pkcs11.c:541
541     {
...
556             ret = initialize_automatic_p11_kit ();
(gdb) 
Missing separate debuginfo for /usr/lib64/pkcs11/gnome-keyring-pkcs11.so
Try: zypper install -C "debuginfo(build-id)=1281a61d7a8b9c5bc19c5bdc2d40f10460124da7"
WARNING: no socket to connect to
558           _pkcs11_compat_init(deprecated_config_file);

4, about gnome-keyring
1), 
Breakpoint 4, rpc_C_Initialize (init_args=0x667788) at gkm-rpc-module.c:1125
1125    {
(gdb) where
#0  rpc_C_Initialize (init_args=0x667788) at gkm-rpc-module.c:1125
#1  0x00007ffff375ced7 in ?? () from /usr/lib64/libp11-kit.so.0
#2  0x00007ffff375d3c5 in ?? () from /usr/lib64/libp11-kit.so.0
#3  0x00007ffff375da8d in p11_kit_initialize_registered () from /usr/lib64/libp11-kit.so.0
#4  0x00007ffff69fb0b5 in initialize_automatic_p11_kit () at pkcs11.c:492
#5  gnutls_pkcs11_init (flags=<optimized out>, deprecated_config_file=0x0) at pkcs11.c:556
#6  0x00007ffff69e8072 in gnutls_global_init () at gnutls_global.c:273
#7  0x00007ffff7a02037 in virInitialize () at libvirt.c:419
#8  virInitialize () at libvirt.c:402
#9  0x0000000000409f27 in main (argc=1, argv=0x7fffffffde48) at virsh.c:16190
2), message is printed because of pkcs11_socket_path. \TODO: trace this bug when available. 
if (!pkcs11_socket_path) {
	warning (("no socket to connect to"));
	return CKR_DEVICE_REMOVED;
}

10:37 2012-04-23
GTD
1, today
1), 10:38-11:45 12:23 read libxl code. see"10:43 2012-04-23".
sleep 30' 

10:43 2012-04-23
suse, virtualization, libvirt, qemu, xen, read source code, cont4, read initialization and configuration code, read xen console relative code, cont2
1, continue, read the following functions, but these function do not commucate with xenstore. 
1), libxl_cpuid_parse_config
2), libxl_xen_console_read_start, libxl_xen_console_read_line, libxl_xen_console_read_finish

2, find out where insert my code. 
libxlDomainCreateXML -> libxlVmStart -> libxl_domain_create_new -> do_domain_create 
do_domain_create -> init_console_info
                 -> libxl_device_console_add -> libxl__device_generic_add
                 -> libxl_device_console_destroy

ret = init_console_info(&console, 0, &state);
libxl_device_console_add(ctx, domid, &console);
libxl_device_console_destroy(&console);

want to add in libxl_device_console_add, but not relative variable. 

3, if i found when /local/domain/5/console/tty is add in the xenstore. Maybe i can read it back. 
1), domain create 
do_domain_create -> libxl__domain_make
                 -> libxl_run_bootloader
                 -> libxl__domain_build -> libxl__build_hvm or libxl__build_pv
                                        -> libxl__build_post -> xs_introduce_domain
                 -> libxl_device_disk_add
                 -> libxl_device_nic_add
                 -> libxl_device_net2_add
                 -> init_console_info
                 -> libxl_device_console_add -> libxl__device_generic_add
                 -> libxl_device_console_destroy
                 -> libxl__create_device_model
                 -> libxl__create_xenpv_qemu
                 -> libxl__confirm_device_model_startup
                 -> libxl__device_pci_add
                 -> cb(autoconnect_console) -> libxl_primary_console_exec

qemu:
xenstore_domain_init2 -> xs_introduce_domain
                      -> xenstore_write_xxx
                      -> xen_config_dev_console
xenstored: 
main -> handle_input -> consider_message -> process_message -> do_introduct -> domain_conn_reset -> send_ack(conn, XS_INTRODUCE)

xenconsoled:
/local/domain/x/console/tty is writed by xenconsoled. 
main -> enum_domains
     -> handle_io -> hand_xs -> enum_domains
                             -> domain_create_ring
                  -> handle_tty_read -> domain_create_tty
                  -> handle_tty_write -> domain_create_tty

enum_domains -> xc_domain_getinfo
             -> lookup_domain
             -> shutdown_domain
             -> create_domain -> watch_domain -> domain_create_ring -> domain_create_tty

domain_create_tty -> openpty 
                  -> ptsname
                  -> write info to xenstore. 

2), in xenconsoled, dev is got by ptsname: slave = ptsname(dom->master_fd)
man ptsname: 
The ptsname() function returns the name of the slave pseudoterminal device corresponding to the master referred to by fd.

ttyname_r
DESCRIPTION
The  function  ttyname()  returns  a  pointer to the null-terminated pathname of the terminal device that is open on the file descriptor fd, or NULL on error (for example, if fd is not connected to a terminal).  The return value may point to static data, possibly overwritten by  the  next  call.   The  function  ttyname_r() stores this pathname in the buffer buf of length buflen.
RETURN VALUE
The  function ttyname() returns a pointer to a pathname on success.  On error, NULL is returned, and errno is set appropriately.  The function ttyname_r() returns 0 on success, and an error number upon error.

3), So, finally, the /local/domain/x/console/tty is writen by xenconsoled. I have to read it from xenstore. 

4, add code in xen libxl.so
1), using libxl__xs_read
prototype: 
char * libxl__xs_read(libxl__gc *gc, xs_transaction_t t, char *path)

example: libxl_domain_unpause and libxl_domain_preserve
libxl__gc gc = LIBXL_INIT_GC(ctx);
char *dom_path = 0;
dom_path = libxl__xs_get_dompath(&gc, domid);
path = libxl__sprintf(&gc, "%s/console/tty", dom_path);
state = libxl__xs_read(&gc, XBT_NULL, path);
libxl__free_all(&gc);

notes: libxl__free_all is a garbage collector. it will free all the buffer malloced in libxl__xs_read. 

2), add libxl_get_console_tty, test in xl command line pass. but fail in libvirt. 

10:23 2012-04-24
GTD
0, 10:00

1, today
1), work report
2), libvirt libxl driver. 

10:26 2012-04-24
(11:13 2012-04-25)
work report - week 16
1, bamvor jian zhang work report
[devel-server] work report - week 16
[green]
1, add one api in xenlight library for libvirt libxlDomainOpenConsole. 
It work in xenlight. libxlDomainOpenConsole work in para vm, not work in hvm virtul machine. 

10:56 2012-04-24
suse, virtualization, libvirt, qemu, xen, read source code, cont5, debug
1, segmentation fault
Program received signal SIGSEGV, Segmentation fault.
0x00000000004c4c47 in libxlDomainOpenConsole (dom=<optimized out>, 
    dev_name=0x0, st=0x7e5a40, flags=<optimized out>)
    at libxl/libxl_driver.c:3927

2, remove "if chr type"
1), sles11_hvm_10
(1), print console channel:
(gdb) p *chr
$5 = {deviceType = 1, targetType = 0, target = {port = 0, addr = 0x0, 
name = 0x0}, source = {type = 2, data = {file = {
path = 0x768750 "/dev/pts/4"}, tcp = {host = 0x768750 "/dev/pts/4", 
service = 0x0, listen = false, protocol = 0}, udp = {
bindHost = 0x768750 "/dev/pts/4", bindService = 0x0, 
connectHost = 0x0, connectService = 0x0}, nix = {
path = 0x768750 "/dev/pts/4", listen = false}, spicevmc = 7767888}}, 
info = {alias = 0x0, type = 0, addr = {pci = {domain = 0, bus = 0, 
slot = 0, function = 0}, drive = {controller = 0, bus = 0, unit = 0}, 
vioserial = {controller = 0, bus = 0, port = 0}, ccid = {
controller = 0, slot = 0}, usb = {bus = 0, port = 0x0}}, 
mastertype = 0, master = {usb = {startport = 0}}}}
(2), but can not input. 
/usr/lib64/xen/bin/xenconsole work, but "virsh conosle" do not work. 

2), sles11_pv_1
(gdb) p *chr
$7 = {deviceType = 2, targetType = 1, target = {port = 0, addr = 0x0, 
name = 0x0}, source = {type = 2, data = {file = {
path = 0x7fd268003620 "/dev/pts/8"}, tcp = {
host = 0x7fd268003620 "/dev/pts/8", service = 0x0, listen = false, 
protocol = 0}, udp = {bindHost = 0x7fd268003620 "/dev/pts/8", 
bindService = 0x0, connectHost = 0x0, connectService = 0x0}, nix = {
path = 0x7fd268003620 "/dev/pts/8", listen = false}, 
spicevmc = 1744844320}}, info = {alias = 0x0, type = 0, addr = {pci = {
domain = 0, bus = 0, slot = 0, function = 0}, drive = {
controller = 0, bus = 0, unit = 0}, vioserial = {controller = 0, 
bus = 0, port = 0}, ccid = {controller = 0, slot = 0}, usb = {
bus = 0, port = 0x0}}, mastertype = 0, master = {usb = {
startport = 0}}}}

3, status and next
1), status
(1),  libvirt xen: both pv and hvm work.
(2), libvirt xenlight: pv work. hvm console hang(no input and output). but "xenconsole hvm_dom_id" ok
2), next
(1), why libvirt xen(xm) work, but libvirt libxl not work. 
(2), the deviceType and targetType is different. 
(3), compare xenconsole code and libvirt virFDStreamOpenFile. 

4, type
1), target type
libvirt-0.9.6/src/conf/domain_conf.h
enum virDomainChrConsoleTargetType {
    VIR_DOMAIN_CHR_CONSOLE_TARGET_TYPE_SERIAL = 0,
    VIR_DOMAIN_CHR_CONSOLE_TARGET_TYPE_XEN,
    VIR_DOMAIN_CHR_CONSOLE_TARGET_TYPE_UML,
    VIR_DOMAIN_CHR_CONSOLE_TARGET_TYPE_VIRTIO,
    VIR_DOMAIN_CHR_CONSOLE_TARGET_TYPE_LXC,
    VIR_DOMAIN_CHR_CONSOLE_TARGET_TYPE_OPENVZ,

    VIR_DOMAIN_CHR_CONSOLE_TARGET_TYPE_LAST,
};

So, sles11_hvm_10 is serial console, sles11_pv_1 is xen console. What's the difference? 
2), device type
enum virDomainChrDeviceType {
    VIR_DOMAIN_CHR_DEVICE_TYPE_PARALLEL = 0,
    VIR_DOMAIN_CHR_DEVICE_TYPE_SERIAL,
    VIR_DOMAIN_CHR_DEVICE_TYPE_CONSOLE,
    VIR_DOMAIN_CHR_DEVICE_TYPE_CHANNEL,

    VIR_DOMAIN_CHR_DEVICE_TYPE_LAST,
};
So, sles11_hvm_10 is serial device, sles11_pv_1 is console device. What's the difference? 
is it affect the /etc/inittab in vm? 
3), type in xenstore. 
(1), xenlight
((1)), sles11_hvm_10: 
linux-bvirt:/usr/lib64/xen/bin # xenstore-read /local/domain/10/name
sles11_hvm_10
linux-bvirt:/usr/lib64/xen/bin # xenstore-ls /local/domain/10/console
backend = "/local/domain/0/backend/console/10/0"
backend-id = "0"
limit = "1048576"
type = "xenconsoled"
output = "pty"
port = "6"
ring-ref = "1044479"
tty = "/dev/pts/5"
vnc-port = "5902"
vnc-listen = "127.0.0.1"
((2)), sles11_pv_1:
linux-bvirt:/usr/lib64/xen/bin # xenstore-read /local/domain/11/name
sles11_pv_1
linux-bvirt:/usr/lib64/xen/bin # xenstore-ls /local/domain/11/console
backend = "/local/domain/0/backend/console/11/0"
backend-id = "0"
limit = "1048576"
type = "ioemu"
output = "pty"
port = "2"
ring-ref = "648971"
tty = "/dev/pts/4"
vnc-port = "5904"
vnc-listen = "127.0.0.1"
(2), xen(xm)
((1)), sles11_hvm_10: 
linux-bvirt:/usr/lib64/xen/bin # xenstore-read /local/domain/15/name
sles11_hvm_10
linux-bvirt:/usr/lib64/xen/bin # xenstore-ls /local/domain/15/console
port = "6"
limit = "1048576"
type = "ioemu"
vnc-port = "5903"
vnc-listen = "127.0.0.1"
tty = "/dev/pts/12"
((2)), sles11_pv_1:
linux-bvirt:/usr/lib64/xen/bin # xenstore-read /local/domain/14/name
sles11_pv_1
linux-bvirt:/usr/lib64/xen/bin # xenstore-ls /local/domain/14/console
tty = "/dev/pts/5"
vnc-port = "5902"
vnc-listen = "127.0.0.1"
ring-ref = "1105020"
port = "2"
limit = "1048576"
type = "ioemu"
(3), I puzzled why libxl hvm console type is xenconsoled??? 
If i can define the console as ioemu, maybe it will work.

5, trace ioemu and xenconsled
1), libxl using the default value as LIBXL_CONSBACK_XENCONSOLED which lead to type is xenconsoled. 
init_console_info:
    console->consback = LIBXL_CONSBACK_XENCONSOLED;
libxl_device_console_add: 
    if (console->consback == LIBXL_CONSBACK_XENCONSOLED)
        flexarray_append(front, "xenconsoled");
    else
        flexarray_append(front, "ioemu");
2), it is not work after change it.

6, virsh console in xen hvm
(gdb) p *chr
$1 = {deviceType = 1, targetType = 0, target = {port = 0, addr = 0x0, 
name = 0x0}, source = {type = 2, data = {file = {
path = 0x757730 "/dev/pts/4"}, tcp = {host = 0x757730 "/dev/pts/4", 
service = 0x0, listen = false, protocol = 0}, udp = {
bindHost = 0x757730 "/dev/pts/4", bindService = 0x0, 
connectHost = 0x0, connectService = 0x0}, nix = {
path = 0x757730 "/dev/pts/4", listen = false}, spicevmc = 7698224}}, 
info = {alias = 0x0, type = 0, addr = {pci = {domain = 0, bus = 0, 
slot = 0, function = 0}, drive = {controller = 0, bus = 0, unit = 0}, 
vioserial = {controller = 0, bus = 0, port = 0}, ccid = {
controller = 0, slot = 0}, usb = {bus = 0, port = 0x0}}, 
mastertype = 0, master = {usb = {startport = 0}}}}

7, debug libvirt libxl
1), "virsh console 21"
(gdb) where
#0  virNetServerServiceAccept (sock=0x797ef0, events=1, opaque=0x799820)
    at rpc/virnetserverservice.c:55
#1  0x00007f27a922f49f in virEventPollDispatchHandles (fds=<optimized out>, 
    nfds=<optimized out>) at util/event_poll.c:470
#2  virEventPollRunOnce () at util/event_poll.c:610
#3  0x00007f27a922e0a5 in virEventRunDefaultImpl () at util/event.c:247
#4  0x000000000044b6cd in virNetServerRun (srv=0x79b7a0)
    at rpc/virnetserver.c:701
#5  0x0000000000423f02 in main (argc=<optimized out>, argv=<optimized out>)
    at libvirtd.c:1574

p localAddr.data.sa.sa_data@3
$8 = {"/var/run/libvi", "rt/libvirt-soc", "k", '\000' <repeats 12 times>}
virsh and libvirt communicate through "/var/run/libvirt/libvirt-sock".
\TODO code excise with accept and getsockname. 

2), 

virEventPollDispatchHandles -> virNetSocketEventHandle -> virNetServerClientDispatchEvent -> virNetServerClientDispatchWrite
          -> virNetServerClientDispatchRead -> virNetServerClientRead -> virNetSocketRead -> virNetSocketReadWire -> read
virNetServerServiceAccept -> virNetSocketAccept 
                          -> virNetServerDispatchNewClient
3), when virsh poll return
(1), libvirtd
#0  virNetSocketWriteWire (sock=0x7f2794000900, buf=0x7f2794040eb1 "", len=36)
    at rpc/virnetsocket.c:932
#1  0x000000000044fcde in virNetSocketWrite (sock=0x7f2794000900, 
    buf=0x7f2794040eb1 "", len=36) at rpc/virnetsocket.c:1076
#2  0x000000000044a278 in virNetServerClientWrite (client=<optimized out>)
    at rpc/virnetserverclient.c:843
#3  virNetServerClientDispatchWrite (client=<optimized out>)
    at rpc/virnetserverclient.c:864
#4  virNetServerClientDispatchEvent (sock=<optimized out>, events=2, 
    opaque=0x7f2794000be0) at rpc/virnetserverclient.c:956
#5  0x00007f27a922f49f in virEventPollDispatchHandles (fds=<optimized out>, 
    nfds=<optimized out>) at util/event_poll.c:470
#6  virEventPollRunOnce () at util/event_poll.c:610
#7  0x00007f27a922e0a5 in virEventRunDefaultImpl () at util/event.c:247
#8  0x000000000044b6cd in virNetServerRun (srv=0x79b7a0)
(2), virsh
#0  virNetClientIOEventLoop (client=0x7f197f810010, thiscall=0x69f5f0)
    at rpc/virnetclient.c:900
#1  0x00007f197f2f46ec in virNetClientIO (thiscall=<optimized out>, 
    client=<optimized out>) at rpc/virnetclient.c:1136
#2  virNetClientSend (client=0x7f197f810010, msg=0x7f197f7cf010, 
    expectReply=true) at rpc/virnetclient.c:1218
#3  0x00007f197f2f6056 in virNetClientProgramCall (prog=0x69f8c0, 
    client=0x7f197f810010, serial=0, proc=66, 
    args_filter=0x7f197c2d2200 <xdr_void_internal>, args=0x0, 
    ret_filter=0x7f197f2ebae0 <xdr_remote_auth_list_ret>, ret=0x7fff8d15e970)
    at rpc/virnetclientprogram.c:291
#4  0x00007f197f2d49a7 in call (conn=<optimized out>, priv=0x69fa70, 
    flags=<optimized out>, proc_nr=66, 
    args_filter=0x7f197c2d2200 <xdr_void_internal>, args=0x0, 
    ret_filter=0x7f197f2ebae0 <xdr_remote_auth_list_ret>, 
    ret=0x7fff8d15e970 "") at remote/remote_driver.c:4122
#5  0x00007f197f2e4940 in remoteAuthenticate (authtype=<optimized out>, 
    auth=<optimized out>, priv=<optimized out>, conn=<optimized out>)
    at remote/remote_driver.c:2405
#6  doRemoteOpen (conn=0x69f7a0, priv=0x69fa70, auth=0x7f197f672100, flags=0)
    at remote/remote_driver.c:649
#7  0x00007f197f2e67a4 in remoteOpen (conn=0x69f7a0, auth=0x7f197f672100, 
    flags=<optimized out>) at remote/remote_driver.c:828
#8  0x00007f197f2b385c in do_open (name=0x0, auth=0x7f197f672100, flags=0)
    at libvirt.c:1072
#9  0x00007f197f2b4406 in virConnectOpenAuth (name=0x0, auth=0x7f197f672100, 
    flags=0) at libvirt.c:1298
#10 0x000000000041a3a1 in vshReconnect (ctl=0x7fff8d15ec90) at virsh.c:607
#11 0x000000000041a5f8 in vshCommandRun (ctl=0x7fff8d15ec90, cmd=0x69f6d0)
    at virsh.c:14775
#12 0x00000000004274ec in main (argc=<optimized out>, argv=<optimized out>)
    at virsh.c:16243

virNetClientProgramCall -> virNetMessageDecodePayload
                        -> virNetClientSend -> virNetClientIO -> virNetClientIOEventLoop
virNetClientIOEventLoop -> virNetClientIOHandleInput 

virNetClientIOHandleInput -> virNetClientIOReadMessage -> virNetSocketRead -> virNetSocketReadWire
                          -> virNetClientCallDispatchReply


recall libvirtd libxlDomainOpenConsole sequence: 
virNetServerNew -> virThreadPoolNew: create virNetServerHandleJob thread

#0  libxlDomainOpenConsole (dom=0x7dfac0, dev_name=0x0, st=0x7dfc40, flags=0)
    at libxl/libxl_driver.c:3883
#1  0x00007f8317443eb4 in virDomainOpenConsole (dom=0x7dfac0, dev_name=0x0, 
    st=0x7dfc40, flags=0) at libvirt.c:16354
#2  0x0000000000429633 in remoteDispatchDomainOpenConsole (
    args=<optimized out>, rerr=<optimized out>, hdr=<optimized out>, 
    client=<optimized out>, server=<optimized out>) at remote_dispatch.h:3394
#3  remoteDispatchDomainOpenConsoleHelper (server=<optimized out>, 
    client=0x7f8304000ba0, hdr=0x7f83040411f8, rerr=0x7f83102c4be0, 
    args=0x7dfc00, ret=<optimized out>) at remote_dispatch.h:3361
#4  0x0000000000448c6f in virNetServerProgramDispatchCall (
    msg=<optimized out>, client=<optimized out>, server=<optimized out>, 
    prog=<optimized out>) at rpc/virnetserverprogram.c:401
    msg=<optimized out>, client=<optimized out>, server=<optimized out>, 
    prog=<optimized out>) at rpc/virnetserverprogram.c:401
#5  virNetServerProgramDispatch (prog=0x79b160, server=0x79b7a0, 
    client=0x7f8304000ba0, msg=0x7f83040011e0) at rpc/virnetserverprogram.c:287
#6  0x000000000044c1ac in virNetServerHandleJob (jobOpaque=<optimized out>, 
    opaque=0x79b7a0) at rpc/virnetserver.c:136
#7  0x00007f83173cc1f6 in virThreadPoolWorker (opaque=<optimized out>)
    at util/threadpool.c:144
#8  0x00007f83173cb8a2 in virThreadHelper (data=0x4c4ad0)
    at util/threads-pthread.c:157 #9  0x00007f831378c7b6 in start_thread () from /lib64/libpthread.so.0 #10 0x00007f83132e49cd in clone () from /lib64/libc.so.6 #11 0x0000000000000000 in ?? ()

4), libvirt libxl console command
virsh: 
vshCommandRun -> vshReconnect
              -> cmd->def->handler(cmdConsole)

5), I do not know how socket communication works. debug qemu to know it. 

09:46 2012-04-25
GTD
1, today
1), 1.5h add helper function in bash. see"09:51 2012-04-25". 
2), work report, see"10:26 2012-04-24".
3), debug libvirt libxl console issue. see"09:47 2012-04-25". 
4), 30' 与同事讨论如果把全虚装上半虚驱动。或者如何把全虚改为半虚。

), wireshark opensuse bug. 

2, next
), verify the libvirt libxl bug. 
), push migrate to bugzilla by Lin Ma. 

1), libvirt configration file.
), contact Vincent Untz about Sanidhya. I think he is a good candidate for my project. 

3, next 
1), 感觉最近一直没做什么事情, 明天先把chunyan的migration作起来, 然后开始看libvirt代码. 每天都要看一部分. 或者一天看代码一天看bug. 
2), summarize kernel crash dump training. especially in crash tools and ABI. see"16:16 2012-03-16"
1), virtualization bug
(1), chunyan forward me a bug. i can get familiar with how to debug. 
https://bugzilla.novell.com/show_bug.cgi?GoAheadAndLogIn=1&id=653788
(2), 关注Jim在work report里面提到的bug. 

09:47 2012-04-25
suse, virtualization, libvirt, qemu, xen, read source code, cont6, debug, cont1
1, next
1), compare libvirt xen(xm) and xenlight dumpxml.
2), compare libvirt xen(xm) and xenlight chr struct.
3), trace communication between libvirt and virsh. compare difference between xen and libxl. 
4), if not work, compare xenconsole code and libvirt virFDStreamOpenFile. from "10:56 2012-04-24"3-2)-(3)

2, chr struct
1), xen(xm)
(gdb) p *chr
$1 = {deviceType = 1, targetType = 0, target = {port = 0, addr = 0x0, 
name = 0x0}, source = {type = 2, data = {file = {
path = 0x75cbd0 "/dev/pts/1"}, tcp = {host = 0x75cbd0 "/dev/pts/1", 
service = 0x0, listen = false, protocol = 0}, udp = {
bindHost = 0x75cbd0 "/dev/pts/1", bindService = 0x0, 
connectHost = 0x0, connectService = 0x0}, nix = {
path = 0x75cbd0 "/dev/pts/1", listen = false}, spicevmc = 7719888}}, 
info = {alias = 0x0, type = 0, addr = {pci = {domain = 0, bus = 0, slot = 0, 
function = 0}, drive = {controller = 0, bus = 0, unit = 0}, 
vioserial = {controller = 0, bus = 0, port = 0}, ccid = {controller = 0, 
slot = 0}, usb = {bus = 0, port = 0x0}}, mastertype = 0, master = {
usb = {startport = 0}}}}
2), xenlight
(gdb) p *chr
$24 = {deviceType = 1, targetType = 0, target = {port = 0, addr = 0x0, 
name = 0x0}, source = {type = 2, data = {file = {
path = 0x7e0560 "/dev/pts/2"}, tcp = {host = 0x7e0560 "/dev/pts/2", 
service = 0x0, listen = false, protocol = 0}, udp = {
bindHost = 0x7e0560 "/dev/pts/2", bindService = 0x0, 
connectHost = 0x0, connectService = 0x0}, nix = {
path = 0x7e0560 "/dev/pts/2", listen = false}, spicevmc = 8258912}}, 
info = {alias = 0x0, type = 0, addr = {pci = {domain = 0, bus = 0, slot = 0, 
function = 0}, drive = {controller = 0, bus = 0, unit = 0}, 
vioserial = {controller = 0, bus = 0, port = 0}, ccid = {controller = 0, 
slot = 0}, usb = {bus = 0, port = 0x0}}, mastertype = 0, master = {
usb = {startport = 0}}}}
3), there are same except spicevmc. \TODO: spicevmc

3, dumpxml. no significant difference:
diff sles11_hvm_10.xml.dump.xen sles11_hvm_10.xml.dump.libxl
1c1
< <domain type='xen' id='1'>
---
> <domain type='xen' id='2'>
9c9
<     <type>hvm</type>
---
>     <type arch='x86_64' machine='xenfv'>hvm</type>
18,20c18
<   <clock offset='utc'>
<     <timer name='hpet' present='no'/>
<   </clock>
---
>   <clock offset='utc'/>
29a28
>       <address type='drive' controller='0' bus='0' unit='0'/>
30a30
>     <controller type='ide' index='0'/>
35d34
<       <target dev='vif1.0'/>
38c37
<       <source path='/dev/pts/1'/>
---
>       <source path='/dev/pts/2'/>
41,42c40,41
<     <console type='pty' tty='/dev/pts/1'>
<       <source path='/dev/pts/1'/>
---
>     <console type='pty' tty='/dev/pts/2'>
>       <source path='/dev/pts/2'/>
46a46,49
>     <video>
>       <model type='cirrus' vram='9216' heads='1'/>
>     </video>
>     <memballoon model='xen'/>

4, console read/write analysis
1), read/write through virFDStreamWrite, virFDStreamRead in libvirt/src/fdstream.c
virFDStreamRead is not called while using xenlight. 
2), trace
#0  virFDStreamWrite (st=0x7dd6c0, bytes=0x7f119400cf2d "\r", nbytes=1)
    at fdstream.c:286
#1  0x00007f11a699ca22 in virStreamSend (stream=0x7dd6c0, 
    data=0x7f119400cf2d "\r", nbytes=1) at libvirt.c:13630
#2  0x000000000043e519 in daemonStreamHandleWriteData (msg=<optimized out>, 
    stream=<optimized out>, client=<optimized out>) at stream.c:495
#3  daemonStreamHandleWrite (stream=<optimized out>, client=<optimized out>)
    at stream.c:630
#4  daemonStreamEvent (st=0x7dd6c0, events=2, opaque=0x7f119400c8c0)
    at stream.c:147
#5  0x00007f11a6997a3a in virFDStreamEvent (watch=<optimized out>, 
    fd=<optimized out>, events=2, opaque=0x7dd6c0) at fdstream.c:158
#6  0x00007f11a691e49f in virEventPollDispatchHandles (fds=<optimized out>, 
    nfds=<optimized out>) at util/event_poll.c:470
#7  virEventPollRunOnce () at util/event_poll.c:610
#8  0x00007f11a691d0a5 in virEventRunDefaultImpl () at util/event.c:247
#9  0x000000000044b6cd in virNetServerRun (srv=0x79b7a0)
    at rpc/virnetserver.c:701
#10 0x0000000000423f02 in main (argc=<optimized out>, argv=<optimized out>)
    at libvirtd.c:1574

virEventPollDispatchHandles -> virNetSocketEventHandle -> 
virNetServerClientDispatchEvent -> virNetServerClientDispatchWrite(似乎没有实际执行就返回了）
                                -> virNetServerClientDispatchRead(call twice)

virNetServerClientDispatchRead -> virNetServerClientRead -> virNetSocketRead
                               -> virNetMessageQueueServe
                               -> virNetMessageDecodeHeader 
                               -> daemonStreamFilter
                               -> virNetMessageNew
                               -> virNetServerClientUpdateEvent

daemonStreamFilter -> virNetServerProgramMatches: check virNetServerProgramPtr 
                                                  and virNetMessagePtr->header
                   -> virNetMessageQueuePush: put msg into stream->rx queue
                   -> daemonStreamUpdateEvents -> virStreamEventUpdateCallback

virStreamEventUpdateCallback -> streamUpdateCallback -> virFDStreamUpdateCallback -> virEventUpdateHandle -> updateHandleImpl -> virEventPollUpdateHandle

virEventPollUpdateHandle -> virEventPollToNativeEvents: convert event. 
                            from VIR_EVENT_HANDLE_xxx to POLLxxx
                         -> virEventPollInterruptLocked -> virLogMessage
                                                        ->safewrite

safewrite:
buf: "14:22:52.982: 10559: debug : virEventPollInterruptLocked:676 : Skip interrupt, 1 -1483163552\n\0
count: 93
it is write log to "/var/log/libvirt/libvirtd.log"

1    393  libvirt-0.9.6/src/fdstream.c
<<GLOBAL>>
.streamUpdateCallback = virFDStreamUpdateCallback,
2   3607  libvirt-0.9.6/src/remote/remote_driver.c
<<GLOBAL>>
.streamUpdateCallback = remoteStreamEventUpdateCallback,

2), 

#1  0x00007f11a692563f in virLogOutputToFd (category=<optimized out>, 
    priority=<optimized out>, funcname=<optimized out>, 
    linenr=<optimized out>, 
    str=0x7f119400a230 "14:31:25.363: 10559: debug : virNetMessageNew:45 : msg=0
    x7f119400cf10 tracked=1\n", len=80, data=0x4) at util/logging.c:800
#2  0x00007f11a6926704 in virLogMessage (
    category=0x50baf5 "file.rpc/virnetmessage.c", priority=1, 
    funcname=0x50bcc0 "virNetMessageNew", linenr=45, flags=0, 
    fmt=<optimized out>) at util/logging.c:768
#3  0x000000000044ee86 in virNetMessageNew (tracked=true)
    at rpc/virnetmessage.c:45
#4  0x000000000044a3fc in virNetServerClientDispatchRead (
    client=<optimized out>) at rpc/virnetserverclient.c:808
#5  virNetServerClientDispatchEvent (sock=<optimized out>, events=1, 
    opaque=0x7f119400c8c0) at rpc/virnetserverclient.c:958
#6  0x00007f11a691e49f in virEventPollDispatchHandles (fds=<optimized out>, 
    nfds=<optimized out>) at util/event_poll.c:470
#7  virEventPollRunOnce () at util/event_poll.c:610
#8  0x00007f11a691d0a5 in virEventRunDefaultImpl () at util/event.c:247
#9  0x000000000044b6cd in virNetServerRun (srv=0x79b7a0)
    at rpc/virnetserver.c:701
#10 0x0000000000423f02 in main (argc=<optimized out>, argv=<optimized out>)
    at libvirtd.c:1574

3), 
virNetServerClientUpdateEvent -> virNetServerClientCalculateHandleMode: return 
                                 mode: VIR_EVENT_HANDLE_READABLE
                              -> virNetSocketUpdateIOCallback -> virEventUpdateHandle

5, lost. debug libvirt qemu. 
1), virFDStreamWrite
#1  0x00007fbad8c950ce in virStreamSend (stream=0x7fbaa400a540, 
    data=0x7c5bbd "\r", nbytes=1) at libvirt.c:13630
#2  0x000000000043bef0 in daemonStreamHandleWriteData (msg=0x7c5ba0, 
    stream=0x7fbaa400e7f0, client=0x781260) at stream.c:495
#3  daemonStreamHandleWrite (stream=0x7fbaa400e7f0, client=0x781260)
    at stream.c:630
#4  daemonStreamEvent (st=<optimized out>, events=2, opaque=0x781260)
    at stream.c:147
#5  0x00007fbad8c76b2a in virFDStreamEvent (watch=<optimized out>, 
    fd=<optimized out>, events=2, opaque=0x7fbaa400a540) at fdstream.c:158
#6  0x00007fbad8bff7a2 in virEventPollDispatchHandles (fds=<optimized out>, 
    nfds=9) at util/event_poll.c:470
#7  virEventPollRunOnce () at util/event_poll.c:611
#8  0x00007fbad8bfdf95 in virEventRunDefaultImpl () at util/event.c:247
#9  0x0000000000449e8d in virNetServerRun (srv=0x77b2e0)
    at rpc/virnetserver.c:701
#10 0x0000000000422479 in main (argc=<optimized out>, argv=<optimized out>)
    at libvirtd.c:1574

6, trace libvirt xen hvm console
1), 
#0  virConsoleEventOnStdout (watch=7759328, fd=1024, events=2, opaque=0x762b20)
    at console.c:272
#1  0x00007fd73f21649f in virEventPollDispatchHandles (fds=<optimized out>, 
    nfds=<optimized out>) at util/event_poll.c:470
#2  virEventPollRunOnce () at util/event_poll.c:610
#3  0x00007fd73f2150a5 in virEventRunDefaultImpl () at util/event.c:247
#4  0x000000000040a360 in vshRunConsole (dom=0x743c20, dev_name=0x0)
    at console.c:355
#5  0x000000000041eab3 in cmdRunConsole (ctl=0x7fff0ee5d6f0, dom=0x743c20, 
    name=0x0) at virsh.c:810
#6  0x000000000041ee7d in cmdConsole (ctl=0x7fff0ee5d6f0, cmd=0x6a4190)
    at virsh.c:836
#7  0x000000000041a4f8 in vshCommandRun (ctl=0x7fff0ee5d6f0, cmd=0x6a4190)
    at virsh.c:14780
#8  0x00000000004274ec in main (argc=<optimized out>, argv=<optimized out>)
    at virsh.c:16243

7,  今天跟了一天没什么进展，感觉还是文件操作参数的问题，明天看看xenconsole代码。


09:51 2012-04-25
software, skill, Linux, shell, bash, function; gdb helper; logAssistant helper
0, add two line in "/etc/bash.bashrc"
tail -n 2 /etc/bash.bashrc
. /home/bamvor/log/novell/Linux_environment/bash/gdb_debug
. /home/bamvor/log/novell/Linux_environment/bash/logAssistant_helper

1, gdb helper function: launch gdb with process name
cat /home/bamvor/log/novell/Linux_environment/bash/gdb_debug
dbgtui() {
    echo "debug $1 with gdbtui"
    gdbtui --pid `ps -e | grep $1 -w | sed "s/^\ *//g" | cut -d \  -f 1`
}

dbg() {
    echo "debug $1 with gdb"
    gdb --pid `ps -e | grep $1 -w | sed "s/^\ *//g" | cut -d \  -f 1`
}

2, logAssistant perl script helper function
cat /home/bamvor/log/novell/Linux_environment/bash/logAssistant_helper
export LOG_BASE="/home/${USER}/log"
find_keyword () { 
    ${LOG_BASE}/logAssistant/perl/find_keyword.pl -f "${LOG_BASE}/log*.txt" -i -u -k "$1" -c "$2"
}

find_keyword_output () { 
    ${LOG_BASE}/logAssistant/perl/find_keyword.pl -f "${LOG_BASE}/log*.txt" -i -u -k "$1" -c "$2" -o "${LOG_BASE}/output_$1_$2.txt"
    less "${LOG_BASE}/output_$1_$2.txt"
}

find_keyword_2012 () { 
    ${LOG_BASE}/logAssistant/perl/find_keyword.pl -f "${LOG_BASE}/log2012*.txt" -i -u -k "$1" -c "$2"
}

find_keyword_2012_output () { 
    ${LOG_BASE}/logAssistant/perl/find_keyword.pl -f "${LOG_BASE}/log2012*.txt" -i -u -k "$1" -c "$2" -o "${LOG_BASE}/output_$1_$2.txt"
    less "${LOG_BASE}/output_$1_$2.txt"
}

14:38 2012-04-26
GTD
1, today
1), maillist. see"14:38 2012-04-26"

14:38 2012-04-26
maillist, check package inter-dependencies, kiwi; suse studio
1, using kiwi check package inter-dependencies
1), "Marcus Schäfer<ms@suse.de>"email"Re: [Research] Checking package inter-dependencies within a repo"
> Given a package repo (YaST, repomd, or plain directory) what is the best
> way to check that for every package in the repo, all it's dependencies
> can be resolved from that same repo?

what you can do is solve all the packages in that repo by using satsolver
you can use kiwi with a mini image description like this:

---cut---

<image schemaversion="5.3" name="solver-test">
   <description type="system">
       <author>bob</author>
       <contact>bob@bob.com</contact>
       <specification>solver-test</specification>
   </description>
   <preferences>
       <type image="tbz"/>
       <version>1.1.1</version>
   </preferences>
   <repository type="yast2">
       <source path="iso:///image/CDs/openSUSE-12.1-DVD-x86_64.iso"/>
   </repository>
   <packages type="image">
       <!--- your package list -->
       <package name="vim"/>
   </packages>
</image>

---paste---

mkdir __bob
vi __bob/config.xml

  ==> cut and paste the above
  ==> adapt repo and package list

kiwi --info __bob/ --select packages

if the solver find problems you will see it

Regards,
Marcus

2), kiwi and SUSE Studio
(1), http://opensuse.github.com/kiwi/
http://susestudio.com/
(2), KIWI -- OS Image and Appliance builder
The KIWI Image System provides a complete operating system image solution for Linux supported hardware platforms as well as for virtualisation systems like KVM (Qemu), Xen, or VMware. KIWI is a command line tool and is the backend of SUSE Studio. The project is sponsored by SUSE.

17:52 2012-04-26
suse, virtualization, libvirt, qemu, xen, libxlDomainOpenConsole, libxl_get_console_tty, debug
1, review xenconsole, I found that xenconsole read the difference xenstore path for hvm: 
pty=/local/domain/1/serial/0/tty, fd=6

2, it is ok in libvirt. 
next: modify code. the code is very ugly. 

20:13 2012-4-26
openstack
1, openstack 定位于千台万台的虚拟机，传统虚拟机定位在几十台机器。	
2, openstack infrastructure service: NOVA. use libvirt api control vm.

8:00 2012-4-27
sync
1, Jason
1), germany
2), boyang visa.
3), meeting in next week. 
4), chunyan got a daughter. 

1, bamvor jian zhang

2, boyang
1), kvm, open vSwitch
open vSwitch
http://openvswitch.org/
Open vSwitch – 开放虚拟交换标准
http://www.tektalk.org/2010/12/20/open-vswitch-%E5%BC%80%E6%94%BE%E8%99%9A%E6%8B%9F%E4%BA%A4%E6%8D%A2%E6%A0%87%E5%87%86/
虚拟交换机项目Open vSwitch源码简单阅读--网络数据包流向
http://hi.baidu.com/widebright/blog/item/c6d5f21f9b6086e4e0fe0bf2.html

3, Lin ma, cobi? 

4, 最后Jim说啥了？ 

5, English
visa US: [ˈvizə]  UK: [ˈviːzə]
1.  an official document or mark in your passport that allows you to enter or leave a country for a specific purpose or period of time
v.
1.  to provide somebody with a visa

10:26 2012-04-27
talk to JIm
as i talked in regular meeting today.

10:28 2012-04-27
GTD
1, today
1), 40' regular meeting. 
2), Jim

2, next
send xen-unstable. Jim.

13:28 2012-04-27
company, law, legal
"Vivian Wang"email
1, en
Hi, all,
This is Vivian Wang, Legal counsel.
My last working day in Novell will be April 30th, 2012. After i leave, Legal work will be taken care by Zhong Zi Law firm.
all the documents that need Legal to review are requested to be sent to the following email address
laijiaying@zhongzi.com.cn
with Ms. Lai Jia Ying as the recipient.
Her telephone No is 86 10 6625 6438
Thank you.
2, cn
各位同事,你们好.
 
我是Vivian Wang, 公司的Legal Counsel. 
我将于2012年4月30日离开公司.我离职后,公司的法律事务将委托中咨律师事务所处理.
公司需要盖章的文件,请全部发到该律师事务所的如下EMAIL地址.
laijiaying@zhongzi.com.cn
联系人: 赖佳颖律师
电话号码: 010 6625 6438
 
经上述律师审核后的文件才可盖章.
 
谢谢.

11:24 2012-04-28
suse, virtualization, libvirt, qemu, xen, libxlDomainOpenConsole, libxl_get_console_tty, send xen patch; documents, manaul; how to configure groupwise stmp
1, how to send patch:
http://wiki.xen.org/wiki/SubmittingXenPatches
http://mercurial.selenic.com/wiki/MqExtension#Email_all_applied_patches
http://mercurial.selenic.com/wiki/QuickStart

2, hg
1), hg qnew: create patch
(1), 
bamvor@linux-bhi8:xen-unstable.hg> hg qnew patch01.diff
abort: no username supplied (see "hg help config")
(2), ref: http://mercurial.selenic.com/wiki/QuickStart
diff ~/.hgrc ~/.hgrc~
1,3d0
< [ui]
< username = Bamvor Jian Zhang <bjzhang@suse.com>
< 
(3), hg qnew pass
bamvor@linux-bhi8:xen-unstable.hg> hg qnew patch01.diff
bamvor@linux-bhi8:xen-unstable.hg> 
2), edit file
3), hg qrefresh -e: save changes
When you're done editing, save your changes into the patch, and add a description. The easiest way to add a description is to use the -e option to hg qrefresh:
hg qrefresh -e
(1), 
bamvor@linux-bhi8:xen-unstable.hg> hg qrefresh -e
fill in patch info: 

foobar: Add a new trondle calls

Add a some new trondle calls to the foobar interface to support
the new zot feature.

Signed-off-by: Joe Smith <joe.smith@citrix.com>

bamvor@linux-bhi8:xen-unstable.hg> 
3), hg out
bamvor@linux-bhi8:xen-unstable.hg> hg out
comparing with http://xenbits.xensource.com/xen-unstable.hg
searching for changes
changeset:   25255:54dbd9fac210
tag:         patch01.diff
tag:         qbase
tag:         qtip
tag:         tip
user:        Bamvor Jian Zhang <bjzhang@suse.com>
date:        Sat Apr 28 11:59:15 2012 +0800
summary:     foobar: foo

4), send patch
(1), fail
bamvor@linux-bhi8:xen-unstable.hg> hg email -o --plain --to bjzhang@suse.com --cc bamv2005@gmail.com
comparing with http://xenbits.xensource.com/xen-unstable.hg
searching for changes
This patch series consists of 1 patches.


** unknown exception encountered, please report by visiting
**  http://mercurial.selenic.com/wiki/BugTracker
** Python 2.7.2 (default, Aug 19 2011, 20:41:43) [GCC]
** Mercurial Distributed SCM (version 1.9.3)
** Extensions loaded: mq, patchbomb
Traceback (most recent call last):
  File "/usr/bin/hg", line 38, in <module>
    mercurial.dispatch.run()
  File "/usr/lib64/python2.7/site-packages/mercurial/dispatch.py", line 27, in run
    sys.exit(dispatch(request(sys.argv[1:])))
  File "/usr/lib64/python2.7/site-packages/mercurial/dispatch.py", line 64, in dispatch
    return _runcatch(req)
  File "/usr/lib64/python2.7/site-packages/mercurial/dispatch.py", line 87, in _runcatch
    return _dispatch(req)
  File "/usr/lib64/python2.7/site-packages/mercurial/dispatch.py", line 688, in _dispatch
    cmdpats, cmdoptions)
  File "/usr/lib64/python2.7/site-packages/mercurial/dispatch.py", line 463, in runcommand
    ret = _runcommand(ui, options, cmd, d)
  File "/usr/lib64/python2.7/site-packages/mercurial/dispatch.py", line 742, in _runcommand
    return checkargs()
  File "/usr/lib64/python2.7/site-packages/mercurial/dispatch.py", line 696, in checkargs
    return cmdfunc()
  File "/usr/lib64/python2.7/site-packages/mercurial/dispatch.py", line 685, in <lambda>
    d = lambda: util.checksignature(func)(ui, *args, **cmdoptions)
  File "/usr/lib64/python2.7/site-packages/mercurial/util.py", line 389, in check
    return func(*args, **kwargs)
  File "/usr/lib64/python2.7/site-packages/mercurial/extensions.py", line 137, in wrap
    util.checksignature(origfn), *args, **kwargs)
  File "/usr/lib64/python2.7/site-packages/mercurial/util.py", line 389, in check
    return func(*args, **kwargs)
  File "/usr/lib64/python2.7/site-packages/hgext/mq.py", line 3218, in mqcommand
    return orig(ui, repo, *args, **kwargs)
  File "/usr/lib64/python2.7/site-packages/mercurial/util.py", line 389, in check
    return func(*args, **kwargs)
  File "/usr/lib64/python2.7/site-packages/hgext/patchbomb.py", line 540, in patchbomb
    sendmail = mail.connect(ui)
  File "/usr/lib64/python2.7/site-packages/mercurial/mail.py", line 100, in connect
    return _smtp(ui)
  File "/usr/lib64/python2.7/site-packages/mercurial/mail.py", line 57, in _smtp
    s.starttls()
  File "/usr/lib64/python2.7/smtplib.py", line 626, in starttls
    raise SMTPException("STARTTLS extension not supported by server.")
smtplib.SMTPException: STARTTLS extension not supported by server.
(2), ref: http://stackoverflow.com/questions/6355456/starttls-extension-not-supported-by-server, modify ~/.hgrc

17c17
< tls = true
---
> #tls = true
(3), successful
bamvor@linux-bhi8:xen-unstable.hg> hg email -o --plain --to bjzhang@suse.com --cc bamv2005@gmail.com
comparing with http://xenbits.xensource.com/xen-unstable.hg
searching for changes
This patch series consists of 1 patches.


password: 
Sending [PATCH] foobar: foo ...

5), summary, "~/.hgrc":
[ui]
username = Bamvor Jian Zhang <bjzhang@suse.com>

[extensions]
mq=
hgext.patchbomb = 

[email]
method = smtp
from = Bamvor Jian Zhang <bjzhang@suse.com>
cc = bjzhang@suse.com

[smtp]
host = mail.novell.com
port = 25
username = bjzhang

[diff]
showfunc=True

3, send patch

4, send the realy patch
1), fail
(1), bamvor@linux-bhi8:xen-unstable.hg> hg qnew patch_0428_libxl_console_helper_api.diff
abort: working directory revision is not qtip

ref: http://dw-dev-training.dreamwidth.org/1673.html
bamvor@linux-bhi8:xen-unstable.hg> hg update -C qtip
4 files updated, 0 files merged, 0 files removed, 0 files unresolved
(2), (13:25 2012-06-06)
another choice(if there is already a patch exist in the patch queue, which patch depend on another SCM version. but I do not apply to that version. So, I need to delete the old patch and create the new patch). 
bamvor@linux-14:~/work/source/virtualization/xen/upstream/xen-unstable.hg> hg qnew patch04.diff
abort: working directory revision is not qtip
bamvor@linux-14:~/work/source/virtualization/xen/upstream/xen-unstable.hg> hg update -C qtip
31 files updated, 0 files merged, 2 files removed, 0 files unresolved
bamvor@linux-14:~/work/source/virtualization/xen/upstream/xen-unstable.hg> hg qpop -a
popping patch03.diff
patch queue now empty
bamvor@linux-14:~/work/source/virtualization/xen/upstream/xen-unstable.hg> hg up
33 files updated, 0 files merged, 0 files removed, 0 files unresolved
"13:25 2012-06-06"
2), command list
hg qnew patchXXX.diff
hg qrefresh -e
hg out
hg email -o --plain --to xen-devel@lists.xensource.com --cc bjzhang@suse.com

bamvor@linux-bhi8:xen-unstable.hg> hg email -o --plain --to xen-devel@lists.xensource.com --cc bjzhang@suse.com
comparing with http://xenbits.xensource.com/xen-unstable.hg
searching for changes
This patch series consists of 1 patches.


password:
Sending [PATCH] [mq]: patch_libxl_get_console_tty.diff ...

19:44 2012-4-30
xen, architecture
1, memory virtualization
1), tlb
in 2003, x86 does not support software tlb and tagged tlb.
bamvor: arm cortex-a support tagged tlb.

