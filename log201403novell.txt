.TODO
11:25 2014-03-03
TODO: check similar regiser as CR0 wp in arm.

14:06 2014-03-03
How to send Ctrl-Alt-Del to my VM?
http://lists.xen.org/archives/html/xen-devel/2009-10/msg00825.html
On Fri, Oct 16, 2009 at 06:02:20PM +0900, Jun Koi wrote:
> Hi,
> 
> My Windows HVM askes me to press Ctrl-Alt-Del to log in. But that keys
> are captured by the host. How can I send those keys to my VM?
> 
> I am using VNCViewer, if that matters.
> 

VNCviewer should have some menu where you can choose to send
ctrl-alt-del. Try pressing F8 (iirc) ?

Or use virt-viewer..

-- Pasi

14:25 2014-03-03
EVP
1,
自由度: 自由度. 参考mulei邮件.
分享:
社区: 分享及社区文化参与; 提高公司的社区影响力. 公司鼓励大家参与社区.
即使之前对开源不了解, 来suse之后也越来越了解.
平等: 对于任何个人和团体都没有差别待遇.

基因: 遗传, 进化.
suse: 平台, 鼓励.

过门: 说了这么多, 感觉开源就像阳光, 水和空气一样, 是生活的必须品.

产品会进化。

2, 开源与suse.
开源故事.
问答: 长江有大湖.
Linux: 鄱阳湖. 候鸟的天堂: Linux对于开源世界的影响. distribution: opensuse.
GNOME: 洞庭湖. Sun. David. 养殖基地.
Xen: 太湖. 产螃蟹. Chunyan. 太湖是庞大的灌溉系统.

注意节奏. 突出suse的产品.
基因如何体现?

15:18 2014-03-03
1, Linux贡献排名
http://www.cnbeta.com/articles/265831.htm
RedHat, Intel, TI, Linaro, SUSE, IBM, Samsung, Google.

22:12 2014-03-03
Hi, Jason
> Hi Bamvor,
>
> I have just assigned you the following L3 Xen bug:  Bug 865219 - L3: USB passthrough (qemu-dm) to Windows VM crashed with segfault
yeah, and i have read your discussion in bugzilla.
>
> Do you have time to look into the issue, perhaps while waiting for responses from upstream about your feature work? I know you don't have a lot of experience with the qemu-dm code, but that's the case for pretty much everyone else on the team as well.
>
> I seem to recall Chun Yan dealing with some sort of usb passthrough issue in the past, so she might be able to give you some direction.
after discuss it with Chunyan, i will test with qemu upstream for this bug tomorrow. considering the qemu upstream is default qemu from xen 4.3 and there are lots of difference between qemu-dm and qemu upstream. it worth to try.
>
> If for some reason this bug is going to be overly burdensome to you, please let me know. Thanks.
>
> Jason
>
BTW, i heard from roger that this bug is assigned to others when i am on vacation. is there other guys work on this bug?

regards

bamvor

09:59 2014-03-04
GTD
0, 9:50

1, today
1), 10:20 bnc#865219. see"10:38 2014-03-04"

10:38 2014-03-04
bnc#865219
1, qemu upstream is not support in xm.
TODO try xl usb passthrough. it should be works if customer device is 1.1 usb device.
2, win server 2008 x64, sles11sp3, xen 4.2.2
xen10:/home/images/winserver2008x64 # xm start win2008x64
xen10:/home/images/winserver2008x64 # lsusb
Bus 001 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub
Bus 002 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub
Bus 001 Device 002: ID 8087:0020 Intel Corp. Integrated Rate Matching Hub
Bus 002 Device 002: ID 8087:0020 Intel Corp. Integrated Rate Matching Hub
Bus 002 Device 003: ID 0d3d:0040 Tangtop Technology Co., Ltd
Bus 002 Device 004: ID 05e3:0736 Genesys Logic, Inc.
Bus 002 Device 005: ID 046d:c05a Logitech, Inc. Optical Mouse M90
xen10:/home/images/winserver2008x64 # xm usb-list win2008x64
xen10:/home/images/winserver2008x64 # xm usb-add win2008x64 host:05e3:0736
xen10:/home/images/winserver2008x64 # xm usb-add win2008x64 host:046d:c05a

4, kernel message
1), a kernel fault when i have lunch. is it relative?
<0>[11712.207338] general protection fault: 0000 [#1] SMP
<4>[11712.207351] CPU 0
<4>[11712.20754] Modules linked in:  aelr ip_tblterips eb_ebtalsxtale plktaac sb_scik lkacatxnbe nthn _os__sndndevie e_edge lcrodefseloehpotp_modcc_hnd_dadaltha_ntesd_coec dnm cba20pnd_ pp1 dosarpo r5eial to CO_Cvedo_sppolipibcnter skema psrc_iidoe_pac3bdmbaceuh1drmelp c_ago2c_oe smo cc_10if_g lgpguttcdbusbcomoessmalhsciai_dscspcsi_ui_d xc xnntahaibai_m>[117Sud, al712207
>[1075i72,corened:   X 3-11- ellInil 9     /D43[23] IP0<fff3de><ffff819d> d_asex0>[20754] P: e088018b  EFLAS: 00
<4>[1255] RX: 0fb0bf8f1RBX: 00000000 RC:801cba1>2.207560 ffff801d58170 SI: 0000000: ffff5a1005
4>[171. RBP: 0188 R08000 R09 fff881ca64>[1122070ffff83e78 11: 0000012: 00000000
<>[11578] 13:ffffb70 R14 0e3e08 R0000008000120] FS7f161937) GS:fff881e8000(000l:00000
    <>2.205Ce033 D0 ES: R00033
    <4.20760: 00054900 CR3 00004000 C000002661171220768] D00000000 DR1000R 000000000
    <271R000000R6: 00ffffR 00000>[11711] Prcessfired: 77en ffff80186200, ts ff885)<0>[122]k:
<4[177630] f1d95a1f1db58fff880024 ff8801d74[117125ffff8810000000000058018b63e68 fff88785c
<4>26]  fffb6e3f38801d9a100 fff8868fffff81<0>[11668] Ca:[12.20768fffffff803a8atnat+0xd9
<4>[107  [<ff80 89 c3 0f 05 00 48 8b 220 48 8 0f 84d2 0 00 0 8b 41 0 <48[1.28]  83 8 00 0 85 6 f6 45 40 0f84d 00 0
[11712.07826R fffff1391e>] _st+0xe800
<>[1112.27837  RSffff883d78>
4>[1712.20 --- end ce e56c423b478 -

2),
<3>[  236.264052] INFO: rcu_sched_state detected stall on CPU 0 (t=15000 jiffies)
<6>[  236.264052] sending NMI to all CPUs:
<4>[  236.264052] NMI backtrace for cpu 0
<4>[  236.264052] CPU 0
<4>[  236.264052] Modules linked in: usb_storage ip6table_filter ip6_tables iptable_filter ip_tables ebtable_nat ebtables x_tables nbd blktap blktap2 pciback usbbk xen_scsibk blkbk blkback_pagemap netbk xenbus_be gntdev evtchn snd_pcm_oss snd_mixer_oss snd_seq snd_seq_device edd af_packet bridge stp llc microcode fuse loop pciehp pci_hotplug dm_mod snd_hda_codec_hdmi 8250_pnp snd_hda_codec_realtek ppdev parport_pc parport 8250 serial_core sg rtc_cmos dcdbas(X) domctl container iTCO_wdt iTCO_vendor_support ipv6 ipv6_lib dell_wmi pcspkr sparse_keymap snd_hda_intel snd_hda_codec snd_hwdep i2c_i801 snd_pcm e1000e snd_timer snd serio_raw soundcore wmi snd_page_alloc ext3 jbd mbcache usbhid hid i915 drm_kms_helper drm i2c_algo_bit i2c_core video sd_mod crc_t10dif ehci_hcd usbcore usb_common intel_agp intel_gtt agpgart button processor thermal_sys hwmon scsi_dh_rdac scsi_dh_emc scsi_dh_hp_sw scsi_dh_alua scsi_dh xenblk cdrom xennet ahci libahci libata scsi_mod
<4>[  236.264052] Supported: Yes, External
<4>[  236.264052]
<4>[  236.264052] Pid: 4962, comm: firefox Tainted: G      D W   X 3.0.76-0.11-xen #1 Dell Inc. OptiPlex 980                 /0D438T
<4>[  236.264052] RIP: e030:[<ffffffff8000330a>]  [<ffffffff8000330a>] HYPERVISOR_vcpu_op+0xa/0x20
<4>[  236.264052] RSP: e02b:ffff8801e4803d00  EFLAGS: 00000046
<4>[  236.264052] RAX: 0000000000000000 RBX: 0000000000000000 RCX: ffffffff8000330a
<4>[  236.264052] RDX: 0000000000000000 RSI: 0000000000000000 RDI: 000000000000000b
<4>[  236.264052] RBP: ffffffff80736ce0 R08: 0000000000000200 R09: ffffffff80736ce0
<4>[  236.264052] R10: 0720072007200720 R11: 0000000000000246 R12: 0000000000000002
<4>[  236.264052] R13: ffffffff80736ce0 R14: ffff8801e4807740 R15: ffff8801e4803e68
<4>[  236.264052] FS:  00007f56726ce720(0000) GS:ffff8801e4800000(0000) knlGS:0000000000000000
<4>[  236.264052] CS:  e033 DS: 0000 ES: 0000 CR0: 0000000080050033
<4>[  236.264052] CR2: 00007f5665a838e0 CR3: 00000001d16c7000 CR4: 0000000000002660
<4>[  236.264052] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
<4>[  236.264052] DR3: 0000000000000000 DR6: 00000000ffff0ff0 DR7: 0000000000000400
<4>[  236.264052] Process firefox (pid: 4962, threadinfo ffff8801c71d2000, task ffff8801c7210580)
<0>[  236.264052] Stack:
<4>[  236.264052]  0720072007200720 0000000000000000 ffffffff802e9f2c ffff8801e4803d28
<4>[  236.264052]  00000000ffffffff ffffffff80736ce0 ffffffff8001875a ffffffff80736ce0
<4>[  236.264052]  0000000000000000 ffffffff806e8d00 ffffffff806e8e00 ffffffff8007a590
<0>[  236.264052] Call Trace:
<4>[  236.264052]  [<ffffffff802e9f2c>] notify_remote_via_ipi+0x4c/0xa0
<4>[  236.264052]  [<ffffffff8001875a>] xen_send_IPI_mask+0x3a/0x70
<4>[  236.264052]  [<ffffffff800188ca>] arch_trigger_all_cpu_backtrace+0x8a/0xd0
<4>[  236.264052]  [<ffffffff800aed15>] check_cpu_stall+0xa5/0x100
<4>[  236.264052]  [<ffffffff800aed99>] __rcu_pending+0x29/0x180
<4>[  236.264052]  [<ffffffff800aef4f>] rcu_check_callbacks+0x5f/0x110
<4>[  236.264052]  [<ffffffff8005678f>] update_process_times+0x3f/0x80
<4>[  236.264052]  [<ffffffff8007a5eb>] tick_sched_timer+0x5b/0xc0
<4>[  236.264052]  [<ffffffff8006e13e>] __run_hrtimer+0xde/0x1c0
<4>[  236.264052]  [<ffffffff8006e487>] hrtimer_interrupt+0xe7/0x260
<4>[  236.264052]  [<ffffffff802f0395>] timer_interrupt+0x35/0x100
<4>[  236.264052]  [<ffffffff800a7de2>] handle_irq_event_percpu+0x62/0x1d0
<4>[  236.264052]  [<ffffffff800aaa12>] handle_percpu_irq+0x42/0x80
<4>[  236.264052]  [<ffffffff8000867a>] handle_irq+0x1a/0x30
<4>[  236.264052]  [<ffffffff802ea177>] evtchn_do_upcall+0x1c7/0x310
<4>[  236.264052]  [<ffffffff804123de>] do_hypervisor_callback+0x1e/0x30
<4>[  236.264052]  [<ffffffff8021aee7>] radix_tree_lookup_slot+0x27/0x60
<4>[  236.264052]  [<ffffffff800db798>] find_get_page+0x18/0xb0
<4>[  236.264052]  [<ffffffff800dce77>] filemap_fault+0x97/0x3e0
<4>[  236.264052]  [<ffffffff800ffea2>] __do_fault+0x72/0x720
<4>[  236.264052]  [<ffffffff801042e1>] handle_pte_fault+0xa1/0x290
<4>[  236.264052]  [<ffffffff8040da21>] do_page_fault+0x251/0x540
<4>[  236.264052]  [<ffffffff8040a2d8>] page_fault+0x28/0x30
<4>[  236.264052]  [<00007f56724fff33>] 0x7f56724fff32
<0>[  236.264052] Code: cc 51 41 53 50 b8 17 00 00 00 0f 05 5b 59 c3 cc cc cc cc cc cc cc cc cc cc cc cc cc cc cc cc cc cc 51 41 53 b8 18 00 00 00 0f 05
<41>[  236.264052]  5b 59 c3 cc cc cc cc cc cc cc cc cc cc cc cc cc cc cc cc cc
<4>[  236.264052] Call Trace:
<4>[  236.264052]  [<ffffffff802e9f2c>] notify_remote_via_ipi+0x4c/0xa0
<4>[  236.264052]  [<ffffffff8001875a>] xen_send_IPI_mask+0x3a/0x70
<4>[  236.264052]  [<ffffffff800188ca>] arch_trigger_all_cpu_backtrace+0x8a/0xd0
<4>[  236.264052]  [<ffffffff800aed15>] check_cpu_stall+0xa5/0x100
<4>[  236.264052]  [<ffffffff800aed99>] __rcu_pending+0x29/0x180
<4>[  236.264052]  [<ffffffff800aef4f>] rcu_check_callbacks+0x5f/0x110
<4>[  236.264052]  [<ffffffff8005678f>] update_process_times+0x3f/0x80
<4>[  236.264052]  [<ffffffff8007a5eb>] tick_sched_timer+0x5b/0xc0
<4>[  236.264052]  [<ffffffff8006e13e>] __run_hrtimer+0xde/0x1c0
<4>[  236.264052]  [<ffffffff8006e487>] hrtimer_interrupt+0xe7/0x260
<4>[  236.264052]  [<ffffffff802f0395>] timer_interrupt+0x35/0x100
<4>[  236.264052]  [<ffffffff800a7de2>] handle_irq_event_percpu+0x62/0x1d0
<4>[  236.264052]  [<ffffffff800aaa12>] handle_percpu_irq+0x42/0x80
<4>[  236.264052]  [<ffffffff8000867a>] handle_irq+0x1a/0x30
<4>[  236.264052]  [<ffffffff802ea177>] evtchn_do_upcall+0x1c7/0x310
<4>[  236.264052]  [<ffffffff804123de>] do_hypervisor_callback+0x1e/0x30
<4>[  236.264052]  [<ffffffff8021aee7>] radix_tree_lookup_slot+0x27/0x60
<4>[  236.264052]  [<ffffffff800db798>] find_get_page+0x18/0xb0
<4>[  236.264052]  [<ffffffff800dce77>] filemap_fault+0x97/0x3e0
<4>[  236.264052]  [<ffffffff800ffea2>] __do_fault+0x72/0x720
<4>[  236.264052]  [<ffffffff801042e1>] handle_pte_fault+0xa1/0x290
<4>[  236.264052]  [<ffffffff8040da21>] do_page_fault+0x251/0x540
<4>[  236.264052]  [<ffffffff8040a2d8>] page_fault+0x28/0x30
<4>[  236.264052]  [<00007f56724fff33>] 0x7f56724fff32
<4>[  236.264508] NMI backtrace for cpu 1
<4>[  236.264528] CPU 1
<4>[  236.264529] Modules linked in: usb_storage ip6table_filter ip6_tables iptable_filter ip_tables ebtable_nat ebtables x_tables nbd blktap blktap2 pciback usbbk xen_scsibk blkbk blkback_pagemap netbk xenbus_be gntdev evtchn snd_pcm_oss snd_mixer_oss snd_seq snd_seq_device edd af_packet bridge stp llc microcode fuse loop pciehp pci_hotplug dm_mod snd_hda_codec_hdmi 8250_pnp snd_hda_codec_realtek ppdev parport_pc parport 8250 serial_core sg rtc_cmos dcdbas(X) domctl container iTCO_wdt iTCO_vendor_support ipv6 ipv6_lib dell_wmi pcspkr sparse_keymap snd_hda_intel snd_hda_codec snd_hwdep i2c_i801 snd_pcm e1000e snd_timer snd serio_raw soundcore wmi snd_page_alloc ext3 jbd mbcache usbhid hid i915 drm_kms_helper drm i2c_algo_bit i2c_core video sd_mod crc_t10dif ehci_hcd usbcore usb_common intel_agp intel_gtt agpgart button processor thermal_sys hwmon scsi_dh_rdac scsi_dh_emc scsi_dh_hp_sw scsi_dh_alua scsi_dh xenblk cdrom xennet ahci libahci libata scsi_mod
<4>[  236.264590] Supported: Yes, External
<4>[  236.264590]
<4>[  236.264590] Pid: 0, comm: swapper Tainted: G      D W   X 3.0.76-0.11-xen #1 Dell Inc. OptiPlex 980                 /0D438T
<4>[  236.264590] RIP: e030:[<ffffffff800033aa>]  [<ffffffff800033aa>] HYPERVISOR_sched_op_new+0xa/0x20
<4>[  236.264590] RSP: e02b:ffff8801db921f08  EFLAGS: 00000246
<4>[  236.264590] RAX: 0000000000000000 RBX: ffff8801db920010 RCX: ffffffff800033aa
<4>[  236.264590] RDX: 0000000000000000 RSI: 0000000000000000 RDI: 0000000000000001
<4>[  236.264590] RBP: 0000000000000001 R08: 0000000000000000 R09: ffffffff80736ce0
<4>[  236.264590] R10: 0000000000000000 R11: 0000000000000246 R12: 0000000000000000
<4>[  236.264590] R13: 0000000000000000 R14: 0000000000000000 R15: 0000000000000000
<4>[  236.264590] FS:  00007fd5a0af0700(0000) GS:ffff8801e4880000(0000) knlGS:0000000000000000
<4>[  236.264590] CS:  e033 DS: 002b ES: 002b CR0: 000000008005003b
<4>[  236.264590] CR2: 00007f0446d24f90 CR3: 00000001cfb07000 CR4: 0000000000002660
<4>[  236.264590] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
<4>[  236.264590] DR3: 0000000000000000 DR6: 00000000ffff0ff0 DR7: 0000000000000400
<4>[  236.264590] Process swapper (pid: 0, threadinfo ffff8801db920000, task ffff8801db91e0c0)
<0>[  236.264590] Stack:
<4>[  236.264590]  0000000000000000 00000000ffffffff ffffffff8000ddf7 0000000000000000
<4>[  236.264590]  ffff8801db920010 ffffffff80736ce0 ffffffff80006677 0000000000000000
<4>[  236.264590]  0000000000000000 0000000000000000 0000000000000000 0000000000000000
<0>[  236.264590] Call Trace:
<4>[  236.264590]  [<ffffffff8000ddf7>] xen_idle+0xb7/0x180
<4>[  236.264590]  [<ffffffff80006677>] cpu_idle+0x67/0xb0
<0>[  236.264590] Code: cc 51 41 53 b8 1c 00 00 00 0f 05 41 5b 59 c3 cc cc cc cc cc cc cc cc cc cc cc cc cc cc cc cc cc cc 51 41 53 b8 1d 00 00 00 0f 05
<41>[  236.264590]  5b 59 c3 cc cc cc cc cc cc cc cc cc cc cc cc cc cc cc cc cc
<4>[  236.264590] Call Trace:
<4>[  236.264590]  [<ffffffff8000ddf7>] xen_idle+0xb7/0x180
<4>[  236.264590]  [<ffffffff80006677>] cpu_idle+0x67/0xb0
<4>[  236.264735] NMI backtrace for cpu 2
<4>[  236.264740] CPU 2
<4>[  236.264742] Modules linked in: usb_storage ip6table_filter ip6_tables iptable_filter ip_tables ebtable_nat ebtables x_tables nbd blktap blktap2 pciback usbbk xen_scsibk blkbk blkback_pagemap netbk xenbus_be gntdev evtchn snd_pcm_oss snd_mixer_oss snd_seq snd_seq_device edd af_packet bridge stp llc microcode fuse loop pciehp pci_hotplug dm_mod snd_hda_codec_hdmi 8250_pnp snd_hda_codec_realtek ppdev parport_pc parport 8250 serial_core sg rtc_cmos dcdbas(X) domctl container iTCO_wdt iTCO_vendor_support ipv6 ipv6_lib dell_wmi pcspkr sparse_keymap snd_hda_intel snd_hda_codec snd_hwdep i2c_i801 snd_pcm e1000e snd_timer snd serio_raw soundcore wmi snd_page_alloc ext3 jbd mbcache usbhid hid i915 drm_kms_helper drm i2c_algo_bit i2c_core video sd_mod crc_t10dif ehci_hcd usbcore usb_common intel_agp intel_gtt agpgart button processor thermal_sys hwmon scsi_dh_rdac scsi_dh_emc scsi_dh_hp_sw scsi_dh_alua scsi_dh xenblk cdrom xennet ahci libahci libata scsi_mod
<4>[  236.264860] Supported: Yes, External
<4>[  236.264864]
<4>[  236.264868] Pid: 0, comm: swapper Tainted: G      D W   X 3.0.76-0.11-xen #1 Dell Inc. OptiPlex 980                 /0D438T
<4>[  236.264876] RIP: e030:[<ffffffff800033aa>]  [<ffffffff800033aa>] HYPERVISOR_sched_op_new+0xa/0x20
<4>[  236.264885] RSP: e02b:ffff8801db925f08  EFLAGS: 00000246
<4>[  236.264890] RAX: 0000000000000000 RBX: ffff8801db924010 RCX: ffffffff800033aa
<4>[  236.264895] RDX: 0000000000000000 RSI: 0000000000000000 RDI: 0000000000000001
<4>[  236.264900] RBP: 0000000000000002 R08: 0000000000000000 R09: ffffffff80736ce0
<4>[  236.264905] R10: 0000000000000000 R11: 0000000000000246 R12: 0000000000000000
<4>[  236.264910] R13: 0000000000000000 R14: 0000000000000000 R15: 0000000000000000
<4>[  236.264918] FS:  00007f4858acc760(0000) GS:ffff8801e4900000(0000) knlGS:0000000000000000
<4>[  236.264924] CS:  e033 DS: 002b ES: 002b CR0: 000000008005003b
<4>[  236.264929] CR2: 00000000006d3ff0 CR3: 00000001cb333000 CR4: 0000000000002660
<4>[  236.264934] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
<4>[  236.264939] DR3: 0000000000000000 DR6: 00000000ffff0ff0 DR7: 0000000000000400
<4>[  236.264945] Process swapper (pid: 0, threadinfo ffff8801db924000, task ffff8801db922100)
<0>[  236.264950] Stack:
<4>[  236.264953]  0000000000000000 00000000ffffffff ffffffff8000ddf7 0000000000000000
<4>[  236.264961]  ffff8801db924010 ffffffff80736ce0 ffffffff80006677 0000000000000000
<4>[  236.264968]  0000000000000000 0000000000000000 0000000000000000 0000000000000000
<0>[  236.264976] Call Trace:
<4>[  236.264987]  [<ffffffff8000ddf7>] xen_idle+0xb7/0x180
<4>[  236.264994]  [<ffffffff80006677>] cpu_idle+0x67/0xb0
<0>[  236.264999] Code: cc 51 41 53 b8 1c 00 00 00 0f 05 41 5b 59 c3 cc cc cc cc cc cc cc cc cc cc cc cc cc cc cc cc cc cc 51 41 53 b8 1d 00 00 00 0f 05
<41>[  236.265038]  5b 59 c3 cc cc cc cc cc cc cc cc cc cc cc cc cc cc cc cc cc
<4>[  236.265060] Call Trace:
<4>[  236.265069]  [<ffffffff8000ddf7>] xen_idle+0xb7/0x180
<4>[  236.265076]  [<ffffffff80006677>] cpu_idle+0x67/0xb0
<4>[  236.265118] NMI backtrace for cpu 3
<4>[  236.265124] CPU 3
<4>[  236.265126] Modules linked in: usb_storage ip6table_filter ip6_tables iptable_filter ip_tables ebtable_nat ebtables x_tables nbd blktap blktap2 pciback usbbk xen_scsibk blkbk blkback_pagemap netbk xenbus_be gntdev evtchn snd_pcm_oss snd_mixer_oss snd_seq snd_seq_device edd af_packet bridge stp llc microcode fuse loop pciehp pci_hotplug dm_mod snd_hda_codec_hdmi 8250_pnp snd_hda_codec_realtek ppdev parport_pc parport 8250 serial_core sg rtc_cmos dcdbas(X) domctl container iTCO_wdt iTCO_vendor_support ipv6 ipv6_lib dell_wmi pcspkr sparse_keymap snd_hda_intel snd_hda_codec snd_hwdep i2c_i801 snd_pcm e1000e snd_timer snd serio_raw soundcore wmi snd_page_alloc ext3 jbd mbcache usbhid hid i915 drm_kms_helper drm i2c_algo_bit i2c_core video sd_mod crc_t10dif ehci_hcd usbcore usb_common intel_agp intel_gtt agpgart button processor thermal_sys hwmon scsi_dh_rdac scsi_dh_emc scsi_dh_hp_sw scsi_dh_alua scsi_dh xenblk cdrom xennet ahci libahci libata scsi_mod
<4>[  236.265269] Supported: Yes, External
<4>[  236.265273]
<4>[  236.265277] Pid: 0, comm: swapper Tainted: G      D W   X 3.0.76-0.11-xen #1 Dell Inc. OptiPlex 980                 /0D438T
<4>[  236.265285] RIP: e030:[<ffffffff800033aa>]  [<ffffffff800033aa>] HYPERVISOR_sched_op_new+0xa/0x20
<4>[  236.265294] RSP: e02b:ffff8801db929f08  EFLAGS: 00000246
<4>[  236.265299] RAX: 0000000000000000 RBX: ffff8801db928010 RCX: ffffffff800033aa
<4>[  236.265303] RDX: 0000000000000000 RSI: 0000000000000000 RDI: 0000000000000001
<4>[  236.265308] RBP: 0000000000000003 R08: 0000000000000000 R09: ffffffff80736ce0
<4>[  236.265313] R10: 0000000000000000 R11: 0000000000000246 R12: 0000000000000000
<4>[  236.265317] R13: 0000000000000000 R14: 0000000000000000 R15: 0000000000000000
<4>[  236.265325] FS:  00007fe1efa8f7a0(0000) GS:ffff8801e4980000(0000) knlGS:0000000000000000
<4>[  236.265330] CS:  e033 DS: 002b ES: 002b CR0: 000000008005003b
<4>[  236.265335] CR2: 00007f9147148000 CR3: 00000001db211000 CR4: 0000000000002660
<4>[  236.265340] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
<4>[  236.265345] DR3: 0000000000000000 DR6: 00000000ffff0ff0 DR7: 0000000000000400
<4>[  236.265350] Process swapper (pid: 0, threadinfo ffff8801db928000, task ffff8801db926140)
<0>[  236.265354] Stack:
<4>[  236.265357]  0000000000000000 00000000ffffffff ffffffff8000ddf7 0000000000000000
<4>[  236.265367]  ffff8801db928010 ffffffff80736ce0 ffffffff80006677 0000000000000000
<4>[  236.265375]  0000000000000000 0000000000000000 0000000000000000 0000000000000000
<0>[  236.265384] Call Trace:
<4>[  236.265395]  [<ffffffff8000ddf7>] xen_idle+0xb7/0x180
<4>[  236.265401]  [<ffffffff80006677>] cpu_idle+0x67/0xb0
<0>[  236.265407] Code: cc 51 41 53 b8 1c 00 00 00 0f 05 41 5b 59 c3 cc cc cc cc cc cc cc cc cc cc cc cc cc cc cc cc cc cc 51 41 53 b8 1d 00 00 00 0f 05
<41>[  236.265455]  5b 59 c3 cc cc cc cc cc cc cc cc cc cc cc cc cc cc cc cc cc
<4>[  236.265481] Call Trace:
<4>[  236.265491]  [<ffffffff8000ddf7>] xen_idle+0xb7/0x180
<4>[  236.265497]  [<ffffffff80006677>] cpu_idle+0x67/0xb0

5, relative bug.
1), https://bugzilla.novell.com/show_bug.cgi?id=767864
2), https://bugs.launchpad.net/qemu/+bug/685096
it might be relative to which usb protocol pass to guest.
Serge Hallyn (serge-hallyn) wrote on 2014-02-06: Re: [Bug 685096] Re: USB Passthrough not working for Windows 7 guest    #25
Quoting Manuel Baesler (<email address hidden>):
[...]
Thanks - so (this isn't documented in the qemu man page) am I to assume
that given " -usbdevice host:0781:5150" as the original bug submitter is
doing means "give me usb 1.0" ?

Max, does it work for you if you use (...taking a wild guess) :

 -device usb-ehci,id=usb,bus=pci.0,addr=0x4 \
 -device usb-host,vendorid=0x0781,productid=0x5150,id=hostdev0,bus=usb.0

or perhaps

 -device usb-ehci,id=usb,bus=pci.0,addr=0x4 \
 -usbdevice tablet \
 -device usb-host,vendorid=0x0781,productid=0x5150,id=hostdev0,bus=usb.0

You also might try xhci in place of ehci.

(If this does turn out to be the answer, then the bug title should be
changed to include 'usb2.0 and usb3.0 devices', to aid people in
finding this gem in the future)

 status: incomplete

Changed in qemu-kvm (Ubuntu):
status:  Confirmed → Incomplete
Manuel Baesler (v-launchpad-manuelbaesler) wrote on 2014-02-12:  #26
RIght, with '-usb' qemu creates then 'piix3-usb-uhci' device:

00:01.2 USB controller: Intel Corporation 82371SB PIIX3 USB [Natoma/Triton II] (rev 01)

5, try
usb-add -> usb-delete -> new(with usb passthrough) -> start -> usb-add
xen10:/home/images/winserver2008x64 # xm usb-add win2008x64 host:046d:c05a
Error: Timed out waiting for device model action
Usage: xm usb-add <domain> <[host:bus.addr] [host:vendor_id:product_id]>

Add the usb device to FV VM.

6, reply to jason email
> Hi Bamvor,
> 
> Welcome back.
> 
> > On Mar 3, 2014, at 8:43 AM, "Bamvor Jian Zhang" <bjzhang@suse.com> wrote:
> >
> > Hi, Jason
> >> Hi Bamvor,
> >>
> >> I have just assigned you the following L3 Xen bug:  Bug 865219 - L3: USB passthrough (qemu-dm) to Windows VM crashed with segfault
> > yeah, and i have read your discussion in bugzilla.
> >>
> >> Do you have time to look into the issue, perhaps while waiting for responses from upstream about your feature work? I know you don't have a lot of experience with the qemu-dm code, but that's the case for pretty much everyone else on the team as well.
> >>
> >> I seem to recall Chun Yan dealing with some sort of usb passthrough issue in the past, so she might be able to give you some direction.
> > after discuss it with Chunyan, i will test with qemu upstream for this bug tomorrow. considering the qemu upstream is default qemu from xen 4.3 and there are lots of difference between qemu-dm and qemu upstream. it worth to try.
> 
> That's essentially what Kirk tried. He found that in the upstream qemu-kvm, USB 1.1 emulation is still broken but that USB 2.0 works … at least, it works with his device. I think it would make sense to see if we can replicate those results under Xen.
i found that xm do not support qemu upstream according to my test and xen wiki.
> 
> >>
> >> If for some reason this bug is going to be overly burdensome to you, please let me know. Thanks.
> >>
> >> Jason
> > BTW, i heard from roger that this bug is assigned to others when i am on vacation. is there other guys work on this bug?
> 
> As mentioned, Kirk looked at this and posted his results in the bug. The only other significant work was my investigation of the possible workarounds (also in the bug), which were all deemed unworkable for the customer.

i tested on sle11sp3 xen(fully patched). it seems that usb1.1 device(mouse) is ok no matter "xm usb-add" or passthrough in xm config file. while usb2.0 device(usb mass storage: tf card reader with tf card) fails in both ways.
my test step is
1), add usb device with "xm usb-add".
2), shutdown guest.
3), xm delete
4), add usb device in config file
#e.g. take mouse for example
usb=1
usbdevice='host:046d:c05a'
5), xm new
6), xm start
7), check usb device passthrough status
8), restore the config file

i test these cycle for mouse more than 4 times. every time is ok.
it is just a little bit different between usb-add and config file:
there are two HID mice in guest after usb-add. one of them is usb passthrough mouse. there are only one mouse in guest after passthrought the same usb mouse in config file.

my test environment
host: sle11sp3(3.0.101-0.15-xen) with xen4.2.4_02
guest: win server 2008


second comment
it might be relative to which usb protocol pass to guest. in qemu-dm my usb2.0 device(tf card reader) is attached to usb1.1 hub. qemu upstream could support usb ehci in "-device" parameter. but i do not how use pass echi in qemu-dm.

link: https://bugs.launchpad.net/qemu/+bug/685096

the relative discuss in this link:
Serge Hallyn (serge-hallyn) wrote on 2014-02-06: Re: [Bug 685096] Re: USB Passthrough not working for Windows 7 guest    #25
Quoting Manuel Baesler (<email address hidden>):
[...]
Thanks - so (this isn't documented in the qemu man page) am I to assume
that given " -usbdevice host:0781:5150" as the original bug submitter is
doing means "give me usb 1.0" ?

Max, does it work for you if you use (...taking a wild guess) :

 -device usb-ehci,id=usb,bus=pci.0,addr=0x4 \
 -device usb-host,vendorid=0x0781,productid=0x5150,id=hostdev0,bus=usb.0

or perhaps

 -device usb-ehci,id=usb,bus=pci.0,addr=0x4 \
 -usbdevice tablet \
 -device usb-host,vendorid=0x0781,productid=0x5150,id=hostdev0,bus=usb.0

You also might try xhci in place of ehci.

(If this does turn out to be the answer, then the bug title should be
changed to include 'usb2.0 and usb3.0 devices', to aid people in
finding this gem in the future)

 status: incomplete

Changed in qemu-kvm (Ubuntu):
status:  Confirmed → Incomplete
Manuel Baesler (v-launchpad-manuelbaesler) wrote on 2014-02-12:  #26
RIght, with '-usb' qemu creates then 'piix3-usb-uhci' device:

00:01.2 USB controller: Intel Corporation 82371SB PIIX3 USB [Natoma/Triton II] (rev 01)

5, try

>
> Bruce had a couple ideas of how this could be analyzed, but he is buried under his own work right now. I've added him to the cc in case he has any suggestions for you.
>
> Jason

16:09 2014-03-04
/dev/sda1              63       80324       40131    6  FAT16
Partition 1 does not start on physical sector boundary.
/dev/sda2           81920    21671935    10795008    7  HPFS/NTFS/exFAT
/dev/sda3        21671936   189438729    83883397    7  HPFS/NTFS/exFAT
/dev/sda4   *   189440000   976773119   393666560    f  W95 Ext'd (LBA)
/dev/sda5       193986560   823138303   314575872   83  Linux
/dev/sda5 on /home/bamvor/sda5_rd type btrfs (rw,relatime,space_cache)

/dev/sda6       823140352   886050815    31455232   83  Linux
/dev/sda7       886052864   898615295     6281216   83  Linux
/dev/sda7 on /home/bamvor/sles11_sp2_home type ext3 (rw,relatime,data=ordered)

/dev/sda8       189442048   189759487      158720   83  Linux
boot? who?

/dev/sda9       189761536   193984511     2111488   8e  Linux LVM
lv for system

/dev/sda10      915402752   976752639    30674944   8e  Linux LVM
lv for system

/dev/sda11      898617344   899641343      512000   83  Linux

/dev/sda12      899643392   915400703     7878656   82  Linux swap / Solaris

/dev/sdb: 160.0 GB, 160041885696 bytes
/dev/sdb1            2048   207724543   103861248   83  Linux
/dev/sdb2       207724544   209840127     1057792   83  Linux
/dev/sdb3       209840128   262277119    26218496   8e  Linux LVM
lv for system2.

Disk /dev/sdc: 80.0 GB, 80000000000 bytes
/dev/sdc1            2048   156249999    78123976   83  Linux

Disk /dev/mapper/system2-root: 16.1 GB, 16106127360 bytes
opensuse 12.3 (2) root

Disk /dev/mapper/system2-swap: 4294 MB, 4294967296 bytes

Disk /dev/mapper/system-home: 17.2 GB, 17179869184 bytes
opensuse 12.3 (1) home. system is broken

Disk /dev/mapper/system-root: 16.4 GB, 16387145728 bytes
opensuse 12.3 (1) root. system is broken

11:08 2014-03-05
software skill, storage, disk, partition, lvm
1, overview
pv上面划分vg, vg上面划分lv.
PV: Physical volume; pvs, pvdisplay.
VG: volume group; vgs, vgdisplay, vgdisplay --verbose(could display the physical volume too).
LV: logical volume; lvs, lvdisplay

11:15 2014-03-05
GTD
0, 10:30-18:30

1, today
1), build sle11sp3 image on suse studio.
TODO install it on physical machine.
2), check the bnc#865219 status: Flavio Pereira will ask customer provide a environment for test.
3), pvscsi.

2, todo
1), how to auto start application in kde.

11:25 2014-03-05
bnc#820715
1, HS22
http://en.wikipedia.org/wiki/IBM_BladeCenter#HS22
(2009–11) Features
One or two Intel Xeon 5500 or 5600 series processors (up to 3.6 GHz 4c or 3.46 GHz 6c)
Twelve DDR3 VLP DIMM slots (up to 192 GB of total memory capacity)
Option for two hot swap SAS 2.5" drives or Solid State drives (RAID 0 and 1 is supported)
Two Gigabit Ethernet ports (Broadcom 5709S)
1 CIOv slot (standard PCI-Express daughter card) and 1 CFFh slot (high-speed PCI-Express daughter card) for a total of 8 ports of I/O to each blade, including 4 ports of high-speed I/O

13:13 2014-03-05
feature, pvscsi
1, FC HBA(host bus adapter).
NPIV (N-Port Identifier Virtualization)
how about LUN?
2, command
scsi-attach, scsi-detach, scsi-list.
3, read code
if dev_class == 'vscsi':
    return self.vscsi_device_configure(dev_sxp)

the earliest patch in upstream 08a42ca0
0001-pvSCSI-xend-changes.patch

4, status
http://wiki.xenproject.org/wiki/GSoc_2014#Implement_Xen_PVSCSI_support_in_xl.2Flibxl_toolstack
Implement Xen PVSCSI support in xl/libxl toolstack
Date of insert: 01/12/2012
Technical contact: Pasi Karkkainen <pasik@iki.fi>
Difficulty: Unknown
Skills Needed: Unknown
Description: xl/libxl does not currently support Xen PVSCSI functionality. Port the feature from xm/xend to xl/libxl. Necessary operations include:
Task 1: Implement PVSCSI in xl/libxl, make it functionally equivalent to xm/xend.
Send to xen-devel mailinglist for review, comments.
Fix any upcoming issues.
Repeat until merged to xen-unstable.
See above for PVSCSI drivers for dom0/domU.
Xen PVSCSI supports both PV domUs and HVM guests with PV drivers.
More info: http://wiki.xen.org/xenwiki/XenPVSCSI
 Lars.kurth 14:14, 23 January 2013 (UTC): Should be suitable, but desc needs. Rate in terms of challenges, size and skill. Also kernel functionality is not yet upstreamed. Maybe Suse kernel.
Outcomes: Not specified, project outcomes
GSoC: Yes

5, xen doc
http://wiki.xen.org/wiki/Paravirtualized_SCSI
gsoc2014
http://wiki.xenproject.org/wiki/GSoc_2014#VM_Snapshots

6, TODO: scsi sharable.

7, doc
1), sys
Midlayer sysfs representation
/sys/class/scsi_device: All SCSI devices in the system
/sys/class/scsi_host: All SCSI hosts (HBAs)

scsi_device sysfs attributes
delete: Remove the device from the midlayer
rescan: Rescan this device
state: Internal state of the device
timeout: Default command timeout
2), lsscsi

8, what is the status of kernel frontend and backend driver?
if such driver is not upstream, could we push the xl pvscsi to xen-devel?

9, email to Jim
about pvscsi

Hi, Jim

I heard from Chunyan that pvscsi should be supported in sle12. i do not have
scsi and pvscsi knowledge. here is the status after my first study. please
correct me if i wrong.

1), the basic scsi attach and detach could be finished by modify the xenstores.
the original pvscsi patch include toolstack support, kernel frontend and
backend driver. there is only one patch for toolstack(08a42ca0):
0001-pvSCSI-xend-changes.patch
in the core code of this patch, xm implement the scsi-attach and scsi-detach
by changing the device in xenstore backend and frontend. i guess that it
similar to the other block device, the host and guest kernel will be informed
by xenstore and know about the new scsi device.

2), the advance feature.
i do not know whether the above work could support some advance features in
scsi or not.
it seems that the advance feature of scsi mainly depend on the backend and
frontend drvier in linux kernel according to the presentation
24_Hitoshi_Matsumoto_en.pdf in xen submit 2008.
maybe we could discuss it or do it after our first scsi patch is sent out?

3, reference link
(1), the pvscsi homepage in xen
http://wiki.xen.org/wiki/Paravirtualized_SCSI
(2), this is the GSOC 2013 and GSOC 2014 project proposal.
http://wiki.xenproject.org/wiki/GSoc_2014#Implement_Xen_PVSCSI_support_in_xl.2Flibxl_toolstack
Implement Xen PVSCSI support in xl/libxl toolstack

regards

bamvor

14:11 2014-03-05
software skill, SCM, git, color
git config --global color.ui auto

15:31 2014-03-05
virtualization, hot idea on xen
https://xenorg.uservoice.com/forums/172169-xen-development

14:35 2014-03-06
doc, markdown, suse studio guide

from [SUSE_Studio](http://en.wikipedia.org/wiki/SUSE_Studio)

SUSE Studio is an online Linux image creation tool by SUSE. Users can develop their own Linux OS, software appliance or virtual appliance, mainly choosing which applications and packages they want on their "custom" Linux and how it looks.
Users can choose between openSUSE or SUSE Linux Enterprise as a base and pick from a variety of pre-configured images including jeOS, minimal server, GNOME and KDE desktops.

14:53 2014-03-06
suse studio, sles11sp3, gui do not started.
1, startx say "no screens found".
BTW: type "Xorg" could get the similar result. there is not useless message after the "no screens found"(Fatal server errors) if run Xorg.
2, display card driver
1), it is the ati display card:
# lspci |grep vga -i
01:00.0 VGA compatible controller: Advanced Micro Devices [AMD] nee ATI Cedar PRO [Radeon HD 5450/6350]

it should be the radeon driver, but it is not loaded in lsmod.
i could load it through "modprobe radeon". the display will be ok(smaller fonts than the default display card).
2), the driver is located in the driver/gpu/drm directory.
notes that it is not located in the "driver/video" directory, the latter one is the framebuffer driver.
# modinfo radeon | head
filename:       /lib/modules/3.0.101-0.15-xen/kernel/drivers/gpu/drm/radeon/radeon.ko
license:        GPL and additional rights
description:    ATI Radeon

3, there is no xf86-video-ati rpm packages. install the following package in suse studio. and try again.
xorg-x11-driver-video
xorg-x11-driver-video-radeonhd

4, no mouse and keyboard package in xf86.
TODO report the bug after confirm it.

5, (10:40 2014-03-07)
there is no xf86-driver-mouse package, the mouse driver is located in xorg-x11-driver-input-7.4-13.44.1.
# rpm -qf /usr/lib64/xorg/modules/input/mouse_drv.so
xorg-x11-driver-input-7.4-13.44.1

install it on my machine, xkeyboard-config is missing too:
linux-ja2p:~ # zypper in xorg-x11-driver-input
Refreshing service 'SMT-http_147_2_207_56'.
Loading repository data...
Reading installed packages...
Resolving package dependencies...

The following NEW packages are going to be installed:
  xkeyboard-config xorg-x11-driver-input

after install, it is ok.

6, report a bug
https://bugzilla.novell.com/show_bug.cgi?id=867277
X could not started on physical machine because of the missing packages while testdrive is OK

i build a sles11sp3 image on suse studio, test it in testdriver is ok(kde
start successfully). but when i run it on my physical machine(in a usb mass
storage, for test). the x is not started. it is because the video and input
driver is not installed.

at first, Xorg say no screen found.
i found that the driver(drivers/gpu/drm/radeon/radeon.ko) exists. but no one
load it. and i found that the following x package is not installed:
xorg-x11-driver-video
xorg-x11-driver-video-radeonhd

after install the above two packages, the mouse and keyboard could not be used.
i found that xorg-x11-driver-input is not installed(xkeyboard-config as well).

after install these four packages, my kde could start successfully.

my sles11sp3 configuration:
HW: x86-64
SW: 3.0.101-0.15-xen, kde4

17:46 2014-03-06
GTD
0, 12:30-17:46

1, today
1), 30' write pvscsi and sent to Jim and Chunyan.

18:06 2014-3-6
ming.lei@canonical.com kvm arm

arm hibernation patch is during review.

10:42 2014-03-07
GTD
0, 10:20

1, today
1), sles11sp3 installation issue: "14:53 2014-03-06"5.
report a bug, bnc#867277.

15:22 2014-03-07
找bug
找漏洞。
找后门。

kvm后端。

17:57 2014-03-07
                    0x8021140e      8031940e
19: NS              0               0
18: 0               0               0
17: nG(not Global)  0               0
16: S(sharable)     1               1

15: AP[2]           0               1
14:12: TEX[2:0]     1               1

11:10: AP[1:0]      1               1
9:                  0               0

8:5: Domain         0               0

4: XN               0               0
3: C                1               1
2: B                1               1
1:0                 b11             b11

TEX C B
1   1 1   Outer and Inner Write-Back, Write-Allocate Normal S bit b

0xc0000000 -- 0xc00ffffff: rw. page table: 0xc0004000 -- 0xc0007fff.
0xc0100000 -- 0xc01ffffff: read only.

https://github.com/mncoppola/suterusu

fault trace

<4>[ 1460.082672] sys_call_table obtained at c000e584
<4>[ 1460.082763] p1:8021140e, p2:8031940e
<4>[ 1460.082794] Hooking function 0xc017a3e4 with 0xbf0110e8
<1>[ 1460.082824] Unable to handle kernel paging request at virtual address c017a3e4
<1>[ 1460.083251] pgd = d67e0000
<1>[ 1460.083465] [c017a3e4] *pgd=8021140e(bad)
    <0>[ 1460.084106] [0:            poc: 4143] Internal error: Oops: 80d [#1] PREEMPT SMP ARM
    <4>[ 1460.084503] [0:            poc: 4143] Modules linked in: sys_test(O) vpnclient tima_debug_log(P) mckernelapi mcdrvmodule exfat_fs(P) exfat_core(P)
    <4>[ 1460.086547] [0:            poc: 4143] CPU: 0    Tainted: P        W  O  (3.4.0-812098 #1)
    <4>[ 1460.086975] [0:            poc: 4143] PC is at memcpy+0xac/0x330
    <4>[ 1460.087219] [0:            poc: 4143] LR is at sys_test_iterate+0x0/0x4c [sys_test]
    <4>[ 1460.087615] [0:            poc: 4143] pc : [<c02c3f6c>]    lr : [<bf0110e8>]    psr: 00000013
    <4>[ 1460.087646] [0:            poc: 4143] sp : da117f3c  ip : 00000014  fp : be9f78ec
    <4>[ 1460.088226] [0:            poc: 4143] r10: bf012ec4  r9 : dbeab5db  r8 : bf0110e8
    <4>[ 1460.088653] [0:            poc: 4143] r7 : e59ff000  r6 : dbeab540  r5 : bf0110e8  r4 : c017a3e4
    <4>[ 1460.089050] [0:            poc: 4143] r3 : bf0110e8  r2 : ffffffec  r1 : da117f74  r0 : c017a3e4
    <4>[ 1460.089447] [0:            poc: 4143] Flags: nzcv  IRQs on  FIQs on  Mode SVC_32  ISA ARM  Segment user
    <4>[ 1460.089874] [0:            poc: 4143] Control: 10c5787d  Table: 97be006a  DAC: 00000015
    <4>[ 1460.090087] [0:            poc: 4143] 
    <4>[ 1460.090087] [0:            poc: 4143] PC: 0xc02c3eec:
    <4>[ 1460.090698] [0:            poc: 4143] 3eec  f5d1f000 e2522060 f5d1f01c ba000002 f5d1f03c f5d1f05c f5d1f07c e8b151f8
    <4>[ 1460.092926] [0:            poc: 4143] 3f0c  e2522020 e8a051f8 aafffffa e3720060 aafffff9 e212c01c e26cc020 108ff00c
    <4>[ 1460.095153] [0:            poc: 4143] 3f2c  ea000011 e320f000 e4913004 e4914004 e4915004 e4916004 e4917004 e4918004
    <4>[ 1460.097412] [0:            poc: 4143] 3f4c  e491e004 e08ff0

https://github.com/mncoppola/suterusu.git

13:22 2014-03-10
GTD
0, 13:20

1, today
1), bnc#820715.

13:29 2014-03-10
Minimal + x11 pattern is missing.
but kde pattern is selected. is there some dependencies between patterns?

14:04 2014-03-10
IBM?

support config.

如果fix不工作，首先下载ptf source包，确定patch已经打了。

after L3 fix, L3 will send to maintenance QA.

只能等L3 tag没有了，并且提交到update:test(maintenance update)里面才能关bug.

L3 question, resolved-invalid: maintenance QA不会追踪。

L3不能直接设duplicate. 因为L3是针对不能客户的。除非L3已经关闭了。

可以要求L3复现bug.

14:13 2014-03-10
bnc#820715
1, > rpm -qa |grep sanlock
libvirt-lock-sanlock-1.2.2-373.2.x86_64
sanlock-devel-2.6-2.1.1.x86_64
libsanlock1-2.6-2.1.1.x86_64
sanlock-3.1.0-27.2.x86_64

2, start service
1), start wdmd
# chkconfig wdmd on
ln -s '/usr/lib/systemd/system/wdmd.service' '/etc/systemd/system/multi-user.target.wants/wdmd.service'
# service wdmd start
# service wdmd status
wdmd.service - Watchdog Multiplexing Daemon
          Loaded: loaded (/usr/lib/systemd/system/wdmd.service; enabled)
          Active: active (running) since Mon, 2014-03-10 14:16:12 CST; 5s ago
         Process: 4832 ExecStart=/usr/sbin/wdmd $WDMDOPTS (code=exited, status=0/SUCCESS)
        Main PID: 4834 (wdmd)
          CGroup: name=systemd:/system/wdmd.service
                  └ 4834 /usr/sbin/wdmd -G sanlock

Mar 10 14:16:11 laptop-work.site systemd[1]: Starting Watchd...
Mar 10 14:16:12 laptop-work.site wdmd[4834]: wdmd started S0...
Mar 10 14:16:12 laptop-work.site systemd[1]: Started Watchdo...
Mar 10 14:16:12 laptop-work.site wdmd[4834]: /dev/watchdog0 ...

2), start sanlock
# chkconfig sanlock on
ln -s '/usr/lib/systemd/system/sanlock.service' '/etc/systemd/system/multi-user.target.wants/sanlock.service'


# service sanlock start
# journalctl -n
Mar 10 14:23:35 laptop-work.site systemd[1]: Starting Shared Storage Lease Manager...
Mar 10 14:23:35 laptop-work.site sanlock[4994]: /usr/sbin/sanlock: symbol lookup error: /usr/sbin/sanlock: undefined symbol: sanlock_write_resource
Mar 10 14:23:35 laptop-work.site systemd[1]: sanlock.service: control process exited, code=exited status=127
Mar 10 14:23:35 laptop-work.site systemd[1]: Failed to start Shared Storage Lease Manager.
Mar 10 14:23:35 laptop-work.site systemd[1]: Unit sanlock.service entered failed state

after update libsanlock1 to 3.1.0, it is ok.

3, edit config file
user = "sanlock"
group = "sanlock"
but the default value is
user = "root"
group = "root"

4, sles11sp3(no update).
# uname -a
Linux linux-bjrd 3.0.76-0.11-default #1 SMP Fri Jun 14 08:21:43 UTC 2013 (ccab990) x86_64 x86_64 x86_64 GNU/Linux
# rpm -qa|grep sanlock
libsanlock1-2.6-0.7.47
sanlock-devel-2.6-0.7.47
libvirt-lock-sanlock-1.0.5.1-0.7.10
sanlock-2.6-0.7.47
# chkconfig wdmd on
insserv: Service localfs has to exists for service vmware-USBArbitrator
insserv: Service cups has to exists for service iprint-listener
# service wdmd start
Starting wdmd                                                                                     done
# chkconfig sanlock on
insserv: Service localfs has to exists for service vmware-USBArbitrator
insserv: Service cups has to exists for service iprint-listener
insserv: Service wdmd is missed in the runlevels 2 to use service sanlock
# service sanlock start
Starting sanlock                                                                                  done

5, test in sles11sp3.
user and group set to root. it is ok.
# ls /var/lib/libvirt/sanlock/
__LIBVIRT__DISKS__
but set to sanlock. libvirtd could not started. error:
2014-03-10 09:24:49.351+0000: 16106: error : virLockManagerSanlockSetupLockspace:277 : Unable to query sector size /var/lib/libvirt/sanlock/__LIBVIRT__DISKS__: No such device

according to the comment before disk_lease_dir:
Moreover, please make sure sanlock daemon can access the specified path.

add the access permission:
# ll /var/lib/libvirt/sanlock -d
drwxrwxrwx 2 root root 4096 Mar 10 17:59 /var/lib/libvirt/sanlock

# ll /var/lib/libvirt/sanlock/
total 2056
-rw-rw---- 1 sanlock sanlock 1048576 Mar 10 18:00 __LIBVIRT__DISKS__
after virsh create
# ll /var/lib/libvirt/sanlock/
total 2056
-rw------- 1 sanlock sanlock 1048576 Mar 10 18:01 e61797da105c26ab1f0acb5764733977
-rw-rw---- 1 sanlock sanlock 1048576 Mar 10 18:00 __LIBVIRT__DISKS__

6, reply to bug.
this is properbly because sanlock do not have the acess permision to the disk_lease_dir(/var/lib/libvirt/sanlock/).
after add the access permision of disk_lease_dir for sanlock:sanlock, it works.
before create vm, there is __LIBVIRT__DISKS__ in disk_lease_dir, owner is sanlock:sanlock.
# ll /var/lib/libvirt/sanlock/
total 2056
-rw-rw---- 1 sanlock sanlock 1048576 Mar 10 18:00 __LIBVIRT__DISKS__
after virsh create, the lease file is added
# ll /var/lib/libvirt/sanlock/
total 2056
-rw------- 1 sanlock sanlock 1048576 Mar 10 18:01 e61797da105c26ab1f0acb5764733977
-rw-rw---- 1 sanlock sanlock 1048576 Mar 10 18:00 __LIBVIRT__DISKS__

16:42 2014-03-10
grub2 repair
note that sles11sp3 reserve the /boot/grub and /boot/grub2. so, i need replace the grub with grub2 in the following command
http://forum.ubuntu.org.cn/viewtopic.php?f=139&t=348503
Grub Rescue修复方法（根据网上资料整理，介绍命令同时也介绍原理）

1), use ls confirm disk.
ls (hd0,X)/grub
2), load grub menu
grub rescue>set root=(hd0,5)
grub rescue>set prefix=(hd0,5)/boot/grub
grub rescue>insmod normal

16:48 2014-03-10
community, release, qemu
http://wiki.qemu.org/Planning/2.0

13:48 2014-03-11
EVP
1, slide1
少说闭源。
遗传和进化: 小草和继承各种优秀的idea，最终成长为一颗硕果累累的参天大树。
小草-> 大树：项目。
Mu Lei关于自由度。

2, slide2
不够有趣，听一下第一次的录音。
长江和湖泊的特点。长江流域。
挖湖，挖池塘。养育，养虾，养螃蟹。
我住长江头，君住长江尾。共饮长江水。

3, slide3
听听大家的心声。现场采访:
-你认同open source吗?
-你参加过社区活动吗?
-你为什么选择加入SUSE?
-你觉得做开源幸福吗?
-你是怎么理解open source in our genes这句话的?
-OpenQA是采用什么协议? --江一帆/Nick/David
-你用的最多的开源软件是哪个?

16:04 2014-03-11
Beijing, virtualization, team meeting
1, Chunyan
1), No COW.
maybe it could not enter 2.0. it could be enter block-next. it might be some issue about build this(block-next).
2, Roger
fate: implementation -> validation: inform partner to test it.
双赢? 如果公司牛人都走了, 不知道公司赢了什么.

17:56 2014-03-11
fate, #316276: XEN: Bring back the Xen snapshot functionality

08:19 2014-03-12
virtualization, xen 4.4, release
http://wiki.xen.org/wiki/Xen_4.4_Release_Notes
New Feature Highlights

Probably one of the most important is solid libvirt support for libxl.
Another big one is a new scalable event channel interface, designed and implemented by David Vrabel from Citrix. The original Xen event channel interface was limited to the number of bits on the platform squared -- 1024 for 32-bit guests and 4096 for 64-bit guests. With many VMs requiring 4 event channels each, that means a theoretical maximum of 256 guests on a 32-bit dom0 -- more than enough back when a large machine had 8 cores, and every VM was a full OS; but a major limitation on systems with 128 cores, or those using cloud OSes like Mirage or OSv. The new "FIFO" event channel interface by default scales up to over 100,000 event channels, and in the future can be extended even further if necessary in a backwards-compatible manner. This should be enough for many years to come.
The ARM port is maturing quickly. As of 4.4, the hypervisor ABI for ARM has been declared stable, meaning that any guest which uses the 4.4 ARM ABI can rely on being able to boot on all future versions of Xen. There are a number of improvements making Xen on ARM more flexible, easier to set up and use, and easier to extend to new platforms.

Xen Project 4.4 Feature List
http://wiki.xen.org/wiki/Xen_Release_Features

13:00 2014-03-13
software skill, storage, virtualization, mount qcow2, qemu-nbd
# modprobe nbd
# qemu-nbd -c /dev/nbd0 ./opensuse12_3_01/disk0.qcow2
# fdisk -l /dev/nbd0

Disk /dev/nbd0: 8589 MB, 8589934592 bytes
255 heads, 63 sectors/track, 1044 cylinders, total 16777216 sectors
Units = sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes

# qemu-nbd -d /dev/nbd0
/dev/nbd0 disconnected

reference: http://smilejay.com/2012/11/how-to-mount-a-qcow2-image/
如何挂载qcow2格式的镜像文件（how to mount a qcow2 image)

16:10 2014-03-13
GTD
0, 11:10

1, today
1), 16:15-16:49 snapshot
2), 16:49 talk with roger.

16:15 2014-03-13
fate, #316276, snapshot, libvirt, libxl, xl
1, discuss with chunyan. i could send the disk snapshot: create, list and delete in the first stage. and than discuss about vm snapshot.

13:12 2014-03-14
EVP
1, slide1
少说闭源。
遗传和进化: 小草和继承各种优秀的idea，最终成长为一颗硕果累累的参天大树。
小草-> 大树：项目。
Mu Lei关于自由度。
自由度: 自由度. 参考mulei邮件.
分享:
社区: 分享及社区文化参与; 提高公司的社区影响力. 公司鼓励大家参与社区.
即使之前对开源不了解, 来suse之后也越来越了解.
平等: 对于任何个人和团体都没有差别待遇.

基因: 遗传, 进化.
suse: 平台, 鼓励.

产品会进化。

过门: 说了这么多, 感觉开源就像阳光, 水和空气一样, 是生活的必须品.


2, 开源与suse. slide2
开源故事.
问答: 长江有大湖.
Linux: 鄱阳湖. 候鸟的天堂: Linux对于开源世界的影响. distribution: opensuse. suse最开始参与社区的时候, Linux还没有arm的支持, 但是现在贡献Linux8个贡献者, 有三个都是做arm的, 除了两家公司之外都是参与arm的: RedHat, Intel, TI, Linaro, SUSE, IBM, Samsung, Google.
GNOME: 洞庭湖. Sun. David的贡献和足迹. 养殖基地.
Xen: 太湖. 产螃蟹. Chunyan. 太湖是庞大的灌溉系统.

注意节奏. 突出suse的产品.
基因如何体现?

不够有趣，听一下第一次的录音。
长江和湖泊的特点。长江流域。
挖湖，挖池塘。养育，养虾，养螃蟹。
我住长江头，君住长江尾。共饮长江水。

3, slide3
听听大家的心声。现场采访:
-你认同open source吗?
-你参加过社区活动吗?
-你为什么选择加入SUSE?
-你觉得做开源幸福吗?
-你是怎么理解open source in our genes这句话的?
-OpenQA是采用什么协议? --江一帆/Nick/David
-你用的最多的开源软件是哪个?

14:02 2014-03-14
company, L3
L1: installation.
L2: configuration.
L3: bug.

14:41 2014-03-14
自己拿到手的C和B是啥意思? cash and bonus?
马云：员工离职原因: 钱没给够; 心凉了.

15:44 2014-03-17
fate, #316276, snapshot, libvirt, libxl, xl
1, list seems work.

laptop-work:/home/bamvor/laptop/images/bjz_04_sles11_sp2 # qemu-img snapshot -l ../opensuse12_3_01/disk0.qcow2
Snapshot list:
ID        TAG                 VM SIZE                DATE       VM CLOCK
1         snapshot_02131643         0 2014-02-13 16:46:19   00:04:48.021
3         20140314_1647             0 2014-03-13 16:46:19   00:05:28.679
laptop-work:/home/bamvor/laptop/images/bjz_04_sles11_sp2 # xl disk_snapshot_list_internal bjz_04_sles11_sp2 hdc
device is ide0-hd0
cleanup
device is ide1-hd0
id<1>
name<snapshot_02131643>
vm-state-size<0>
date-sec<1392281179>
date-nsec<673459000>
vm-clock-sec<288>
vm-clock-nsec<21611438>
id<3>
name<20140314_1647>
vm-state-size<0>
date-sec<1394700379>
date-nsec<853556000>
vm-clock-sec<328>
vm-clock-nsec<679400540>
device is hda
cleanup
device is hdc
id<1>
name<snapshot_02131643>
vm-state-size<0>
date-sec<1392281179>
date-nsec<673459000>
vm-clock-sec<288>
vm-clock-nsec<21611438>
id<3>
name<20140314_1647>
vm-state-size<0>
date-sec<1394700379>
date-nsec<853556000>
vm-clock-sec<328>
vm-clock-nsec<679400540>

2, TODO
1), transaction.
2), rewrite code for one snapshot cmdline.

17:44 2014-03-17
GTD
0, 10:30-17:50

1, today
1), 15:44-17:44 fate, #316276, snapshot

10:35 2014-03-18
software skills, ssh, copy-input-to-clipboard-over-ssh
http://unix.stackexchange.com/questions/16694/copy-input-to-clipboard-over-ssh
 If you run ssh with X forwarding, this is transparent: remote commands (including xclip) have access to your X server (including its keyboard). Make sure you have ForwardX11 yes in your ~/.ssh/config and X11Forwarding yes in the server sshd_config (depending on your distributions, these options may be on or off by default).

 <myconffile.conf sed {...} | xclip -i

 There are other ways of working on remote files that may be more convenient, for example mounting remote directories on your local machine with SSHfs, or opening remote files in Emacs with Tramp. If you have ssh and FUSE set up and SSHfs installed, SSHfs is as easy as mkdir ~/net/myserver; sshfs myserver:/ ~/net/myserver. If you have ssh set up and Emacs installed, Tramp is as easy as opening /myserver:/path/to/file.
 shareimprove this answer

 answered Jul 15 '11 at 0:06
 Gilles

10:38 2014-03-18
GTD
0, 9:30-17:30

1, today
1), 20' copy input to clipboard over ssh. see"10:35 2014-03-18"
2), 10:40-10:55 work report.
3), 10:55-11:45 15:28-16:00 snapshot. see"15:28 2014-03-18"
4), 50' virtualization local sync. see"16:16 2014-03-18"

10:40 2014-03-18
work report - bjzhang -week 10,11
bnc#820715 SLES11 SP3 - sanlock configuration in libvirt fails (kvm)
bnc#820873 The "long" option doesn't work with "xl list" on opensuse 12.3
bnc#865219 L3: USB passthrough (qemu-dm) to Windows VM crashed with segfault
Trello Orientation and Discussion meeting hosted by Jason
SUSE EVP preparation discussion and workshop.
Virtualiztion bi-weekly meeting
1:1 with roger

13:08 2014-03-18
company, annual leave
1, 2012: total 10
5: 6, Aug - 10, Aug.
5: ?
2, 2013: total 11.5
2: 25, March, 26, March.
5: 0401, 0415-0417, 0423
2: 0508-0509.
2: 0613-0614.
0.5: 1224(0.5)
3, 2014
5: 0224-0228.

15:28 2014-03-18
fate, #316276, snapshot, libvirt, libxl, xl
1,
# xl disk_snapshot_internal_transaction bjz_04_sles11_sp2 hda 20140314_1512 hdc 20140314_1512
libxl: error: libxl_qmp.c:462:qmp_handle_error_response: received an error message from QMP server: Invalid parameter 'blockdev-snapshot-internal-sync'

2, backing file
# qemu-img create -f qcow2 -b disk0.raw disk0.qcow2
Formatting 'disk0.qcow2', fmt=qcow2 size=2147483648 backing_file='disk0.raw' encryption=off cluster_size=65536 lazy_refcounts=off
# file disk0.qcow2
disk0.qcow2: QEMU QCOW Image (v2), has backing file (path disk0.raw), 2147483648 bytes

3, transaction is ok.

16:16 2014-03-18
virtualization local sync
1, hunting.

2, Lin Ma
https://build.suse.de/package/show/Devel:Virt:Tests/virt-test

15:01 2014-03-19
GTD
0, 11:00-17:06

1, today
1), 15:10-17:06 snapshot. see"16:25 2014-03-19"
interrupt by "2)"
2), 20' git add basics. see"15:35 2014-03-19"

15:03 2014-03-19
arm, TODO
1, read arm architecture: especially the virtualization extension and aarch64.
2, GIC and its virtualization extension.

15:35 2014-03-19
software skill, SCM, git, git add
1, interactive add file
git add -i
2, add update file
git add -u

16:25 2014-03-19
fate, #316276, snapshot, libvirt, libxl, xl
1, command
disk-snapshot-create
disk-snapshot-list
disk-snapshot-delete

if support external snapshot. i need add extenal snapshot file in config file otherwise i could not list and delete them according to domain name.

2, only support disk snapshot for all vm disk?
it is the requirement for vm snapshot.

3, qemu version issue:
need upstream qemu. TODO: check the version requirement of qemu.

14:29 2014-03-20
GTD
0, -17:55

1, today
1), 14:29-17:55 snapshot. see"17:50 2014-03-20"
interrupt by something.

17:50 2014-03-20
fate, #316276, snapshot, libvirt, libxl, xl
1, how about list command?
check the qemu/libvirt result.
2, (16:30 2014-03-21)
qemu will issue the "guest-fsfreeze-freeze" agent command before disk external snapshot.
3, snapshot-list in libvirt
lixia:/var/lib/libvirt # virsh snapshot-list 83
Name                 Creation Time             State
------------------------------------------------------------
1395392867           2014-03-21 17:07:45 +0800 running
4, TODO: write snapshot list code.
5, (10:24 2014-03-24)
list should list the internal result.

17:34 2014-03-21
work report - bjzhang -week 12
GREEN
fate#316276: XEN: Bring back the Xen snapshot functionality
1, discuss with chunyan and jim about my current work.
2, rewrite code in order to push it to upstream

10:23 2014-03-24
GTD
1, today
1), 10:23- snapshot. see"17:50 2014-03-20"5

16:46 2014-03-25
sync
1, Chunyan
1), pvusb.
2), libvirt hostdev: fix mac address.

16:01 2014-03-26
GTD
0, -18:20

1, today
1), snapshot.
2), coding execise: calculate second to date.

16:11 2014-03-26
fate, #316276, snapshot, libvirt, libxl, xl
1, create snapshot struct reference libvirt "struct _virDomainSnapshotDef" in src/conf/snapshot_conf.h
2, (10:40 2014-03-27)
reference libxl_device_disk_add(defined by macro) and libxl__device_disk_add. eventually, it will call the libxl__device_generic_add for adding frontend and backend driver.

10:38 2014-03-27
GTD
1, today
1), 10:48- snapshot. see"16:11 2014-03-26"2.
2), Summary:
9点半来了公司，搞了一个多小时才开始正式干活。

15:54 2014-03-27
software skill, editor, vim, paste
1, paste to command line in vim from vim buffer
Ctrl+r,"

