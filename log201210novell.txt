.LOG
18:08 2012-10-08
fate, virtualization, libvirt, xen
1, disk image lock
copy from https://fate.suse.com/313599
The virtual machine lock manager is a daemon which will ensure that a virtual machine's disk image cannot be written to by two QEMU/KVM processes at the same time. It provides protection against starting the same virtual machine twice, or adding the same disk to two different virtual machines. From our point view, this feature is a must to have in every production environment.

To enable this functionality the following packages are needed: kvm, qemu, libvirt and sanlock. According to the sles11 sp2 Release Notes http://www.novell.com/linux/releasenotes/x86_64/SUSE-SLES/11-SP2/ SANLOCK is not part of it. It would be very helpfull to include this sanlock into Sles11 SP2. To make make sure sanlock is working, libvirt must be updated version 0.9.9 (planned version 0.9.6) btw. sanlock is already available for RHEL6 Additional information: http://fedoraproject.org/wiki/Features/VirtLockManager http://libvirt.org/locking.html

2, 
https://fate.suse.com/313519
Avaya is switching from RH to SLES because we support Xen. This revenue stream is approx 400,000USD per year.

18:23 2012-10-08
GTD
2, next
1), opensuse arm: create MK802 new image. then reply "[opensuse-arm] Cubieboard".

13:08 2012-10-09
company, career, hire
"The Attachmate Group News <Novell.Send-As@Attachmate.com>"_email_"We're Hiring!  Refer a New Hire, Reap the Reward!"_20121009_0556
Bookmark these links and visit often!
Internal Career Site https://mynetiqcareers.silkroad.com/netiqint/Home.html
Employee Referral Policy https://mytagcareers.silkroad.com/netiqint/About_Us.html

18:19 2012-10-10
(13:07 2012-10-11)
opensuse, arm, opensuse 12.2, MK802, upload MK802 image to miniand; markdown example
1, picture
log/novell/opensuse_arm/picture
2, sftp
bamvor@dump.miniand.com
password: v5v4ZQvmRTCqbf8t
3, message(ref markdown convert and example, see"13:36 2012-10-11")
Title: Install Opensuse 12.2 with xfce

here is the lastest opensuse arm on MK802 -- opensuse 12.2 -- with xfce. The current version of the images support Wifi, USB Bluetooth, USB audio, USB network adaptor. 

 Download
--------------
[1GB 720p](http://dl.miniand.com/bamvor/opensuse_arm_1010__12_2__for_MK802_forum__xfce4_ok.7z) - 739MB. md5sum 423e81a198a87520ada9e33d27289e72


install and usage
-----------------------
* pls reference [Install Ubuntu Linux 12.04 - now including Droidmote](https://www.miniand.com/forums/forums/2/topics/1)
* you could write my 4G image to larger tf card through [makeSD.sh](git://github.com/cnxsoft/a10-tools.git)

detailed features
-----------------------
* 720p hdmi output
* start droidmote after x11 bootup with port 2303 and password 1234. 
* kernel config
    - enable uinput
    - enable the following use network adaptor in kernel config: AX8817X, QF9700, CDCETHER, DM9601, SMSC95XX, NET1080, ZAURUS. test qf9700 and smsc95xx successful. 
    - enable usb audio. test pass with CM108. 
    - enable usb bluetooth. 

Changelog
---------------
v1 - 2012-10-11
Initial version.

Known issues
-------------------
Hardware video decoding and 3D OpenGL isn't available.

![1](http://dl.miniand.com/bamvor/picture/1_login.jpg)
![2](http://dl.miniand.com/bamvor/picture/2_xfce_boot.jpg)
![3](http://dl.miniand.com/bamvor/picture/3_welcome_from_abiword.jpg)

4, url
https://www.miniand.com/forums/forums/development/topics/install-opensuse-12-2-with-xfce

11:34 2012-10-11
virtualization, libvirt, lock
1, Chunyan email
Hi, Bamvor, 

I've read your lock patch and qemu lock functions. I have some questions: 
1. Our lock patch functions are all similar to qemu functions, I think it should be OK since qemu is working. Some other functions in qemu but not in libxl like qemuDomainObjRestoreJob(). (will never used in libxl?) 
2. This is the first time I'm digging in the job series code, seems the benefit of these functions is only to coordinate different jobs (when we try to do a job, it will check if there are other jobs doing and check if this job can be co-working with those jobs), right? 
But "virsh list" doesn't use the job code, so live migration and "virsh list" co-working problem could not be solved by this lock mechanism. Its migration code lock driver and vm at the perform phase, and virsh list too, I doubt qemu can be virsh list and migration same time? Never tested. 

Thanks, 
Chunyan 

2, reply
> Hi, Bamvor, 
> 
> I've read your lock patch and qemu lock functions. I have some questions: 
> 1. Our lock patch functions are all similar to qemu functions, I think it
> should be OK since qemu is working.
yes, i think so.
> Some other functions in qemu but not in libxl like qemuDomainObjRestoreJob().
> (will never used in libxl?) 
the RestoreJob will be used in libxl if i want to recover job in the libxlReconnectDomain. but i guess it is not very important for now. 
> 2. This is the first time I'm digging in the job series code, seems the
> benefit of these functions is only to coordinate different jobs (when we try
> to do a job, it will check if there are other jobs doing and check if this
> job can be co-working with those jobs), right? 
yes. coordinate the api which maybe change the vm state.
> But "virsh list" doesn't use the job code, so live migration and "virsh list"
> co-working problem could not be solved by this lock mechanism. Its migration
> code lock driver and vm at the perform phase, and virsh list too, 
yes, because the "virsh list" only query the state, there is no need to protect. so do the qemu. 
> I doubt qemu can be virsh list and migration same time? Never tested. 
i test and it work. 

> 
> Thanks, 
> Chunyan 
> 

12:53 2012-10-11
virtualization, xen, meeting
"Lars Kurth <lars.kurth@xen.org>"_email_"[XenARM] Xen Day Barcelona 2012, Nov 8th @ LinuxCon"_20121009_2116
http://www.xen.org/community/events/xendaybarcelona2012.html
Topics that will be covered include:
* Virtualization in the Cloud: Featuring Xen and XCP
* Xen on ARM Cortex A15
* Xen 4.2 and xl
* Xen Benchmarks
* Meet the Xen Developers

13:36 2012-10-11
software, skill, markdown
1, example
1), http://daringfireball.net/projects/markdown/basics
2), 

2, tools
1), pandoc
2), sundown
https://github.com/vmg/sundown

16:36 2012-10-11
suse, release notes
"Karl Eichwalder <ke@suse.de>"_email_"[Research] Providing SLE 11 SP3 Release Notes"_20121011_1541
Here are some notes how you can help with the Release Notes.

Technical Background Info
=========================

Since SLE 11 SP2 we mostly create and maintain release notes entries in
FATE.  The "Editor" tab features an "Release Notes" sub-tab, where you
are expected to write the text: just Title, Challenge (optional), and
Solution.

Then select a "ReleaseNotes" category from the "Internal" sub-tab.  As
long as there is no ReleaseNotes category assigned, the entry does not
appear in the final release notes document.

We have FATE export scripts (written by Jürgen Weigert and Thomas
Schraitle) that merge FATE entries that are set to "Done", into the
traditional docbook document.  From the docbook document we create the
output format for yast, html, and pdf using the standard docbook xsl
style-sheets.

Thus far, in https://svn.suse.de/svn/doc/trunk we have

release-notes-sdk/
release-notes-sled/
release-notes-sles/         (also used for sles-for-vmware)
release-notes-suse-cloud/


Writing Texts
=============

Everybody is encouraged to help with writing such texts (drafts).  In
the end, the so-called stakeholders are responsible for providing the
texts.  Stakeholders are our partners (IBM is already pretty good with
providing input for their features), project and engineering managers,
and the developer.  Often even the product manager will lend a helping
hand in one or the other way ;)

If you do not feel comfortable with writing draft texts in the release
notes tab, at least try to summarize the implemented feature somehow and
either add this summary as a regular comment or add it to the
"Documentation Impact" field in the "Misc" sub-tab.

The assigned documentation editor (that's mostly me these days) cannot
wade through all the comments of a feature and write the release notes
snippets on his own.  I often simply do not actually understand what a
certain feature might be about, or it would take too much time to study
the long list of comments to get a clue about it.  Thus your help is
very much needed!


Challenges
==========

Some features apply for more than one SP and we will update the SP2
release notes document in parallel with the SP3 document for several
months.  This means you must write the entry in a way that it fits for
both SPs.

Release notes categories are often unclear.  If in doubt, select
ReleaseNotes:Features:Other (or, once available, ReleaseNotes:Misc).


Discussion
==========

This is how it looks to me.  I'd like to hear comments, either "in
general" or about some details.  Matthias, Gerald, or Jürgen, please add
what is needed!

-- 
Karl Eichwalder                              SUSE LINUX Products GmbH
R&D / Documentation                          Maxfeldstraße 5
                                             90409 Nürnberg, Germany
GF: Jeff Hawn, Jennifer Guild, Felix Imendörffer, HRB 16746 (AG Nürnberg)

17:31 2012-10-11
1, configure command in build service
./configure --host=x86_64-suse-linux-gnu --build=x86_64-suse-linux-gnu --target=x86_64-suse-linux --program-prefix= --prefix=/usr --exec-prefix=/usr --bindir=/usr/bin --sbindir=/usr/sbin --sysconfdir=/etc --datadir=/usr/share --includedir=/usr/include --libdir=/usr/lib64 --libexecdir=/usr/lib64 --localstatedir=/var --sharedstatedir=/usr/com --mandir=/usr/share/man --infodir=/usr/share/info --disable-static --with-pic --without-phyp --without-hyperv --without-numad --without-netcf --without-netcontrol --without-udev --without-macvtap --without-dtrace --without-libpcap --without-sanlock --without-driver-modules --libexecdir=/usr/lib64/libvirt --with-qemu-user=root --with-qemu-group=root --with-init_script=redhat ac_cv_path_MODPROBE=/sbin/modprobe ac_cv_path_UDEVADM=/sbin/udevadm ac_cv_path_SHOWMOUNT=/usr/sbin/showmount

2, commit log
1), Introduce a lock for libxl long-running api
This patch introduce a lock for protecting the long-running
api (save, dump, migration and so on) from the other api
which may update the status of the virtual machine. 

Signed-off-by: Bamvor Jian Zhang <bjzhang@suse.com>

2), Add lock for libxl api

Add long-running jobs for save, dump. Add normal job for the
api maybe modify the domain.

Signed-off-by: Bamvor Jian Zhang <bjzhang@suse.com>

3, 0913之后似乎修改过我这个patch，但是忘记在哪里修改的了。

4, make check && make syntax-check

5, write cover letter, confirm format. send patch to upstream

6, check Chunyan current patch. 
(17:47 2012-10-12)
discuss with Chunyan: migration still fail while "virsh list" execute. I need to compare this patch with my former patch. 

23:15 2012-10-11
virtualization, libvirt, libxl, lock; git, send patch
git format-patch --cover-letter master
git send-email --cover-letter --no-chain-reply-to --annotate --to libvir-list@redhat.com --cc eblake@redhat.com --cc jfehlig@suse.com --cc cyliu@suse.com 000*.patch

12:32 2012-10-12
hackweek, security, Shawn Chang
 canary: 每个函数的堆栈的插入4byte做检查。甚至打乱系统的堆栈顺序。
kernel: 如果内核进程hang，先睡眠三十秒。这样攻击者至少需要1024x30=512小时。

17:48 2012-10-12
GTD
2, next
1), lock patch
(1), check Chunyan patch. 
(2), add restore job. 
(3), waiting for libvirt upstream response. 

17:59 2012-10-12
opensource, China, open hardware
http://blug.chinalug.org/
http://www.open-drone.org/

13:46 2012-10-15
GTD
0, 13:46

1, today
1), check the mail. 
2), work report. see"15:57 2012-10-15"
3), read Chunyan laster migration patch. see"16:11 2012-10-15"

13:54 2012-10-15
mailing list, opensuse arm
1, execute virsh connect through normal user with polkit. 
jfehlig_email_"Re: [opensuse-virtual] outdated docs, kvm/libvirtd auth changes in 12.2"_20121012_1733
Olaf Hering wrote:
> While reading through the KVM documentation I noticed that the current
> version of openSuSE does not have the referenced polkit-auth anymore:
>
> http://doc.opensuse.org/documentation/html/openSUSE/opensuse-kvm/cha.libvirt.connect.html
>   

Yeah, that applies to SLES11, but not for openSUSE since 11.2 or so.  I
created a comment about this outdated info as per the feedback
instructions in "About This Manual".

> Has polkit-auth a replacement in 12.2?
>   

polkit-auth is part of the PolicyKit package, which was replaced with
polkit in openSUSE long ago.  Better documentation for using polkit is here

http://wiki.libvirt.org/page/SSHPolicyKitSetup

> For my own testing with libguestfs all it takes is to add the user to the
> group 'kvm' for the attach-method 'libvirt', so I dont really need
> polkit-auth.
>   

Your normal user can do stuff like 'virsh -c qemu+ssh:///system' without
configuring polkit as per the libvirt wiki?  On my 12.2 machine, I must
add the following to authenticate to the system URI (even when user
jfehlig is a member of libvirt, kvm, and qemu groups)

# cat /etc/polkit-1/localauthority/50-local.d/50-libvirt-remote-access.pkla
[Remote libvirt SSH access]
 Identity=unix-user:jfehlig
 Action=org.libvirt.unix.manage
 ResultAny=yes
 ResultInactive=yes
 ResultActive=yes

14:11 2012-10-15
Linux, development, 第七届中国Linux内核开发者大会 
KERNEL会议视频：http://www.tudou.com/home/item_u21107135s0p1.html

14:27 2012-10-15
1, bamvor_email_20121012_1837
I make a image for Allwinnner A10 MK802 dongle. and I upload it to MK802 forum(https://www.miniand.com/forums/forums/development/topics/install-opensuse-12-2-with-xfce). i not familiar with kiwi, so it is not available on build service. 
It should be work with other A10 board with 1G memory and HDMI output. 
besides it is a 3.0.38+ kernel(get it from github) in my image, it is possible to generate an official image for A10 borad? 
2, "Alexander Graf <agraf@suse.de>"_email_20121012_2347
Yes, definitely!
I will need to write up some slides on how to get your own board supported for the openSUSE Conference next week anyways. Once I have those done, I can easily send them over. It's really not all that complicated :).
3, "Kai Dupke <kdupke@suse.com>"_email_20121012_2354
> I will need to write up some slides on how to get your own board supported for the openSUSE Conference next week anyways. Once I have those done, I can easily send them over. It's really not all that complicated :).
That will be cool!

15:53 2012-10-15
virtualization, xen, kvm, libvirt, HA
1, Jfehlig_email_20121012_2317, HA on xen
The xen-tools package contains the userspace pieces for remus, but for
SLES at least we don't have the required sch_plug driver.  openSUSE does
have the driver, so in theory you could use remus with openSUSE12.2. 
More info on Xen and remus: http://wiki.xen.org/xenwiki/Remus

The kemari project noted by Andreas was also made to work with Xen, but
I haven't seen any activity wrt Xen+kemari in years.

FYI, some related fates

#311266: Add Kemari support (dynamic VM failover)
#306445: Stateful fail-over for Xen guests

> is it a something old ? no more maintained  ?
> did you have done any evaluation on it ?
>   

AFAIK, it is still maintained.  Support for remus was added to the new
libxl toolstack in Xen, so folks are still working on it.

I experimented with remus long ago (SLES11 GA timeframe??), but had
problems getting it configured/working and never did follow through. 
Chunyan, did you try remus in the early stages of SP2 development? 
Perhaps it was Dong Yang that had done some investigation, but I doubt
there is any written report on his findings.

2, Chunyan
>I experimented with remus long ago (SLES11 GA timeframe??), but had
>problems getting it configured/working and never did follow through.
>Chunyan, did you try remus in the early stages of SP2 development? 
Not yet. I did some experiments together with Dong Yang trying to make it work on SLES 11 SP1, but haven't touch it for a long time since then. 

3, Remus
Transparent high availability ("Fault Tolerance") for Xen VMs
Remus provides transparent, comprehensive high availability to ordinary virtual machines running on the Xen virtual machine monitor. It does this by maintaining a completely up-to-date copy of a running VM on a backup server, which automatically activates if the primary server fails. Key features:
The backup VM is an exact copy of the primary VM. When failure happens, it continues running on the backup host as if failure had never occurred.
The backup is completely up-to-date. Even active TCP sessions are maintained without interruption.
Protection is transparent. Existing guests can be protected without modifying them in any way. 
http://wiki.xen.org/xenwiki/Remus

15:57 2012-10-15
work report - week 41
1, [devel-server] work report - week 41
1), test and discuss with Chunyan about lock in libxl. 
and send this patch to upstream for 1st time review.
2), upload a opensuse12.2 image to forum for Allwinner A10 based board -- MK802.
https://www.miniand.com/forums/forums/development/topics/install-opensuse-12-2-with-xfce 

16:11 2012-10-15
virtualization
1, there is no lock if libxlVmStart fail. i guess it necessary to get driver and obj lock even if mlibxlVmStart fail. 
same status for libxl_domain_suspend

10:07 2012-10-16
GTD
0, 9:50

1, today
1), 10:13 personal stuff.
2), 11:30 libxl lock improvement. see"10:43 2012-10-16"
3), 30' discuss with Jiaju about Arm Linux distribution. 
4), check the mail. 

2, next
1), 看看北京开源软件和硬件"17:59 2012-10-12".
2), download the video, "14:11 2012-10-15".

10:43 2012-10-16
virtualization, libvirt, migration, libxl(xenlight), lock, cont22, improve the lock according to Chunyan's suggestion
1, plan
1), add RestoreJob and SetJobPhase.

2, about qemuProcessRecoverJob
如果migration进行中libvirtd restart, libxl的migration还会继续么? 从代码看qemu会继续. 

3, \TODO
1), define enum libxlMigrationJobPhase



