.LOG
12:54 2014-07-01
GTD
0, -18:00

1, today
1), health check.
2), 13:40-14:12 nap.
3), 14:12-17:53 snapshot doc.

14:35 2014-07-01
snapshot
1, comment
 * load domain snapshot configuration file(format: libxl-json) to
 * libxl_domain_snapshot struct for the domain domid and
 * domain snapshot name(snapshot->name).

 * store libxl_domain_snapshot struct to domain snapshot configuration
 * file(format: libxl-json) belong to specific domain(domain id: domid).
 * file name will be snapshotdata-<snapshot_name>.libxl-json
2, snapshot
libxl__qmp_disk_snapshot_transaction do not support external snapshot.
3, 突然忘了snapshot里面的path什么时候会用到?
path is only used when invoke qemu-img command. currently, only revert.
libxl_disk_to_snapshot is in wrong version. it could merge snapshot struct and disk info.
TODO consider how to deal with it.
4, TODO
感觉libxl_disk_to_snapshot函数问题很多啊, 什么是否判断是否可以做snapshot呢?
感觉还是需要加type的, 如果用户需要指明全局的type, 每个disk可以覆盖全局的flag.
否则就是操作disk snapshot时, 检查是否可以做snapshot. 但是这样感觉比较乱
(16:02 2014-07-02)
已经加了type, 改代码吧。

16:12 2014-07-01
bash
set -x
set +x

09:50 2014-07-02
suse, colleague, L3/Maintenance, Vit Pelcak
All,

I'm glad to announce that Vit Pelcak takes over the role
of Team Lead Maintenance QA Prague in the L3/Maintenance department.

Together with Heiko Rommel and Tony Yuan, who lead the Nuremberg and the China
QA Maintenace teams, he will lead our QA Maintenance effort.

Please join me in congratulating Vit to his new role and in
offering him our full support for his work.


Thanks a lot,
Mike

--
Michael Hager
Director L3/Maintenance

SUSE LINUX Products GmbH
Maxfeldstr. 5, D-90409 Nürnberg
GF:  Jeff Hawn, Jennifer Guild, Felix Imendörffer, HRB 16746 (AG Nürnberg)

09:52 2014-07-02
suse, colleague, team, suse lab, performance
Hello all,

I'd like to introduce a new team in the Labs, one that will be focusing on
tracking, understanding and improving the performance characteristics of SLES.

The team will be led by

Mel Gorman

and

Jan Kára
Mike Galbraith
Jan "Moskyto" Matějka
Tony Jones

will be the initial crew. I expect the team to grow as it takes on new
challenges.

I welcome Mel in his new role as a teamlead, and wish both him and the
team a lot of success!

--
Vojtech Pavlik
Director SUSE Labs

10:10 2014-07-02
GTD
0, 9:40-17:55

1, today
1), 10:11-10:18 summary virtualization. see"10:11 2014-07-02"
TODO: add my voice recording.
2), 10:19-17:49 snapshot doc.
3), 11:15-14:00 send stuff to my parents.

10:11 2014-07-02
summay, virtualization, kernel; qemu; management tools
1, 从虚拟化技术看内核的新feature.
1), memory relative
tmem: 最开始为了xen引入.
ksm: for kvm?
huge tlb, transparent tlb.
2), pvops

2, qemu
multi data pane.

3, management tools
看起来用libvirt控制xen或kvm虚拟机是一样的. 其实libvirt控制xen经常要通过hypercall到xen hypervisor. 控制qemu多数是直接和qemu进程打交道. 如果有必要qemu或通过kvm fd和kernel kvm module说话.

10:35 2014-07-02
software skill, quilt import

18:10 2014-07-02
software skill, language, locale
LANG=zh_CN.utf8 LC_ALL=zh_CN.utf8 man ls

10:21 2014-07-03
GTD
0, 10:13

1, today
1), send snapshot doc v5 candidate to Chunyan and Roger.
2), 10:20-11:35 snapshot code.
3), 11:35-12:19 lunch.
4), 13:30-14:20 go to hospital

12:33 2014-07-03
/usr/bin/qemu-kvm -name clmd_n1_sles12 -S -machine pc-i440fx-1.4,accel=kvm,usb=off -m 768 -smp 4,sockets=4,cores=1,threads=1 -uuid a4eb4367-b880-3b11-d1e8-d5d2b2c1a3aa -no-user-config -nodefaults -chardev socket,id=charmonitor,path=/var/lib/libvirt/qemu/clmd_n1_sles12.monitor,server,nowait -mon chardev=charmonitor,id=monitor,mode=control -rtc base=utc -no-shutdown -device piix3-usb-uhci,id=usb,bus=pci.0,addr=0x1.0x2 -drive file=/mnt/vm/clmd_n1_sles12/disk0.raw,if=none,id=drive-virtio-disk0,format=raw -device virtio-blk-pci,scsi=off,bus=pci.0,addr=0x4,drive=drive-virtio-disk0,id=virtio-disk0,bootindex=1 -netdev tap,fd=23,id=hostnet0,vhost=on,vhostfd=25 -device virtio-net-pci,netdev=hostnet0,id=net0,mac=52:54:00:0c:78:00,bus=pci.0,addr=0x3 -vnc 0.0.0.0:0 -vga cirrus -device virtio-balloon-pci,id=balloon0,bus=pci.0,addr=0x5

11:17 2014-07-04
GTD
0,

1, today
1), 13:39-18:19 virtualization summary.

13:16 2014-07-04
software skill, system, log, rsyslog; mailing list, suse, research
1, "Marcus Rueckert <mrueckert@suse.de>"_email_"sean <xrfu@novell.com>"_"[Research] Does "syslogd" support encrypted transmission?"_20140630_1540
On 2014-06-30 09:39, sean wrote:
>   Does "syslogd" support encrypted transmission?
> If yes, Could you tell me how to set it?

use rsyslog.

for older distributions you could try TCP syslog via stunnel.

2, http://www.rsyslog.com/
RSYSLOG is the Rocket-fast SYStem for LOG processing.

It offers high-performance, great security features and a modular design. While it started as a regular syslogd, rsyslog has evolved into a kind of swiss army knife of logging, being able to accept inputs from a wide variety of sources, transform them, and output to the results to diverse destinations.

RSYSLOG can deliver over one million messages per second to local destinations when limited processing is applied (based on v7, December 2013). Even with remote destinations and more elaborate processing the performance is usually considered "stunning".

 RSYSLOG:
    Multi-threading
    TCP, SSL, TLS, RELP
    MySQL, PostgreSQL, Oracle and more
    Filter any part of syslog message
    Fully configurable output format
    Suitable for enterprise-class relay chains

13:47 2014-07-04
virtualization, docker
1, start docker daemon
> systemctl show docker | head -n 12
Id=docker.service
Names=docker.service
Requires=network.target basic.target
Wants=system.slice
Conflicts=shutdown.target
Before=shutdown.target
After=multi-user.target systemd-journald.socket basic.target system.slice
Description=Docker
LoadState=loaded
ActiveState=inactive
SubState=dead
> systemctl start docker
Failed to issue method call: Access denied
> sudo systemctl start docker
root's password:
> systemctl show docker | head -n 12
Id=docker.service
Names=docker.service
Requires=network.target basic.target
Wants=system.slice
Conflicts=shutdown.target
Before=shutdown.target
After=multi-user.target systemd-journald.socket basic.target system.slice
Description=Docker
LoadState=loaded
ActiveState=active
SubState=running
> ps -ef|grep docker
root      3554     1  0 13:47 ?        00:00:00 /usr/bin/docker -d

13:58 2014-07-04
software skill, zypper, non-interactive
        --non-interactive, -n   Do not ask anything, use default answers
                                automatically.
e.g. zypper -n in libvirt

16:06 2014-07-04
snapshot doc TODO
1, path: external snapshot file or dev path to new?
TODO: try it in libvirt qemu.
it is new. it is not the external snapshot file.
2, cover letter可以把我们的需求写的更迫切一些，恳切一些。

17:51 2014-07-04
bj-ha-3:/mnt/vm/bamvor # cat snapshot_ex.xml
<domainsnapshot>
  <description>Snapshot external test</description>
  <memory snapshot='external' file='/mnt/vm/bamvor/memory'/>
  <disks>
    <disk name='/mnt/vm/bamvor/disk0.qcow2' snapshot='external'>
      <driver type='qcow2'/>
      <source file='/mnt/vm/bamvor/disk0_new.qcow2'/>
    </disk>
  </disks>
</domainsnapshot>

bj-ha-3:/mnt/vm/bamvor # vim snapshot_ex.xml
bj-ha-3:/mnt/vm/bamvor # virsh snapshot-create cl8_n1_sles12b8_bjz snapshot_ex.xml
Domain snapshot 1404467157 created from 'snapshot_ex.xml'
bj-ha-3:/mnt/vm/bamvor # virsh list
 Id    Name                           State
----------------------------------------------------
 3     cl1_n1_sles12                  running
 4     cl8_n1_sles12b8                running
 5     clmd_n1_sles12                 running
 27    cl8_n1_sles12b8_bjz            running

bj-ha-3:/mnt/vm/bamvor # virsh dumpxml 27 | less
bj-ha-3:/mnt/vm/bamvor # ps -ef|grep qemu
root     27085     1  3 17:11 ?        00:01:08 /usr/bin/qemu-kvm -name cl8_n1_sles12b8_bjz -S -machine pc-i440fx-1.4,accel=kvm,usb=off -m 1024 -smp 1,sockets=1,cores=1,threads=1 -uuid 016db229-a046-26a8-3956-85c7fca5f96a -no-user-config -nodefaults -chardev socket,id=charmonitor,path=/var/lib/libvirt/qemu/cl8_n1_sles12b8_bjz.monitor,server,nowait -mon chardev=charmonitor,id=monitor,mode=control -rtc base=utc -no-shutdown -device piix3-usb-uhci,id=usb,bus=pci.0,addr=0x1.0x2 -drive file=/mnt/vm/bamvor/disk0.qcow2,if=none,id=drive-ide0-0-0,format=qcow2 -device ide-hd,bus=ide.0,unit=0,drive=drive-ide0-0-0,id=ide0-0-0,bootindex=1 -netdev tap,fd=25,id=hostnet0 -device rtl8139,netdev=hostnet0,id=net0,mac=52:54:00:6f:d6:f1,bus=pci.0,addr=0x3 -netdev tap,fd=26,id=hostnet1 -device rtl8139,netdev=hostnet1,id=net1,mac=52:54:00:82:d4:da,bus=pci.0,addr=0x5 -vnc 0.0.0.0:3 -vga cirrus -device virtio-balloon-pci,id=balloon0,bus=pci.0,addr=0x4
root     28207 26515  0 17:46 pts/3    00:00:00 grep qemu
bj-ha-3:/mnt/vm/bamvor # ls
bjz.xml  disk0_new.qcow2  disk0.qcow2  disk0.raw  memory  snapshot_ex.xml
bj-ha-3:/mnt/vm/bamvor # qemu-img info disk0.qcow2
image: disk0.qcow2
file format: qcow2
virtual size: 10G (10737418240 bytes)
disk size: 974M
cluster_size: 65536
backing file: disk0.raw
Snapshot list:
ID        TAG                 VM SIZE                DATE       VM CLOCK
1         1404466193             851M 2014-07-04 17:29:53   00:18:08.509
bj-ha-3:/mnt/vm/bamvor # qemu-img info disk0_new.qcow2
image: disk0_new.qcow2
file format: qcow2
virtual size: 10G (10737418240 bytes)
disk size: 4.7M
cluster_size: 65536
backing file: /mnt/vm/bamvor/disk0.qcow2
backing file format: qcow2
bj-ha-3:/mnt/vm/bamvor #

08:12 2014-7-7
summary
live migration, lazy restore.

9:28 2014-7-7
software skill, misc, share mouse and keyboard
http://synergy-project.org

10:32 2014-07-07
GTD
0, 10:10

1, today
1), 10:33-11:37 13:21-15:46 send snapshot doc.
2), 11:37-12:35 lunch.
3), 12:35-13:16 software skill, "12:47 2014-07-07", "13:15 2014-07-07"
4), 20' discuss with dongmao about lvm. ref"16:19 2014-07-07"
5), 16:52-17:54 snapshot coding.

10:43 2014-07-07
snapshot, doc
git send-email * --no-chain-reply-to --annotate --to xen-devel@lists.xen.org --cc anthony.perard@citrix.com --cc ian.jackson@eu.citrix.com --cc ian.campbell@citrix.com --cc cyliu@suse.com --cc jfehlig@suse.com --cc zzhou@suse.com --cc hahn@univention.de --cc davidkiarie4@gmail.com --cc bjzhang@suse.com

12:47 2014-07-07
software skill, editor, vim, system clipboard: register *; X clipboard: register +
1, http://vim.wikia.com/wiki/Accessing_the_system_clipboard
Vim has extended vi to allow use of the * register as a reference to the system clipboard. So we can use normal mode commands like: "*dd or 1G"*yG to copy things into the * register and "*p to paste text from it.
2, "+" mean X clipboard.

13:15 2014-07-07
software skill, man page, man
1, "man apropos" to learn about a REALLY awesome program for searching through the manual pages.
2, man man
       -k, --apropos
              Equivalent to apropos.  Search the short manual page descriptions for keywords and display any matches.  See apropos(1) for details.

15:49 2014-07-07
virtualization, xen, arm
Stefano Stabellinim 20130731
http://lists.xen.org/archives/html/xen-devel/2013-07/msg02867.html
Considering that all guests, including dom0, run on xen on arm with
second stage translation enabled, it follows that without an IOMMU no
guests could actually drive the hardware.

The solution for platforms without an IOMMU is to use swiotlb-xen,
adapted to autotranslate guests. swiotlb-xen provides a set of dma_ops
that can be used by Linux to setup a contiguous buffer in stage-2
addresses and use it for dma operations.
Basically Linux asks Xen to make a buffer contiguous and gets the
machine address for it. This buffer is going to be used by lib/swiotlb.c
to allocate bounce buffers.

16:19 2014-07-07
software skill, storage, device mapper, lvm, dmsetup table
linux-bjrd:/home/bamvor # vgs
File descriptor 12 (socket:[335378]) leaked on vgs invocation. Parent PID 20125: bash
  VG      #PV #LV #SN Attr   VSize  VFree
  host      1   6   0 wz--n-  1.00t 513.00g
  system    2   2   0 wz--n- 31.26g      0
  system2   1   2   0 wz--n- 25.00g   6.00g
File descriptor 12 (socket:[335378]) leaked on vgchange invocation. Parent PID 20125: bash
  6 logical volume(s) in volume group "host" now active
linux-bjrd:/home/bamvor # dmsetup table
host-root: 0 104857600 linear 8:2 419432448
host-root_opensuse: 0 104857600 linear 8:2 629147648
host-migration_test: 0 20971520 linear 8:2 528484352
host-vm: 0 419430400 linear 8:2 734005248
host-home: 0 419430400 linear 8:2 2048
host-target: 0 2097152 linear 8:2 526387200

bamvor: meaning: name: ?? size linear major:minor start

16:54 2014-07-07
snapshot
1, libxl_disk_to_snapshot.
set or unset empty string in this function.
DONE
2, 现在就是external snapshot revert, 没有做，如果社区同意不做，就省事了。
3, create external snapshot时，xenstore和libxl-json里面的信息是否要修改??
最好是都修改了，但是不能影响系统运行。实在不行就修改一部分，但是输出配置文件应该是正确的。

10:28 2014-07-08
virtualization, colleague, alex graf, XNU
http://zh.wikipedia.org/wiki/XNU
XNU，由蘋果電腦發展的作業系統內核，被使用於Mac OS X中。它是Darwin作業系統的一部份，跟隨著Darwin一同作為自由及开放源代码软件被發布。XNU是X is Not Unix的縮寫。
歷史
XNU最早是NeXT公司為了NeXTSTEP作業系統而發展的。它是一種混合式核心（Hybrid kernel），結合了由卡內基美隆大學發展的Mach 2.5版，4.3BSD，與稱為Driver Kit的物件導向應用程式介面。
在蘋果電腦收購NeXT公司之後，XNU的Mach微內核被升級到Mach 3.0，BSD的部份升級至FreeBSD，Driver Kit則改成I/O Kit，一套以C++撰寫的應用程式介面。

