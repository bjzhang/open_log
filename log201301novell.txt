.LOG
21:27 2013-01-01
opensuse, arm, build sun4i image, cont1, build u-boot
1, ref u-boot build doc on git hub
https://github.com/linux-sunxi/u-boot-sunxi/wiki

10:59 2013-01-04
GTD
0, 10:45-19:55

1, today
1), 10:59-11:40 mail.
2), Jim email. "11:00 2013-01-04"
3), debug libvirt libxl console. see"16:50 2013-01-04"

11:00 2013-01-04
virtualization, libvirt, xen, xenlight, libxl, xen4.2 support, cont17, Jim's email
1, Jim
Jim Fehlig wrote:
> Bamvor Jian Zhang wrote:
>   
>> i patch u two patches to libvirt upstream code. and test hvm start, shutdown, save and pv start.
>> hvm shutdown, hvm save and pv start fail. hvm shutdown and pv start both fail at seqfault in the pthread_mutex_lock in which lock is 0. and called from libxlFDDeregisterEventHook.
>>   
>>     
>
> That is interesting.  I haven't seen this problem, but I'm back to
> testing on our Xen 4.2 packages (which include backports of Ian's
> patches).  I'll have to remove our Xen packages and try xen-untable again.
>   
>   
>> at first, i thought the failure in pv start is because libxlDomainObjPrivateFree is called before libxlFDDeregisterEventHook, but it is not happened from code or from gdb log.
>> So, what if libxlFDDeregisterEventHook is failed at the first time? it is in the pv start. and it will be failed while libxlFDDeregisterEventHook is called before libxlDomainObjPrivateAlloc. test it in gdb, gdb log approve it.
>> from gdb log, the priv is 0x712d60 same in fd register and deregister. the but virMutex is different:
>> in fd register: 0x717d60
>> in fd deregister: 0x712d70
>>   
>>     
>
> I'm testing another version of my libvirt patch that seems to work with
> Xen 4.2.  I'll try it with xen-unstable and if all goes well, I'll send
> you the updated patch for testing on your side.
>   

Ok, I've tested the attached patches on xen-unstable and do not see the
races.  I don't see any problem with hvm guests, but there is a problem
with the console on pv guests.  When viewing the guest's vnc console, I
see "serial0 console" and nothing else.  Seems like the guest is waiting
for the console to initialize before continuing booting.  The vfb setup
in xenstore is quite strange too.  xenstore-ls shows a backend vfb path
of '/local/domain/0/backend/vfb/11/-1' with the following contents

       frontend = "/local/domain/11/device/vfb/-1"
       frontend-id = "11"
       online = "1"
       state = "4"
       domain = "sles11sp2-pv"
       vnc = "1"
       vnclisten = "127.0.0.1"
       vncdisplay = "0"
       vncunused = "0"
       sdl = "0"
       opengl = "0"
       feature-resize = "1"
       hotplug-status = "connected"
       request-update = "1"

The '-1' is odd.  I haven't looked into this problem yet, but don't
think it is related to these patches.  IMO this problem is related to
some console initialization bug.

Can you review and test these patches?  I'd like to get the race issues
resolved and patches committed upstream soon.

Thanks!
Jim
2, 
Jim Fehlig wrote:
> Jim Fehlig wrote:
>   
>> Bamvor Jian Zhang wrote:
>>   
>>     
>>> i patch u two patches to libvirt upstream code. and test hvm start, shutdown, save and pv start.
>>> hvm shutdown, hvm save and pv start fail. hvm shutdown and pv start both fail at seqfault in the pthread_mutex_lock in which lock is 0. and called from libxlFDDeregisterEventHook.
>>>   
>>>     
>>>       
>> That is interesting.  I haven't seen this problem, but I'm back to
>> testing on our Xen 4.2 packages (which include backports of Ian's
>> patches).  I'll have to remove our Xen packages and try xen-untable again.
>>   
>>   
>>     
>>> at first, i thought the failure in pv start is because libxlDomainObjPrivateFree is called before libxlFDDeregisterEventHook, but it is not happened from code or from gdb log.
>>> So, what if libxlFDDeregisterEventHook is failed at the first time? it is in the pv start. and it will be failed while libxlFDDeregisterEventHook is called before libxlDomainObjPrivateAlloc. test it in gdb, gdb log approve it.
>>> from gdb log, the priv is 0x712d60 same in fd register and deregister. the but virMutex is different:
>>> in fd register: 0x717d60
>>> in fd deregister: 0x712d70
>>>   
>>>     
>>>       
>> I'm testing another version of my libvirt patch that seems to work with
>> Xen 4.2.  I'll try it with xen-unstable and if all goes well, I'll send
>> you the updated patch for testing on your side.
>>   
>>     
>
> Ok, I've tested the attached patches on xen-unstable and do not see the
> races.

Hmm, spoke too soon.  When doing save/restore in a loop, I eventually
hit a race between libxlEventHandler() and domain cleanup in
libxlDoDomainSave().

>   I don't see any problem with hvm guests, but there is a problem
> with the console on pv guests.  When viewing the guest's vnc console, I
> see "serial0 console" and nothing else.  Seems like the guest is waiting
> for the console to initialize before continuing booting.  The vfb setup
> in xenstore is quite strange too.  xenstore-ls shows a backend vfb path
> of '/local/domain/0/backend/vfb/11/-1' with the following contents
>
>        frontend = "/local/domain/11/device/vfb/-1"
>        frontend-id = "11"
>        online = "1"
>        state = "4"
>        domain = "sles11sp2-pv"
>        vnc = "1"
>        vnclisten = "127.0.0.1"
>        vncdisplay = "0"
>        vncunused = "0"
>        sdl = "0"
>        opengl = "0"
>        feature-resize = "1"
>        hotplug-status = "connected"
>        request-update = "1"
>
> The '-1' is odd.  I haven't looked into this problem yet, but don't
> think it is related to these patches.  IMO this problem is related to
> some console initialization bug.
>   

I sent a patch to xen-devel to fix this issue

http://lists.xen.org/archives/html/xen-devel/2013-01/msg00137.html

The devid field of vfb and vkb could also have been initialized in the
libxl driver, similar to how we set it in libxlMakeNicList().  But libxl
already sets devid for other devices, so seems the right place to do it
for vfb and vkb devices too.

> Can you review and test these patches?  I'd like to get the race issues
> resolved and patches committed upstream soon.
>   

No need to test the patches.  Maybe we need to rethink this whole
problem and see if there isn't a more elegant solution...

Jim

11:01 2013-01-04
company, colleague, QA, Yoonsuk Cho, report to Sebastian Vollath
"Sebastian Vollath <svollath@suse.de>"_email
it's my pleasure to announce a new team member.
Yoonsuk Cho joined the QA-EMEA team in Nuremberg today. Yoonsuk - also called
Brian - has a strong background in IBM's System Z/s390, where he will focus on
within QA.
Please join me in giving him a warm welcome and support him in getting used to
SUSE and QA.

Thanks,
  Sebastian

16:50 2013-01-04
suse, virtualization, libvirt, qemu, xen, libxlDomainOpenConsole, base on xen4.2, cont1, debug
1, seqfault
#0  0x00007f16f80e9c80 in __errno_location@plt () from /usr/lib64/libvirt.so.0
#1  0x00007f16f8217410 in virNetServerFatalSignal (sig=11,
    siginfo=0x7f16f03be570, context=0x7f16f03be440) at rpc/virnetserver.c:337
#2  <signal handler called>
#3  __pthread_mutex_lock (mutex=0x0) at pthread_mutex_lock.c:50
#4  0x00007f16f817eaec in virConsoleOpen (cons=0x0, pty=0x706b40 "/dev/pts/4",
    st=0x705900, force=false) at conf/virconsole.c:345

and the mutex is empty:
(gdb) frame 3
#3  __pthread_mutex_lock (mutex=0x0) at pthread_mutex_lock.c:50
(gdb) p mutex
$7 = (pthread_mutex_t *) 0x0
1), this is because of missing alloc and free in private alloc and free.
add virConsoleAlloc and VirConsoleFree to libxlDomainObjPrivateAlloc and libxlDomainObjPrivateFree.
2), successful in pv. add console and test it in hvm.

2, even xl and xenconsole could not got it
# xl console 5
xenconsole: Could not read tty from store: No such file or directory
1), test it on xen4.1.2
linux-work:~ # xenstore-read /local/domain/1/serial/0/tty
/dev/pts/1
2), it is not exist in xen4.2

10:14 2013-01-05
GTD
0, 9:50-10:50 12:25-13:35 15:04-18:05

1, today
1), 20' talk with Shawn. about arm multi-processor.
2), 10:23-10:50 15:04-16:11 fix xen install issue, try to update patch. see"14:30 2012-12-25". "10:30 2013-01-05"
nap 30'
3), 40' read ARM_ARM doc. see"14:04 2013-01-05"
4), 16:43-17:59 libvirt libxl blkstats: write the code for libxl qmp. see"16:44 2013-01-05"

14:04 2013-01-05
architecture, arm, read ARM_ARM doc, Long-descriptor format
1, system mmu
The field marked as Reserved for System MMU use is ignored by a processor that is using the Large Physical
Address Extension. When a processor is using this extension, the architecture guarantees that the hardware
does not alter this field.
2, Contiguous hint
Use of this hint means that the TLB can cache a single entry to cover the 16 translation table entries.
3, Use of TTBR0 and TTBR1, Long-descriptor format
Table B3-2
introduce T1SZ in TTBCR. it will use with T0SZ. 看起来这个是为了支持大于32位地址空间时，application和kernel可以用不连续的区域。是否在armv7A里面，hypervisor可以利用这个把自己放在高地址？类似x86_64里面user space and kernel space的划分。

16:44 2013-01-05
virtualization, libvirt, xenlight, add libxl api, cont3, domainBlockStats, cont2, qemu, QMP, add qmp in libxl
1, found a libxl__qmp_query_serial in libxl_qmp.c, could i get the serial device?
if serial device is found, store_serial_port_info will write it to xenstore. So, in my test, xenstore fail is because serial device is not found in qemu. but why? is it mean that libvirt do not give the serial info to libxl? \TODO. 

2, how to write the qmp for querying block stats?
qmp_run_command ->  libxl__qmp_initialize
                    qmp_synchronous_send
                    libxl__qmp_close

3, install a qemu vm and see how does the domblklist, domblkstats used in libvirt and how blockstats used in qemu monitor.

10:59 2013-01-06
GTD
0, 10:40-11:40 12:50-18:03

1, today
1), 30' github how to. see"14:02 2012-12-26"5.
2), 13:30-14:44 hg and bitbucket. see"13:26 2013-01-06"
3), 14:57-16:36 xen patch: upstream reply. see"14:57 2013-01-06"
rest 30'
4), 16:43-17:20 libvirt libxl blkstats: write the code for libxl qmp.

13:26 2013-01-06
software, SCM, hg, bitbucket.org
1, try bitbucket: support both git and hg. the import repo GUI is very simple.
https://bitbucket.org/
http://shawphy.com/2010/08/bitbucket-vs-github.html
2, doc link
** Email validation **
Confirming your email address enables Bitbucket to better recognize your commits, even if you’ve made them from different identities.
Validate: http://click.mailer.atlassian.com/?qs=8485701c4c0134c7f562703a2fed60c320a5e2211ea5c615f9b0296132fbba92548914af82bdc84c
** Import your code **
Import your existing source code  from Subversion directly into Bitbucket. Importers are also available for Google Code, SourceForge and Mercurial.
Import: http://click.mailer.atlassian.com/?qs=8485701c4c0134c75002c02905017653b74e916cf1841d3fa9a4b26a3df89f82fd20aee5fde417a8 
** Bitbucket 101 **
Everything you need to know to get started using Bitbucket, but were afraid to ask.
101: http://click.mailer.atlassian.com/?qs=8485701c4c0134c792a414a9cc6a98b7f7dc8d3c3ff973c1df8686a0c384be7ad19d93814b3f9ba7 
** Hgtip.com **
This brief document provides step-by-step instructions for configuring your Mercurial source code, users, projects and more.
Hgtip: http://click.mailer.atlassian.com/?qs=8485701c4c0134c76933f63c01313dc18fc7919e9ff2b6880b3b3173bda4e1ec6087d5563e6a1c52 
** Follow us **
Keep up with the latest Bitbucket improvements and news, as well as tips for getting started with Mercurial, on the Bitbucket blog or Twitter.
Blog: http://click.mailer.atlassian.com/?qs=8485701c4c0134c79f2ec9f37916a67ea89bcabeeda94690c5cf01adfe2d73b752d3948a322c7e02
Twitter: http://click.mailer.atlassian.com/?qs=8485701c4c0134c78ce0509f48e00bb3d4b59a8e201231b1a21991b4c933a8ff32ed673dd90c5a4b
3, how to merge with upstream
ref: http://stackoverflow.com/questions/2679605/how-to-pull-in-upstream-changes-into-a-fork-using-mercurial
If you cloned the repository from the one you want to pull changes from, you can simply do:
hg pull
If you cloned the repository from another repository, you can:
hg pull <location of repository to pull from>
You'll then need to update your working copy:
hg update
That's the basics, anyway. More details are available in the Mercurial: The Definitive Guide
4, gitweb like tools
ref:  http://www.hksilicon.com/kb/cn/articles/7766/Mercurial
input "hg serve -p 5000" under hg repo.
input http://localhost:5000 in my web browser.
5, branch how to
1), create
> hg branch libxl_blkstats
marked working directory as branch libxl_blkstats
(branches are permanent and global, did you want a bookmark?)
> hg branch                             
libxl_blkstats                                               
before u first commit, branches will not show this branch.
> hg branches                           
default                    26323:64b36dde26bc                
se "hg -v help branches" to show more info
> hg commit -m "create branch for adding block stats in libxl"
> hg branches
libxl_blkstats             26324:5961ce950c2a
default                    26323:64b36dde26bc

14:35 2013-01-06
git, doc, about HEAD,How does origin/HEAD get set?
http://stackoverflow.com/questions/8839958/how-does-origin-head-get-set
origin/HEAD represents the default branch on the remote. origin's HEAD will only change if you or someone else actually changes it in the remote repository, which should basically never happen - you want the default branch a public repo to stay constant, on the stable branch (probably master). origin/HEAD is a local ref representing a local copy of the HEAD in the remote repository. (Its full name is refs/remotes/origin/HEAD.)

14:57 2013-01-06
(16:58 2013-01-08)
virtualization, xen, build error, libxl-save-helper not found, cont4, upstream reply
1, "Matt Wilson <msw@amazon.com>"_email_20130105
Hi Bamvor,

Please include a "Signed-off-by:" line in your patches. See "Signing
off a patch" in http://wiki.xen.org/wiki/Submitting_Xen_Patches

Do you see this problem when you run "./configure --libdir=/usr/lib64"?
See the 4.2 release notes for more information:
  http://wiki.xen.org/wiki/Xen_4.2_Release_Notes#Build_Requirements

Matt

2, about libdir
1), my current cmd:
./configure --enable-xenapi --prefix=/usr --exec_prefix=/usr --bindir=/usr/bin --sbindir=/usr/sbin --libdir=/usr/lib64 --datadir=/usr/share
2), i do not notice this. but it could explain why xen4.2 is ok.
3), try it on osc local build.
it is.

3, reply
> Please include a "Signed-off-by:" line in your patches. See "Signing
> off a patch" in http://wiki.xen.org/wiki/Submitting_Xen_Patches
sorry missing it. i will add it next time.

> Do you see this problem when you run "./configure --libdir=/usr/lib64"?
> See the 4.2 release notes for more information:
>   http://wiki.xen.org/wiki/Xen_4.2_Release_Notes#Build_Requirements
I got this issue while using the above libdir, here is my command of configure 
./configure --enable-xenapi --prefix=/usr --exec_prefix=/usr --bindir=/usr/bin --sbindir=/usr/sbin --libdir=/usr/lib64 --datadir=/usr/share
but the LIBEXEC is force set to /usr/lib/xen/bin in config/StdGNU.mk. So, the libdir is /usr/lib64 while libexec is /usr/bin/xen/bin in tools/libxl/_paths.h

meanwhile, the libxl-save-helper is install to "PRIVATE_BINDER" in tools/libxl/Makefile not LIBEXEC:
$(INSTALL_PROG) libxl-save-helper $(DESTDIR)$(PRIVATE_BINDIR)
using the "PRIVATE_BINDER" in run_helper make it coherence with this Makefile.

BTW, these files are not changed after xen4.2, but i only found this issue in xen-unstable.

4, "Ian C"_email_20120107
16:56 2013-01-08
On Sun, 2013-01-06 at 08:35 +0000, Bamvor Jian Zhang wrote:
> 
>  >>>Matt Wilson <msw@amazon.com> wrote: 
> > On Sat, Jan 05, 2013 at 04:10:52PM +0800, Bamvor Jian Zhang wrote: 
> > > in current xen x86_64, the default libexec directory is /usr/lib/xen/bin, 
> > > while the private binder is /usr/lib64/xen/bin. but some commands(pygrub, 
> > > libxl-save-helper) located in private binder directory is called from 
> > > libexec directory which lead to the following error: 
> > > 1, for pygrub bootloader: 
> > > libxl: debug: libxl_bootloader.c:429:bootloader_disk_attached_cb: 
> > > /usr/lib/xen/bin/pygrub doesn't exist, falling back to config path 
> > > 2, for libxl-save-helper: 
> > > libxl: cannot execute /usr/lib/xen/bin/libxl-save-helper: No such file or 
> > > directory 
> > > libxl: error: libxl_utils.c:363:libxl_read_exactly: file/stream truncated 
> > > reading ipc msg header from domain 3 save/restore helper stdout pipe 
> > > libxl: error: libxl_exec.c:118:libxl_report_child_exitstatus: domain 3 
> > > save/restore helper [10222] exited with error status 255 
> > >  
> > > there are two ways to fix above error. the first one is make such command 
> > > store in the /usr/lib/xen/bin and /usr/lib64/xen/bin(symbol link to 
> > > previous), e.g. qemu-dm. The second way is using private binder dir 
> > > instead of libexec dir. e.g. xenconsole. 
> > > For these cases, the latter one is suitable. 

This change seems correct to me.

> > Hi Bamvor, 
> >  
> > Please include a "Signed-off-by:" line in your patches. See "Signing
> > off a patch" in http://wiki.xen.org/wiki/Submitting_Xen_Patches
> sorry missing it. i will add it next time.

Please do.

> 
> > Do you see this problem when you run "./configure --libdir=/usr/lib64"?
> > See the 4.2 release notes for more information:
> >   http://wiki.xen.org/wiki/Xen_4.2_Release_Notes#Build_Requirements
> I got this issue while using the above libdir, here is my command of configure 
> ./configure --enable-xenapi --prefix=/usr --exec_prefix=/usr --bindir=/usr/bin --sbindir=/usr/sbin --libdir=/usr/lib64 --datadir=/usr/share
> but the LIBEXEC is force set to /usr/lib/xen/bin in config/StdGNU.mk. So, the libdir is /usr/lib64 while libexec is /usr/bin/xen/bin in tools/libxl/_paths.h

You aren't saying that _paths.h is inconsistent with the actual install
locations for either LIBEXEC or PRIVATE_BINDIR, are you? Just that the
wrong one is being used in the code.

I'm not entirely sure what the intended distinction between libexec and
private-bindir is. We should perhaps consider nuking one or the other.

> meanwhile, the libxl-save-helper is install to "PRIVATE_BINDER" in tools/libxl/Makefile not LIBEXEC:
> $(INSTALL_PROG) libxl-save-helper $(DESTDIR)$(PRIVATE_BINDIR)
> using the "PRIVATE_BINDER" in run_helper make it coherence with this Makefile.
> 
> BTW, these files are not changed after xen4.2, but i only found this issue in xen-unstable.

That's odd, both branches contain 25594:ad08cd8e7097 which is when the
libexec dir changed. I can't see anything else which looks like it would
cause the two to differ.

Ian.

5, from Ian Campbell email, i know that Matt Wilson add the patch for specifying the --libdir in configure.

6, do more test about this.
i fail in xen4.2 either.

7, reply
> Please do.
sent it.

> You aren't saying that _paths.h is inconsistent with the actual install
> locations for either LIBEXEC or PRIVATE_BINDIR, are you? Just that the
> wrong one is being used in the code.
yes, i am not. i talking about how to use the path in the code.

> That's odd, both branches contain 25594:ad08cd8e7097 which is when the
> libexec dir changed. I can't see anything else which looks like it would
> cause the two to differ.
i re-test in xen4.2, got the same error in xen-unstable. it is only ok in
xen4.1 in my test right now. Sorry for my wrong report in my last post.
this code(25539:0f1a974bfb38) has beed commit over 6 months. i should
not the only one who encounter this issue. but i do not found anything wrong
in my build and run-time environment.

8, hg send email
missing --flag while i sending. how fool am i.
hg email -r 26338 --plain --flag V2 --to xen-devel@lists.xen.org --cc Ian.Jackson@eu.citrix.com --cc Ian.Campbell@citrix.com  --cc msw@amazon.com --cc bjzhang@suse.com

9, (14:29 2013-01-14)
Ian C ack my patch.

17:04 2013-01-06
virtualization, xen, arm
1, i should prepare the following things before i involved into the xen arm port to Allwinner A20.
1), finish obs build for A10 device in order to fimiliar with build service.
2), try openocd on A10. someone have tried it.
http://linux-sunxi.org/JTAG

17:10 2013-01-06
JTAG
1, http://www.scribd.com/doc/97198556/Using-OpenOCD-JTAG-in-Android-Kernel-Debugging
The Joint Test Action Group(JTAG) is the name associated with the IEEE 1149.1 standard entiled Standard Test Access Port and Boundary Scan Architecture.
2, a article write about the openocd and cortex-a8.
http://arttools.blogspot.com/2009/09/debugging-on-cortex-a8-system.html

17:34 2013-01-06
arm
Bamv

10:18 2013-01-07
GTD
0, 10:10-11:34 12:50-15:44 17:16-18:17

1, today
1), 10:18-10:55 personal stuff.
2), 10:56-11:34 12:50-15:44 17:16-18:17 libxl blkstats: write the code for libxl qmp. see"11:31 2013-01-07"
3), 15:44-17:16 personal stuff.

11:31 2013-01-07
virtualization, libvirt, xenlight, add libxl api, cont3, domainBlockStats, cont3, qemu, QMP, add qmp in libxl
1, blockstats
1), qemu monitor commands
"info blockstats". could not specify the device. the driver should exact its self. ref: qemuMonitorTextGetBlockStatsInfo or qemuMonitorJSONGetBlockStatsInfo from "src/qemu/qemu_monitor.c"
2), "virsh domblkstat domid vda" will search the "virtio-disk0" in qemu monitor command result.
3), i need add a idl struct in libxl: libxl_block_stats.

17:33 2013-01-07
company, colleague, Chao wei, farewell letter, my leaving
Hi team,

I am sorry to see by how much surprise my decision catch you. I think we have developed a very relationship in the last years and I am thankful for the trust we have in each other by some events and activities whatever in QA team or accross team.

It is important to me that let you understand that I am not leaving because of any reason of the recent past but because I have set for myself a career path and would like to focus on QA management or process stuffs and now is a good time for me to go after that opportunity. Unfortunately, I did not feel that I could reach that goal at Novell and with Ralf and Harald's some offers that would satisfy me and keep me happy.

About the new site leader, I quoted a section from Ralf's mail for your reference.
"In terms of future solution in terms of site manager please let the team know that Ralf is thinking about it and has not yet made a decision and that people who are interested in taking on this additional role should contact Ralf directly via e-mail."

For the Chinese new year show, I will not be available. Please Sunny and Yifan to work with Gracie on preparation.I hope we can perform it well very. I will attend the rehearsing until my last day.

My last woking day will be this Friday(11st, Jan). If you have any questions about site stuffs, you can come to me directly or Claudia and Ralf by mail&IM. For QA part, you can talk to SunYan or Harald via mail&phone&IM.

Best Regards,
Charles

17:53 2013-01-07
arm, Allwinner A10, storage
突然想用A10搭个存储的环境，保存本地数据用。看看自己整合系统的能力如何。

17:00 2013-01-08
GTD
0, -17:49
1, today
1), reply to upstream. see"14:57 2013-01-06"4.

15:31 2013-01-09
software, skill, SCM, git send patch howto
1, configure the smtp and git user.
if not, set this in the git send-patch. e.g. i do not add the password in this configuration file, so, i need to input the password during git send-email
[sendemail]
        smtpuser = bjzhang
        smtpserver = mail.novell.com
        smtpserverport = 25
[user]
        name = Bamvor Jian Zhang
        email = bjzhang@suse.com

2, generate the patch file:
git format-patch --cover-letter --signoff -n 2
git format-patch --cover-letter --signoff --subject-prefix="PATCH V2" f5f80cec9e43442d12a445db14e6c01c026d946a
"-n number" could be used while generate the first number of patch.
"--subject-prefix" is useless for the first time.

3, test and send the email
git send-email --no-chain-reply-to --annotate --to xxx@xxx.xxx  --cc xxx@xxx.xxx -cc xxx@xxx.xxx 000*.patch
1), use "--dry-run" for test.
2), usually, "--to" send to list. "--cc" send to the people who may be interested in.  The --cc option must be repeated for each user you want on the cc list.

4, notes: usually, there is guide line in upstream about this. for me, i reference the http://libvirt.org/hacking.html for libvirt patch.

15:59 2013-01-09
GTD
1, today
1), 30' write doc for git send-email. see"15:31 2013-01-09"
2), 16:16- reply to upstream. see"14:57 2013-01-06"7.

9:29 2013-1-11
company, virtualization, suse, xen, regular meeting: US / China Virtualization Sync, meeting
bo yang
1, feature about macvtype. seems ok.

14:47 2013-01-11
GTD
0, 9:00-9:40 14:48-19:50

1, today
1), 9:00-9:40 US/China Sync meeing. see"9:29 2013-1-11"
2), 14:50-15:19 work report. see"14:50 2013-01-11"
3), 15:20-17:47 test the libxl qmp. see"16:17 2013-01-11"

14:50 2013-01-11
work report - week 52, 01, 02
1, [devel-server] work report - week 52, 01, 02
1), working on libxl xen4.2 support with Jim.
read and discuss with Jim about this. it is a good for me to know deeply how the event handling mechanism works in xenlight. and I also write a patch for it, although i found that it only fix some of the race conditions. i heard that Jim write a patch and it works. I will get and test the Jim lastest patch next week.
2), send a patch to xen upstream for fixing a wrong path. Ian Campbell said it is ok for him except the missing sign off string. so, re-send it...

16:17 2013-01-11
virtualization, libvirt, xenlight, add libxl api, cont3, domainBlockStats, cont3, qemu, QMP, add qmp in libxl, cont1
1, study json
1), study with json c
git://github.com/json-c/json-c.git
2), ref: 四种json c parser的兼容性比较 
http://blog.csdn.net/linux_lyb/article/details/3451224

14:13 2013-01-14
GTD
0, 10:30-18:08

1, today
1), 14:13-14:41 email.
2), 14:42-15:36 mailing list. xen. see"14:49 2013-01-14". libvirt.

14:14 2013-01-14
company, CSM(Cloud and Systems Management Department); colleague, virtual team, Virtual Cloud team, Dirk Mueller
1, "Mihnea Istinie <mistinie@suse.com>"_email_"[devel] Dirk Mueller - new member of  the CSM department"_20130111
Hi,

Please join me in welcoming Dirk Mueller as a new member of the Cloud and Systems Management Department.

Dirk has an excellent track of record as a senior engineer, and we are looking forward to have him on board to
strengthen the Virtual Cloud Team. His experience with complex projects and his ability to understand and solve 
intricate challenges are a major gain for the team.

Dirk's new responsibilities will be in the area of Openstack, Crowbar and our new Cloud Products

Organizationally Dirk will belong to the Systems Management Team in NUE and report to Duncan Mac-Vicar Prett. 
The effective date for the change will be Tuesday, January 15th.

Dirk, welcome, and all the best for your new position!

Mihnea Istinie
2, "Michael Hager <mike@suse.de>"
Hi Dirk, 

I want to thank you for the impressive work you did for maintenance. We have 
improved huge since you joined. Thanks!

And my very best wishes for your new role!


And as you played the major role, a short 
comment how we go on for now: 

ECOs: please direct them to Marcus Meissner

Maintenance Issues: as usual, use maint-coord@suse.de,
our second Maintenance PrjMgr: Leonardo Chiquitto will 
follow up.

For everything else, please contact me

Best
Mike

-- 
Michael Hager
Director L3/Maintenance

SUSE LINUX Products GmbH
Maxfeldstr. 5, D-90409 Nürnberg
GF:  Jeff Hawn, Jennifer Guild, Felix Imendörffer, HRB 16746 (AG Nürnberg) 

14:23 2013-01-14
community, xen, comminuty management, how to add a project to xen hosted project
1, "Lars Kurth <lars.kurth@xen.org>"_"[XenARM] [Community Review] Mirage Incubation Project Proposal"_20130112
Hi everybody,

this e-mail is to let you know that the OpenMirage project is seeking to 
become a
Xen.org hosted project.

The prospective project lead of the Mirage Project - Anil Madhavapeddy - 
has requested
a Review of the Mirage Project to become an Xen.org Incubation project. 
In line with
Xen Project Governance (see 
http://www.xen.org/projects/governance.html), in particular
sections

- "Forming a Project" at
    http://www.xen.org/projects/governance.html#project.forming

- "Project Proposal" at
    http://www.xen.org/projects/governance.html#project.proposal

- "Requesting Reviews, Reviews and Voting" at
    http://www.xen.org/projects/governance.html#project.requests

This is an informal community review, which will be followed by a formal 
vote.

The Proposal and Proposal Meta Information
==========================================

- Proposal Location at:
   http://wiki.xen.org/wiki/Mirage_Incubation_Project_Proposal

- Project Lead: Anil Madhavapeddy
- Project Sponsor:      Tim Deegan
- Project Mentor:       Lars Kurth

- Deadline:             review open until 24:00, 27th of Jan, 2013 (GMT)

Following the Community Review, there may be an update to the proposal if
needed. Which is then followed by a formal vote by eligible community 
members.

Why and How to Provide Feedback
===============================
- Anybody in the Community can provide feedback

- Preferably, feedback should be provided by annotating the in-lined 
copy of
   the document using the instructions in the wiki. In other word insert

   "{{comment|~~~~}} your comment."

   into the document, at a suitable location in the document.

- Alternatively you can provide feedback by replying to this e-mail

Best Regards
Lars

2, Mirage: a OS on xen hypervisor(like a OS on xen hardware).
The cloud has so far mostly been used to consolidate existing operating systems and manage them more conveniently. The interface between guest kernels, applications and VMs are all managed very differently, leading to serious inefficiencies, unreliability and insecurity.

Our Mirage OS revisits the library OS concept (built as Nemesis in the Cambridge Computer Lab in the late ’90s), and finds it a practical approach to improve this situation. Applications are written in a high-level functional programming language (OCaml) and compiled directly into microkernels that run on the Xen hypervisor. These microkernels can be treated as stand-alone appliances which use the Xen hypervisor interfaces directly.

Treating the hypervisor as a stable hardware platform means we can focus on high-performance protocol implementations without worrying about having to support the thousands of device drivers found in a traditional OS. Mirage includes clean-slate functional implementations of protocols ranging from TCP/IP, DNS, SSH, Openflow (switch/controller), HTTP, XMPP and Xen inter-VM transports. Some of the new applications we are building using Mirage include the next-generation Xen Cloud Platform (a widely deployed open-source Xen distribution), dubbed Project Windsor.

An example of a current Mirage appliance can be seen at http://openmirage.org, which is a self-hosted site deployed on the public cloud (in this case, on Amazon EC2). With some further work, it should also be possible to ‘encapsulate’ an existing piece of software using Mirage. One example might be to use Mirage to form an appliance from an existing Content Management System (e.g Drupal or Joomla). Such systems typically need several components and expect to be installed on a server. Mirage could be used to encapsulate a CMS, retaining only the components and bindings required by the CMS and removing the need for the rest of the Operating System. Such an appliance could be auto-configured and deployed directly to the public cloud (e.g. Rackspace or Amazon EC2). 

14:49 2013-01-14
mailing list, xen, PVH, initial post; about PVH debug
1, "Mukesh Rathor"_email_"[Xen-devel] [RFC PATCH 0/15]: PVH xen: Patches for PVH guests"_20130111
Hi All,

I'm excited (and a bit nervous) to finally submit xen PVH patches for
your input. This is Phase I.  Kindly ignore the 'noinline' for now, it
helps me debug. Of course, in the final patches that won't be there.

Phase I:
   - Establish a baseline of something working. These patches allow for 
     dom0 to be booted in PVH mode, and after that guests to be started
     in PV, PVH, and HVM modes. I also tested booting dom0 in PV mode, and
     starting PV, PVH, and HVM guests.

     There are few fixme's that I thought we could punt to Phase II. 

     Also, the disk must be specified as phy: in vm.cfg file:
         > losetup /dev/loop1 guest.img
         > vm.cfg file: disk = ['phy:/dev/loop1,xvda,w']

     I've not tested anything else.

Phase II:
   - Shutdown cleanup. I need to look at shutdown path during dom0 reboot.
   - arch_get_info_guest() and other fixmes.
   - Change xl to support other modes other than "phy:".

Phase III:
   - Migration, shadow code. I've skipped shadow code for now.

Thanks for all the help,
Mukesh
2, about PVH dom0 boot stack overflow
1), "Keir Fraser"_email_"Re: [Xen-devel] PVH update...."
On 10/01/2013 02:20, "Mukesh Rathor" <mukesh.rathor@xxxxxxxxxx> wrote:

> On Tue, 8 Jan 2013 18:50:30 -0800
> Mukesh Rathor <mukesh.rathor@xxxxxxxxxx> wrote:
> 
> Strange. So the latest is, things are OK with debug=n. With debug=y,
> I get DOUBLE FAULT at:
> 
> ffff82c4802d4710: construct_dom0+d               subq $0x2488, %rsp
> 
> where rsp == ffff82c4802efe20 is there, but (rsp - 0x2488), ie,
> 0xffff82c4802ed998 is not there. But, the subtract instruction
> should not cause an exception like that IMO.  ss is 0, but that
> should be OK. Hmm... I am at a loss on this one!

This one's not rocket science, Mukesh. The hypervisor stack is 8kB, and
construct_dom0() is trying to allocate a stack frame bigger than 8kB. Debug
builds enforce the 8kB limit with guard pages. You will actually be crashing
on the first stack writing instruction after the subq, but double fault is
imprecise (in fact reported cs:eip is undefined for a double fault).

You're allocating a ridiculously big local variable on construct_dom0's
stack. So just don't do that.

 -- Keir
2), 我的理解
0x2488 is bigger than 0x2000(2x2^12=2^13=8kbytes). but the hypervisor stack size is 8kb. So, Mukesh avoid to allocate such array on the stack.

10:31 2013-01-16
GTD
0, 10:17-11:40 12:50-17:51

1, today
1), 10:17-10:31 10:36-11:40 personal stuff. 
2), 13:03-14:50 16:17-17:51 test Jim patch for libxl xen4.2 bug. see"10:36 2013-01-16".

10:36 2013-01-16
virtualization, libvirt, xen, xenlight, libxl, xen4.2 support, cont16, debug and test with Jim lastest patch, cont2
1, test Jim lastest patch on 15, Jan.
2, patch the patch
1), 不知道我上次说的deregister时指针问题Jim有没有改, 先假设不改, 一边编译一边看看.
2), patch after 26234:bc624b00d6d6 to 35a0556a7f76.
3,
1), libvirt libxl: 测试HVM和PV, 都是malloc出错.
2), xl fail too:
linux-work:/var/lib/xen/images_2/bjz_04_sles11_sp2 # xl create bjz_04_sles11_sp2.orig
Parsing config from bjz_04_sles11_sp2.orig
WARNING: ignoring "kernel" directive for HVM guest. Use "firmware_override" instead if you really want a non-default firmware
WARNING: ignoring device_model directive.
WARNING: Use "device_model_override" instead if you really want a non-default device_model
libxl: error: libxl.c:3657:libxl_set_memory_target: new target 0 for dom0 is below the minimum threshold

libxl: error: libxl.c:3657:libxl_set_memory_target: new target 0 for dom0 is below the minimum threshold

libxl: error: libxl.c:3657:libxl_set_memory_target: new target 0 for dom0 is below the minimum threshold

failed to free memory for the domain
linux-work:/var/lib/xen/images_2/bjz_04_sles11_sp2 # cd ../sles11_sp2_pv
linux-work:/var/lib/xen/images_2/sles11_sp2_pv # ls
disk0.raw      sles11_sp2_pv.xml   sles11_sp2_pv.xml.bak.chunyan
sles11_sp2_pv  sles11_sp2_pv.xml~
linux-work:/var/lib/xen/images_2/sles11_sp2_pv # xl create sles11_sp2_pv
Parsing config from sles11_sp2_pv
libxl: error: libxl.c:3657:libxl_set_memory_target: new target 0 for dom0 is below the minimum threshold

libxl: error: libxl.c:3657:libxl_set_memory_target: new target 0 for dom0 is below the minimum threshold

libxl: error: libxl.c:3657:libxl_set_memory_target: new target 0 for dom0 is below the minimum threshold

failed to free memory for the domain

15:06 2013-01-16
opensuse, factroy, 12.3, roadmap, installation, DVD
1, opensuse portal factory
http://en.opensuse.org/Portal:Factory
2, opensuse 12.3 factory milestone 2 download:
http://software.opensuse.org/developer/en
3, openSUSE:Factory_installation 
http://en.opensuse.org/openSUSE:Factory_installation
4, openSUSE:Roadmap
http://en.opensuse.org/openSUSE:Roadmap

11:37 2013-1-17
hi

yestoday, i test your patch with upstream libvirt and xen. but i got no enough memory 

14:41 2013-01-17
GTD
0, 14:40-18:13

1, today
1), 14:42-16:00 17:30-18:13 test Jim patch for libxl xen4.2 bug. see"14:42 2013-01-17"
2), 25' mailing list xen. see"15:05 2013-01-17"
3), 90' 排练节目. 

14:42 2013-01-17
virtualization, libvirt, xen, xenlight, libxl, xen4.2 support, cont16, debug and test with Jim lastest patch, cont3
1, Jim_email_"[libvirt] RFC: libxl race fixes"_20130116
I've been investigating some races in the libxl driver and would like to
get comments on some potential solutions.

The first race is in the fd/timeout event handling code, which maps
libxl's osevent interface to libvirt's event loop interface.  This
mapping opens the possibility for libvirt's event loop to invoke
event callbacks after libxl has already deregistered the event,
potentially accessing an event object that has already been freed.

One solution to this race I've found successful is reference counting the
objects associated with the events.  When libxl registers an event, an
object encapsulating the event is created and it's reference count is set
to 1.  When the event is injected into libvirt's event loop, another
reference is taken on the object.  When libxl deregisters the event, it's
reference count is decremented.  Once the event is removed from libvirt's
event loop, the final reference is decremented and the object is disposed.
This approach ensures the object is not disposed until it is removed
from libvirt's event loop *and* libxl had explicitly deregistered the event.
The notion of an event being 'disabled' found in libvirt's event loop impl
also had to be added to the libxl event object, to ensure the driver doesn't
call into libxl for a previously deregistered event.

The second race is between destroying a vm (i.e., calling
privateDataFreeFunc, which frees the libxl ctx) and deregistration/cleanup
of all events that have been registered by libxl.

One solution for this race is to convert libxlDomainObjPrivate to a
virObject and increment its reference for each fd and timeout registration.
Only when all fds and timeouts are deregistered and destroyed will the
libxlDomainObjPrivate be destroyed.  One downside to this approach is that
an API to "cleanup" the libxl ctx is needed.  Without such an API, some
fds are not deregistered until calling libxl_ctx_free.  But since the fd
events have references on the libxlDomainObjPrivate, libxl_ctx_free is
never called.  (BTW I have a patch adding libxl_ctx_quiesce() to libxl,
which upstream xen folks seem receptive to, including backporting to
Xen 4.2 branch, but I don't think this is ideal.)

An alternate solution that can be used to address both of these races
is to maintain a list of the fd/timeout registrations in the
libxlDomainObjPrivate object, and take a more brute force approach to
managing the registrations

Other solutions that I might be overlooking are certainly appreciated :).

Regards,
Jim

2, remove upstream patch and test again. see whether the no memory error encounter again.
1), install the 10.1 version in my local zypper cache. it does not include xen upstream patch and jim patch.
可能是因为我没有换xen hypervisor造成昨天的错误.
10.1 xl create test pass for both pv and hvm.
11.1 xl create test pass for both pv and hvm.
notes: 10.1 without patch_bc624b00d6d6_35a0556a7f76 and Jim's patch. while 11.1 include it. which mean the latter one is the upstream code(libvirt and xen) with Jim patch.

3, 11.1 virsh create fail: libvirtd crash.
1), libvirt crash log
Program received signal SIGSEGV, Segmentation fault.
[Switching to Thread 0x7f01a7427700 (LWP 16255)]    
__pthread_mutex_lock (mutex=0x2cafe0044) at pthread_mutex_lock.c:50
50        unsigned int type = PTHREAD_MUTEX_TYPE (mutex);          
(gdb) where 
#0  __pthread_mutex_lock (mutex=0x2cafe0044) at pthread_mutex_lock.c:50
#1  0x00007f01a0d0144f in libxlTimeoutModifyEventHook (priv=<optimized out>,
    hndp=0x7f0198001b90, abs_t=...) at libxl/libxl_driver.c:370
#2  0x00007f01a0ad02f0 in time_deregister (ev=<optimized out>,
    gc=<optimized out>) at libxl_event.c:294
#3  libxl__ev_time_deregister (gc=0x7f01a7426420, ev=0x70f860)
    at libxl_event.c:375
#4  0x00007f01a0ad0cec in libxl__ev_devstate_cancel (ds=<optimized out>,
    gc=<optimized out>) at libxl_internal.h:1006
#5  devstate_watch_callback (egc=0x7f01a7426420, watch=0x70f848,
    watch_path=<optimized out>, event_path=<optimized out>)
    at libxl_event.c:651
#6  0x00007f01a0acf9cb in watchfd_callback (egc=0x7f01a7426420,
    ev=<optimized out>, fd=<optimized out>, events=<optimized out>,
    revents=<optimized out>) at libxl_event.c:504
#7  0x00007f01a0aceffd in afterpoll_internal (egc=0x7f01a7426420,
    poller=0x71c690, nfds=2, fds=0x7f0198000de0, now=...) at libxl_event.c:995
#8  0x00007f01a0acfbc7 in eventloop_iteration (egc=0x7f01a7426420,
    poller=0x71c690) at libxl_event.c:1440
#9  0x00007f01a0ad00ea in libxl__ao_inprogress (ao=0x70d190,
    file=<optimized out>, line=<optimized out>, func=<optimized out>)
    at libxl_event.c:1685
#10 0x00007f01a0ab62f7 in do_domain_create (ctx=<optimized out>,
    d_config=<optimized out>, domid=0x7f01a742662c, restore_fd=1,
    ao_how=<optimized out>, aop_console_how=0x0) at libxl_create.c:1209
#11 0x00007f01a0ab66a4 in libxl_domain_create_new (ctx=0x2cafe0044,
    d_config=0x7f0198001b90, domid=0x0, ao_how=<optimized out>,
    aop_console_how=<optimized out>) at libxl_create.c:1230
2), mutex is invalid:
(gdb) p *mutex
Cannot access memory at address 0x2cafe0044
3), 但是xenlight里面的代码对应不上. 装的有问题???
重新build一下libvirt. 
Program received signal SIGSEGV, Segmentation fault.
[Switching to Thread 0x7fe6500b6700 (LWP 15508)]    
__pthread_mutex_lock (mutex=0x2cafe0044) at pthread_mutex_lock.c:50
50        unsigned int type = PTHREAD_MUTEX_TYPE (mutex);          
(gdb) where                                                        
#0  __pthread_mutex_lock (mutex=0x2cafe0044) at pthread_mutex_lock.c:50
#1  0x00007fe64999044f in libxlTimeoutModifyEventHook (priv=<optimized out>,
    hndp=0x7fe640003ca0, abs_t=...) at libxl/libxl_driver.c:370
#2  0x00007fe64975f2f0 in time_deregister (ev=<optimized out>,
    gc=<optimized out>) at libxl_event.c:294
#3  libxl__ev_time_deregister (gc=0x7fe6500b5420, ev=0x7fe640002c70)
    at libxl_event.c:375
#4  0x00007fe64975fcec in libxl__ev_devstate_cancel (ds=<optimized out>,
    gc=<optimized out>) at libxl_internal.h:1006
#5  devstate_watch_callback (egc=0x7fe6500b5420, watch=0x7fe640002c58,
    watch_path=<optimized out>, event_path=<optimized out>)
    at libxl_event.c:651
#6  0x00007fe64975e9cb in watchfd_callback (egc=0x7fe6500b5420,
    ev=<optimized out>, fd=<optimized out>, events=<optimized out>,
    revents=<optimized out>) at libxl_event.c:504
#7  0x00007fe64975dffd in afterpoll_internal (egc=0x7fe6500b5420,
    poller=0x7fe640001030, nfds=2, fds=0x7fe640004250, now=...)
    at libxl_event.c:995
#8  0x00007fe64975ebc7 in eventloop_iteration (egc=0x7fe6500b5420,
    poller=0x7fe640001030) at libxl_event.c:1440
#9  0x00007fe64975f0ea in libxl__ao_inprogress (ao=0x7fe6400012a0,
    file=<optimized out>, line=<optimized out>, func=<optimized out>)
    at libxl_event.c:1685
#10 0x00007fe6497452f7 in do_domain_create (ctx=<optimized out>,
    d_config=<optimized out>, domid=0x7fe6500b562c, restore_fd=1,
    ao_how=<optimized out>, aop_console_how=0x0) at libxl_create.c:1209
#11 0x00007fe6497456a4 in libxl_domain_create_new (ctx=0x2cafe0044,
    d_config=0x7fe640003ca0, domid=0x0, ao_how=<optimized out>,
    aop_console_how=<optimized out>) at libxl_create.c:1230
#12 0x00007fe64998f0d1 in libxlVmStart (driver=0x6ea4d0, vm=0x717f20,
    start_paused=false, restore_fd=-1) at libxl/libxl_driver.c:936
搞了半天是代码没有切过来. 我编译的代码并不是Jim最新的patch. 
晚上细看. 

15:05 2013-01-17
mailing list, virtualization, xen, enable xl command on arm; cpufreq on AMD cpu
1, enable xl(create) on arm.
"Stefano Stabellini"_email_"[Xen-devel] [PATCH 0/4] xen/arm: compile and run xl"_20130114
http://lists.xen.org/archives/html/xen-devel/2013-01/msg00869.html

2, about the cpufreq on AMD cpu
1), "Matt Wilson"_email_"Re: [Xen-devel] kernel 3.7+ cpufreq regression on AMD system running as dom0"_20130115
The correct values should be returned already via rdmsr if
"cpureq=dom0-kernel" is specified on the Xen command line. Looking at
the LP report, it doesn't seem that this option was used.

Likely you will also need to use "dom0_vcpu_pin=1" if you want dom0 to
be the cpufreq controller on AMD.

3, xen meeting minutes
Xen Maintainer, Committer and Developer Meeting/January 2013 Minutes
http://wiki.xen.org/wiki/Xen_Maintainer,_Committer_and_Developer_Meeting/January_2013_Minutes

4, GSOC 2013
Xen Development Projects
This page lists various Xen related development projects that can be picked up by anyone! If you're interesting in hacking Xen this is the place to start! Ready for the challenge? 
http://wiki.xen.org/wiki/Xen_Development_Projects

10:47 2013-01-18
GTD
0, 10:40-11:54 13:45-18:45

1, today
1), 10:51-11:50 13:45- test Jim patch for libxl xen4.2 bug. see"10:51 2013-01-18".

10:51 2013-01-18
virtualization, libvirt, xen, xenlight, libxl, xen4.2 support, cont16, debug and test with Jim lastest patch, cont4
1, plan
1), 不更新libvirt和xen的upstream, 看看有无问题. 如果有问题就是upstream update问题, 暂时忽略.
2), 昨天的问题应该是我阅读的代码没有加入Ian和Jim的第一版patch. 加入后分析.
2, 和Chunyan讨论这个问题. 其实chunyan说的没错阿, 为什么会多一次传输呢? 应该是有原因的, 有空问问jim.
3, 阅读Jim的patch
1), reference count是不是让libxl自己维护比较好, 为什么libvirt要帮忙做这个事情呢.
4, talk with Jim:
Today I've been testing on libvirt master
The tip of my xen tree is commit e7c5674950f0496523dbb5cc46e9c53d199c79ee
commit e7c5674950f0496523dbb5cc46e9c53d199c79ee
Author: Dongxiao Xu <dongxiao.xu@intel.com>
Date:   Wed Dec 12 10:47:18 2012 +0100
5, so, try to test it on this version.
the changeset of Jim is 26275:74d4a6cc5392.

8:55 2013-1-20
老杳吧:
1, 在 2012年7月，英特尔斥资给ASML Holdings公司33亿美元，促使其开发450毫米的硅片和极紫外光刻.英特尔在今年的CES大会上正式面向智能移动设备推出了名为“Bay Trail”和“Clover Trail+”的全新处理器产品。
2, 【搜狐数码消息】2013年1月19日消息，分析人 士预测，苹果的第七代智能手机将会迎来重大升级， 相比iPhone 5在硬件配置上有较大的进步。根据杰富 瑞集团的Peter Misek分析，下一代iPhone将会使用“ 超高清”分辨率的显示屏，这就意味着这款设备的分辨 率将超过1080p（iPhone 5的屏幕分辨率为1136 x 64 0，被称为“次高清”）。 除此之外，新的显示屏会采用IGZO（铟镓锌氧化 物）技术，可能在像素数目上有所增加，因此可以被 称为“Retina+”。相比传统的LCD屏幕使用的非晶硅屏 幕技术，IGZO技术可以使得更小的像素点显示出更高 的分辨率效果。

11:46 2013-1-21
lunch and learning, libreoffce, Michael Meeks 
0, 
1), contacts: Michael Meeks <michael.meeks@suse.com>
mmeeks,#libreoffice-dev, irc.freenode.net
2), who?  
Michael is the architect of SUSE LibreOffice team, director of board of the Document Foundation and a core developer of OpenOffice.org/LibreOffice for over 10 years. He is giving a presentation on the latest development of LibreOffice this noon.
1, suse contribute lots of code.
2, windows usrs download.
3, android remote control.
4, librelogo.
5, gerrit for code review.
https://gerrit.libreoffice.org
http://code.google.com/p/gerrit/
Objective
Gerrit is a web based code review system, facilitating online code reviews for projects using the Git version control system.

Gerrit makes reviews easier by showing changes in a side-by-side display, and allowing inline comments to be added by any reviewer.

Gerrit simplifies Git based project maintainership by permitting any authorized user to submit changes to the master Git repository, rather than requiring all approved changes to be merged in by hand by the project maintainer. This functionality enables a more centralized usage of Git.

16:06 2013-01-21
GTD
0, -18:05

1, today
1), lunch and learning, libreoffice. see"11:46 2013-1-21"
2), 16:35 for libxl xen4.2 bug, figure out why virsh got event after libxl think its done. see"16:36 2013-01-21".

16:36 2013-01-21
virtualization, libvirt, xen, xenlight, libxl, xen4.2 support, cont17, debug virsh fail
1, figure out why virsh got event after libxl think its done. 
2, read all the mail for this bug.

13:31 2013-01-22
virtualization, libvirt, xen, xenlight, libxl, xen4.2 support, cont18, Jim lastest comment
1, Jim_email_20130122
Ian Campbell wrote:
> On Mon, 2012-12-10 at 16:56 +0000, Ian Jackson wrote:
>   
>> Ian Jackson writes ("Re: [PATCH] fix race condition between libvirtd event handling and libxl fd deregister"):
>>     
>>> I'm not surprised that the original patch makes Bamvor's symptoms go
>>> away.  Bamvor had one of the possible races (the fd-related one) but
>>> not the other.
>>>       
>> Here (followups to this message, shortly) is v3 of my two-patch series
>> which after conversation with Ian C I think fully fixes the race, and
>> which I have tested now.
>>     
>
> Is this version now tested and ready to be applied?
>   

I have done quite a bit of successful testing with this version and a
libvirt patch series [1] that fixes several races and bugs in the libxl
driver.  So from my perspective, ACK to these patches, assuming my last
comment on patch 2 [2] is addressed.

[1] https://www.redhat.com/archives/libvir-list/2013-January/msg01463.html
[2] http://lists.xen.org/archives/html/xen-devel/2012-12/msg00937.html

Thanks for all the help with resolving these races!

16:19 2013-01-22
how to build rpm package in local directory
1, Lance Wang(by study how quilt works)
--define="_sourcedir $PWD" --define="_specdir $PWD" --define="_builddir $PWD"
e.g.
rpmbuild --define="_sourcedir $PWD" --define="_specdir $PWD" -bb libvirt.spec
bamvor: 这里用--define的方式定义rpm build使用的宏.
2, Dongmao Zhang
http://147.2.207.240/~dmzhang/tips.html
localbuild的脚本

rpmbuild要求spec文件，src文件在/usr/src下，比较麻烦，下面的脚本做一个软链接，在任何源文件下都可以做rpmbuild了

用法:

localbuild -bb file.spec

代码:

#!/bin/bash
#check local build system
check_build_fs()
{
    #exclude SOURCES
    for dir in ~/rpmbuild/{BUILD,RPMS,SPECS,SRPMS}
    do
        if [[ ! -d $dir ]]
        then
            echo "$dir not exsit"
            echo "mkdir -p $dir"
            mkdir -p $dir
        fi
    done
}

check_rpm_macro()
{
    echo '%_topdir %(echo $HOME)/rpmbuild' > ~/.rpmmacros
}

mount_current_diretory()
{
    src=~/rpmbuild/SOURCES
    if test -d $src -a -h $src
    then
        echo "delete previous link"
        rm $src
    elif test -f $src
    then
        echo "delete previous file"
        rm $src
    elif test -d $src
    then
        echo "$src is not a symlink,quit.."
        exit
    fi

    echo "create link $src"
    ln -s `pwd` $src
}

check_build_fs
check_rpm_macro
mount_current_diretory
args=$*
rpmbuild $args
1), bamvor亮点
(1), 在~/.rpmmacros定义macro, 供rpmbuild使用.
    echo '%_topdir %(echo $HOME)/rpmbuild' > ~/.rpmmacros
(2), 用软链接link包到/usr/src目录.
    ln -s `pwd` $src

11:28 2013-01-23
test with Jim version patch, but apply to xen-unstable. libvirt upstream
1, pv
Program received signal SIGSEGV, Segmentation fault.
[Switching to Thread 0x7f09a5980700 (LWP 9173)]     
__strlen_sse2 () at ../sysdeps/x86_64/strlen.S:31   
31              pcmpeqb (%rdi), %xmm2               
(gdb) where
#0  __strlen_sse2 () at ../sysdeps/x86_64/strlen.S:31
#1  0x00007f09a99bf516 in *__GI___strdup (s=0x0) at strdup.c:42
#2  0x00000000004ff869 in libxlMakeDomBuildInfo (d_config=<optimized out>,
    def=<optimized out>) at libxl/libxl_conf.c:496
#3  libxlBuildDomainConfig (driver=0x7e9fa0, def=0x895370,
    d_config=0x7f09a597f680) at libxl/libxl_conf.c:979
#4  0x00000000004f6352 in libxlVmStart (driver=0x7e9fa0, vm=0x89b730,
    start_paused=false, restore_fd=-1) at libxl/libxl_driver.c:724
#5  0x00000000004f8365 in libxlDomainCreateWithFlags (dom=<optimized out>,
    flags=0) at libxl/libxl_driver.c:2786
#6  0x00007f09aeb0763f in virDomainCreate (domain=0x8a3300) at libvirt.c:8313
#7  0x00000000004474a0 in remoteDispatchDomainCreate (args=<optimized out>,
    rerr=<optimized out>, msg=<optimized out>, client=<optimized out>,
    server=<optimized out>) at remote_dispatch.h:1066
#8  remoteDispatchDomainCreateHelper (server=<optimized out>,
    client=<optimized out>, msg=<optimized out>, rerr=0x7f09a597fbc0,
    args=<optimized out>, ret=<optimized out>) at remote_dispatch.h:1044
#9  0x00007f09aeb571c3 in virNetServerProgramDispatchCall (
    msg=<optimized out>, client=<optimized out>, server=<optimized out>,
    prog=<optimized out>) at rpc/virnetserverprogram.c:431
#10 virNetServerProgramDispatch (prog=0x7f099c001040, server=0x7d5d40,
    client=0x8a41b0, msg=0x8a44f0) at rpc/virnetserverprogram.c:304
#11 0x00007f09aeb5153e in virNetServerProcessMsg (srv=<optimized out>,
    client=0x8a41b0, prog=0x0, msg=0x8a44f0) at rpc/virnetserver.c:171
#12 0x00007f09aeb5208b in virNetServerHandleJob (jobOpaque=<optimized out>,
    opaque=0x7d5d40) at rpc/virnetserver.c:192
#13 0x00007f09aea76d14 in virThreadPoolWorker (opaque=<optimized out>)
    at util/threadpool.c:144
#14 0x00007f09aea765ba in virThreadHelper (data=<optimized out>)
    at util/threads-pthread.c:161
#15 0x00007f09aa0c27b6 in start_thread (arg=<optimized out>)
    at pthread_create.c:301
#16 0x00007f09a9a179cd in clone ()
    at ../sysdeps/unix/sysv/linux/x86_64/clone.S:112
#17 0x0000000000000000 in ?? ()

2, hvm
Program received signal SIGABRT, Aborted.
[Switching to Thread 0x7fee736a6700 (LWP 9463)]
0x00007fee76e97b55 in *__GI_raise (sig=<optimized out>)
    at ../nptl/sysdeps/unix/sysv/linux/raise.c:64      
64        return INLINE_SYSCALL (tgkill, 3, pid, selftid, sig);
(gdb) where                                                    
#0  0x00007fee76e97b55 in *__GI_raise (sig=<optimized out>)
    at ../nptl/sysdeps/unix/sysv/linux/raise.c:64
#1  0x00007fee76e99131 in *__GI_abort () at abort.c:92
#2  0x00007fee76e90a10 in *__GI___assert_fail (
    assertion=0x7fee7bd25ea0 "mode != LIBXL_TIMER_MODE_DELAY_FOR_MISSED_TICKS && mode <= LIBXL_TIMER_MODE_ONE_MISSED_TICK_PENDING",
    file=0x7fee7bd2546a "libxl_dom.c", line=462,
    function=0x7fee7bd262b7 "timer_mode") at assert.c:81
#3  0x00007fee7bd0552d in libxl__build_hvm ()
   from /usr/lib64/libxenlight.so.2.0
#4  0x00007fee7bcfac8a in libxl__domain_build ()
   from /usr/lib64/libxenlight.so.2.0
#5  0x00007fee7bcfaf0a in domcreate_bootloader_done ()
   from /usr/lib64/libxenlight.so.2.0
#6  0x00007fee7bd18544 in bootloader_local_detached_cb ()
   from /usr/lib64/libxenlight.so.2.0
#7  0x00007fee7bcf0314 in local_device_detach_cb ()
   from /usr/lib64/libxenlight.so.2.0
#8  0x00007fee7bcf2225 in libxl__device_disk_local_initiate_detach ()
   from /usr/lib64/libxenlight.so.2.0
#9  0x00007fee7bd186f0 in bootloader_callback ()
   from /usr/lib64/libxenlight.so.2.0
#10 0x00007fee7bd19a79 in libxl__bootloader_run ()
   from /usr/lib64/libxenlight.so.2.0
#11 0x00007fee7bcfbd30 in do_domain_create ()
   from /usr/lib64/libxenlight.so.2.0
#12 0x00007fee7bcfbd74 in libxl_domain_create_new ()
   from /usr/lib64/libxenlight.so.2.0
#13 0x00000000004f6735 in libxlVmStart (driver=0x7eb600, vm=0x822a20,
    start_paused=false, restore_fd=-1) at libxl/libxl_driver.c:737
#14 0x00000000004f8365 in libxlDomainCreateWithFlags (dom=<optimized out>,
    flags=0) at libxl/libxl_driver.c:2786
#15 0x00007fee7c02c63f in virDomainCreate (domain=0x7fee68098350)
    at libvirt.c:8313
#16 0x00000000004474a0 in remoteDispatchDomainCreate (args=<optimized out>,
    rerr=<optimized out>, msg=<optimized out>, client=<optimized out>,
    server=<optimized out>) at remote_dispatch.h:1066
#17 remoteDispatchDomainCreateHelper (server=<optimized out>,
    client=<optimized out>, msg=<optimized out>, rerr=0x7fee736a5bc0,
    args=<optimized out>, ret=<optimized out>) at remote_dispatch.h:1044

12:50 2013-01-23
virtualization, libvirt, xen, xenlight, libxl, xen4.2 support, cont18, test with Jim instruction
1, Jim_email
Hey, sorry I missed you.  Right after I pinged you my daughter asked for
help with homework, so I was away for a while...

(08:33:36 PM) Bamvor: i saw your patch sent to upstrem yestoday.
(08:33:59 PM) Bamvor: and i test fail even if i roll back to your commit
version.
(08:34:24 PM) Bamvor: i mean the commit your give me for your test last
time.

I've been testing all of these patches today on both xen-unstable
(freshly updated today) and our Xen 4.2.1 package in IBS
Devel:Virt:SLE-11-SP3.  By "all of these patches" I mean Ian's 2 libxl
patches (with my one fix to patch #2) and my 6 patches recently posted
to the libvirt list.  The libvirt patches are based libvirt master
updated yesterday.

From my testing, all looks good.  I'm not seeing any of the
segfaults/asserts/aborts that we've seen in the past from all the race
and memory management bugs.  I've tried both pv and hvm guests.  With pv
guests, I've done save/restore in a loop for more than 200 iterations.

(08:35:06 PM) Bamvor: could u have rpm package for me, maybe i could
easily know what is going on.

I'll look at adding Ian J's patches to the xen package in D:V:SLE-11-SP3
tomorrow.  They might even get committed by then.  Did you see that I
ACKed those patches yesterday?  Ian C wants to get those committed.

For libvirt, I'd need to make a tarball of latest git since my patches
use the recently added virObjectLockable code.  But I think you can just
add my patches to an updated libvirt git checkout and build locally.

Hmm, come to think of it, I'll attach Ian's patches that I'm using for
4.2.1.  You can just add them to a branch of the D:V:SLE-11-SP3 xen
package and test with the resulting build.  I'll still add them to the
official SP3 xen package once they are committed upstream.

Thanks,
Jim
2, compile the xen-4.2.1 base on the patch jim give me.

12:54 2013-01-23
GTD
0, 11:10-11:40 12:50-18:14

1, today
1), 15:53- for libxl xen4.2 bug, figure out why virsh got event after libxl think its done. see"12:50 2013-01-23".
2), 17:07- write code for libxl qmp. see"17:15 2013-01-23"
3), Summary: 今天仅仅工作了两个小时. 我现在完全是通过把自己搞的状态不好, 然后"被动的"降低了工作效率. 

17:15 2013-01-23
(11:05 2013-01-24)
virtualization, libvirt, xenlight, add libxl api, cont3, domainBlockStats, cont3, qemu, QMP, add qmp in libxl, cont2
1, how to add a command to xl?
1), def_getopt: call getopt
2, block stats需要加device名称, 通过libxl_block_stats.devname传递.
3, finish coding(only alpha version). compile on linux-vm4
build.sh ./configure --enable-xenapi --prefix=/usr --exec_prefix=/usr --bindir=/usr/bin --sbindir=/usr/sbin --libdir=/usr/lib64 --datadir=/usr/share
4, compile pass but encounter error(it is what i expert):
linux-vm4:/var/lib/xen/images_2/bjz_04_sles11_sp2 # xl block-info 1 xvda
libxl: error: libxl_qmp.c:780:libxl__qmp_initialize: Connection error: No such file or directory
xvda  139765835149736 60       4290491  0        316823510656 6441104  6445104  140735538628000
5, (16:39 2013-01-28)
it is timeout at connect. the libxl__qmu_handler is 
(gdb) p *(libxl__qmp_handler *) 0x625990
$4 = {addr = {sun_family = 1,
    sun_path = "/var/run/xen/qmp-libxl-2", '\000' <repeats 83 times>},
  qmp_fd = 12, connected = false, timeout = 5, wait_for_id = 0,
  buffer = '\000' <repeats 4095 times>, yajl_ctx = 0x0, ctx = 0x625050,
  domid = 2, last_id_used = 0, callback_list = {stqh_first = 0x0,
    stqh_last = 0x626a30}}
but the sun_path "/var/run/xen/qmp-libxl-2" does not exist. i need to find out where it come from.

6, in xl create a hvm vm, libxl__qmp_initializations is not called. it is exist while pv create.
linux-vm4:/var/run/xen # file qmp-libxl-4
qmp-libxl-4: socket
1), some qmp value in qmp_next, still do not know the meaning in buffer.
(gdb) p *qmp
$2 = {addr = {sun_family = 1,
    sun_path = "/var/run/xen/qmp-libxl-5", '\000' <repeats 83 times>},
  qmp_fd = 12, connected = true, timeout = 5, wait_for_id = 2,
  buffer = "{\"return\": {}, \"id\": 1}\r\nu\": {\"micro\": 0, \"minor\": 3, \"m
ajor\": 1}, \"package\": \"\"}, \"capabilities\": []}}\r\n", '\000' <repeats 399
0 times>, yajl_ctx = 0x0, ctx = 0x625050, domid = 5, last_id_used = 2,
  callback_list = {stqh_first = 0x625930, stqh_last = 0x625950}}

(gdb) p *qmp
$5 = {addr = {sun_family = 1,
    sun_path = "/var/run/xen/qmp-libxl-5", '\000' <repeats 83 times>},
  qmp_fd = 12, connected = true, timeout = 5, wait_for_id = 2,
  buffer = "{\"return\": [{\"device\": \"ide1-cd0\", \"stats\": {\"flush_total_t
ime_ns\": 0, \"wr_highest_offset\": 0, \"wr_total_time_ns\": 0, \"wr_bytes\": 0,
 \"rd_total_time_ns\": 0, \"flush_operations\": 0, \"wr_operations\": 0, \""...,
 yajl_ctx = 0x0, ctx = 0x625050, domid = 5, last_id_used = 2, callback_list = {
    stqh_first = 0x625930, stqh_last = 0x625950}}
2), i could get qmp response in qmp->buffer in qmp_next.
3), the device name is not match. maybe there is a look-up table for device name translation?
ide1-cd0
floppy0
sd0
if i direct pass the name above, i could get the integer, but the number seems wrong.


10:29 2013-01-24
GTD
0, 10:20-13:00 13:53-18:21

1, today
1), 10:30 for libxl xen4.2 bug, figure out why virsh got event after libxl think its done. see"10:41 2013-01-24".
2), write code for libxl qmp. see"17:15 2013-01-23"

10:41 2013-01-24
virtualization, libvirt, xen, xenlight, libxl, xen4.2 support, cont19, test with Jim instruction
1, read mail about Ian Jackson and Jim. the patch in libxl has been acked.
2, 感觉搞不清到底这些patch都是怎么搞的, 试一试, 如果不行我还是接着写自己的qmp了.
3, test with xen4.2.1 and libvirt upstream. virsh start, destroy, shutdown successful.
4, talk with Jim, Jim explain to me why it is indeed a race:
novell/im/NM20130124_Jim_Fehlig__discuss_about_libxl_xen4.2_race_condition.txt

15:42 2013-01-24
virtualization, xen, pci passthrough
1, http://wiki.xen.org/wiki/Xen_PCI_Passthrough
Xen PCI Passthrough

PCI passthrough allows you to give control of physical devices to guests: that is, you can use PCI passthrough to assign a PCI device (NIC, disk controller, HBA, USB controller, firewire controller, soundcard, etc) to a virtual machine guest, giving it full and direct access to the PCI device.

This has several potential uses, including the following:

    One of the major overheads of virtual networking is the unavoidable overhead of copying; passing through a network card directly completely avoids this overhead.
    Passing through graphics cards to guests allows them full access to the 3D acceleration capabilities. This can be useful not only for desktops, but also to enable Virtual Desktops for high-end CAD users, for example.
    You can set up a Driver Domain, which can increase both security and reliability of your system. 
2, 
http://wiki.xen.org/wiki/Driver_Domain
Xen Driver Domain

A driver domain is unprivileged Xen domain that has been given responsibility for a particular piece of hardware. It runs a minimal kernel with only that hardware driver and the backend driver for that device class. Thus, if the hardware driver fails, the other domains (including Dom0) will survive and, when the driver domain is restarted, will be able to use the hardware again. 

Setup

Software requirements of the driver domain:

    The passthroughed hardware driver.
    The backend driver.
    The hotplug scripts. 

To start using the driver domain as block device backend:
# xm block-attach <Domain> file:/disks/disk1.img xvdc w <DriverDomain>

The xenstore entries looks like:

...
/local/domain/3/backend/vbd/4/51744=""
/local/domain/3/backend/vbd/4/51744/domain="OVM_EL5U3_X86_PVM_4GB"
/local/domain/3/backend/vbd/4/51744/frontend="/local/domain/4/device/vbd/51744"
/local/domain/3/backend/vbd/4/51744/uuid="1c955e9d-c6a8-dcee-dfb2-fcbe1e836479"
/local/domain/3/backend/vbd/4/51744/bootable="0"
/local/domain/3/backend/vbd/4/51744/dev="xvdc"
/local/domain/3/backend/vbd/4/51744/state="1"
/local/domain/3/backend/vbd/4/51744/params="/share/vm/disks/disk18.img"
/local/domain/3/backend/vbd/4/51744/mode="w"
/local/domain/3/backend/vbd/4/51744/online="1"
/local/domain/3/backend/vbd/4/51744/frontend-id="4"
/local/domain/3/backend/vbd/4/51744/type="file"
/local/domain/3/backend/vbd/4/51744/node="/dev/loop0"
/local/domain/3/backend/vbd/4/51744/physical-device="7:0"
/local/domain/3/backend/vbd/4/51744/hotplug-status="connected
...
/local/domain/4/device/vbd/51744=""
/local/domain/4/device/vbd/51744/virtual-device="51744"
/local/domain/4/device/vbd/51744/device-type="disk"
/local/domain/4/device/vbd/51744/protocol="x86_32-abi"
/local/domain/4/device/vbd/51744/backend-id="3"
/local/domain/4/device/vbd/51744/state="3"
/local/domain/4/device/vbd/51744/backend="/local/domain/3/backend/vbd/4/51744"
/local/domain/4/device/vbd/51744/ring-ref="836"
/local/domain/4/device/vbd/51744/event-channel="11"

16:25 2013-01-24
virtualization, cloud, redhat, Emerging Technologies
http://et.redhat.com/
An assortment of projects developing new open source technology related to virtualization and the cloud.
1, Virtualization Technologies: KVM, libvirt, virt-manager.
libguestfs
    libguestfs is a set of tools for accessing and modifying virtual machine (VM) disk images. You can use this for viewing and editing files inside guests, scripting changes to VMs, monitoring disk used/free statistics, P2V, V2V, performing partial backups, cloning VMs, and much else besides.
Spice
    The Spice project aims to provide a complete open source solution for interaction with virtualized desktop devices. The main project focus is to provide high-quality remote access for KVM hosted virtual machines. Seeking to help break down the barriers to virtualization adoption by overcoming traditional desktop virtualization challenges, emphasizing user experience.
Matahari
    Matahari provides an extensible QPid QMF agent framework, along with a set of schemas for managing physical or virtual hosts
oVirt
    A community project for virtualization infrastructure & management providing a small node through to a fully featured vitualization management platform

2, Cloud Technologies 
Deltacloud
    an API that abstracts the differences between clouds. Deltacloud protects your apps from cloud API changes and incompatibilities, so you can concentrate on managing cloud instances the way you want. 
Katello
    Katello helps take control of your software and your systems in an easy-to-use and scalable manner. Offering a modern web user interface and API, Katello can pull content from remote repositories into isolated environments, make subscriptions management easier and provide provisioning at scale.

3, Other Technologies
Augeas
    Augeas is a configuration editing tool. It parses configuration files in their native formats and transforms them into a tree. Configuration changes are made by manipulating this tree and saving it back into native config files.
FreeIPA
    FreeIPA is an integrated security information management solution combining Linux (Fedora), 389 (formerly known as Fedora Directory Server), MIT Kerberos, NTP, DNS. It consists of a web interface and command-line administration tools.

09:00 2013-01-25
company, virtualization, suse, xen, regular meeting: US / China Virtualization Sync, meeting
1, Lin Ma
jekin.
2. Chunayn 
1), test pci passthrough on virt-manager. seems that it is not support by virt-manager. email with charles.
2), discuss about xen passthrough on meeting.
3, Bamvor
1), Jim fix the dead lock on libvirt which he told me yestoday. check the mailing list.
4, Bo yang
1), 3 L3 bugs.
2), macvtype. close?
Jim: should test on sp3 instead of sp2 because qemu version is low in sp2.
3), seabios user issue? python issue.

09:52 2013-01-25
GTD
0, 9:00-9:40

1, today
1), 9:00-9:40 US/China Sync meeing. see"9:00 2013-1-25"

11:17 2013-01-28
GTD
0, 11:0-11:40 13:00-18:22

1, today
1), 30' reconsider my work and others.
2), 14:40-15:00 work report. see"14:40 2013-01-28"
3), 15:20-16:30 test Jim patch for libxl xen4.2 bug.
4), 1h write code for libxl qmp. see"17:15 2013-01-23"5.

14:40 2013-01-28
work report - week 03, 04
1, [devel-server] work report - week 03, 04
1), working on libxl xen4.2 support with Jim.
Jim release his lastest patch, i finally got successful in xen4.2.1 and libvirt upstream. will test it on xen-unstable with lastest patch Jim sent last Friday.
2), write code for block status qmp command in xenlight.

10:14 2013-01-29
GTD
0, 10:05-11:36 12:43-18:10

1, today
1), 10:15-10:20 daily.
2), 10:20-11:36 15:11-17:40 test Jim patch for libxl xen4.2 bug. see"10:24 2013-01-29"
3), Summary:
(1), 今天才发现xen也有git repo, 之前费了那么多功夫琢磨hg...
(2), 想起原来同事从rtos转到Linux的感觉, 就是觉得东西特别多. 我之前是否也是Linux
做的太少了, 或者是去年太荒废了.

10:24 2013-01-29
virtualization, libvirt, xen, xenlight, libxl, xen4.2 support, cont20, finally test
1, 找到Jim的最终版本patch, 然后测试, 今天必须有初步结果.
1), 看了看邮件, 没看到libvirt的patch里面用到了libxl_ctx_cleanup. 
2, read the patch committed by Jim.
1), generate the patch though: git format-patch e06420..702911.
ref: SPECIFYING REVISIONS and SPECIFYING RANGES in "git rev-parse --help".
2), libxl_ctx_cleanup is used by libxlDomainObjPrivateFree in Jim patch 14, Jan.
check the same function in patch in 21, Jan.
3, read libxl_ctx_alloc and libxl_ctx_free. know pthread_atfork, there are lots of thing need to study.
4, virObjectLockable seems new in Jim patch. it will init a virMutex while the object is created and destory the lock while reference count is zero.
5, (13:14 2013-01-30)
为了避免有问题, 直接取最新的代码然后build.
fix build error, ref "10:12 2012-12-12". 为什么之前把patch 99999, 99998注释了? 99999正是要处理没有编译domu-xenstore的问题.
不确定tmp-initscript-modprobe.patch有没有用, 如果有问题再拿掉. 

10:33 2013-01-29
mailing list, virtualization, xen
1, libvirt 0.10.2.3 support xen4.2 now.
[libvirt] ANNOUNCE: libvirt 0.10.2.3 maintenance release
https://www.redhat.com/archives/libvir-list/2013-January/msg01976.html
* build: Add libxenctrl to LIBXL_LIBS
* Convert libxl driver to Xen 4.2

18:05 2013-01-29
房产证, 逐页复印.
契税. 复印.
身份证, 
联名卡.
 

朝阳门男大街14
号. 
一层.

身份证, 
联名卡.
yang.yang2@fesco.com.cn

12:36 2013-01-30
virtualization, xen, arm, embeddedXen
PENAR: Porting XEN on ARM-based Embedded Systems. FINAL TECHNICAL REPORT
1, A porting strategy for XEN on ARM: 5.4.1   Memory management 
The ARM port of Linux is not using the MMU’s domain features. Each page or section is however
still allocated to a domain:
          Domain 0 for I/O pages or section
          Domain 1 for user mode pages or section
          Domain 2 for kernel pages and page table
Linux uses the “client mode” for its domains. Thus permission sare set by the AP bits.

13:10 2013-01-30
GTD
0, 11:30-11:40 12:30-15:00 16:13-18:10

1, today
1), 12:40-13:11 read doc about embeddedXen, see"12:36 2013-01-30".
2), 13:14-15:00 16:13-18:10 test Jim patch for libxl xen4.2 bug. see"10:24 2013-01-29"5.

1), coding excise for pthread_atfork.
2), rt-thread moto control driver in lua. first version do not use the PWM.

2, daily work
1), tracking xen-arm update.
2), read libvirt and xen-devel quickly, should less that 30minutes.
3), read linux news
http://www.linux.com/
http://www.phoronix.com/scan.php?page=home

3, week plan
1), test Jim lastest Patch.
2), send console patch to upstream.
3), finish libxl block status and relative functions.

4, next
1), for libxl xen4.2 bug, figure out why virsh got event after libxl think its done. see"10:41 2013-01-24".
2), write code for libxl qmp. see"17:15 2013-01-23"
4), read jim patch on libvirt and xen.
3), debug libvirt libxl console. see"16:50 2013-01-04"
1), send xen libexec patch.
1), test Jim patch for libxl xen4.2 bug. see"11:00 2012-12-21"
3), re-read all the patch about libxl xen4.2.
1), got arm technical symposia pdf.
2), libvirt blkstats:
(1), add block stats in libxl_qmp.c, add cmd in xl.
(2), add patch in libvirt, send it to Jim. if the former patch only accept by xen-unstable not xen4.2-testing. i could not send patch to libvirt upstream.
3), try xen on kvm.
4), 对于vi不能方便查找keywords这个事情, 实在不能忍了, 如果这周能把managed save和bridge-utils bug fix, 就把这个做一个.

3, next week
1), work on lock patch.
2), try to build MK802 kernel on obs. speed up. i want it work on opensuse12.3
2), read kernel doc: "10:36 2012-11-23"
1), read code for patch. see"10:25 2012-11-23"2-2)-(2).
2), after "1)" finish. try xen on kvm.
3), read the mail on "Andrew Wafaa <awafaa@opensuse.org>"_email_"[opensuse-arm] Fwd: [fedora-arm] ARMv8 Bootstrap Project"_20121122
3), work on xen on ARM. ref"22:33 2012-11-19"
4), check the error from "10:18 2012-11-15"2
2012-11-15 04:02:45.318+0000: 4307: error : virNodeGetSecurityModel:9567 : this function is not supported by the connection driver: virNodeGetSecurityModel
5), ask jim to invite me to xen irc.

3, next next
1), gsoc: "22:23 2012-11-17"
1), notes about Huawei from eet-china.
2), read bug:https://bugzilla.novell.com/show_bug.cgi?id=781425

2, next
1), try to improve attach-disk, detach-disk in libxl driver, see"18:17 2012-11-07"4
2), test attach-disk command. see"10:41 2012-10-30"2
3), maybe libxl and qemu could communicate with qemu through xenstore?

libxl_dm.c:
        /* Find uuid and the write the vnc password to xenstore for qemu. */
        t = xs_transaction_start(ctx->xsh);
        vm_path = libxl__xs_read(&gc,t,libxl__sprintf(&gc, "%s/vm", p->dom_path));
        if (vm_path) {
            /* Now write the vncpassword into it. */
            pass_stuff = libxl__calloc(&gc, 3, sizeof(char *));
            pass_stuff[0] = "vncpasswd";
            pass_stuff[1] = info->vncpasswd;
            libxl__xs_writev(&gc,t,vm_path,pass_stuff);

3, for Jim
1), xenlight event lock in libvirt. see"16:52 2012-11-06"2-1).

4, next month
1), opensuse on MK802
(1), generate the 512MB version with opensuse12.2 RC2 which enable yast fist run.
(2), try opensuse based on ubuntu kernel in order to solve the error from miniand.
2), try armv8 emulator and read armv8 kernel code.
 
14:43 2013-01-30
shawn: openssl, gnu tls.
HA team: jiaju, mili, steven
lvm maintenaner: dongmao.
distributed fs: ceph

17:58 2013-01-30
community, fosdem
0, i know this from
"Michal Hrusecky <michal@hrusecky.net>"_email_"[opensuse-arm] openSUSE & ARM & FOSDEM"_20130128
1, https://fosdem.org/2013/
OSDEM is a free event that offers open source communities a place to meet, share ideas and collaborate.
2, interested topic
1), The Anykernel and Rump Kernels
https://fosdem.org/2013/schedule/event/operating_systems_anykernel/
    Track: Operating systems
    Room: K.1.105
    Day: Saturday
    Start: 14:00
    End: 14:50
A rump kernel is a lightweight virtualized driver execution environment. Typically, OS virtualization means that the application execution environment is virtualized. In contrast, the rump kernel is designed for ultralightweight kernel driver virtualization. Benefits of using rump kernels include millisecond bootstrap times and a small memory footprint.
2), Open ARM GPU drivers
https://fosdem.org/2013/schedule/event/operating_systems_open_arm_gpu/
Where are we today, one year after the unveiling of the Lima driver.
    Track: Operating systems
    Room: K.1.105
    Day: Saturday
    Start: 15:00
    End: 15:50

This talk will cover several open source graphics driver projects for several ARM GPUs:
    ARM's own Mali with the Lima driver, and some of its developers: Luc Verhaegen, Connor Abbott (present), and Ben Brewer.
    The Qualcomm Adreno with the freedreno driver, and its main developer Rob Clark (present).
    The Nvidia Tegra, and its principal developer of the open source 3D driver for it; Erik Faye-Lund (present).
    Vivante GC range: Wladimir J. Van Der Laan.
    Broadcoms Videocore.
    Imaginations PowerVR.

diff --git a/log201301novell.txt b/log201301novell.txt
index 1d02a4b..0bf32b4 100644
--- a/log201301novell.txt
+++ b/log201301novell.txt
@@ -1596,3 +1596,11 @@ https://www.redhat.com/archives/libvir-list/2013-January/msg01976.html
 联名卡.
 yang.yang2@fesco.com.cn
 
