.LOG
10:12 2013-8-1
mailing list, virtualization, xen-devel; software skill, systemd
Configuring systemd to restart libvirtd on failure
Mooli Tayer
This will create a respawn behaviour in case libvirt process exits due to nonzero exit code, is terminated by a signal, an operation times out or the configured watchdog timeout is triggered. see http://www.freedesktop.org/software/systemd/man/systemd.service.html ---daemon/libvirtd.service.in | 1 + 1 file changed, 1 insertion(+)

diff --git a/daemon/libvirtd.service.in b/daemon/libvirtd.service.in index aa5913b..25979ef 100644 --- a/daemon/libvirtd.service.in +++ b/daemon/libvirtd.service.in @@ -15,6 +15,7 @@ EnvironmentFile=-/etc/sysconfig/libvirtd ExecStart=@sbindir@/libvirtd $LIBVIRTD_ARGS ExecReload=/bin/kill -HUP $MAINPID KillMode=process +Restart=on-failure # Override the maximum number of opened files #LimitNOFILE=2048

12:49 2013-08-01
GTD
0, 11:30

1, today
1), try to update os-prober script in order to support xen in other os.

11:11 2013-08-05
GTD
0, 10:40-11:40 12:20-13:45 16:30-18:20 18:42-21:10

1, today
1), mail.
2), 18:47-21:10 try exclusive operation in linux for sun6i. see"18:47 2013-08-05"

11:12 2013-08-05
company, colleague, openSUSE team, Antonio Larrosa Jiménez
"Agustin Benito Bethencourt <abebe@suse.com>"_email_"[devel] new openSUSE Team member: Antonio Larrosa"_20130802_1721
Hi,

I am happy to announce that Antonio Larrosa Jiménez joined yesterday the 
openSUSE Team at SUSE. He will work remotely from Spain.  He is not new at 
SUSE since he worked here for a year back in 2000.

Antonio is a KDE developer. Those of you who contributed to that project years 
ago will certainly know him. He will replace Will Stephenson as the KDE L3 
maintainer.

Antonio has been working the last 10 years in a company called Tedial that 
develop a real time backup system for multimedia-tv companies. The last years 
he also teached OS at Malaga College for IT students. 

Until August 9th he is in our offices in Nuremberg.

Welcome back Antonio.

Saludos
-- 
Agustin Benito Bethencourt
openSUSE Team Lead at SUSE
abebe@suse.com

11:13 2013-08-05
company, colleague, virtualization, Mike Latimer
1, "Jason Douglas <jdouglas@suse.com>"_email_"[devel] New Colleague in Virtualization Team -- Mike Latimer"
It is my pleasure to announce that Mike Latimer is the newest member of 
the Virtualization Team within the SLE Department. Mike lives in Utah 
and will join the SUSE team on the 5th floor in Provo.

Many of you might know Mike from NTS where he has spent nearly 20 years 
doing backline support on various products. We are confident that his 
experience will be a great asset to the team, and will allow him to hit 
the ground running as he transitions to development work around Xen and 
KVM.

Please join me in welcoming Mike to this new position.

Thanks!
Jason Douglas

2, (10:37 2013-08-09)
during this bi-week sync. Mike said he could speak Japanese.

12:28 2013-08-05
qemu, qcow2, qed
1, qed is Qemu Enhanced Disk
http://wiki.qemu.org/Features/QED
http://www.phoronix.com/scan.php?page=news_item&px=OTY0MQ

2, performance compare with qcow2, qed, QED with L2 Flush
http://wiki.qemu.org/Qcow2/PerformanceRoadmap

3, mount qcow2 through qemu-nbd
http://blog.loftninjas.org/2008/10/27/mounting-kvm-qcow2-qemu-disk-images/

18:00 2013-08-05
software skill, virtualization, qemu, qcow2, snapshot
【转】QCOW增量虚拟机制作
http://hi.baidu.com/chenshake/item/6b2a6327fa4ab7d6a517b6dd
kvm环境快照（snapshot）的使用方法
http://blog.csdn.net/gg296231363/article/details/6899533

18:06 2013-08-05
blog, virtualization, cloud
http://www.cnblogs.com/feisky/

18:08 2013-08-05
GTD, week review, week plan
1, week review
1), get console patch commit. WAITING OTHERS COMMENTS -> commit DONE
2), try ao_how: at least work when callback == NULL.  ref"11:00 2013-07-23"3.
THIS IS IMPORTANT. no progress.
3), try exclusive operation on sun6i. try sun6i upstream kernel. CANCEL
4), try rbd on libvirt libxl. 
(1), MINOR: report in week 30. CANCEL
(2), enable rbd cache? i am not sure whether it need or not. NEED. it is ok in current code.
(3), found chance to enhance xenlight rbd support. see"10:27 2013-07-29"5. CANCEL.
5), opensuse arm bug test and report. CANCEL
(1), ask help for run opensuse arm on cubie.
(2), arndale x11 not start. TRY AGAIN IN NEXT WEEK.

2, week plan
1), try exclusive operation on sun6i. try sun6i upstream kernel.
i wait it in two weeks. must do it this week.
2), try ao_how.
3), sr kvm patch to bruce with him suggestion.

3, other
1), xen: arm. add cpu in dts. add platform support for sun6i in xen.
ask linux-sunxi about u-boot.

18:47 2013-08-05
xen, arm, sun6i, kernel
1, try kernel 3.4 when could the ldrex/strex use?
2, bad crc
sunxi#fatload mmc 0:2 43000000 script.bin
reading script.bin

41068 bytes read
sunxi#fatload mmc 0:2 48000000 linux/uImage
reading linux/uImage

3464192 bytes read
sunxi#setenv bootargs "console=ttyS0,115200 root=/dev/mmcblk0p3 init=/init loglevel=8"
sunxi#bootm 48000000
## Booting kernel from Legacy Image at 48000000 ...
   Image Name:   Linux-3.3.0
   Image Type:   ARM Linux Kernel Image (uncompressed)
   Data Size:    3464128 Bytes = 3.3 MiB
   Load Address: 40008000
   Entry Point:  40008000
   Verifying Checksum ... Bad Data CRC
ERROR: can't get kernel image!
sunxi#

the actual kernel size: 
> ll arch/arm/boot/uImage
-rw-r--r-- 1 bamvor users 3464192 Aug  5 19:37 arch/arm/boot/uImage

install mkimage and rebuild the kernel(clean first).
(8:38 2013-8-26)
this is because the filesystem is corrupt. after recreate the new partition, i never see this.
"8:38 2013-8-26"end
3, modify gic according to Maxime Ripard patch
1), 
gic: interrupt-controller@01c81000 {
        compatible = "arm,cortex-a7-gic";
        reg = <0x01c81000 0x1000>,
              <0x01c82000 0x1000>,
              <0x01c84000 0x2000>,
              <0x01c86000 0x2000>;
        interrupt-controller;
        #interrupt-cells = <3>;
        interrupts = <1 9 0xf04>;
};

2), uart0
uart0: serial@01c28000 {
        compatible = "snps,dw-apb-uart";
        reg = <0x01c28000 0x400>;
        interrupts = <0 0 1>;
        reg-shift = <2>;
        reg-io-width = <4>;
        clocks = <&osc>;
        status = "disabled";
};

the following line is important:
        interrupts = <0 0 1>;
it will be pass after changing this.

4, \TODO fix this
(XEN) WARNING: Unrecognized/unsupported device tree compatible list
(XEN) Available platform support:
(XEN)     - VERSATILE EXPRESS
(XEN)     - SAMSUNG EXYNOS5

5, hang after local_irq_enable().
start_xen<509>
start_xen<511>
start_xen<514>
start_xen<517>
(XEN) Using scheduler: SMP Credit Scheduler (credit)
start_xen<520>
start_xen<523>
start_xen<526>
\TODO: which irq will araise after local_irq_enable()? 

6, \TODO: make sure console init ok.

10:45 2013-08-06
GTD
0, 10:40-11:40 15:40-18:10

1, today
1), mail.
2), 13:40-15:40. nap.
3), 15:40-17:30 ao_how. why event not return. see"15:42 2013-08-06"

10:51 2013-08-06
company, colleague, SLE Core Team, Pawel Wieczorkiewicz
"Stefan Fent <sf@suse.de>"_email_"[devel] Please welcome new memeber of the SLE Core Team Pawel Wieczorkiewicz"_20130805_2200
Hi,

I am very pleased to announce a new member of the SLE Core Team, Pawel 
Wieczorkiewicz.
Pawel has started working for SUSE on August 1st, coming from Intel working on 
networking  / wireless technologies. 
He lives in Nürnberg, and therefore can be found in office 2.3.21.

Please join me and welcome Pawel.

Regards,

Stefan
-- 
SUSE LINUX Products GmbH GF: Jeff Hawn, Jennifer Guild, Felix Imendörffer, HRB 
16746 (AG Nürnberg) 
Maxfeldstr. 5 / D-90409 Nürnberg / Phone: +49-911-740 53 - 0  
GPG 1024D/91614BBC B226 E3DA 37B0 2170 7403  D19C 18AF E579 9161 4BBC

15:42 2013-08-06
virtualization, xen, libxl, async, try ao_how, cont2, debug save, cont2
1, plan 
1), why the first time call libxl__ao_complete_check_progress_reports not report the complete. i need this.

2, 
helper_exited
helper_done
libxl__domain_suspend_device_model

3, i think i should add the libxl__fork_selfpipe_woken things to libxl_osevent_hooks.
because it is the only thing missing in libvirt but inplement in afterpoll_internal.

    int selfpipe = libxl__fork_selfpipe_active(CTX);
    if (selfpipe >= 0 &&
        afterpoll_check_fd(poller,fds,nfds, selfpipe, POLLIN)) {
        int e = libxl__self_pipe_eatall(selfpipe);
        if (e) LIBXL__EVENT_DISASTER(egc, "read sigchld pipe", e, 0);
        libxl__fork_selfpipe_woken(egc);
    }

09:00 2013-08-07
GTD
0, 8:50-11:30 12:30-17:10

1, today
1), 9:30-11:30 12:30- is it possible handle libxl__fork_selfpipe_woken in libxl? see"09:19 2013-08-07"
some time for personal stuff.
2), ask help about boot A31 kernel. send email?
3), Summary: 1hour for lunch, is it too long?

09:09 2013-08-07
mailing list, virtualization, xen, guest support
"Lars Pinne <lars.pinne@suse.com>"_email_"[virtualization-xen] SLES version is supported as guest on which SLES version as host?"_to_"XEN Hypervisor Technology Discussion"
1, "Antoine Ginies <aginies@suse.com>" reply
1), 
Lars Pinne:
> - we have a list of guest OS supported with Xen host SLES11sp3
> https://www.suse.com/documentation/sled11/book_xen/?page=/documentation/sled11/book_xen/data/book_xen.html
> 
> - we have a list of Xen hosts supported with guest SLES11sp2
> http://doc.opensuse.org/products/draft/SLES/SLES-xen_sd_draft/cha.xen.basics.html
> 
> Do we have an overview or a general rule for
> which SLES version is supported as guest on which SLES version as host?

There is no general rule. There is a white-paper on VT, he should help
you understand which host/guest scenario we support:

http://www.novell.com/docrep/2009/09/SUSE_Linux_Enterprise_Server_Virtualization_Technology_Support_en.pdf


-- 
Antoine Ginies <aginies@suse.com>
Project Manager
SUSE France

2), 
Lars Pinne:
> Hi Antoine,
> I did not find infos about running newer versions on older hosts.
> And in the paper's version for sp2, we did not mention sp3 as guest.
> 
> Or is it a rule, that we will support any SLES as guest on any
> older SLES, as long as both are under support?


This is true, we support any SLES as guest on any older SLES as long as
both are under support.
There is one exception: 
we are not able to boot a SLE11 SP3 PV guest on SLE10 SP4 (secure boot
issue).

> Such cases might be very common, since no customers wants to update
> its Xen hosts without urgent need.


regards
Antoine

-- 
Antoine Ginies <aginies@suse.com>
Project Manager
SUSE France

09:19 2013-08-07
virtualization, xen, libxl, async, try ao_how, cont2, debug save, cont3
1, 现在的关键问题是helper_exited没有人调用.
helper_exited will be called during childproc_reaped: ch->callback.

libxl__fork_selfpipe_woken -> childproc_reaped
libxl_childproc_reaped -> childproc_reaped

i could call libxl_childproc_reaped in libxl driver. but when?
1), read the doc about subprocess handling. in xen/tools/libxl/libxl_event.h
according to this doc, i should call libxl_childproc_setmode.
using libxl_sigchld_owner_mainloop or libxl_sigchld_owner_libxl_always?

2), if use libxl_sigchld_owner_libxl_always
 *     libxl_sigchld_owner_libxl_always:
 *       The application expects libxl to reap all of its children,
 *       and provides a callback to be notified of their exit
 *       statues.

sigchld_handler is installed when libxl_sigchld_owner_libxl_always set. sigchld_handler will write to sigchld_owner->sigchld_selfpipe[1]. who listen this?
i could register this to libvirt event loop then call the callback by myself.

3), if use libxl_sigchld_owner_mainloop 
i need to hand the signal in libvirt. it seems that there is no libvirt common function for this. except the virnetserver.c, the latter one is too complex for my requirement.

2, try libxl_sigchld_owner_libxl_always
1), register event to loop.
2), libxl_childproc_reaped need pid of child process.
should i get pid from fork_replacement? yes.
sigchld_selfpipe could not get from libxl outside. i need to modify the code.

3, currently, there are three choices for me, i am trying choice 2).
1), using ao_how without callback -> libxl_sigchld_owner_mainloop
2), using ao_how without callback -> libxl_sigchld_owner_libxl_always?
3), using ao_how with callback

22:08 2013-8-7
刚才看amba5介绍，看了两篇文章，没理解Coherent Hub Interface里面的hub是什么意思，有没有基于cortex-a5x和amba5的系统框图？
http://blogs.arm.com/soc-design/984-what-is-amba-5-chi-and-how-does-it-help/
http://www.arm.com/zh/about/newsroom/arm-announces-amba-5-chi-specification-to-enable-high-performance-highly-scalable-system-on-chip.php

9:12 2013-8-8
arm, doc, gic
When a GIC that implements the GIC Security Extensions is connected to a processor that implements the ARM Security Extensions: 
Group 0 interrupts are Secure interrupts, and Group 1 interrupts are Non-secure interrupts

12:59 2013-08-08
GTD
0, 11:10-11:40 14:40-17:56 19:12-20:58

1, today
1), email.
2), submit request to openSUSE 12.3 kvm package. see"17:47 2013-08-08"
3), 19:12-20:58 try to finish choice 2). mentioned in "09:19 2013-08-07"3-2). see"17:45 2013-08-08"
4), Summary
(1), too many personal stuff today. about 2h?

17:45 2013-08-08
virtualization, xen, libxl, async, try ao_how, cont2, debug save, cont4, try to finish without callback
0, ref"09:19 2013-08-07"3-2)
1, add libxl_get_pipe_handle, but still not work.
when i issue virsh list
2013-08-08T20:55:44.213124+08:00 linux-rd libvirtd[23744]: call libxl_childproc_reaped
2013-08-08T20:55:44.213222+08:00 linux-rd libvirtd[23744]: libvirtd: libxl_internal.h:2701: libxl__ctx_lock: Assertion `!r' failed.
2013-08-08T20:55:58.490216+08:00 linux-rd libvirtd[23744]: libxl_event_wait fail
2013-08-08T20:55:58.491282+08:00 linux-rd libvirtd[23744]: Caught abort signal dumping internal log buffer:
2, (11:31 2013-08-09)
check why libxl_sigchld_callback is not called after woken?
1), fault
Program received signal SIGABRT, Aborted.
0x00007f6bcba9f3d5 in raise () from /lib64/libc.so.6

2), 
(gdb) where
#0  0x00007f6bcba9f3d5 in raise () from /lib64/libc.so.6
#1  0x00007f6bcbaa0858 in abort () from /lib64/libc.so.6
#2  0x00007f6bcba982e2 in __assert_fail_base () from /lib64/libc.so.6
#3  0x00007f6bcba98392 in __assert_fail () from /lib64/libc.so.6
#4  0x00007f6bbf234c1e in libxl__ctx_lock (ctx=<optimized out>)
    at libxl_internal.h:2701
#5  0x00007f6bbf261376 in libxl_childproc_reaped (ctx=<optimized out>, 
    pid=2555, status=32619) at libxl_fork.c:279
#6  0x00007f6bcf0cda58 in virEventPollDispatchHandles (fds=<optimized out>, 
    nfds=<optimized out>) at util/vireventpoll.c:498
#7  virEventPollRunOnce () at util/vireventpoll.c:645
#8  0x00007f6bcf0cbfbb in virEventRunDefaultImpl () at util/virevent.c:273
#9  0x00007f6bcf1f8d4d in virNetServerRun (srv=0x7f6bd1a403b0)
    at rpc/virnetserver.c:1097
#10 0x00007f6bcfbdf57b in main (argc=<optimized out>, argv=<optimized out>)
    at libvirtd.c:1512
(gdb) frame 4
#4  0x00007f6bbf234c1e in libxl__ctx_lock (ctx=<optimized out>)
    at libxl_internal.h:2701
(gdb)      

3, (10:00 2013-08-14)
figure out why fault in libxl__ctx_lock

4, using the "-O0" flag as last week. restart the following process after re-install xen-tools, xen-libs: 
# zypper ps
The following running processes use deleted files:

PID  | PPID | UID | Login | Command                    | Service | Files                
-----+------+-----+-------+----------------------------+---------+----------------------
1057 | 1    | 0   | root  | xenstored                  |         | /usr/lib64/libxenct->
     |      |     |       |                            |         | /usr/sbin/xenstored->
1064 | 1    | 0   | root  | xenconsoled                |         | /usr/lib64/libxenct->
     |      |     |       |                            |         | /usr/lib64/libxenst->
     |      |     |       |                            |         | /usr/sbin/xenconsol->
1090 | 1    | 0   | root  | qemu-system-i386 (deleted) |         | /usr/lib64/libxenst->
     |      |     |       |                            |         | /usr/lib64/libxenct->
     |      |     |       |                            |         | /usr/lib64/libxengu->
     |      |     |       |                            |         | /usr/lib/xen/bin/qe->

/usr/sbin/xenstored --pid-file /var/run/xenstored.pid
xenconsoled --pid-file=/var/run/xenconsoled.pid
/usr/lib/xen/bin/qemu-system-i386 -xen-domid 0 -xen-attach -name dom0 -nographic -M xenpv -daemonize -monitor /dev/null

after enable "-O0", xen kernel module, xenstore, qemu not loaded. but 
/etc/rc.d/xencommons restart
successful.

5, remove CTX_LOCK and CTX_UNLOCK in libxl_childproc_reaped for test.
ctx is invalid in childproc_reaped, so this is why CTX_LOCK get 22(EINVAL).
$7 = {lg = 0x6b63617473, xch = 0x0, xsh = 0x6365537269760000, nogc_gc = {
    alloc_maxsize = 1953067637, alloc_ptrs = 0x73654e6464416b63, owner = 0x646574}, 
  event_hooks = 0x6365537269760000, event_hooks_user = 0x6174537974697275, lock = {
    __data = {__lock = 1699179363, __count = 1936019060, __owner = 6579572, 
      __nusers = 6512996, __kind = 1969448307, __spins = 2037672306, __list = {
        __prev = 0x746972756365732f, __next = 0x632e6361645f79}}, 
    __size = "ckGetNested\000dac\000security/security_dac.c", 
    __align = 8315138548831841123}, occurred = {tqh_first = 0x7220746f6e6e6163, 
    tqh_last = 0x732065766c6f7365}, osevent_in_hook = 1768713593, 
  osevent_hooks = 0x75253a75250073, osevent_user = 0x250074756f2e7325, poller_app = {
    entry = {le_next = 0x6e692e73, le_prev = 0x6e69747465530000}, 
    fd_polls = 0x7375204341442067, fd_polls_allocd = 1629516389,
    fd_rindices_allocd = 1730176110, fd_rindices = 0x206e6f2070756f72, wakeup_pipe = {
      661857575, 544175136}}, pollers_event = {lh_first = 0x646c253a646c2527}, 
  pollers_idle = {lh_first = 0x6e69747465530027}, hook_fd_nexi_idle = {
    slh_first = 0x6120726573752067}, hook_timeout_nexi_idle = {
    slh_first = 0x70756f726720646e}, efds = {lh_first = 0x646c2527206f7420}, etimes = {
    tqh_first = 0x6e6f2027646c253a, tqh_last = 0x6f6e202773252720}, 
  watch_slots = 0x726f707075732074, watch_nslots = 543450484, watch_freeslots = {
    slh_first = 0x6574737973656c69}, watch_counter = 1699938413, watch_efd = {
    fd = 1937055847, events = 29285, func = 0x70756f726720646e, entry = {
      le_next = 0x646c2527206f7420, le_prev = 0x6e6f2027646c253a}, 
    nexus = 0x6f6e202773252720}, death_list = {tqh_first = 0x74696d7265702074, 
    tqh_last = 0x646574}, death_reported = {tqh_first = 0x6e69747465530000, 
    tqh_last = 0x6120726573752067}, death_watch = {
    path = 0x70756f726720646e <Address 0x70756f726720646e out of bounds>, 
    callback = 0x646c2527206f7420, slotnum = 1684809018, counterval = 1852776487}, 
  disk_eject_evgens = {lh_first = 0x6f6e202773252720}, 
  childproc_hooks = 0x626973736f702074, childproc_user = 0x6572206e6f20656c, 
  sigchld_selfpipe = {1852793953, 1713404268}, children = {
    lh_first = 0x6574737973656c69}, version_info = {xen_version_major = 1853161581, 
    xen_version_minor = 1701601889, 
    xen_version_extra = 0x20746573206f7420 <Address 0x20746573206f7420 out of bounds>, 
    compiler = 0x646e612072657375 <Address 0x646e612072657375 out of bounds>, 
    compile_by = 0x742070756f726720 <Address 0x742070756f726720 out of bounds>, 
    compile_domain = 0x253a646c2527206f <Address 0x253a646c2527206f out of bounds>, 
    compile_date = 0x27206e6f2027646c <Address 0x27206e6f2027646c out of bounds>, 
    capabilities = 0x277325 <Address 0x277325 out of bounds>, 
    changeset = 0x726f747365520000 <Address 0x726f747365520000 out of bounds>, 
    virt_start = 2324773593510538857, pagesize = 1919251317, 
    commandline = 0x6f2070756f726720 <Address 0x6f2070756f726720 out of bounds>}}

6, check when the ctx is freed?
libxl_ctx_free breakpoints not entered. so, i using the wrong ctx???
yes. i not set the ctx to for info struct.
1), child_reaped pass after changing. but it entered several times. i should remove it.
2), i still could not recevice the event in libxl_check_event. check it tomorrow.

17:47 2013-08-08
virtualization, libvirt, kvm, bnc#815201, save hang, cont8, submit request to kvm package
1, using SIZE_MAX instead of UINT_MAX.
2, test 19times including 17times greater than 3G.
3, sr
> osc sr -m "fix xfer limit in buffered_close"
WARNING:
WARNING: Project does not accept submit request, request to open a NEW maintenance incident instead
WARNING:
created request id Request: #186365

  maintenance_incident: home:bjzhang:branches:openSUSE:12.3:Update/kvm4sr -> openSUSE:Maintenance (release in openSUSE:12.3:Update)


Message:
fix xfer limit in buffered_close

State:   new        2013-08-08T09:50:51 bjzhang
Comment: <no comment>

18:53 2013-08-08
cloud, openstack
http://docs.mirantis.com/fuel/fuel-3.1/index.html
This step-by-step guide takes you through this process of:
Configuring OpenStack and its supporting components into a robust cloud architecture
Deploying that architecture through an effective, well-integrated automation package that sets up and maintains the components and their configurations
Providing access to a well-integrated, up-to-date set of components known to work together

20:00 2013-08-08
sun6i, mkimage, kernel, uImage
/bin/sh /home/bamvor/sda5_rd/home/bamvor/work_bak/arm/Allwinner/source/sun6i/linux-A31-2v0/scripts/mkuboot.sh -A arm -O linux -T kernel -C none -a 0x40008000 -e 0x40008000 -n 'Linux-3.3.0' -d arch/arm/boot/zImage arch/arm/boot/uImage

i will use
mkimage -A arm -O linux -T kernel -C none -a 0x40008000 -e 0x40008000 -d arch/arm/boot/zImage arch/arm/boot/uImage

11:28 2013-08-09
GTD
0, 10:30-14:40 15:42-18:10

1, today
1), 40' virtualization sync.
2), report to Jiaju about virtualization sync.
3), discuss with Chunyan about migration fault.
4), 11:30-11:50 15:42-18:05 try to finish choice 2). mentioned in "09:19 2013-08-07"3-2). see"17:45 2013-08-08"2.
5), 12:15-13:30 lunch and learning. see"12:16 2013-8-9"
6), Summary
(1), two days not get my result. what a pity.

12:16 2013-8-9
lunch and learning
1, dongmao
1), y2log, showy2log
/var/log
2), webYaST
3), device mapper
   /            \
lvm           multipath(光纤, iscsi)

kpartx also use dm.

2, shawn
gnu/linux hardening(linux加固).

18:01 2013-08-09
(21:00 2013-08-15)
arm, sun6i, kernel, upstream
1, sent to Maxime Ripard(maxime.ripard@free-electrons.com) 
Hi, Maxime 

this is Bamvor Jian Zhang. currently, i work on port xen to sun6i. and i need a upstream kernel for sun6i.
i have had ping u at linux-sunxi in freenode last week, and got your github branch for sun6i(https://github.com/mripard/linux/tree/sunxi-next-a31). I also saw your A31 patch sent to linux-arm.
which one should i use for boot sun6i kernel?
i test your patch in my mele M9 box(A31 with 2G memory). but i fail on u-boot loading kernel.
i am not sure if the u-boot ship with my box is too old to using the dtb and kernel.
So, could u do me a favor to give me some instruction about how to boot your kernel, including proper u-boot, cmdline and filesystem.
BTW: do i need to use fex for booting your kernel?

i am so excited to boot your kernel in my board. and i hope i could make a opensuse image for sun6i. 

thanks

bamvor

2, reply
Hi Bamvor,

On Thu, Aug 15, 2013 at 07:12:42AM -0600, Bamvor Jian Zhang wrote:
> this is Bamvor Jian Zhang. currently, i work on port xen to sun6i. and
> i need a upstream kernel for sun6i.

Cool :)

> i have had ping u at linux-sunxi in freenode last week,

Sorry about that. I'm currently on holidays, hence why I probably didn't
see your ping.

> and got your github branch for sun6i
> (https://github.com/mripard/linux/tree/sunxi-next-a31). I also
> saw your A31 patch sent to linux-arm.  which one should i use for boot
> sun6i kernel?

The github branch you picked is the latest I sent to the ML.

> i test your patch in my mele M9 box(A31 with 2G memory). but i fail on
> u-boot loading kernel.

How so ?

What is the error from the kernel? What configuration did you use? Which
device tree did you use? How do you load the kernel and device tree
images?

> i am not sure if the u-boot ship with my box is too old to using the
> dtb and kernel.

I can't answer that question. You can always use CONFIG_ARM_APPENDED_DTB
if your u-boot is too old.

> So, could u do me a favor to give me some instruction about how to
> boot your kernel, including proper u-boot, cmdline and filesystem.

http://linux-sunxi.org/Mainline_Kernel_Howto

> BTW: do i need to use fex for booting your kernel?

No. We don't and never will support fex. We use device tree just like
any other ARM platform.

Maxime

-- 
Maxime Ripard, Free Electrons
Embedded Linux, Kernel and Android engineering
http://free-electrons.com

10:15 2013-08-13
virtualization, nested, xen
http://www.slideshare.net/xen_com_mgr/nested-virtualization-update-from-intel
1, xiantao.zhang@intel.com
2, Why nested virtualization?
Ordinary OS are adopting  VMX now
    Windows 7 XP compatibility mode 
    Windows 8 Hyper-V
Other Commercial VMMs requires VMX for better performance
    vmware vmm
Anti-virus software depends on VMX
    McAfee Deep Defender
3, What is the goal ?
    To make VMX-based system software run smoothly in a Xen guest. 

14:34 2013-08-13
fate, virtualization, kvm, arm
Feature changed by: Michal Svec <msvec@suse.com>
Feature #314465, revision 10
  Title: Support the ARM architecture of KVM
   
- SLES-12: Rejected
+ SLES-12: Rejected by Michal Svec <msvec@suse.com>
+ reject date: 2013-08-09 15:41:18
+ reject reason: There are no plans to support ARMv7 in SLE 12. ARMv8
+ AArch64 is also not in the current plan of SLE 12, but we'd be open and
+ happy to have engagement on the BizDev side.
  Priority
      Requester: Desirable
   
  Requested by: yi li <yili@novell.com>
  Product Manager: Michal Svec <msvec@suse.com>
  Product Manager: Vladimir Botka <vbotka@suse.com>
  Partner organization: SUSE
   
  Categories:
  Virtualization, Virtualization / KVM
   
Description:
  Support ARM: create VM on ARM architecture, include passthrough the
  amba device to the guest os.
   
-- 
https://fate.novell.com/314465
More information about FATE on https://wiki.innerweb.novell.com/index.php/FATE
This feature is available to SUSE at: https://partnerfate.novell.com/314465

09:54 2013-08-14
GTD
0, 9:40-11:35 12:40-17:50

1, today
1), 10' mail.
2), 9:59-11:35 13:50-17:44 try to finish choice 2). mentioned in "09:19 2013-08-07"3-2). see"17:45 2013-08-08"3.
3), sun6i: reply to Bob. see"13:14 2013-08-14"

09:54 2013-08-14
virtualization, storage, storage motion
1, "Sebastian Martinez" <smartinez@suse.com>""
I have found this:  
http://wiki.xen.org/wiki/Storage_XenMotion and I would like to know if we support this kind of technology (storage live
migration without shared storage). 
And Is there any similar for KVM? 

Best regards, 

Sebastián Martínez
Business Development Manager
C/José Echegaray 8 Edif. III, 1ª, oficina 5 y 6.  
28232. Las Rozas. Spain.
+34 652 86 19 49
smartinez@suse.com
SUSE

2, Jim Fehlig
Sebastian Martinez wrote:
>
> I have found this:
>
> /_http://wiki.xen.org/wiki/Storage_XenMotion_/ and I would like to
> know if we support this kind of technology (storage live migration
> without shared storage).
>

Storage XenMotion is supported by the XCP toolstack from Citrix, which
is not provided in SLES.

> And Is there any similar for KVM?
>

libvirt's migrate API supports a VIR_MIGRATE_NON_SHARED_DISK flag, which
is implemented in the QEMU/KVM driver.  With virsh, you should be able
to do something like

virsh migrate vm-name --copy-storage-all ...

Regards,
Jim

3, Bruce Rogers
>>> On 8/12/2013 at 09:07 AM, Jim Fehlig <jfehlig@suse.com> wrote: 
> Sebastian Martinez wrote:
>>
>> I have found this:
>>
>> /_http://wiki.xen.org/wiki/Storage_XenMotion_/ and I would like to
>> know if we support this kind of technology (storage live migration
>> without shared storage).
>>
> 
> Storage XenMotion is supported by the XCP toolstack from Citrix, which
> is not provided in SLES.
> 
>> And Is there any similar for KVM?
>>
> 
> libvirt's migrate API supports a VIR_MIGRATE_NON_SHARED_DISK flag, which
> is implemented in the QEMU/KVM driver.  With virsh, you should be able
> to do something like
> 
> virsh migrate vm-name --copy-storage-all ...
> 
> Regards,
> Jim

Although available for KVM, we haven't stated support for storage migration.
We could certainly consider it if there is customer demand.

Bruce

12:40 2013-08-14
virtualization, xen, arm
[Xen-devel] How ARM Xen process the harddisk requests from DomU
1, Ian C
On Mon, 2013-08-12 at 12:06 +0800, Josh Zhao wrote:
> I am wondering how arm xen process the harddisk requests from DomU, is
> there a daemon in dom0 to do this work?
Xen on ARM supports only PV devices, so the PV disk backend will deal
with it. I'm not sure anyone has tried qdisk on ARM, although it should
work fine, but I expect most people are currently using the in-kernel
blkback driver in their driver domain.

2, Ian C
On Mon, 2013-08-12 at 14:23 +0800, Josh Zhao wrote:
> As the dom0 can use map_devices_from_device_tree() to map all devices
> into dom0 memory space , why we need to use the sysmmu ?
All ARM domains run with hardware nested page tables ("second stage
paging" in ARM speak, equivalent to HAP for x86 HVM guests). So an IOMMU
is needed to translate guest physical addresses into host physical
addresses for the device e.g. for doing DMA.

13:14 2013-08-14
allwinner, A31, sun6i, mele M9
1, Bob Ham <rah@settrans.net>
Hi there,

I've just got a Mele A1000G which you stated is the same as the A1000
you unboxed here:

  http://xen_on_arm.farbox.com/post/mele_m9_quadcore

I'd like to get the serial output from u-boot in order to work on Linux
on the device.  In your hacking page, you noted a 3v3 uart: "the uart
pin is same as mele A1000, from left to right: 3v3, Tx, Rx, Gnd".

However, it isn't clear which connector you're referring to on the
board.  Could you possible tell me which connector is the UART? :-)

Any help is much appreciated.

Kind regards,

Bob Ham

2, reply
Hi, Bob

glad to see more and more people hacking A31. and sorry to late to reply to u.
my box is a engineering test version of mele M9. i am not sure it is same or not with
your box.

could u see the right-down connector in my inside picture(next to the last picture)?
that is the uart connector. there are four pins in that, 3v3, Tx, Rx, Gnd.
AFAIK, there is only one four pins connector in this board.

BTW, i am trying to port xen to A31. currently, i need a upstream kernel. and recently, 
Maxime Ripard(maxime.ripard@free-electrons.com) send the A31 patches to linux-arm-kernel
 and linux-sunxi mailing list. but i do not get a chance to test it.
will u try it?

and if u could get any kernel and filsystem running successful on A31. i could package 
it to opensuse arm. it would be useful for others one.

regards

bamvor

09:53 2013-08-15
GTD
0, 9:40-18:00

1, today
1), 10' jim email. CANCEL.
2), 17:00-17:54 ao_how
3), a31 email.

09:58 2013-08-15
mailing list, virtualization, libvirt, libxl, logging
1, [libvirt] [PATCH] libxl: Create per-domain log file 
1), Daniel reply to Jim.
> > Startup of libvirtd SEGVs with this change in GIT
> >
> > ==4706== For counts of detected and suppressed errors, rerun with: -v
> > ==4706== ERROR SUMMARY: 0 errors from 0 contexts (suppressed: 2 from 2)
> > ==4601== Thread 12:
> > ==4601== Invalid read of size 8
> > ==4601==    at 0x1E57964F: xtl_logv (in /usr/lib64/libxenctrl.so.4.2.0)
> > ==4601==    by 0x1E5796D3: xtl_log (in /usr/lib64/libxenctrl.so.4.2.0)
> > ==4601==    by 0x1E33258A: ??? (in /usr/lib64/libxenlight.so.2.0.0)
> > ==4601==    by 0x1E332641: ??? (in /usr/lib64/libxenlight.so.2.0.0)
> > ==4601==    by 0x1E317CD7: libxl_ctx_alloc (in /usr/lib64/libxenlight.so.2.0.0)
> >   
> 
> I should have looked at the xen code closer.  Seems libxl doesn't cope
> well with a NULL logger :(.
> 
> Hmm, should the logger for this driver-wide ctx (used for getting libxl
> version and the like, no domain ops) just dump messages to /dev/null or
> should they go to a driver-wide log file?

Depends if you think there's any useful info to be had from the
driver wide context object ? If so, then probably best to have a
driver-wide log file for those messages


Daniel

2), 
> > Daniel
> Eric
Daniel

> > Depends if you think there's any useful info to be had from the
> > driver wide context object ? If so, then probably best to have a
> > driver-wide log file for those messages
> 
> Or even just reply the data into the main libvirtd.log (ie. use existing
> virLog functionality, rather than creating a new file), since ideally
> the log will be relatively sparse: in my case, it would be just one
> message stating that libxl is not available, at which point the libxl
> driver no longer does anything else during the life of libvirtd.

I was going to suggest that, but IIUC, the libxl logger API requires
you to give it a FILE * instance to which it writes directly. To feed
it into our normal logs, we'd want it to let us give it a callback
for writing log messages.

Daniel

3), Jim reply to Daniel
> I was going to suggest that, but IIUC, the libxl logger API requires
> you to give it a FILE * instance to which it writes directly.

Right.

>  To feed
> it into our normal logs, we'd want it to let us give it a callback
> for writing log messages.
>   

I was going to pass the logger create function 'stderr' for the
driver-wide ctx.  Would that be safe?

Regards,
Jim

4), Eric reply to Daniel
> I was going to suggest that, but IIUC, the libxl logger API requires
> you to give it a FILE * instance to which it writes directly. To feed
> it into our normal logs, we'd want it to let us give it a callback
> for writing log messages.

Can we rely on open_memstream() being present on any platform with
libxl?  If so, that would give us a FILE* interface to libxl, while
still giving us access to the strings it prints which we can then turn
around and hand to our logger.

-- 
Eric Blake   eblake redhat com    +1-919-301-3266
Libvirt virtualization library http://libvirt.org

5), Jim
I should have tested this change on a system with libxl, but not booted
to Xen.  libxl would have then complained, and I would have seen the
crash.  Lesson learned...

I've sent a patch to fix the issue

https://www.redhat.com/archives/libvir-list/2013-August/msg00484.html

Regards,
Jim

6), Dario Faggioli reply to Jim
> I should have tested this change on a system with libxl, but not booted
> to Xen.  libxl would have then complained, and I would have seen the
> crash.  Lesson learned...
> 
Ups! I was wondering how that could happen, since I tested this too and
it worked, but yes, I tested it on Xen too... Did not think about doing
the above, although, yes, it definitely sounds like a reasonable thing
to do! :-P

Note taken for next time. :-)

Dario

2, example about how to use xtl_createlogger_stdiostream in libvirt.
[libvirt] [PATCH] libxl: fix libvirtd segfault
https://www.redhat.com/archives/libvir-list/2013-August/msg00484.html

@@ -1229,6 +1232,7 @@ libxlStateInitialize(bool privileged,
                      void *opaque ATTRIBUTE_UNUSED)
 {
     const libxl_version_info *ver_info;
+    char *log_file = NULL;
     virCommandPtr cmd;
     int status, ret = 0;
     unsigned int free_mem;
@@ -1308,6 +1312,17 @@ libxlStateInitialize(bool privileged,
         goto error;
     }
 
+    if (virAsprintf(&log_file, "%s/libxl-driver.log", libxl_driver->logDir) < 0)
+        goto error;
+
+    if ((libxl_driver->logger_file = fopen(log_file, "a")) == NULL)  {
+        virReportSystemError(errno,
+                             _("failed to create logfile %s"),
+                             log_file);
+        goto error;
+    }
+    VIR_FREE(log_file);
+
     /* read the host sysinfo */
     if (privileged)
         libxl_driver->hostsysinfo = virSysinfoRead();
@@ -1316,8 +1331,18 @@ libxlStateInitialize(bool privileged,
     if (!libxl_driver->domainEventState)
         goto error;
 
-    if (libxl_ctx_alloc(&libxl_driver->ctx, LIBXL_VERSION, 0, NULL)) {
-        VIR_INFO("cannot initialize libxenlight context, probably not running in a Xen Dom0, disabling driver");
+    libxl_driver->logger =
+            (xentoollog_logger *)xtl_createlogger_stdiostream(libxl_driver->logger_file, XTL_DEBUG, 0);
+    if (!libxl_driver->logger) {
+        VIR_INFO("cannot create logger for libxenlight, disabling driver");
+        goto fail;
+    }
+
+    if (libxl_ctx_alloc(&libxl_driver->ctx,
+                       LIBXL_VERSION, 0,
+                       libxl_driver->logger)) {
+        VIR_INFO("cannot initialize libxenlight context, probably not running "
+                 "in a Xen Dom0, disabling driver");
         goto fail;
     }
 
@@ -1383,6 +1408,7 @@ libxlStateInitialize(bool privileged,
 error:
     ret = -1;
 fail:
+    VIR_FREE(log_file);
     if (libxl_driver)
         libxlDriverUnlock(libxl_driver);
     libxlStateCleanup();

10:11 2013-08-15
THIS EMAIL IS NOT SENT TO JIM.
title: about your per domain log patch
Hi, Jim

i read your per domain log patch and relative segfault patch.
IIRC, you said that it is relative to my jobs patch? but i am not understand this.


10:35 2013-08-15
virtualization, libvirt, packages
bamvor@linux-rd:libvirt> sudo zypper in libvirt
Loading repository data...
Reading installed packages...
Resolving package dependencies...

The following NEW packages are going to be installed:
  libvirt libvirt-client libvirt-daemon libvirt-daemon-config-nwfilter 
  libvirt-daemon-driver-interface libvirt-daemon-driver-libxl libvirt-daemon-driver-lxc 
  libvirt-daemon-driver-network libvirt-daemon-driver-nodedev 
  libvirt-daemon-driver-nwfilter libvirt-daemon-driver-qemu 
  libvirt-daemon-driver-secret libvirt-daemon-driver-storage libvirt-daemon-driver-uml 
  libvirt-daemon-driver-vbox libvirt-daemon-driver-xen 

16 new packages to install.
Overall download size: 7.2 MiB. After the operation, additional 28.5 MiB will be used.
Continue? [y/n/?] (y): 

11:01 2013-08-15
mailing list, virtualization, xen
1, "ar16 <ar16@imapmail.org>"_email_"[opensuse-virtual] "EVTCHNOP failure" @ OS 12.3 + Xen 4.3 boot for some Guests; launch manually OK"_20130815_1018
I've recently upgraded pkgs an Opensuse 12.3 + XEN 4.3
(xen-4.3.0_08-264.1.x86_64) server.

It's got two guests set for auto-launch @ boot.

It's been working fine for awhile.  The guest cfg's have not changed in
ages.  Just the upgrade has occured recently.

Now, reproducibly after boot, one Guest is missing,

	xl list
		Name                                        ID   Mem
		VCPUs      State   Time(s)
		(null)                                       0   985    
		4     r-----      44.2             <====== Why "(null)"
		here? systemd?
		test2                                        2  1024    
		4     -b----      13.3

but launches manually 

	xl create /etc/xen/auto/test1.cfg
	xl list
		Name                                        ID   Mem
		VCPUs      State   Time(s)
		(null)                                       0   985    
		4     r-----      48.2
		test2                                        2  1024    
		4     -b----      13.8
		test1                                        3   768    
		2     -b----       2.3

and functions normally.

checking xen boot logs, I find these, new failures

	xl dmesg
		...
		[  OK  ] Started Haveged Entropy Gathering Daemon.
		[  OK  ] Started Restore Sound Card State.
		[  OK  ] Started LSB: irqbalance daemon providing irq
		balancing on MP-machines.
		[  OK  ] Started LSB: Framebuffer setup.
		[   35.614880] Event-channel device installed.
		[   35.677851] usbcore: registered new interface driver
		usbback
		[   35.711552] pciback: backend is vpci
		[   35.748410] blktap_device_init: blktap device major
		252

		Welcome to openSUSE 12.3 "Dartmouth" - Kernel
		3.7.10-1.16-xen (xvc0).


		testsvr login:

		(XEN) [2013-08-15 01:42:22] event_channel.c:233:d0
		EVTCHNOP failure: domain 2, error -22
		(XEN) [2013-08-15 01:42:22] event_channel.c:233:d0
		EVTCHNOP failure: domain 2, error -22
		(XEN) [2013-08-15 01:42:22] event_channel.c:233:d0
		EVTCHNOP failure: domain 2, error -22
		(XEN) [2013-08-15 01:42:22] event_channel.c:233:d0
		EVTCHNOP failure: domain 2, error -22
		(XEN) [2013-08-15 01:42:22] event_channel.c:233:d0
		EVTCHNOP failure: domain 2, error -22
		(XEN) [2013-08-15 01:42:22] event_channel.c:233:d0
		EVTCHNOP failure: domain 2, error -22
		(XEN) [2013-08-15 01:42:22] event_channel.c:233:d0
		EVTCHNOP failure: domain 2, error -22
		(XEN) [2013-08-15 01:42:22] event_channel.c:233:d0
		EVTCHNOP failure: domain 2, error -22
		(XEN) [2013-08-15 01:42:22] event_channel.c:233:d0
		EVTCHNOP failure: domain 2, error -22
		(XEN) [2013-08-15 01:42:22] event_channel.c:233:d0
		EVTCHNOP failure: domain 2, error -22
		[  OK  ] Started LSB: Configure network interfaces and
		set up routing.
		[  OK  ] Reached target Network.
		         Starting Command Scheduler...
		...

Those

	"event_channel.c:233:d0 EVTCHNOP failure: domain 2, error -22"

errors are new to me.

Looks like a XEN issue.  I've seen recent work on event channel deadlock
on the dev list, but my xen's logs don't mention anything evtchn-related
since ~ Nov 2011.

Before deciding to file a bug, I need to do some local troubleshooting.

Any suggestions as to what this might be about, or specific additional
info that might be enlightening?

AR
-- 
To unsubscribe, e-mail: opensuse-virtual+unsubscribe@opensuse.org
To contact the owner, e-mail: opensuse-virtual+owner@opensuse.org

1), bamvor: i got the same error. keep an eye on this bug report.

2, Jan reply
These being failures of Dom0 trying to bind inter-domain event
channels between itself and Dom2, these would quite likely be
accompanied by some log entries from the xen tools or the Dom0
kernel. In any case - the failure message here indicates that the
event channel either wasn't in "unbound" state, or wasn't
intended to be bound to by Dom0. For what it's worth, both seem
pretty unlikely...

Furthermore, you certainly realize that with the update to Xen 4.3,
which isn't part of 12.3, you also got switched from xend/xm to the
libxl based tools, which may be part of your problem. Thus it would
also be important to know what's so specific about this one failing
VM (there ought to be something, or else it wouldn't be always the
same VM that fails to come up).

Jan

11:29 2013-08-15
xen, libxl, ao_how
libxlEventHandler
LIBXL_EVENT_TYPE_OPERATION_COMPLETE

16:47 2013-08-15
virtualization, xen, arm, sun6i
1, Josh zhao <alephman@gmail.com>
你好 jian zhang,
我最近对xen arm很有兴趣，所以也关注 xen maillist. 发现除Arndale board 外，你发了一些针对全志A31的patchs。
我刚入手了一块A20(dual A7) 的开发板，我想应该区别不大，所以想把xen 移植 上去。我对xen是新手，所以请教几个问题：
1)  我在xen的主树（http://xenbits.xen.org/gitweb/?p=xen.git;a=summary）的master
branch中看不到你的代码，不知在什么地方？
2）在最新的3,8 以上的linux kernel中没有全志A31/A20的板子支持（只有A1X），不知哪里可以看到最新
针对A31/A20的Linux kernel 代码？

非常感谢！

-- 
Best regards!

Josh Zhao

2, 
Hi, Josh 
> 你好 jian zhang,
> 我最近对xen arm很有兴趣，所以也关注 xen maillist. 发现除Arndale board 外，你发了一些针对全志A31的patchs。
> 我刚入手了一块A20(dual A7) 的开发板，我想应该区别不大，所以想把xen 移植 上去。我对xen是新手，所以请教几个问题：
A20目前社区很活跃啊，你可以关注linux-sunxi mailing list. 其实我也有打算移植xen到A20，只是想买cubietruck(2G memory). 你用的什么板子？cubieboard2, OlinuXino, pad ,机顶盒?
> 1)  我在xen的主树（http://xenbits.xen.org/gitweb/?p=xen.git;a=summary）的master
> branch中看不到你的代码，不知在什么地方？
你搜索Bamvor看看。因为我有的patch也不是只针对A31，有些针对A31相关的patch不适合放在xen里面。最终的patch title并不是A31，所以你没搜到？
> 2）在最新的3,8 以上的linux kernel中没有全志A31/A20的板子支持（只有A1X），不知哪里可以看到最新
> 针对A31/A20的Linux kernel 代码？
linux-sunxi mailing list里面有Maxime Ripard基于upstream的A20/A31的patch: code name sun7i, sun6i.
> 
> 非常感谢！
很乐意和你一起把xen for sunxi做好，咱们可以多沟通。
我在IRC freenode: bjzhang
Google+ : bamv2005@gmail.com

regards

bamvor
> 
> -- 
> Best regards!
> 
> Josh Zhao

17:01 2013-08-15
company, colleague, SUSE labs, Shirish Pargaonkar
[devel] New Colleague in SUSE Labs: Shirish Pargaonkar
Hi all -

It's my pleasure to announce that we have a new member of the SUSE Labs
File Systems and Storage team: Shirish Pargaonkar. Shirish is located in
Austin (US) and will be joining us remotely.

He'll be primarily working on storage drivers and software RAID.

Welcome, Shirish!

-Jeff

-- 
Jeff Mahoney
SUSE Labs

18:08 2013-8-15
virtualization, xen, libxl, async, try ao_how, cont2, debug save, cont5, debug
1, hvm boot get domain id 0 in libvirt.
pv ok.
test precedure.
1), create pv. domain id 1.
2), create hvm, domain id 0.
3), destroy pv, create pv. domain id 3.
4), create another hvm, domain id 4.
So, the only the first hvm domain id is wrong.

2, (17:16 2013-08-16)
using my lastest patch. save and restore successful. but restore to domain as 0. 
if using the libvirt in Virtualization, it is ok.

21:14 2013-08-15
sorry, i could input Chinese right now.
here is the a20 cubie2 branch from Maxime, i do not know the exact status about this:
https://github.com/mripard/linux/tree/sunxi-next-a20-cubie2

Maxime send the patch to the three mailing lists: 
linux-arm-kernel@lists.infradead.org.
linux-kernel@vger.kernel.org.
linux-sunxi@googlegroups.com(https://groups.google.com/d/forum/linux-sunxi)

here is the link for v3 patch of a20.
http://lists.infradead.org/pipermail/linux-arm-kernel/2013-August/189046.html

09:55 2013-08-16
GTD
0, 9:40-18:15

1, today
1), \TODO:  mp3 editor in linux. ask YiFan.

10:46 2013-08-16
mailing list, virtualization
"David Byte" <dbyte@suse.com>""_to_"virtualization-dev@lists.novell.com","linux-server@lists.novell.com"_email_"[Virtualization-dev] Virtualization HA RFP Questions"_20130815_2252
These are some questions from a virtualization RFP we are responding to at Avaya.  Any help is appreciated.

HV is hypervisor.  These questions are specific to HA + KVM or HA + Xen.

Avaya needs instantaneous failover feature (<250 ms time to failover to backup server and resume service), a hot standby solution for applications in the event of server failure. Does your HV support this speed, if not what is your failover speed? 

 Ideally Avaya would like to have a hot standby solution that continues to use the local storage on the servers, can your HV provide that? If not please detail what the storage requirements are for hot standby HA. 

Ideally Avaya would like to have a warm standby solution that continues to use the local storage on the servers, can your HV provide that? If not please detail what the storage requirements are for warm standby HA.

Please detail resource requirements for warm standby and hot standby failovers. 


Are there maximum core and memory limits, what are range and network requirements between servers? 

Does the hot or warm standby configuration have a performance cost to the application? 


David ByteSr. Technology Strategist, OEMSUSEdbyte@novell.com(P)918.230.2771
www.suse.com https://www.suse.com/partners/integrated-systems/

10:48 2013-08-16
1, Jim reply
ar16 wrote:
> Ooops, sry, cp'd the wrong result.  Same result for BOTH Guests, alone.
>
> My point is that in BOTH cases, the single-guest -- whether it's "test1"
> or "test2" -- launches without error.
>
> If BOTH guests are included to auto-launch, then only the one launches
> successfully.
>   

Were you using the xl toolstack before the packages were updated?

Do both guests start if you run the xendomains script after boot?  I.e.
disable the script from running at boot, then do '/etc/init.d/xendomains
start' after boot.

Your suspicion of systemd might warrent some investigation

 # rpm -q xen --changelog | grep -A 7 systemd
- Added support for systemd with the following service files
  xenstored.service
  blktapctrl.service
  xend.service
  xenconsoled.service
  xen-watchdog.service
  xendomains.service
  xencommons.service

Perhaps a bit of tweaking on the xendomains script might give some hints
too, e.g.

--- /etc/init.d/xendomains.orig    2013-08-15 11:53:39.487569293 -0600
+++ /etc/init.d/xendomains    2013-08-15 11:54:33.440841893 -0600
@@ -34,7 +34,7 @@
 $CMD list &> /dev/null
 if test $? -ne 0
 then
-    CMD=${SBINDIR}/xl
+    CMD=${SBINDIR}/xl -v
     HEADCOMP="Xen saved domain"
 fi
 
@@ -297,7 +297,7 @@
         if [ $? -eq 0 ] || is_running $dom; then
         echo -n "(skip)"
         else
-        XMC=`$CMD create --quiet --defconfig $dom`
+        XMC=`$CMD create --defconfig $dom`
         if [ $? -ne 0 ]; then
             echo -e "\nAn error occurred while creating domain
${dom##*/}: $XMC\n"
             rc_failed $?

Regards,
Jim

2, ar16 reply
On Thu, Aug 15, 2013, at 11:02 AM, Jim Fehlig wrote:
> Were you using the xl toolstack before the packages were updated?

Yes.  I've been using Xen 4.3 for quite a long time.

> Do both guests start if you run the xendomains script after boot?  I.e.
> disable the script from running at boot, then do '/etc/init.d/xendomains
> start' after boot.

Yes, without fail or error.

> Your suspicion of systemd might warrent some investigation
>  # rpm -q xen --changelog | grep -A 7 systemd
> - Added support for systemd with the following service files

Noted

> Perhaps a bit of tweaking on the xendomains script might give some hints
> too, e.g.
...

Aha!.  Just found that, if I edit BOTH .cfg's,

 -    vcpus        = 2
 -    cpu_cap      = 100
 -    cpu_weight   = 256
 +    #vcpus        = 2
 +    #cpu_cap      = 100
 +    #cpu_weight   = 256

then reboot, now BOTH Guests launch,

xl list
    Name                                        ID   Mem VCPUs     
    State   Time(s)
    (null)                                       0  1241     4    
    r-----      38.9
    test1                                        1  1024     1    
    -b----       6.6
    test2                                        2  1024     1    
    r-----      14.0

Those configs most certainly used to be OK and functional.

I can still tweak the xendomains script here in a bit ...

3, Jim reply to ar16
> Just one question ...
>
> I'm not sure that Xen *should* depend on external network being up, but
> rather just local network and bridges -- even without attached eth0
> interfaces.  I think ...
>   

Agreed, Xen should not depend on the external network being up.  But we
are talking about xendomains, which IMO should depend on external
network.  The domains it starts may need that...

Regards,
Jim

4, ar16
1), 
> > carnold will take care of it, no bug necessary IMO.

Updating @Dom0

 rpm -qa | grep -i xen
    ipset-kmp-xen-6.19_k3.7.10_1.1-32.1.x86_64
    kernel-xen-3.7.10-1.16.1.x86_64
    kernel-xen-devel-3.7.10-1.16.1.x86_64
    xen-4.3.0_09-265.1.x86_64
    xen-devel-4.3.0_09-265.1.x86_64
    xen-libs-4.3.0_09-265.1.x86_64
    xen-tools-4.3.0_09-265.1.x86_64

  rpm -q --changelog xen | head -n5
    * Thu Aug 15 2013 carnold@suse.com
    - Change the default bridge in xl.conf from xenbr0 to just br0
      xl-conf-default-bridge.patch
    - Add network.target to xendomains.service 'After' tag
      xendomains.service

after reboot, not so good,

  xl list
    Name                                        ID   Mem VCPUs     
    State   Time(s)
    (null)                                       0  1280     4    
    r-----     114.0
    (null)                                       1     0     0    
    --p---       0.0
    (null)                                       2     0     0    
    --p---       0.0

and,

journatctl -b | grep xen
...
Aug 15 15:56:14 testsvr.loc xenstored[1124]: Checking store ...
Aug 15 15:56:14 testsvr.loc xenstored[1124]: Checking store complete.
Aug 15 15:56:14 testsvr.loc xenstored[1124]: Checking store ...
Aug 15 15:56:14 testsvr.loc xenstored[1124]: Checking store complete.
Aug 15 15:56:16 testsvr.loc xenconsoled[1516]: xenstore watch on
@introduceDomain fails.
Aug 15 15:56:20 testsvr.loc kernel: xenstored[1124]: segfault at 4 ip
00007f5f74f82eac sp 00007fff1f5ab310 error 4
Aug 15 15:56:20 testsvr.loc kernel:  in
libxenctrl.so.4.3.0[7f5f74f67000+25000]
Aug 15 15:56:20 testsvr.loc dkms_autoinstaller[1044]: dkms: running auto
installation service for kernel 3.7.10-1.16-xen
Aug 15 15:56:20 testsvr.loc xenstored[1076]: FATAL: Failed to open
evtchn device: No such file or directory
Aug 15 15:56:20 testsvr.loc xenconsoled[1516]: xenstore watch on
@introduceDomain fails.
Aug 15 15:56:27 testsvr.loc systemd[1]: Starting Xendomains - start and
stop Xen VMs on boot and shutdown...
Aug 15 15:56:29 testsvr.loc xendomains[2895]: Starting auto Xen domains:
test1.cfglibxl: error: libxl_xshelp.c:134:libxl__xs_get_dompath: failed
to get dompath for 1: Bad file descriptor
Aug 15 15:56:29 testsvr.loc xendomains[2895]: libxl: error:
libxl_create.c:644:initiate_domain_create: cannot make domain: -3
Aug 15 15:56:29 testsvr.loc xendomains[2895]: libxl: error:
libxl_xshelp.c:134:libxl__xs_get_dompath: failed to get dompath for 1:
Bad file descriptor
Aug 15 15:56:29 testsvr.loc xendomains[2895]: libxl: error:
libxl_xshelp.c:134:libxl__xs_get_dompath: failed to get dompath for 1:
Bad file descriptor
Aug 15 15:56:29 testsvr.loc xendomains[2895]: libxl: error:
libxl.c:1342:domain_destroy_callback: unable to destroy guest with domid
1
Aug 15 15:56:29 testsvr.loc xendomains[2895]: libxl: error:
libxl_create.c:1209:domcreate_destruction_cb: unable to destroy domain 1
following failed creation
Aug 15 15:56:29 testsvr.loc xendomains[2895]: An error occurred while
creating domain test1.cfg:
Aug 15 15:56:29 testsvr.loc xendomains[2895]: !
Aug 15 15:56:29 testsvr.loc xendomains[2895]: test2.cfgDomain name must
be specified.
Aug 15 15:56:29 testsvr.loc xendomains[2895]: libxl: error:
libxl_xshelp.c:134:libxl__xs_get_dompath: failed to get dompath for 2:
Bad file descriptor
Aug 15 15:56:29 testsvr.loc xendomains[2895]: libxl: error:
libxl_create.c:644:initiate_domain_create: cannot make domain: -3
Aug 15 15:56:29 testsvr.loc xendomains[2895]: libxl: error:
libxl_xshelp.c:134:libxl__xs_get_dompath: failed to get dompath for 2:
Bad file descriptor
Aug 15 15:56:29 testsvr.loc xendomains[2895]: libxl: error:
libxl_xshelp.c:134:libxl__xs_get_dompath: failed to get dompath for 2:
Bad file descriptor
Aug 15 15:56:29 testsvr.loc xendomains[2895]: libxl: error:
libxl.c:1342:domain_destroy_callback: unable to destroy guest with domid
2
Aug 15 15:56:29 testsvr.loc xendomains[2895]: libxl: error:
libxl_create.c:1209:domcreate_destruction_cb: unable to destroy domain 2
following failed creation
Aug 15 15:56:29 testsvr.loc xendomains[2895]: An error occurred while
creating domain test2.cfg:
Aug 15 15:56:29 testsvr.loc xendomains[2895]: !
Aug 15 15:56:29 testsvr.loc xendomains[2895]: ..done
Aug 15 15:56:29 testsvr.loc systemd[1]: Started Xendomains - start and
stop Xen VMs on boot and shutdown.

2), 
changing

	edit /etc/sysconfig/kernel
	-       DOMU_INITRD_MODULES="xennet xenblk"
	+       DOMU_INITRD_MODULES="xennet xenblk evtchn"

then

	mkinitrd
	reboot

now,

	lsmod | grep evt
		evtchn                 13162  1 

bug NO guests

	xl list
		Name                                        ID   Mem
		VCPUs      State   Time(s)
		(null)                                       0  1280    
		4     r-----      38.2

checking

	journalctl -b | egrep -i "xen|evt"
		...
		Aug 15 16:28:09 testsvr.loc xendomains[2924]: Starting
		auto Xen domains: test1.cfglibxl: error:
		libxl_bootloader.c:364:libxl__bootloader_run: failed to
		create bootloader dir /var/run/xen/bootloader.1.d: No
		such file or directory
		Aug 15 16:28:09 testsvr.loc xendomains[2924]: libxl:
		error: libxl_create.c:900:domcreate_rebuild_done: cannot
		(re-)build domain: -3
		Aug 15 16:28:09 testsvr.loc xendomains[2924]: An error
		occurred while creating domain test1.cfg:
		Aug 15 16:28:09 testsvr.loc xendomains[2924]: !
		Aug 15 16:28:09 testsvr.loc xendomains[2924]:
		test2.cfglibxl: error:
		libxl_bootloader.c:364:libxl__bootloader_run: failed to
		create bootloader dir /var/run/xen/bootloader.2.d: No
		such file or directory
		Aug 15 16:28:09 testsvr.loc xendomains[2924]: libxl:
		error: libxl_create.c:900:domcreate_rebuild_done: cannot
		(re-)build domain: -3
		Aug 15 16:28:09 testsvr.loc xendomains[2924]: An error
		occurred while creating domain test2.cfg:
		Aug 15 16:28:09 testsvr.loc xendomains[2924]: !
		Aug 15 16:28:09 testsvr.loc xendomains[2924]: ..done
		Aug 15 16:28:09 testsvr.loc systemd[1]: Started
		Xendomains - start and stop Xen VMs on boot and
		shutdown.

and

	ls -al /var/run/xen/
		ls: cannot access /var/run/xen/: No such file or
		directory


i suspsect you'll need, at least, some form of

	cat /etc/tmpfiles.d/xendomains.conf
		D /var/run/xen      0755 root root -   ('root' user
		correct here?)

and

	systemd-tmpfiles --create /etc/tmpfiles.d/xendomains.conf

on install

3), 
doing

    edit /etc/tmpfiles.d/xendomains.conf
        D /var/run/xen      0755 root root -

    systemd-tmpfiles --create /etc/tmpfiles.d/xendomains.conf

here, does the trick.  after reboot,

  xl list
    Name                                        ID   Mem VCPUs     
    State   Time(s)
    (null)                                       0  1269     4    
    r-----      43.7
    test1                                        1  1024     2    
    -b----       7.7
    test2                                        2  1024     4    
    -b----      28.6

and back to full function.

still have that "(null") rather than Dom0 in its Name, but doesn't
appear (yet) to have any detrimental effect on function
-- 
To unsubscribe, e-mail: opensuse-virtual+unsubscribe@opensuse.org
To contact the owner, e-mail: opensuse-virtual+owner@opensuse.org

13:42 2013-08-16
mkdir sda5_rd sles11_sp2_home vm Downloads_new sda3/home /var/lib/xen/images_2 -p

17:37 2013-08-16
sun6i, kernel, upstream, device tree(dtb)
1, 
CONFIG_ARM_APPENDED_DTB=y
CONFIG_ARM_ATAG_DTB_COMPAT=y
CONFIG_ARM_ATAG_DTB_COMPAT_CMDLINE_FROM_BOOTLOADER=y

enable early printk:
CONFIG_DEBUG_LL=y
CONFIG_DEBUG_SUNXI_UART0=y
CONFIG_DEBUG_LL_INCLUDE="debug/sunxi.S"
CONFIG_DEBUG_UNCOMPRESS=y
CONFIG_UNCOMPRESS_INCLUDE="debug/uncompress.h"
CONFIG_EARLY_PRINTK=y

2, log, wrong r1:
i got the following message: 
U-Boot 2011.09-rc1-00001-g8f3ca1c-dirty (Apr 23 2013 - 15:07:05) Allwinner Technology 

CPU:   SUNXI Family
Board: SUN6I
DRAM:  2 GiB
MMC:   SUNXI SD/MMC: 0
In:    serial
Out:   serial
Err:   serial
MMC: block number 0x72a004 exceeds max(0x1e4600)
bootcmd set setargs_mmc
Hit any key to stop autoboot:  0 
sunxi#setenv fdt_high ffffffff
sunxi#fatload mmc 0:2 0x48000000 uImage
reading uImage

2864928 bytes read
sunxi#bootm 48000000
## Booting kernel from Legacy Image at 48000000 ...
   Image Name:   
   Image Type:   ARM Linux Kernel Image (uncompressed)
   Data Size:    2864864 Bytes = 2.7 MiB
   Load Address: 40008000
   Entry Point:  40008000
   Verifying Checksum ... OK
   Loading Kernel Image ... OK
OK
[      31.726]

Starting kernel ...

Uncompressing Linux... done, booting the kernel.

Error: unrecognized/unsupported machine ID (r1 = 0x00000f34).

Available machine support:

ID (hex)        NAME
ffffffff        Generic DT based system
ffffffff        Allwinner A1X (Device Tree)

Please check your kernel config and/or bootloader.

the kernel commit is cc5d8a7c.

3, i forget to append the dtb
linux> cd arch/arm/boot/
boot> cat zImage dts/sun6i-a31
sun6i-a31-colombus.dtb  sun6i-a31-colombus.dts  sun6i-a31.dtsi
boot> cat zImage dts/sun6i-a31-colombus.dtb > zImage_dtb
boot> cd ..
arm> cd ..
arch> cd ..
linux> mkimage -A arm -O linux -T kernel -C none -a 0x40008000 -e 0x40008000 -d arch/arm/boot/zImage_dtb arch/arm/boot/uImage_dtb
Image Name:   
Created:      Fri Aug 16 17:58:06 2013
Image Type:   ARM Linux Kernel Image (uncompressed)
Data Size:    2868027 Bytes = 2800.81 kB = 2.74 MB
Load Address: 40008000
Entry Point:  40008000

kernel boot ok:
U-Boot 2011.09-rc1-00001-g8f3ca1c-dirty (Apr 23 2013 - 15:07:05) Allwinner Technology 

CPU:   SUNXI Family
Board: SUN6I
DRAM:  2 GiB
MMC:   SUNXI SD/MMC: 0
In:    serial
Out:   serial
Err:   serial
MMC: block number 0x72a004 exceeds max(0x1e4600)
bootcmd set setargs_mmc
Hit any key to stop autoboot:  0 
sunxi#
sunxi#
sunxi#fatload mmc 0:2 48000000 uImage_dtb
reading uImage_dtb

2868091 bytes read
sunxi#setenv fdt_high ffffffff
sunxi#bootm 48000000
## Booting kernel from Legacy Image at 48000000 ...
   Image Name:   
   Image Type:   ARM Linux Kernel Image (uncompressed)
   Data Size:    2868027 Bytes = 2.7 MiB
   Load Address: 40008000
   Entry Point:  40008000
   Verifying Checksum ... OK
   Loading Kernel Image ... OK
OK
[      34. 34]

Starting kernel ...

Uncompressing Linux... done, booting the kernel.
[    0.000000] Booting Linux on physical CPU 0x0
[    0.000000] Linux version 3.11.0-rc4-12838-gcc5d8a7-dirty (bamvor@linux-rd.site) (gcc version 4.8.1 20130401 (prerelease) (crosstool-NG linaro-1.13.1-4.8-2013.04-20130417 - Linaro GCC 2013.04) ) #3 SMP Fri Aug 16 17:34:07 CST 2013
[    0.000000] CPU: ARMv7 Processor [410fc073] revision 3 (ARMv7), cr=10c5387d
[    0.000000] CPU: PIPT / VIPT nonaliasing data cache, VIPT aliasing instruction cache
[    0.000000] Machine: Allwinner A1X (Device Tree), model: WITS A31 Colombus Evaluation Board
[    0.000000] bootconsole [earlycon0] enabled
[    0.000000] Memory policy: ECC disabled, Data cache writealloc
[    0.000000] PERCPU: Embedded 5 pages/cpu @c182b000 s7104 r0 d13376 u32768
[    0.000000] Built 1 zonelists in Zone order, mobility grouping on.  Total pages: 522768
[    0.000000] Kernel command line: earlyprintk console=ttyS0,115200
[    0.000000] PID hash table entries: 4096 (order: 2, 16384 bytes)
[    0.000000] Dentry cache hash table entries: 131072 (order: 7, 524288 bytes)
[    0.000000] Inode-cache hash table entries: 65536 (order: 6, 262144 bytes)
[    0.000000] Memory: 2074076K/2097152K available (4184K kernel code, 201K rwdata, 892K rodata, 190K init, 243K bss, 23076K reserved, 1318912K highmem)
[    0.000000] Virtual kernel memory layout:
[    0.000000]     vector  : 0xffff0000 - 0xffff1000   (   4 kB)
[    0.000000]     fixmap  : 0xfff00000 - 0xfffe0000   ( 896 kB)
[    0.000000]     vmalloc : 0xf0000000 - 0xff000000   ( 240 MB)
[    0.000000]     lowmem  : 0xc0000000 - 0xef800000   ( 760 MB)
[    0.000000]     pkmap   : 0xbfe00000 - 0xc0000000   (   2 MB)
[    0.000000]       .text : 0xc0008000 - 0xc04fd29c   (5077 kB)
[    0.000000]       .init : 0xc04fe000 - 0xc052dbc0   ( 191 kB)
[    0.000000]       .data : 0xc052e000 - 0xc0560600   ( 202 kB)
[    0.000000]        .bss : 0xc0560600 - 0xc059d3d4   ( 244 kB)
[    0.000000] SLUB: HWalign=64, Order=0-3, MinObjects=0, CPUs=4, Nodes=1
[    0.000000] Hierarchical RCU implementation.
[    0.000000] NR_IRQS:16 nr_irqs:16 16
[    0.000000] sched_clock: 32 bits at 24MHz, resolution 41ns, wraps every 178956ms
[    0.000000] Console: colour dummy device 80x30
[    0.004720] Calibrating delay loop... 2007.04 BogoMIPS (lpj=10035200)
[    0.062979] pid_max: default: 32768 minimum: 301
[    0.067813] Mount-cache hash table entries: 512
[    0.074063] CPU: Testing write buffer coherency: ok
[    0.079751] /cpus/cpu@0 missing clock-frequency property
[    0.085680] /cpus/cpu@1 missing clock-frequency property
[    0.091079] /cpus/cpu@2 missing clock-frequency property
[    0.096980] /cpus/cpu@3 missing clock-frequency property
[    0.102383] CPU0: thread -1, cpu 0, socket 0, mpidr 80000000
[    0.108147] Setting up static identity map for 0xc03f99e0 - 0xc03f9a38
[    0.116226] CPU1: failed to boot: -38
[    0.120589] CPU2: failed to boot: -38
[    0.124914] CPU3: failed to boot: -38
[    0.128665] Brought up 1 CPUs
[    0.132009] SMP: Total of 1 processors activated (2007.04 BogoMIPS).
[    0.138437] CPU: All CPU(s) started in SVC mode.
[    0.143717] devtmpfs: initialized
[    0.150720] pinctrl core: initialized pinctrl subsystem
[    0.156294] regulator-dummy: no parameters
[    0.160724] NET: Registered protocol family 16
[    0.165866] DMA: preallocated 256 KiB pool for atomic coherent allocations
[    0.177614] bio: create slab <bio-0> at 0
[    0.182573] SCSI subsystem initialized
[    0.187033] usbcore: registered new interface driver usbfs
[    0.192640] usbcore: registered new interface driver hub
[    0.198595] usbcore: registered new device driver usb
[    0.204423] pps_core: LinuxPPS API ver. 1 registered
[    0.209934] pps_core: Software ver. 5.3.6 - Copyright 2005-2007 Rodolfo Giometti <giometti@linux.it>
[    0.219158] PTP clock support registered
[    0.223194] EDAC MC: Ver: 3.0.0
[    0.227395] Switched to clocksource timer
[    0.238540] NET: Registered protocol family 2
[    0.243874] TCP established hash table entries: 8192 (order: 4, 65536 bytes)
[    0.251150] TCP bind hash table entries: 8192 (order: 4, 65536 bytes)
[    0.257787] TCP: Hash tables configured (established 8192 bind 8192)
[    0.264270] TCP: reno registered
[    0.267911] UDP hash table entries: 512 (order: 2, 16384 bytes)
[    0.274544] UDP-Lite hash table entries: 512 (order: 2, 16384 bytes)
[    0.281239] NET: Registered protocol family 1
[    0.285975] RPC: Registered named UNIX socket transport module.
[    0.291997] RPC: Registered udp transport module.
[    0.296779] RPC: Registered tcp transport module.
[    0.302031] RPC: Registered tcp NFSv4.1 backchannel transport module.
[    0.310097] bounce pool size: 64 pages
[    0.321059] NFS: Registering the id_resolver key type
[    0.326753] Key type id_resolver registered
[    0.331450] Key type id_legacy registered
[    0.335769] Block layer SCSI generic (bsg) driver version 0.4 loaded (major 251)
[    0.343259] io scheduler noop registered
[    0.347262] io scheduler deadline registered
[    0.351754] io scheduler cfq registered (default)
[    0.357916] sunxi-pinctrl 1c20800.pinctrl: initialized sunXi PIO driver
[    0.406371] Serial: 8250/16550 driver, 4 ports, IRQ sharing disabled
[    0.434326] 1c28000.serial: ttyS0 at MMIO 0x1c28000 (irq = 32) is a U6_16550A
[    0.442264] console [ttyS0] enabled, bootconsole disabled
[    0.442264] console [ttyS0] enabled, bootconsole disabled
[    0.453953] serial: Freescale lpuart driver
[    0.458324] [drm] Initialized drm 1.1.0 20060810
[    0.463517] ehci_hcd: USB 2.0 'Enhanced' Host Controller (EHCI) Driver
[    0.470053] ehci-platform: EHCI generic platform driver
[    0.475417] usbcore: registered new interface driver usb-storage
[    0.481832] mousedev: PS/2 mouse device common for all mice
[    0.487724] sdhci: Secure Digital Host Controller Interface driver
[    0.493894] sdhci: Copyright(c) Pierre Ossman
[    0.498268] sdhci-pltfm: SDHCI platform and OF driver helper
[    0.504284] usbcore: registered new interface driver usbhid
[    0.509864] usbhid: USB HID core driver
[    0.513908] TCP: cubic registered
[    0.517757] NET: Registered protocol family 10
[    0.522824] sit: IPv6 over IPv4 tunneling driver
[    0.528077] Key type dns_resolver registered
[    0.532411] VFP support v0.3: implementor 41 architecture 2 part 30 variant 7 rev 3
[    0.540110] Registering SWP/SWPB emulation handler
[    0.545501] drivers/rtc/hctosys.c: unable to open rtc device (rtc0)
[    0.552456] VFS: Cannot open root device "(null)" or unknown-block(0,0): error -6
[    0.559949] Please append a correct "root=" boot option; here are the available partitions:
[    0.568302] Kernel panic - not syncing: VFS: Unable to mount root fs on unknown-block(0,0)
[    0.576558] CPU: 0 PID: 1 Comm: swapper/0 Not tainted 3.11.0-rc4-12838-gcc5d8a7-dirty #3
[    0.584674] [<c00144a8>] (unwind_backtrace+0x0/0xf4) from [<c00113f0>] (show_stack+0x10/0x14)
[    0.593198] [<c00113f0>] (show_stack+0x10/0x14) from [<c03f57b4>] (dump_stack+0x84/0x94)
[    0.601287] [<c03f57b4>] (dump_stack+0x84/0x94) from [<c03f32cc>] (panic+0xa4/0x1f4)
[    0.609028] [<c03f32cc>] (panic+0xa4/0x1f4) from [<c04ff0c8>] (mount_block_root+0x1a0/0x230)
[    0.617459] [<c04ff0c8>] (mount_block_root+0x1a0/0x230) from [<c04ff260>] (mount_root+0x108/0x110)
[    0.626410] [<c04ff260>] (mount_root+0x108/0x110) from [<c04ff3c0>] (prepare_namespace+0x158/0x19c)
[    0.635448] [<c04ff3c0>] (prepare_namespace+0x158/0x19c) from [<c04fed84>] (kernel_init_freeable+0x1cc/0x1dc)
[    0.645353] [<c04fed84>] (kernel_init_freeable+0x1cc/0x1dc) from [<c03f267c>] (kernel_init+0xc/0x160)
[    0.654565] [<c03f267c>] (kernel_init+0xc/0x160) from [<c000e0b8>] (ret_from_fork+0x14/0x3c)

4, reply to M
Hi Maxime, 

thanks your reply.
> Hi Bamvor,
> 
> On Thu, Aug 15, 2013 at 07:12:42AM -0600, Bamvor Jian Zhang wrote:
> > this is Bamvor Jian Zhang. currently, i work on port xen to sun6i. and
> > i need a upstream kernel for sun6i.
> 
> Cool :)
> 
> > i have had ping u at linux-sunxi in freenode last week,
> 
> Sorry about that. I'm currently on holidays, hence why I probably didn't
> see your ping.
> 
> > and got your github branch for sun6i
> > (https://github.com/mripard/linux/tree/sunxi-next-a31). I also
> > saw your A31 patch sent to linux-arm.  which one should i use for boot
> > sun6i kernel?
> 
> The github branch you picked is the latest I sent to the ML.
> 
> > i test your patch in my mele M9 box(A31 with 2G memory). but i fail on
> > u-boot loading kernel.
> 
> How so ?
> 
> What is the error from the kernel? What configuration did you use? Which
> device tree did you use? How do you load the kernel and device tree
> images?
> 
> > i am not sure if the u-boot ship with my box is too old to using the
> > dtb and kernel.
> 
> I can't answer that question. You can always use CONFIG_ARM_APPENDED_DTB
> if your u-boot is too old.
> 
> > So, could u do me a favor to give me some instruction about how to
> > boot your kernel, including proper u-boot, cmdline and filesystem.
> 
> http://linux-sunxi.org/Mainline_Kernel_Howto
after, append dtb to kernel and i could boot kernel to mounting filesystem.
thanks your help!

i will try to make a initramfs image. do u have some prebuild kernel and fs image for 
testing?
> 
> > BTW: do i need to use fex for booting your kernel?
> 
> No. We don't and never will support fex. We use device tree just like
> any other ARM platform.
got it. do u plan add some peripheral for A31, e.g. sd, usb...
currenly, i want to make xen dom0 bootup. after this, i'd like to do some sun6i driver
work. if there is a some sort of task list, i could know which one i could do.

regards

bamvor
> 
> Maxime
> 
> -- 
> Maxime Ripard, Free Electrons
> Embedded Linux, Kernel and Android engineering
> http://free-electrons.com

5, try build root
http://buildroot.uclibc.org/
http://blog.csdn.net/youyudehexie/article/details/7583657

6, (16:21 2013-08-20)
Maxime_reply_20130817_0236
Hi Bamvor,

On Fri, Aug 16, 2013 at 04:11:58AM -0600, Bamvor Jian Zhang wrote:
> > > So, could u do me a favor to give me some instruction about how to
> > > boot your kernel, including proper u-boot, cmdline and filesystem.
> > 
> > http://linux-sunxi.org/Mainline_Kernel_Howto
> after, append dtb to kernel and i could boot kernel to mounting
> filesystem.  thanks your help!

Great, you're welcome :)

> i will try to make a initramfs image. do u have some prebuild kernel
> and fs image for testing?

I don't have a kernel image here, but you can find an initramfs image I
use here

http://free-electrons.com/~maxime/pub/uInitrd

> > > BTW: do i need to use fex for booting your kernel?
> > 
> > No. We don't and never will support fex. We use device tree just like
> > any other ARM platform.
> got it. do u plan add some peripheral for A31, e.g. sd, usb...

Yes, of course. I've been busy working on the A20/A31 bringup the last
monthes, but as soon as these patches are merged, I'll work on
supporting new IPs, probably MMC in priority.

> currenly, i want to make xen dom0 bootup. after this, i'd like to do
> some sun6i driver work. if there is a some sort of task list, i could
> know which one i could do.

http://linux-sunxi.org/Mainlining_Effort

Maxime

-- 
Maxime Ripard, Free Electrons
Embedded Linux, Kernel and Android engineering
http://free-electrons.com

22:47 2013-08-16
software skill, arm, hard float point
the last line mean this is a Hard Float Point binary.
arm-linux-gnueabihf-readelf -a busybox
  Tag_FP_arch: VFPv3-D16
  Tag_ABI_FP_denormal: Needed
  Tag_ABI_FP_exceptions: Needed
  Tag_ABI_FP_number_model: IEEE 754
  Tag_ABI_HardFP_use: SP and DP
  Tag_ABI_VFP_args: VFP registers

09:48 2013-08-19
GTD
0, 9:35-18:10

1, today
1), disable disgest mode for virtualiation-xxx list.
2), 10:06-11:31 12:29-13:20 14:49-18:07 ao_how. see"10:06 2013-08-19"
3), build common kernel and initramfs for sun6i and exynos5250. on obs?

10:06 2013-08-19
virtualization, xen, libxl, async, try ao_how, cont2, debug save, cont6, debug
1, current status:
1), using ao mode save 
save with error?
# virsh save bjz_04_sles11_sp2 bjz_04_sles11_sp2.save 
error: Failed to save domain bjz_04_sles11_sp2 to bjz_04_sles11_sp2.save
error: internal error Failed to save domain '4' with libxenlight
2), restore: domain id is 0 after restore.

2, save hang.
libxl: error: libxl_exec.c:129:libxl_report_child_exitstatus: domain 3 save/restore helper [3129] died due to fatal signal Unknown signal 120 (core dumped)
libxl: debug: libxl_event.c:1569:libxl__ao_complete: ao 0x7ff82c0017d0: complete, rc=-3
libxl: debug: libxl_event.c:1541:libxl__ao__destroy: ao 0x7ff82c0017d0: destroy
libxl: debug: libxl_event.c:1154:egc_run_callbacks: event 0x7ff848d4fcc0 callback type=operation_complete
libxl: debug: libxl.c:1251:libxl_domain_destroy: ao 0x7ff82c001940: create: how=(nil) callback=(nil) poller=0x7ff80c003a00
libxl: debug: libxl_dm.c:1321:libxl__destroy_device_model: Device Model signaled
libxl: debug: libxl_event.c:559:libxl__ev_xswatch_register: watch w=0x7ff82c001dd8 wpath=/local/domain/0/backend/vbd/3/768/state token=2/4: register slotnum=2
libxl: debug: libxl_event.c:559:libxl__ev_xswatch_register: watch w=0x7ff82c002608 wpath=/local/domain/0/backend/vif/3/0/state token=1/5: register slotnum=1
libxl: debug: libxl.c:1260:libxl_domain_destroy: ao 0x7ff82c001940: inprogress: poller=0x7ff80c003a00, flags=i
libxl: debug: libxl_event.c:503:watchfd_callback: watch w=0x7ff82c001dd8 wpath=/local/domain/0/backend/vbd/3/768/state token=2/4: event epath=/local/domain/0/backend/vbd/3/768/state
libxl: debug: libxl_event.c:643:devstate_watch_callback: backend /local/domain/0/backend/vbd/3/768/state wanted state 6 ok
libxl: debug: libxl_event.c:596:libxl__ev_xswatch_deregister: watch w=0x7ff82c001dd8 wpath=/local/domain/0/backend/vbd/3/768/state token=2/4: deregister slotnum=2
libxl: debug: libxl_event.c:608:libxl__ev_xswatch_deregister: watch w=0x7ff82c001dd8: deregister unregistered
libxl: debug: libxl_device.c:959:device_hotplug: calling hotplug script: /etc/xen/scripts/block remove
libxl: debug: libxl_event.c:472:watchfd_callback: watch epath=/local/domain/0/backend/vbd/3/768/state token=2/4: empty slot
libxl: debug: libxl_event.c:503:watchfd_callback: watch w=0x7ff82c002608 wpath=/local/domain/0/backend/vif/3/0/state token=1/5: event epath=/local/domain/0/backend/vif/3/0/state
libxl: debug: libxl_event.c:647:devstate_watch_callback: backend /local/domain/0/backend/vif/3/0/state wanted state 6 still waiting state 5
libxl: debug: libxl_event.c:503:watchfd_callback: watch w=0x7ff82c002608 wpath=/local/domain/0/backend/vif/3/0/state token=1/5: event epath=/local/domain/0/backend/vif/3/0/state
libxl: debug: libxl_event.c:643:devstate_watch_callback: backend /local/domain/0/backend/vif/3/0/state wanted state 6 ok
libxl: debug: libxl_event.c:596:libxl__ev_xswatch_deregister: watch w=0x7ff82c002608 wpath=/local/domain/0/backend/vif/3/0/state token=1/5: deregister slotnum=1
libxl: debug: libxl_event.c:608:libxl__ev_xswatch_deregister: watch w=0x7ff82c002608: deregister unregistered
libxl: debug: libxl_device.c:959:device_hotplug: calling hotplug script: /etc/xen/scripts/vif-bridge offline
libxl: debug: libxl_device.c:995:device_hotplug_timeout_cb: killing hotplug script /etc/xen/scripts/block remove because of timeout
libxl: debug: libxl_device.c:995:device_hotplug_timeout_cb: killing hotplug script /etc/xen/scripts/vif-bridge offline because of timeout

1), it seems that missing some between libxl_report_child_exitstatus, libxl_domain_destroy.
2), tracing with GDB. 
123538_356650844
#0  libxl__self_pipe_wakeup (fd=37) at libxl_event.c:1360
#1  0x00007f917d7fad36 in sigchld_handler (signo=<optimized out>) at libxl_fork.c:160
#2  <signal handler called>
#3  0x00007fffd1bff698 in gettimeofday ()
#4  0x00007f917d7f7e66 in libxl__gettimeofday (gc=0x7f91840e9810, 
    now_r=<optimized out>) at libxl_event.c:246
#5  0x00007f917d7f969e in eventloop_iteration (egc=egc@entry=0x7f91840e9810, 
    poller=0x7f914c0049b0) at libxl_event.c:1401
#6  0x00007f917d7fa8f5 in libxl__ao_inprogress (ao=ao@entry=0x7f9154000930, 
    file=file@entry=0x7f917d805952 "libxl.c", line=line@entry=1260, 
    func=func@entry=0x7f917d8079b0 <__func__.16595> "libxl_domain_destroy")
    at libxl_event.c:1685
#7  0x00007f917d7d338e in libxl_domain_destroy (ctx=0x7f914c002850, domid=4, 
    ao_how=ao_how@entry=0x0) at libxl.c:1260
#8  0x00007f917da5e212 in libxlVmReap (driver=0x7f91740931c0, vm=0x7f914c002cc0, 
    reason=VIR_DOMAIN_SHUTOFF_SAVED) at libxl/libxl_driver.c:704

libxl_childproc_setmode

3, device_hotplug

4, create, save, destroy, restore successful. after disable libxl_childproc_reaped enter twice.
static void
libxl_sigchld_callback(int watch ATTRIBUTE_UNUSED,
                     int fd ATTRIBUTE_UNUSED,
                     int vir_events,
                     void *fd_info)
{
    sigchild_info *info = fd_info;
    int rc;

    if (1 == info->called)
        return;

    info->called = 1;
    VIR_INFO("vir_events: %d", vir_events);
    VIR_INFO("libxl_childproc_reaped pid: %d", info->pid);
    rc = libxl_childproc_reaped(info->ctx, info->pid, info->status);
    VIR_INFO("libxl_childproc_reaped rc: %d", rc);

}

5, \TODO: test other ao and try callbacks.

18:23 2013-8-19
arm, summary
0, collecting a picture for popular arm device.
1), preface
arm is a active architecture(x86, mips, arm...), not 51.
1, introduction
1), history
(1), different arm arch and cpu for different market.
(2), compare with arm and x86: for the lastest arm evolution.
2), arm ecosystem.
(1), android push the hardware update and ecosystem grow up.
2, programming model.
1), instruction
2), exception 
3), mmu
4), debug
5), about pc. \TODO: pc+4, pc+8?
3, support for os
1), bitops: mutex...
\TODO check the book.
4, virtualization
psci.

13:33 2013-08-20
company, colleague, L3, L3 Technical Coordinator, Milan Vančura
"Petr Uzel <petr.uzel@suse.cz>"
Dear colleagues,

It is my pleasure to announce that Milan Vančura takes the role
of L3 Technical Coordinator.

In this role, Milan will be responsible for technical requirements of L3
support. He will be the interface for project managers and autobuild team
to discuss L3 requirement towards:
- packages building
- product configurations in IBS
- product metadata

Milan stays in the L3 team and continues reporting to me.

Please join me in congratulating Milan to his new role and offering
him full support for his work.




Thanks,

        Petr

-- 
Petr Uzel
Team Lead SUSE L3 Team, Prague

14:18 2013-08-20
product, suse, sle11sp3, virtualization, features
https://wiki.innerweb.novell.com/index.php/SLE11_SP3_VT_feature

14:41 2013-08-20
(17:56 2013-08-27)
blog, sun6i, kernel, upstream
write blog about how to boot A31 upstream kernel on Mele M9.
http://xen_on_arm.farbox.com/post/mele_m9_upstream_kernel

title: boot upstream kernel on A31(Mele M9)

# build kernel
there is a [howto](http://linux-sunxi.org/Mainline_Kernel_Howto) describe how to use the upstream kernel for Allwinner SOC. it could be apply to A31(sun6i) too.

after contacts with Maxime, i got the lastest code for [A31](https://github.com/mripard/linux/tree/sunxi-next-a31).

all the allwinner SOC support the arm multi-platform, so i could use multi_v7_defconfig for kernel:

    ARCH=arm make multi_v7_defconfig

the u-boot is got from Mele m9 update image, which does not support device tree. So, i need enable the append dtb:
CONFIG_ARM_APPENDED_DTB=y

    ARCH=arm CROSS_COMPILE=arm-linux-gnueabihf- make
    ARCH=arm CROSS_COMPILE=arm-linux-gnueabihf- make dtbs

generate the uImage including device tree blob:

    cat arch/arm/boot/zImage arch/arm/boot/dts/sun6i-a31-colombus.dtb > arch/arm/boot/zImage_dtb
    mkimage -A arm -O linux -T kernel -C none -a 0x40008000 -e 0x40008000 -d arch/arm/boot/zImage_dtb arch/arm/boot/uImage_dtb

if the u-boot is the lastest one, only one comamnd is necessary:

    ARCH=arm CROSS_COMPILE=arm-linux-gnueabihf- LOADADDR=0x40008000 make uImage dtbs

# build rootfs
[buildroot](http://buildroot.uclibc.org/)

# u-boot commands

# references: 
1, [official website](linux-sunxi.org)
2, [Allwinner Axx SOC mainline status](http://linux-sunxi.org/Mainlining_Effort)



16:47 2013-08-20
sun6i, kernel, upstream, investigate the eabi
1, buildroot
> arm-linux-gnueabihf-readelf -a bin/busybox |grep FP
  Tag_FP_arch: VFPv3-D16
  Tag_ABI_FP_denormal: Needed
  Tag_ABI_FP_exceptions: Needed
  Tag_ABI_FP_number_model: IEEE 754
  Tag_ABI_HardFP_use: SP and DP
  Tag_ABI_VFP_args: VFP registers

2, Maxime:
> arm-linux-gnueabihf-readelf -a bin/busybox |grep FP
  Tag_ABI_FP_denormal: Needed
  Tag_ABI_FP_exceptions: Needed
  Tag_ABI_FP_number_model: IEEE 754

3, opensuse arm initrd
bamvor@linux-rd:bin> arm-linux-gnueabihf-readelf -a bash |grep FP
  Tag_FP_arch: VFPv3-D16
  Tag_ABI_FP_rounding: Needed
  Tag_ABI_FP_denormal: Needed
  Tag_ABI_FP_exceptions: Needed
  Tag_ABI_FP_number_model: IEEE 754
  Tag_ABI_HardFP_use: SP and DP
  Tag_ABI_VFP_args: VFP registers

4, initrd from opensuse for cubieboard, seems also work:
although only one line print after free memory, i think it is printed from filesytem.
[    0.886147] Freeing unused kernel memory: 188K (c04fe000 - c052d000)
[    4.058261] systemd-udevd[80]: starting version 195

5, todo:
1), ref: http://linux-sunxi.org/Buildroot for buildroot.
2), try build seperate hf file and test it on maxime fs.

18:15 2013-08-20
GTD
0, 10:40-18:15

1, 3h write a blog about how to build upstream kernel for A31. see"14:41 2013-08-20"

18:36 2013-08-21
hi, maxime


with your initrd, i could boot into.
few question:
it is not a hf filesystem. while in the default kernel, vfp enable. should use hf fs for it?
but the buildroot fs fail on A31. which is hf.

btw: i am writing a blog about how to boot upstream kernel for A31. hope it could help other guys.

13:02 2013-08-21
GTD
0, 12:30

1, today
1), 30' lunch.
2), 13:36- try hf fs on sun6i. see"13:36 2013-08-21"

13:36 2013-08-21
1, buildroot for cubie
http://linux-sunxi.org/Buildroot
mkdir cubie && cd cubie
git clone https://github.com/matson-hall/allwinner-buildroot.git -b cubieboard
git clone https://github.com/matson-hall/allwinner-pack-tools.git -b cubieboard
git clone https://github.com/matson-hall/linux-sunxi.git -b cubieboard linux-allwinner

./allwinner-pack-tools/bin/build.sh

2, add some binary to maxime initrd
mkimage -A arm -T ramdisk -C none -n "uInitrd" -d rootfs.cpio uInitrd

09:27 2013-08-22
GTD
0, 9:25-18:20

1, today
1), 10' plan
2), write doc about how to debug arm kernel crash. see"09:35 2013-08-22"
3), download maxime uInitrd and try again. make new bootable sd.
4), try callback in ao_how.

09:35 2013-08-22
1, 
Uncompressing Linux... done, booting the kernel.
[    0.000000] Booting Linux on physical CPU 0x0
[    0.000000] Linux version 3.11.0-rc4-12838-gcc5d8a7-dirty (bamvor@linux-rd.site) (gcc version 4.8.1 20130401 (prerelease) (crosstool-NG linaro-1.13.1-4.8-2013.04-20130417 - Linaro GCC 2013.04) ) #9 SMP Wed Aug 21 18:07:21 CST 2013
[    0.000000] CPU: ARMv7 Processor [410fc073] revision 3 (ARMv7), cr=10c5387d
[    0.000000] CPU: PIPT / VIPT nonaliasing data cache, VIPT aliasing instruction cache
[    0.000000] Machine: Allwinner A1X (Device Tree), model: WITS A31 Colombus Evaluation Board
[    0.000000] bootconsole [earlycon0] enabled
[    0.000000] Memory policy: ECC disabled, Data cache writealloc
setup_arch:944.
[    0.000000] setup_arch:944.
[    0.000000] Unhandled fault: alignment exception (0x001) at 0x00000051
[    0.000000] Internal error: : 1 [#1] SMP ARM
[    0.000000] CPU: 0 PID: 0 Comm: swapper Not tainted 3.11.0-rc4-12838-gcc5d8a7-dirty #9
[    0.000000] task: c055d280 ti: c0552000 task.ti: c0552000
[    0.000000] PC is at setup_arch+0x8c0/0x928
[    0.000000] LR is at setup_arch+0x8b8/0x928
[    0.000000] pc : [<c0520194>]    lr : [<c052018c>]    psr: 200001d3
[    0.000000] sp : c0553f80  ip : 00000001  fp : c055e078
[    0.000000] r10: c0564d70  r9 : c055e078  r8 : 00000004
[    0.000000] r7 : 00000003  r6 : c053fcac  r5 : c0588380  r4 : c055cfc0
[    0.000000] r3 : 00000051  r2 : c0563670  r1 : c0414468  r0 : 00007628
[    0.000000] Flags: nzCv  IRQs off  FIQs off  Mode SVC_32  ISA ARM  Segment kernel
[    0.000000] Control: 10c5387d  Table: 4000406a  DAC: 00000015
[    0.000000] Process swapper (pid: 0, stack limit = 0xc0552238)
[    0.000000] Stack: (0xc0553f80 to 0xc0554000)
[    0.000000] 3f80: 00000000 10c5387d 00000000 00000000 00000000 00000002 00000000 00000000
[    0.000000] 3fa0: c04a62d8 c0588100 00000001 00000000 ffffffff 4000406a 410fc073 00000000
[    0.000000] 3fc0: 00000000 c051d7fc 00000000 00000000 00000000 00000000 00000000 c0546058
[    0.000000] 3fe0: 00000000 10c5387d c055a40c c0546054 c055e188 40008074 00000000 00000000
[    0.000000] [<c0520194>] (setup_arch+0x8c0/0x928) from [<c051d7fc>] (start_kernel+0x8c/0x30c)
[    0.000000] [<c051d7fc>] (start_kernel+0x8c/0x30c) from [<40008074>] (0x40008074)
[    0.000000] Code: e3a02e3b ebfffd0d e3070628 e59f1060 (e1934f9f) 
[    0.000000] ---[ end trace 1b75b31a2719ed1c ]---
[    0.000000] Kernel panic - not syncing: Attempted to kill the idle task!
[    0.000000] Unable to handle kernel NULL pointer dereference at virtual address 00000000
[    0.000000] pgd = c0004000
[    0.000000] [00000000] *pgd=00000000
[    0.000000] Internal error: Oops: 80000005 [#2] SMP ARM
[    0.000000] CPU: 0 PID: 0 Comm: swapper Tainted: G      D      3.11.0-rc4-12838-gcc5d8a7-dirty #9
[    0.000000] task: c055d280 ti: c0552000 task.ti: c0552000
[    0.000000] PC is at 0x0
[    0.000000] LR is at __irq_svc+0x40/0x50
[    0.000000] pc : [<00000000>]    lr : [<c0011f40>]    psr: 200001d3
[    0.000000] sp : c0553d50  ip : 00000000  fp : c055d280
[    0.000000] r10: c04a77e0  r9 : c0588670  r8 : 00000000
[    0.000000] r7 : c0553d84  r6 : ffffffff  r5 : 60000153  r4 : c040c530
[    0.000000] r3 : c040c46c  r2 : c0553d98  r1 : c055e190  r0 : c0553d50
[    0.000000] Flags: nzCv  IRQs off  FIQs off  Mode SVC_32  ISA ARM  Segment kernel
[    0.000000] Control: 10c5387d  Table: 4000406a  DAC: 00000015
[    0.000000] Process swapper (pid: 0, stack limit = 0xc0552238)
[    0.000000] Stack: (0xc0553d50 to 0xc0554000)
[    0.000000] 3d40:                                     c058b0e0 00000000 c0563670 00000000
[    0.000000] 3d60: c0588670 c04aa28c 0000000b 00000000 00000000 c0588670 c04a77e0 c055d280
[    0.000000] 3d80: 00000000 c0553d98 c040c46c c040c530 60000153 ffffffff 00000000 c0553dcc
[    0.000000] 3da0: c058b9d6 0000000b c0552000 0000000b 00000001 c0552018 c0520198 c04a77e0
[    0.000000] 3dc0: c055d280 c001fca4 c04aa28c c0553dd8 00000000 c0552000 c0520198 c04a77e0
[    0.000000] 3de0: c05883c4 c040c9b0 c04aa04c c05636d8 00000000 c055e178 c0552000 0000000b
[    0.000000] 3e00: 00000001 c0520196 c0520198 c04a77e0 c05883c4 c0011648 c0552238 0000000b
[    0.000000] 3e20: 00000000 600001d3 c055e178 00000000 00000000 00000008 65000000 32306133
[    0.000000] 3e40: 20623365 66666265 64306466 30336520 32363037 35652038 30316639 28203036
[    0.000000] 3e60: 33393165 66396634 c0002029 c040c9b0 c04a87ac 00000001 00000007 c055e348
[    0.000000] 3e80: 00000051 c0553f38 c055e078 c0564d70 c055e078 c0008434 00000000 c0553f58
[    0.000000] 3ea0: 00000007 00000000 00030001 00000051 c185c86c 0000000e fffffffd c0326c24
[    0.000000] 3ec0: c0553f5c 0000002c 0000185d 00000001 c185c924 c0851d44 c0851d48 c0851d48
[    0.000000] 3ee0: c185c15c c0553f58 00000000 c08519f0 c0553f5c c185c86b c05bb304 600001d3
[    0.000000] 3f00: c185c640 c0324a98 00000004 00000001 c054acfc 00000001 c0852454 00000012
[    0.000000] 3f20: c0520194 200001d3 ffffffff c0553f6c 00000004 c0011ed8 00007628 c0414468
[    0.000000] 3f40: c0563670 00000051 c055cfc0 c0588380 c053fcac 00000003 00000004 c055e078
[    0.000000] 3f60: c0564d70 c055e078 00000001 c0553f80 c052018c c0520194 200001d3 ffffffff
[    0.000000] 3f80: 00000000 10c5387d 00000000 00000000 00000000 00000002 00000000 00000000
[    0.000000] 3fa0: c04a62d8 c0588100 00000001 00000000 ffffffff 4000406a 410fc073 00000000
[    0.000000] 3fc0: 00000000 c051d7fc 00000000 00000000 00000000 00000000 00000000 c0546058
[    0.000000] 3fe0: 00000000 10c5387d c055a40c c0546054 c055e188 40008074 00000000 00000000
[    0.000000] [<c0011f40>] (__irq_svc+0x40/0x50) from [<c040c530>] (panic+0x194/0x1f4)
[    0.000000] [<c040c530>] (panic+0x194/0x1f4) from [<c001fca4>] (do_exit+0x8c0/0x8c8)
[    0.000000] [<c001fca4>] (do_exit+0x8c0/0x8c8) from [<c0011648>] (die+0x210/0x3c4)
[    0.000000] [<c0011648>] (die+0x210/0x3c4) from [<c0008434>] (do_DataAbort+0x98/0x9c)
[    0.000000] [<c0008434>] (do_DataAbort+0x98/0x9c) from [<c0011ed8>] (__dabt_svc+0x38/0x60)
[    0.000000] Exception stack(0xc0553f38 to 0xc0553f80)
[    0.000000] 3f20:                                                       00007628 c0414468
[    0.000000] 3f40: c0563670 00000051 c055cfc0 c0588380 c053fcac 00000003 00000004 c055e078
[    0.000000] 3f60: c0564d70 c055e078 00000001 c0553f80 c052018c c0520194 200001d3 ffffffff
[    0.000000] [<c0011ed8>] (__dabt_svc+0x38/0x60) from [<c0520194>] (setup_arch+0x8c0/0x928)
[    0.000000] [<c0520194>] (setup_arch+0x8c0/0x928) from [<c051d7fc>] (start_kernel+0x8c/0x30c)
[    0.000000] [<c051d7fc>] (start_kernel+0x8c/0x30c) from [<40008074>] (0x40008074)
[    0.000000] Code: bad PC value
[    0.000000] ---[ end trace 1b75b31a2719ed1d ]---

pc = 1558(c98+8c0):
    1554:       e59f1060        ldr     r1, [pc, #96]   ; 15bc <init_machine_late+0xd5c>
    1558:       e1934f9f        ldrex   r4, [r3]
    155c:       e3400000        movt    r0, #0

while r3 = 00000051, which is not aligned to 4bytes. it will failed if aligned bit is disabled in cp15.

13:31 2013-08-22
arm, sun6i, kernel, debug how the initrd(rootfs) is mounted by kernel
1, check
drivers/of/fdt.c:#ifdef CONFIG_BLK_DEV_INITRD
drivers/of/fdt.c:#endif /* CONFIG_BLK_DEV_INITRD */
include/linux/of_fdt.h: * If BLK_DEV_INITRD, the fdt early init code will call this function,
include/linux/of_fdt.h:#ifdef CONFIG_BLK_DEV_INITRD
include/asm-generic/vmlinux.lds.h:#ifdef CONFIG_BLK_DEV_INITRD
include/config/auto.conf:CONFIG_BLK_DEV_INITRD=y
include/generated/autoconf.h:#define CONFIG_BLK_DEV_INITRD 1
init/Kconfig:config BLK_DEV_INITRD
init/Kconfig:if BLK_DEV_INITRD
init/main.c:#ifdef CONFIG_BLK_DEV_INITRD
init/do_mounts.h:#ifdef CONFIG_BLK_DEV_INITRD
init/Makefile:ifneq ($(CONFIG_BLK_DEV_INITRD),y)
init/Makefile:obj-$(CONFIG_BLK_DEV_INITRD)   += initramfs.o
init/Makefile:mounts-$(CONFIG_BLK_DEV_INITRD)   += do_mounts_initrd.o
kernel/sysctl.c:#ifdef CONFIG_BLK_DEV_INITRD
usr/Makefile:obj-$(CONFIG_BLK_DEV_INITRD) := initramfs_data.o
bamvor@linux-rd:linux> 
2, command line
root=/dev/ram0 rw ramdisk=8192 initrd=0x47000064,8M
3, 
U-Boot SPL 2013.04 (May 01 2013 - 21:05:26)
Board: Cubieboard
DRAM: 1024MB
SUNXI SD/MMC: 0


U-Boot 2013.04 (May 01 2013 - 21:05:26) Allwinner Technology

CPU:   SUNXI Family
Board: Cubieboard
I2C:   ready
DRAM:  1 GiB
MMC:   SUNXI SD/MMC: 0
*** Warning - bad CRC, using default environment

In:    serial
Out:   serial
Err:   serial
Net:   wemac
Hit any key to stop autoboot:  0 
sun4i#
sun4i#
sun4i#
sun4i#ext2load mmc 0 46000000
** No boot file defined **
sun4i#mmc init
mmc - MMC sub system

Usage:
mmc read addr blk# cnt
mmc write addr blk# cnt
mmc erase blk# cnt
mmc rescan
mmc part - lists available partition on current mmc device
mmc dev [dev] [part] - show or set current mmc device [partition]
mmc list - lists available devices
sun4i#ext2load mmc 0 46000000 uImage
4781032 bytes read in 255 ms (17.9 MiB/s)
sun4i#ext2load mmc 0 47000000 Initrd
** File not found Initrd **
sun4i#ext2load mmc 0 47000000 initrd
4934390 bytes read in 256 ms (18.4 MiB/s)
sun4i#bootm 46000000 47000000
## Booting kernel from Legacy Image at 46000000 ...
   Image Name:   Linux-3.4.29-9-sun4i
   Created:      2013-05-05   5:01:28 UTC
   Image Type:   ARM Linux Kernel Image (uncompressed)
   Data Size:    4780968 Bytes = 4.6 MiB
   Load Address: 40008000
   Entry Point:  40008000
   Verifying Checksum ... OK
## Loading init Ramdisk from Legacy Image at 47000000 ...
   Image Name:   Initrd
   Created:      2013-05-05   0:01:51 UTC
   Image Type:   ARM Linux RAMDisk Image (uncompressed)
   Data Size:    4934326 Bytes = 4.7 MiB
   Load Address: 00000000
   Entry Point:  00000000
   Verifying Checksum ... OK
   Loading Kernel Image ... OK
OK

Starting kernel ...

<6>Booting Linux on physical CPU 0
<6>Initializing cgroup subsys cpuset
<6>Initializing cgroup subsys cpu
<5>Linux version 3.4.29-9-sun4i (abuild@armbuild04) (gcc version 4.7.2 20130108 [gcc-4_7-branch revision 195012] (SUSE Linux) ) #2 PREEMPT Sun May 5 04:59:52 UTC 2013
CPU: ARMv7 Processor [413fc082] revision 2 (ARMv7), cr=10c5387d
CPU: PIPT / VIPT nonaliasing data cache, VIPT aliasing instruction cache
Machine: sun4i
<6>Memory cut off:
<6>     MALI : 0x5c000000 - 0x5fffffff  (  64 MB)
<4>Ignoring unrecognised tag 0x00000000
<6>Memory Reserved:
<6>     SYS  : 0x43000000 - 0x4300ffff  (  64 kB)
<6>     VE   : 0x44000000 - 0x48ffffff  (  80 MB)
<6>     G2D  : 0x49000000 - 0x49ffffff  (  16 MB)
<6>     LCD  : 0x5a000000 - 0x5bffffff  (  32 MB)
Memory policy: ECC disabled, Data cache writeback
<6>chip-id: A10 (AW1623 revision C)
<7>On node 0 totalpages: 114688
<7>free_area_init_node: node 0, pgdat c08f5a90, node_mem_map c0b0d000
<7>  Normal zone: 896 pages used for memmap
<7>  Normal zone: 0 pages reserved
<7>  Normal zone: 113792 pages, LIFO batch:31
<7>pcpu-alloc: s0 r0 d32768 u32768 alloc=1*32768<c>
<7>pcpu-alloc: <c>[0] <c>0 <c>
Built 1 zonelists in Zone order, mobility grouping on.  Total pages: 113792
<5>Kernel command line: mem=448M@0x40000000 console=ttyS0,115200
<6>PID hash table entries: 2048 (order: 1, 8192 bytes)
<6>Dentry cache hash table entries: 65536 (order: 6, 262144 bytes)
<6>Inode-cache hash table entries: 32768 (order: 5, 131072 bytes)
<6>allocated 917504 bytes of page_cgroup
<6>please try 'cgroup_disable=memory' option if you don't want memory cgroups
<6>Memory: 448MB = 448MB total
<5>Memory: 311372k/311372k available, 147380k reserved, 0K highmem
<5>Virtual kernel memory layout:
    vector  : 0xffff0000 - 0xffff1000   (   4 kB)
    fixmap  : 0xfff00000 - 0xfffe0000   ( 896 kB)
    vmalloc : 0xdc800000 - 0xff000000   ( 552 MB)
    lowmem  : 0xc0000000 - 0xdc000000   ( 448 MB)
    pkmap   : 0xbfe00000 - 0xc0000000   (   2 MB)
    modules : 0xbf000000 - 0xbfe00000   (  14 MB)
      .text : 0xc0008000 - 0xc0873180   (8621 kB)
      .init : 0xc0874000 - 0xc08aa000   ( 216 kB)
      .data : 0xc08aa000 - 0xc0901e28   ( 352 kB)
       .bss : 0xc0901e4c - 0xc0b0cb58   (2092 kB)
<6>NR_IRQS:128
<6>timer0: Periodic Mode
<6>sched_clock: 32 bits at 100 Hz, resolution 10000000ns, wraps every 4294967286ms
<6>Console: colour dummy device 80x30
<6>Calibrating delay loop... <c>383.38 BogoMIPS (lpj=1916928)
<6>pid_max: default: 32768 minimum: 301
<6>Security Framework initialized
<6>AppArmor: AppArmor initialized
<6>Mount-cache hash table entries: 512
<6>Initializing cgroup subsys cpuacct
<6>Initializing cgroup subsys memory
<6>Initializing cgroup subsys devices
<6>Initializing cgroup subsys freezer
<6>Initializing cgroup subsys net_cls
<6>Initializing cgroup subsys blkio
<6>Initializing cgroup subsys perf_event
<6>CPU: Testing write buffer coherency: ok
<6>Setting up static identity map for 0x405d4e68 - 0x405d4ec0
<6>devtmpfs: initialized
<6>dummy: 
<6>NET: Registered protocol family 16
<6>hw-breakpoint: debug architecture 0x4 unsupported.
SOFTWINNER DMA Driver, (c) 2003-2004,2006 Simtec Electronics
<6>Initialize DMAC OK
<6>Init eGon pin module V2.0
<6>bio: create slab <bio-0> at 0
<5>SCSI subsystem initialized
<7>libata version 3.00 loaded.
<6>usbcore: registered new interface driver usbfs
<6>usbcore: registered new interface driver hub
<6>usbcore: registered new device driver usb
<6>Linux media interface: v0.10
<6>Linux video capture interface: v2.00
<6>Advanced Linux Sound Architecture Driver Version 1.0.25.
<6>Bluetooth: Core ver 2.16
<6>NET: Registered protocol family 31
<6>Bluetooth: HCI device and connection manager initialized
<6>Bluetooth: HCI socket layer initialized
<6>Bluetooth: L2CAP socket layer initialized
<6>Bluetooth: SCO socket layer initialized
<6>NetLabel: Initializing
<6>NetLabel:  domain hash size = 128
<6>NetLabel:  protocols = UNLABELED CIPSOv4
<6>cfg80211: Calling CRDA to update world regulatory domain
<6>NetLabel:  unlabeled traffic allowed by default
<6>Switching to clocksource aw 64bits couter
<5>FS-Cache: Loaded
<6>CacheFiles: Loaded
<6>AppArmor: AppArmor Filesystem Enabled
<6>NET: Registered protocol family 2
<6>IP route cache hash table entries: 4096 (order: 2, 16384 bytes)
<6>TCP established hash table entries: 16384 (order: 5, 131072 bytes)
<6>TCP bind hash table entries: 16384 (order: 4, 65536 bytes)
<6>TCP: Hash tables configured (established 16384 bind 16384)
<6>TCP: reno registered
<6>UDP hash table entries: 256 (order: 0, 4096 bytes)
<6>UDP-Lite hash table entries: 256 (order: 0, 4096 bytes)
<6>NET: Registered protocol family 1
<6>RPC: Registered named UNIX socket transport module.
<6>RPC: Registered udp transport module.
<6>RPC: Registered tcp transport module.
<6>RPC: Registered tcp NFSv4.1 backchannel transport module.
<6>Trying to unpack rootfs image as initramfs...
<6>Freeing initrd memory: 4816K
<4>NetWinder Floating Point Emulator V0.97 (extended precision)
<6>audit: initializing netlink socket (disabled)
<5>type=2000 audit(1.109:1): initialized
<5>VFS: Disk quotas dquot_6.5.2
Dquot-cache hash table entries: 1024 (order 0, 4096 bytes)
<5>NFS: Registering the id_resolver key type
<5>FS-Cache: Netfs 'nfs' registered for caching
<6>nfs4filelayout_init: NFSv4 File Layout Driver Registering...
<6>NTFS driver 2.1.30 [Flags: R/W].
<6>fuse init (API version 7.18)
<6>msgmni has been set to 617
<6>alg: No test for stdrng (krng)
<6>Block layer SCSI generic (bsg) driver version 0.4 loaded (major 252)
<6>io scheduler noop registered
<6>io scheduler deadline registered
<6>io scheduler cfq registered (default)
<6>sunxi disp driver loaded (/dev/disp api 1.0)
<6>Serial: 8250/16550 driver, 8 ports, IRQ sharing disabled
<3>[uart]: failed to get uart0's used information
<3>[uart]: failed to get uart1's used information
<3>[uart]: failed to get uart2's used information
<3>[uart]: failed to get uart3's used information
<3>[uart]: failed to get uart4's used information
<3>[uart]: failed to get uart5's used information
<3>[uart]: failed to get uart6's used information
<3>[uart]: failed to get uart7's used information
<6>Non-volatile memory driver v1.3
<7>G2D: drv_g2d_init
<6>G2D: g2dmem: g2d_start=49000000, g2d_size=1000000
<6>G2D: head:c9000000,tail:ca000000
<6>G2D: Module initialized.major:250
<6>brd: module loaded
<6>loop: module loaded
<6>Fixed MDIO Bus: probed
<4>emac_init fetch emac using configuration failed
<6>emac driver is disabled
<6>ehci_hcd: USB 2.0 'Enhanced' Host Controller (EHCI) Driver
<6>ohci_hcd: USB 1.1 'Open' Host Controller (OHCI) Driver
WRN:L86(/home/abuild/rpmbuild/BUILD/kernel-sun4i-3.4.29/linux-3.4.29/drivers/usb/host/sw_hci_sunxi.c):ERR: get usbc2 enable failed
WRN:L96(/home/abuild/rpmbuild/BUILD/kernel-sun4i-3.4.29/linux-3.4.29/drivers/usb/host/sw_hci_sunxi.c):ERR: get usbc1(usbc1) id failed
WRN:L86(/home/abuild/rpmbuild/BUILD/kernel-sun4i-3.4.29/linux-3.4.29/drivers/usb/host/sw_hci_sunxi.c):ERR: get usbc2 enable failed
WRN:L96(/home/abuild/rpmbuild/BUILD/kernel-sun4i-3.4.29/linux-3.4.29/drivers/usb/host/sw_hci_sunxi.c):ERR: get usbc1(usbc1) id failed
WRN:L432(/home/abuild/rpmbuild/BUILD/kernel-sun4i-3.4.29/linux-3.4.29/drivers/usb/host/sw_hci_sunxi.c):ERR: gpio_request failed
WRN:L859(/home/abuild/rpmbuild/BUILD/kernel-sun4i-3.4.29/linux-3.4.29/drivers/usb/host/sw_hci_sunxi.c):ERR: usb1 alloc_pin failed
<6>Initializing USB Mass Storage driver...
<6>usbcore: registered new interface driver usb-storage
<6>USB Mass Storage support registered.
<6>usbcore: registered new interface driver ums-alauda
<6>usbcore: registered new interface driver ums-cypress
<6>usbcore: registered new interface driver ums-datafab
<6>usbcore: registered new interface driver ums_eneub6250
<6>usbcore: registered new interface driver ums-freecom
<6>usbcore: registered new interface driver ums-isd200
<6>usbcore: registered new interface driver ums-jumpshot
<6>usbcore: registered new interface driver ums-karma
<6>usbcore: registered new interface driver ums-onetouch
<6>usbcore: registered new interface driver ums-realtek
<6>usbcore: registered new interface driver ums-sddr09
<6>usbcore: registered new interface driver ums-sddr55
<6>usbcore: registered new interface driver ums-usbat
<6>mousedev: PS/2 mouse device common for all mice
sunxi RTC version 0.1 
<6>sunxi-rtc sunxi-rtc: sunxi_rtc_probe tmp_data = 380248073
[RTC] ERR: Set LOSC to external failed!!!
[RTC] WARNING: Rtc time will be wrong!!
<6>sunxi-rtc sunxi-rtc: rtc core: registered rtc as rtc0
<6>i2c /dev entries driver
!!! base_Addr = 0xf1c2ac00 
config i2c gpio with gpio_config api 
<3>gpio count < =0 ,gpio_count is: 0
<4>twi0 request gpio fail!
request i2c gpio failed!
<4>Trying to free nonexistent resource <0000000000000000-00000000ffffffff>
<4>sun4i-i2c: probe of sun4i-i2c.0 failed with error -5
!!! base_Addr = 0xf1c2b000 
<3>gpio count < =0 ,gpio_count is: 0
<4>twi1 request gpio fail!
request i2c gpio failed!
<4>Trying to free nonexistent resource <0000000000000000-00000000ffffffff>
<4>sun4i-i2c: probe of sun4i-i2c.1 failed with error -5
!!! base_Addr = 0xf1c2b400 
<3>gpio count < =0 ,gpio_count is: 0
<4>twi2 request gpio fail!
request i2c gpio failed!
<4>Trying to free nonexistent resource <0000000000000000-00000000ffffffff>
<4>sun4i-i2c: probe of sun4i-i2c.2 failed with error -5
[cedar dev]: install start!!!
[cedar dev]: install end!!!
[ace_drv] start!!!
[ace_drv] init end!!!
[pa_drv] start!!!
[pa_drv] init end!!!
<6>Bluetooth: HCI UART driver ver 2.2
<6>Bluetooth: HCI H4 protocol initialized
<6>Bluetooth: HCI BCSP protocol initialized
<6>Bluetooth: HCILL protocol initialized
<6>Bluetooth: HCIATH3K protocol initialized
<6>cpuidle: using governor ladder
<6>cpuidle: using governor menu
[mmc_pm]: failed to fetch sdio card configuration!
[mmc]: sunximmc_init
sunximmc_init fetch mmc0 using configuration failed
sunximmc_init fetch mmc1 using configuration failed
sunximmc_init fetch mmc2 using configuration failed
sunximmc_init fetch mmc3 using configuration failed
[mmc]: sunxi mmc controller using config : 0x0
[mmc]: sunximmc_init(L967): cannot find any using configuration for controllers, return directly!
<6>sunxi_leds driver init
<6>sunxi leds can't find script data '[leds_para]' 'leds_used'
<6>ledtrig-cpu: registered to indicate activity on CPUs
<6>logger: created 256K log 'log_main'
<6>logger: created 256K log 'log_events'
<6>logger: created 256K log 'log_radio'
<6>logger: created 256K log 'log_system'
enter sun4i Audio codec!!!
<6>sun4i audio support initialized
<3>script parser fetch err.
audio codec_wakeup request gpio fail!
<3>sun4i-codec sun4i-codec: not found (0).
<4>soc-audio soc-audio.0: ASoC machine sun4i-sndhdmi should use snd_soc_register_card()
<6>asoc: sndhdmi <-> sun4i-hdmiaudio.0 mapping ok
<6>IPv4 over IPv4 tunneling driver
<6>TCP: cubic registered
<6>Initializing XFRM netlink socket
<6>NET: Registered protocol family 17
<6>NET: Registered protocol family 15
<5>Bridge firewalling registered
<6>Bluetooth: RFCOMM TTY layer initialized
<6>Bluetooth: RFCOMM socket layer initialized
<6>Bluetooth: RFCOMM ver 1.11
<6>Bluetooth: BNEP (Ethernet Emulation) ver 1.3
<6>Bluetooth: BNEP filters: protocol multicast
<6>8021q: 802.1Q VLAN Support v1.8
<6>lib80211: common routines for IEEE802.11 drivers
<7>lib80211_crypt: registered algorithm 'NULL'
[mmc_pm]: No sdio card, please check your config !!
<5>Registering the dns_resolver key type
<6>VFP support v0.3: implementor 41 architecture 3 part 30 variant c rev 3
<5>Registering SWP/SWPB emulation handler
<6>CPUFREQ: ondemand sampling rate set to 300 ms
<6>registered taskstats version 1
<4>[DISP] lcd0_para.lcd_used not exit
<4>[DISP] lcd1_para.lcd_used not exit
<4>[DISP] fetch script data disp_init.disp_init_enable fail
<6>I2C: i2c-0: HDMI I2C adapter
<3>sunxi-rtc sunxi-rtc: hctosys: unable to read the hardware clock
<6>ALSA device list:
<6>  #0: sun4i-sndhdmi
<4>Warning: unable to open an initial console.
<6>Freeing init memory: 216K
<6>hp_sw: device handler registered
<6>emc: device handler registered
<6>alua: device handler registered
<6>rdac: device handler registered
<30>systemd-udevd[84]: starting version 195

4, cubieboard
sun4i#ext2load mmc 0 48000000 uImage
4781032 bytes read in 256 ms (17.8 MiB/s)
sun4i#ext2load mmc 0 43100000 initrd
4934390 bytes read in 256 ms (18.4 MiB/s)
sun4i#bootm 48000000 43100000:aa6c

5, generate cpio image
/* find . | cpio -o -H newc gzip > ../qemu_arm_root.img */
find . | cpio -o -H newc > ../rootfs.cpio.new
mkimage -A arm -T ramdisk -C none -n "uInitrd" -d rootfs.cpio.new uInitrd

6, 
search_binary_handler:1410: fn: c00ece6c
[    0.739744] search_binary_handler:1410: fn: c00ece6c
search_binary_handler:1410: fn: c00ee600
[    0.748352] search_binary_handler:1410: fn: c00ee600

7, 
[    0.691610] Freeing unused kernel memory: 196K (c0536000 - c0567000)
[    0.702232] kernel_init:834: ramdisk_execute_command: /init

08:08 2013-08-23
company, virtualization, suse, xen, regular meeting: US / China Virtualization Sync, meeting
1, Anderas
1), huawei EPT bug.
\TODO check it.
2), update kvm package in ibs in his branches.
2, Chunyan
1), migration
2), common library.
3), report the bug in ao_how. jason suggest open a bug for tracing.
3, boyang
1), Mike: vga bios?

13:43 2013-08-23
software skill, build service, obs, enable/disable email build result
https://hermes.opensuse.org/

18:32 2013-08-23
sun6i, kernel
rest_init:396.
cpu_idle_loop:71.
drivers/tty/tty_io.c:1203:tty_write: enter
drivers/tty/tty_io.c:1078:do_tty_write: enter: write: c02140f4
drivers/tty/serial/8250/8250_core.c:1309:serial8250_start_tx: enter
drivers/tty/serial/8250/8250_core.c:1309:serial8250_start_tx: enter
drivers/tty/serial/8250/8250_core.c:1309:serial8250_start_tx: enter
drivers/tty/tty_io.c:1203:tty_write: enter
drivers/tty/tty_io.c:1078:do_tty_write: enter: write: c02140f4
drivers/tty/serial/8250/8250_core.c:1309:serial8250_start_tx: enter
drivers/tty/serial/8250/8250_core.c:1309:serial8250_start_tx: enter
drivers/tty/serial/8250/8250_core.c:1309:serial8250_start_tx: enter
drivers/tty/tty_io.c:1203:tty_write: enter
drivers/tty/tty_io.c:1078:do_tty_write: enter: write: c02140f4
drivers/tty/serial/8250/8250_core.c:1309:serial8250_start_tx: enter
drivers/tty/serial/8250/8250_core.c:1309:serial8250_start_tx: enter
drivers/tty/tty_io.c:1203:tty_write: enter
drivers/tty/tty_io.c:1078:do_tty_write: enter: write: c02140f4
drivers/tty/serial/8250/8250_core.c:1309:serial8250_start_tx: enter
drivers/tty/serial/8250/8250_core.c:1309:serial8250_start_tx: enter
drivers/tty/tty_io.c:1024:tty_read: enter

2, interrupt no enable?
1), ok
^Mcpu_idle_loop:71.
^Mdrivers/tty/tty_io.c:1203:tty_write: enter
^Mdrivers/tty/tty_io.c:1078:do_tty_write: enter: write: c02140f4
^Mdrivers/tty/serial/8250/8250_core.c:1309:serial8250_start_tx: enter
^Mdrivers/tty/serial/8250/8250_core.c:1314:serial8250_start_tx: !(up->ier & UART_IER_THRI)
^Mserial8250_interrupt(32)...status = 60...^MTHRE...end.
^Mserial8250_interrupt(32)...end.
^Mdrivers/tty/serial/8250/8250_core.c:1309:serial8250_start_tx: enter
^Mdrivers/tty/serial/8250/8250_core.c:1314:serial8250_start_tx: !(up->ier & UART_IER_THRI)
^Mserial8250_interrupt(32)...status = 60...^M
THRE...end.
^Mserial8250_interrupt(32)...end.
^Mdrivers/tty/tty_io.c:1203:tty_write: enter
^Mdrivers/tty/tty_io.c:1078:do_tty_write: enter: write: c02140f4
^Mdrivers/tty/serial/8250/8250_core.c:1309:serial8250_start_tx: enter
^Mdrivers/tty/serial/8250/8250_core.c:1314:serial8250_start_tx: !(up->ier & UART_IER_THRI)
^Mserial8250_interrupt(32)...status = 60...Welcome to BuildrootTHRE...end.
2), fail
cpu_idle_loop:71.
drivers/tty/tty_io.c:1203:tty_write: enter
drivers/tty/tty_io.c:1078:do_tty_write: enter: write: c02140f4
drivers/tty/serial/8250/8250_core.c:1309:serial8250_start_tx: enter
drivers/tty/serial/8250/8250_core.c:1309:serial8250_start_tx: enter
drivers/tty/serial/8250/8250_core.c:1309:serial8250_start_tx: enter

3, serial8250_interrupt not entered.

4, just because i press "ENTER" before u-boot prompt? !!!

5, test vfp fs pass.

6, 开始几天一直以为是文件系统eabi不对。
后来发现明明正确的，稍微一改就不行。
也尝试了不同类型的文件系统。

后来又遇到反复，决定单独尝试一种文件系统：initrd.

先是trace 文件系统加载过程，发现无问题。
再看tty，发现死在无中断。手工触发中断也不行。

maybe i should try reset serial before kernel init it?
ref"8:14 2013-8-26" for the whole story.

8:14 2013-8-26
(10:20 2013-08-27)
本月尝试sun6i kernel and fs.
1, at the beginning, i want to analysis why exclusive operation hang in xen arm.
on 0805, i got crc error in u-boot load kernel.
this is because filesystem is corrupted. i always use that sd card carefully in order to not to over the actual fat16 boundary. (就是说用量产工具做的sd卡，fat分区本身就有问题，实际容量小于分区表上分配的容量). the better way is recreate a new fat16 partition with the same start block.

2, from 9 Aug, i discuss with Maxime the author for the currently sun6i upstream kernel, "18:01 2013-08-09", he give me a lot of useful information.
at that time, i could boot the upstream kernel successful. but fail on mount filesystem.

3, maxime gave me a uInitrd, ref"17:37 2013-08-16"6.
i successful in the first try. \TODO: add the u-boot command line in to the blog. "14:41 2013-08-20"
but after i try to build my own buildroot, it fail. because my buildroot is hard float compare with Maxime soft float(i guess it from readelf -a xxx | grep FP). so it takes me lots of times to try about the eabi thing.
try the different configuration and toolchain(gnueabi, gnueabihf). it fails, because i fianlly find there is a uart isssue in sun6i. 

4, i do not understand this. and i found that even if i change a little or not change the uInitrd of maxime, the mount wil fails. only few time could successful.
so, i guess that this is because the hardware is not stable. but after i try the samething more that ten times, i fail ten times, i guess that i might be a wrong direction.

5, trace the how the filesytem mount.
\TODO i do not know how rootfs mounted.
kernel_init_freeable
ramdisk_execute_command

6, how to run "init": 
if sys_access, it will call prepare_namespace.  which will "Prepare the namespace - decide what/where to mount, load ramdisks, etc".

    if (sys_access((const char __user *) ramdisk_execute_command, 0) != 0) {
        early_print("%s:%d.\n", __FUNCTION__, __LINE__);
        ramdisk_execute_command = NULL;
        prepare_namespace();
    }

relative kernel log:
[    0.689115] Freeing unused kernel memory: 196K (c0536000 - c0567000)
[    0.699740] kernel_init:834: ramdisk_execute_command: /init
[    0.707412] do_execve_common:1515.
[    0.716234] do_execve_common:1517: filename</init> opened file<ef16b600>
[    0.725015] do_execve_common:1523.
[    0.807650] do_execve_common:1562.

notes: if filesystem mount fail, there will be a message about this. and if init executes fails, it will be:
	panic("No init found.  Try passing init= option to kernel. "
	      "See Linux Documentation/init.txt for guidance.");

7, when will got the console output?
1), init
(1), probe
dw8250_probe -> serial8250_register_8250_port

(2), open

console_init -> tty_ldisc_begin -> tty_register_ldisc
             -> serial8250_console_init -> register_console -> newcon->early_setup
                                                               newcon->setup

tty_open -> uart_open(tty->ops->open) -> uart_startup -> uart_port_startup -> serial8250_startup(uport->ops->startup)
ops is tty_operations. it is uart_ops(tty/serial/serial_core.c) for serial.

tty_ldisc_setup -> tty_ldisc_open -> (ld->ops->open)

console_unlock -> up(&console_sem)

printk -> console_trylock_for_printk 

\TODO: question: is console_sem lock the console? i could not see the specific code about it.

(3), relative log:
((1)), probe
[    0.598350] Serial: 8250/16550 driver, 4 ports, IRQ sharing disabled
drivers/tty/serial/serial_core.c:2579:uart_add_one_port: enter
drivers/tty/serial/serial_core.c:2115:uart_configure_port: enter
drivers/tty/serial/serial_core.c:2629:uart_add_one_port: exit
drivers/tty/serial/serial_core.c:2579:uart_add_one_port: enter
drivers/tty/serial/serial_core.c:2115:uart_configure_port: enter
drivers/tty/serial/serial_core.c:2629:uart_add_one_port: exit
drivers/tty/serial/serial_core.c:2579:uart_add_one_port: enter
drivers/tty/serial/serial_core.c:2115:uart_configure_port: enter
drivers/tty/serial/serial_core.c:2629:uart_add_one_port: exit
drivers/tty/serial/serial_core.c:2579:uart_add_one_port: enter
drivers/tty/serial/serial_core.c:2115:uart_configure_port: enter
drivers/tty/serial/serial_core.c:2629:uart_add_one_port: exit
drivers/tty/serial/8250/8250_dw.c:271:dw8250_probe: enter
drivers/tty/serial/8250/8250_core.c:3249:serial8250_register_8250_port: enter
drivers/tty/serial/serial_core.c:2579:uart_add_one_port: enter
drivers/tty/serial/serial_core.c:2115:uart_configure_port: enter
[    0.720609] 1c28000.serial: ttyS0 at MMIO 0x1c28000 (irq = 32) is a U6_16550A
kernel/printk/printk.c:2231:register_console: enter
[    0.732471] console [ttyS0] enabled, bootconsole disabled
[    0.732471] console [ttyS0] enabled, bootconsole disabled
kernel/printk/printk.c:2373:register_console: exit
drivers/tty/serial/serial_core.c:2169:uart_configure_port: exit
drivers/tty/serial/serial_core.c:2629:uart_add_one_port: exit
drivers/tty/serial/8250/8250_core.c:3314:serial8250_register_8250_port: exit
drivers/tty/serial/8250/8250_dw.c:328:dw8250_probe: exit
((2)), open
kernel_init_freeable:897.
drivers/tty/tty_io.c:2001:tty_open: enter
[    0.884399] tty_open: opening ttyS0...
serial8250_interrupt(32)...end.
drivers/tty/serial/8250/8250_core.c:1709:serial_link_irq_chain: ret<0>
serial8250_interrupt(32)...end.
drivers/tty/tty_io.c:2106:tty_open: exit

2), write
"10:41 2009-9-7"1-4)

\TODO: the filesystem checklist.

10:19 2013-08-27
GTD
0, 10:00-11:30 12:50-18:10 19:20-21:20

1, today
1), 10:10-11:30 12:50-16:51 summary about sun6i upstream kernel. "8:14 2013-8-26"
nap 1h
2), 16:56-17:56 finish sun6i kernel blog. see"14:41 2013-08-20"
3), 18:01-18:10 19:28-21:19 reply to maxime and bob. see"10:40 2013-08-27"

10:40 2013-08-27
arm, sun6i, email
1, reply to Maxime
Hi Maxime,

> On Fri, Aug 16, 2013 at 04:11:58AM -0600, Bamvor Jian Zhang wrote:
> > > > So, could u do me a favor to give me some instruction about how to
> > > > boot your kernel, including proper u-boot, cmdline and filesystem.
> > > 
> > > http://linux-sunxi.org/Mainline_Kernel_Howto
> > after, append dtb to kernel and i could boot kernel to mounting
> > filesystem.  thanks your help!
> 
> Great, you're welcome :)
> 
> > i will try to make a initramfs image. do u have some prebuild kernel
> > and fs image for testing?
> 
> I don't have a kernel image here, but you can find an initramfs image I
> use here
> 
> http://free-electrons.com/~maxime/pub/uInitrd
thanks your fs, it works on my STB. i write some notes in my blog [1].
meanwhile, i found a weird issue: if i press keyboard before u-boot booted,
the interrupt of ttyS0 will be broken. i mean the u-boot log and kernel
printk works well but there is no message after filesystem mounted.
i guess it will be ok if u-boot or kernel issue a reset to ttyS0. but i 
do not know how to do it. do u have some document which describe the reset
system in sun6i?
> 
> > > > BTW: do i need to use fex for booting your kernel?
> > > 
> > > No. We don't and never will support fex. We use device tree just like
> > > any other ARM platform.
> > got it. do u plan add some peripheral for A31, e.g. sd, usb...
> 
> Yes, of course. I've been busy working on the A20/A31 bringup the last
> monthes, but as soon as these patches are merged, I'll work on
> supporting new IPs, probably MMC in priority.
great, if mmc works, i could put opensuse on it.

bamvor
> 
> > currenly, i want to make xen dom0 bootup. after this, i'd like to do
> > some sun6i driver work. if there is a some sort of task list, i could
> > know which one i could do.
> 
> http://linux-sunxi.org/Mainlining_Effort
> 
> Maxime
> 
> -- 
> Maxime Ripard, Free Electrons
> Embedded Linux, Kernel and Android engineering
> http://free-electrons.com

[1]: http://xen_on_arm.farbox.com/post/mele_m9_upstream_kernel 

2, reply to bob(20130825_1940)
> On Wed, 2013-08-14 at 13:27 +0800, Bamvor Zhang wrote:
> > could u see the right-down connector in my inside picture(next to the
> > last picture)?
> > that is the uart connector. there are four pins in that, 3v3, Tx, Rx,
> > Gnd.
> > AFAIK, there is only one four pins connector in this board.
> >
> Yes, it's the same on my board and I've managed to get serial I/O up and
> working now, thanks.
u r welcome:)
> >
> > BTW, i am trying to port xen to A31. currently, i need a upstream
> > kernel. and recently,
> > Maxime Ripard(maxime.ripard@free-electrons.com) send the A31 patches
> > to linux-arm-kernel
> >  and linux-sunxi mailing list. but i do not get a chance to test it.
> > will u try it?
> 
> I'm actually working on porting Ubuntu Touch to the device.  Getting
> something working is my priority but obviously once it's up and running
> I'll want to do things right, including using the main linux-sunxi
> kernel.
> >
> > and if u could get any kernel and filsystem running successful on A31.
> 
> I actually have a Linaro image that I'm trying to get on the A1000G.
> However, I'm having trouble getting the device into FEL mode so that I
> can flash the image with LiveSuit.
> 
> Do you know how to get the board into FEL mode?
in bottom of my M9, there is a hole for recovery. it will boot from sd card
if press this key in this hole. so, i gueess it also should boot into FEL
mode.
> 
> 
> Kind regards,
> 
> Bob
> 
> 
> PS, By the way your website seems to be having problems.  I tried to
> look at your A1000G page again and it just says "date type error, should
> be a datetime type"
thanks. i do not know why it happens. when i re-copy the whole blog acticles,
it is ok.
and i add a new blog about how to upstream kernel on my box. [1]

bamvor

[1]: http://xen_on_arm.farbox.com/post/mele_m9_upstream_kernel

14:31 2013-08-27
x86 平台硬件辅助虚拟化技术的新发展
http://www.ibm.com/developerworks/cn/linux/l-cn-virtnew/

15:20 2013-08-27
kernel, contect, checker, \TODO: try it
http://bbs.chinaunix.net/thread-1095873-1-1.html
基本上明白意思了，搜到了linus在2004年的一个邮件：

Sparse "context" checking.. From: Linus Torvalds Date: Sat Oct 30 2004 - 22:23:19 EST 
Next message: OGAWA Hirofumi: "Re: [2.6 patch] kill fatfs_syms.c" Previous message: Andi Kleen: "Re: [PATCH] Add panic blinking to 2.6" Next in thread: Roland Dreier: "Re: Sparse "context" checking.." Messages sorted by: [ date ] [ thread ] [ subject ] [ author ] 
-------------------------------------------------------------------------------- 
I just committed the patches to the kernel to start supporting a new automated correctness check that I added to sparse: the counting of static "code context" information. 
The sparse infrastructure is pretty agnostic, and you can count pretty much anything you want, but it's designed to test that the entry and exit contexts match, and that no path through a function is ever entered with conflicting contexts. 
In particular, this is designed for doing things like matching up a "lock" with the pairing "unlock", and right now that's exactly what the code does: it makes each spinlock count as "+1" in the context, and each spinunlock count as "-1", and then hopefully it should all add up.

基本上就是检查lock一个锁后是否有对应的unlock来解锁，在代码级来由sparse自动检查lock的匹配情况,程序员就可以轻松了。

10:37 2013-08-28
GTD
0, 10:30-11:30 12:30-20:55

1, today
1), 10' mailing list. see"10:40 2013-08-28"
2), 10:50-11:30 12:30-12:50 send libxl and libxl driver patch to Jim. see"10:42 2013-08-28"
3), 13:00-14:11 ralf rd all hands. see"13:02 2013-08-28"
4), 14:12-20:55 try lastest xen again. see"15:36 2013-08-28"
interrupt by "5)"
supper 50'
5), 30' discuss with Chunyan about libxl_domain_suspend procedure. see"15:26 2013-08-28"

10:40 2013-08-28
mailing list, virtualization, libvirt, lxc, how to allocate loopback device; \TODO programming excise
1, [libvirt] [PATCH] Use loop-control to allocate loopback device. 
Ian Main <imain@redhat.com>

static int virFileLoopDeviceOpenLoopCtl(char **dev_name)
{
    int fd = -1;
    int devnr;
    char *looppath = NULL;

    VIR_DEBUG("Opening loop-control device");
    if ((fd = open("/dev/loop-control", O_RDWR)) < 0) {
        virReportSystemError(errno, "%s",
                             _("Unable to open /dev/loop-control"));
        return -1;
    }

    if ((devnr = ioctl(fd, LOOP_CTL_GET_FREE)) < 0) {
        virReportSystemError(errno, "%s",
                             _("Unable to get free loop device via ioctl"));
        close(fd);
        return -1;
    }
    close(fd);

    VIR_DEBUG("Found free loop device number %i", devnr);

    if (virAsprintf(&looppath, "/dev/loop%i", devnr) < 0)
        return -1;

    if ((fd = open(looppath, O_RDWR)) < 0) {
        virReportSystemError(errno,
                _("Unable to open %s"), looppath);
        VIR_FREE(looppath);
        return -1;
    }

    *dev_name = looppath;
    return fd;
}

10:42 2013-08-28
virtualization, xen, libxl, async, try ao_how, cont3, discuss with Jim the status about ao_how without callback
Hi, Jim

i got ao_how work in libxl driver without callback, and i test create, save, restore, destroy. meanwhile i found somethings different from libxl doc. i am not sure if it need to send it to xen-devel. during last virtualization sync call, i report this and Jason suggest me discuss with u. here is the details:

1, libxl_event_check do not work in libxl driver:
in libxl.h doc, it says:
 * If ao_how->callback==NULL, a libxl_event will be generated which
 * can be obtained from libxl_event_wait or libxl_event_check.  The
 * event will have type OPERATION_COMPLETE (which is not used
 * elsewhere).

but, in libvirt, because we regsiter the libxl_event_hooks through libxl_event_register_callbacks, when the event will append to egc->occurred_for_callback not to CTX->occurred, the latter one is the waited by libxl_event_check.
at this point, ao_how without callback mode accually use the libxlEventHandler callback. if xen guys want to keep document right, they need to update libxl__event_occurred and distinguish the ao_how callback(egc->aos_for_callback) and event_hooks callback.

2, add a new api in libxl and i need to register a new event to libvirt except the fd and timeout.
in libxl, there are two ways for libvirt get the child exit event from libxl: libxl_sigchld_owner_mainloop and libxl_sigchld_owner_libxl_always.
the first need libvirt handle the SIGCHLD. currently only virLXCControllerMain handle this through virNetServerAddSignalHandler. So, i use the second one.
when the child(libxl-save-helper) exit, libxl will write to sigchld_owner->sigchld_selfpipe[1], So, i need read sigchld_selfpipe[1] by adding a new api libxl_get_pipe_handle. notes that libvirt could not access the item in ctx because ctx in defined in libxl internal.

i append the libxl and libxl driver patch in this email.  this patch is far from send it out. it just a referece for what i am doing to ao_how. 
if we realy send the patch out, i wll remove handle in libxlVmReap and remve lots of duplicated code.

BTW: i am trying with callback this week.

bamvor

10:45 2013-08-28
xen, arm
Hi, 


I also the try the lastest xen-unstable. because i saw some changes in bitops.

diff --git a/log201308novell.txt b/log201308novell.txt
index 205b148..bac6c35 100644
--- a/log201308novell.txt
+++ b/log201308novell.txt
@@ -3044,3 +3044,26 @@ In particular, this is designed for doing things like matching up a "lock" with
 
 基本上就是检查lock一个锁后是否有对应的unlock来解锁，在代码级来由sparse自动检查lock的匹配情况,程序员就可以轻松了。
 
13:02 2013-08-28
suse, rd, ralf, all hands
1, achievement.
helped to stabilized SUSE business in China.
performance win compare with redhat( by calen chen).
文件服务器, io performance.
web server.
database server. 

2, china
0), OEM: c和p是啥意思？
1), recent customer wins
china meteorology: total 2000 server? 年初200k. 9月会有60k.
china life.400k 800-900 servers.
icbc.
zhejiang cmcc.

3, jiaju离职感言。

4, outlook
hackweek: week of Oct 7th. 1008-1012.
i must finish opensuse for sun6i at least.
i hope i could got xen run on this device.

15:26 2013-08-28
virtualization, libvirt, libxl, save/migration, libxl_domain_suspend procedure
1, there are two stage in save.
1), the first one is memory save. this is done by xc_domain_save. 
libxl create libxl-save-helper for doing this. and libxl communication with libxl-save-helper through stdin and stdout. including suspend and complete message.
there are two fds for stdin and stdout respectively and libxl register this to libvirt(ro itself, i only talk about the progress when libxl use with libvirt). libvirt will handle the callback through datacopier_readable and datacopier_writable.

2), the second stage:
(1), for pv:
domain suspend through libxl__domain_pvcontrol_write(xenstore things).
(2), for hvm:
save qemu device model. datacopier_readable read the save image from file and write to datacopier_writable(i guess, no prof).

3, others
prefix data -> writeable; 
readable(reregiste writable) -> writable

15:36 2013-08-28
xen, arm, sun6i
1, there is no problem in lastest xen, \TODO: why?
Starting kernel ...

- UART enabled -
- CPU 00000000 booting -
- Machine ID 00000f34 -
- Started in Secure state -
- Entering Hyp mode -
- Zero BSS -
- Setting up control registers -
- Turning on paging -
- Ready -
RAM: 0000000040000000 - 00000000bfffffff

MODULE[1]: 0000000060000000 - 0000000060400000 
Placing Xen at 0x00000000bfe00000-0x00000000c0000000
Xen heap: 65536 pages  Dom heap: 458752 pages
Looking for UART console serial0
Unable to initialize serial: -9

2, add ns16550. hang at 
(XEN) GIC: 160 lines, 4 cpus, secure (IID 0100043b).
(XEN) Waiting for 0 other CPUs to be ready
(XEN) Using scheduler: SMP Credit Scheduler (credit)

1), 
(XEN) GIC initialization:
(XEN)         gic_dist_addr=0000000001c81000
(XEN)         gic_cpu_addr=0000000001c82000
(XEN)         gic_hyp_addr=0000000001c84000
(XEN)         gic_vcpu_addr=0000000001c86000
(XEN)         gic_maintenance_irq=25
(XEN) GIC: 160 lines, 4 cpus, secure (IID 0100043b).
(XEN) Waiting for 0 other CPUs to be ready
(XEN) setup.c:562:start_xen
(XEN) Using scheduler: SMP Credit Scheduler (credit)
(XEN) setup.c:565:start_xen
(XEN) setup.c:568:start_xen
(XEN) setup.c:571:start_xen
gic.c:767:gic_interrupt. irq: 1023
gic.c:767:gic_interrupt. irq: 1023
gic.c:767:gic_interrupt. irq: 1023
gic.c:767:gic_interrupt. irq: 1023

2), 
gic_route_dt_irq -> gic_route_irq -> "desc->handler = &gic_host_irq_type"

3), after print all the gic. i found that gic init is abnormal. check it later.

08:55 2013-08-29
GTD
0, 8:50-11:30 13:33-17:59

1, today
1), 9:00-11:30 read the patch about device tree. see"13:49 2013-08-29"1
2), 1h mailing list.
3), figure out why gic not works.
4), find out which modify make sun6i exclusive operation works in xen.
5), if "3)" no progress, try boot-wrapper

09:06 2013-08-29
Julien Grall <julien.grall@linaro.org> 
to: xen-devel@lists.xen.org
cc: patches@linaro.org; Julien Grall <julien.grall@linaro.org>; ian.campbell@citrix.com; andre.przywara@linaro.org; stefano.stabellini@eu.citrix.com

Hi Julien
> On some board, there is no alias to the UART. To avoid modification in
> the device tree, dt-uart should also search device by path.
> 
> To distinguish an alias from a path, dt-uart will check the first character.
> If it's a / then it's path, otherwise it's an alias.
> 
> Signed-off-by: Julien Grall <julien.grall@xxxxxxxxxx>
> Acked-by: Ian Cambell <ian.campbell@xxxxxxxxxx>
> ---
>  xen/drivers/char/dt-uart.c |   16 ++++++++++------
>  1 file changed, 10 insertions(+), 6 deletions(-)
> 
> diff --git a/xen/drivers/char/dt-uart.c b/xen/drivers/char/dt-uart.c
> index 93bb0f5..d7204fb 100644
> --- a/xen/drivers/char/dt-uart.c
> +++ b/xen/drivers/char/dt-uart.c
> @@ -26,9 +26,10 @@
>  
>  /*
>   * Configure UART port with a string:
> - * alias,options
> + * path,options
>   *
> - * @alias: alias used in the device tree for the UART
> + * @path: full path used in the device tree for the UART. If the path
> + * doesn't start with '/', we assuming that it's an alias.
>   * @options: UART speficic options (see in each UART driver)
>   */
>  static char __initdata opt_dtuart[30] = "";
> @@ -38,7 +39,7 @@ void __init dt_uart_init(void)
>  {
>      struct dt_device_node *dev;
>      int ret;
> -    const char *devalias = opt_dtuart;
> +    const char *devpath = opt_dtuart;
>      char *options;
>  
>      if ( !console_has("dtuart") || !strcmp(opt_dtuart, "") )
> @@ -53,12 +54,15 @@ void __init dt_uart_init(void)
>      else
>          options = "";
>  
> -    early_printk("Looking for UART console %s\n", devalias);
> -    dev = dt_find_node_by_alias(devalias);
> +    early_printk("Looking for UART console %s\n", devpath);
> +    if ( *devpath == '/' )
> +        dev = dt_find_node_by_path(devpath);
> +    else
> +        dev = dt_find_node_by_alias(devpath);
if '/' start an alias, it should be
+    if ( *devpath == '/' )
+        dev = dt_find_node_by_alias(devpath);
+    else
+        dev = dt_find_node_by_path(devpath);


bamvor
>  
>      if ( !dev )
>      {
> -        early_printk("Unable to find device \"%s\"\n", devalias);
> +        early_printk("Unable to find device \"%s\"\n", devpath);
>          return;
>      }
>  
> -- 
> 1.7.10.4

09:11 2013-08-29
1, cmdline_parse will parse the parameter located in ".init.setup" section which start from __setup_start, and the end is __setup_end.
parameter, e.g. "dtuart", defined in xen/drivers/char/dt-uart.c
2, build domain
construct_dom0 -> map_devices_from_device_tree -> handle_node -> map_device
                                                              -> handle_node

1), in construct_dom0
(1), load the kernel where the load is set by the kernel_prepare in the construct_dom0.
(2), xen will prepare the kernel boot register, for 32bit: r0=0, r1=0xffffffff, r2=dtb_addr; for aarch64: x0=dtb_addr, x1=0, x2=0, x3=0.
(3), alloc_vcpu.

3, after contruct_dom0, will unpause domain 0 by change vcpu status and final call init_done and finally call idle_loop.

09:34 2013-08-29
virtualization, xen, arm, device tree; psci
[Xen-devel] [PATCH V1 00/29] Allow Xen to boot with a raw Device Tree, Julien Grall
1, device tree
1), http://www.devicetree.org/Device_Tree_Usage
linux/Documentation/devicetree/booting-without-of.txt

2), three basic element in device tree node:
reg
#address-cells
#size-cells

ref: 
    Each addressable device gets a reg which is a list of tuples in the form reg = <address1 length1 [address2 length2] [address3 length3] ... >. Each tuple represents an address range used by the device. Each address value is a list of one or more 32 bit integers called cells. Similarly, the length value can either be a list of cells, or empty.
    Since both the address and length fields are variable of variable size, the #address-cells and #size-cells properties in the parent node are used to state how many cells are in each field. Or in other words, interpreting a reg property correctly requires the parent node's #address-cells and #size-cells values. To see how this all works, lets add the addressing properties to the sample device tree, starting with the CPUs.

e.g. sun6i:
	cpus {
		#address-cells = <1>;
		#size-cells = <0>;

		cpu@0 {
			compatible = "arm,cortex-a7";
			device_type = "cpu";
			reg = <0>;
		};

		cpu@1 {
			compatible = "arm,cortex-a7";
			device_type = "cpu";
			reg = <1>;
		};

        ...
    }

#address-cells equal 1 means the address length in reg is 32bit. while the #size-cells equals 0 means there is not length in reg. acctually, in cpu node, the number in reg means cpu number.
and must including device_type which is cpu.
the compatible value means which "driver" could use on this device. here is "arm,cortex-a7", if there is not cortex-a7 support in kernel, the cpu could not work.
hehe, using uart as an example of compatible is better than cpu:

    uart0: serial@01c28000 {
        compatible = "snps,dw-apb-uart";
        reg = <0x01c28000 0x400>;
        interrupts = <0 0 1>;
        reg-shift = <2>;
        reg-io-width = <4>;
        clocks = <&osc>;
        status = "disabled";
    };

drivers/tty/serial/8250/8250_dw.c:
    static const struct of_device_id dw8250_of_match[] = {
        { .compatible = "snps,dw-apb-uart" },
        { .compatible = "cavium,octeon-3860-uart" },
        { /* Sentinel */ }
    };
    MODULE_DEVICE_TABLE(of, dw8250_of_match);

2, PSCI
Documentation/devicetree/bindings/arm/psci.txt
Power State Coordination Interface (PSCI)


13:49 2013-08-29
mailing list, virtualization, xen, arm
1, [Xen-devel] [PATCH V1 00/29] Allow Xen to boot with a raw Device Tree, Julien Grall
ref"09:34 2013-08-29"
2, [Xen-devel] [PATCH v3 00/10] xen/arm: live migration support in arndale board
bamvor: as mentioned in this patch, there are still bugs in it.
\TODO: read it later.

14:18 2013-08-29
mailing list, virtualization, network, multiqueue
1, multiqueue
1), Michal Privoznik <mprivozn@redhat.com> 
Do you mean multiqueue network? It's supported from 1.0.6. You can set
it in /domain/devices/interface/driver/@queues attribute:

http://libvirt.org/formatdomain.html#elementsDriverBackendOptions

2), multiqueue status in kvm
http://www.linux-kvm.org/page/Multiqueue

14:33 2013-08-29
xen, arm, gic
1, function calls
gic_init -. 
2, compare with arndale
setenv kernel_addr_r 0x60000000
setenv xen_addr_r 0x50000000
setenv bootcmd_load_linux_mmc 'ext2load mmc 0 $kernel_addr_r zImage'
setenv boot_xen_mmc 'run bootcmd_load_linux_mmc; ext2load mmc 0 $xen_addr_r xen-uImage; bootm $xen_addr_r -'
setenv bootcmd 'run boot_xen_mmc'

搞了半天觉得arndale板子串口工作不正常: 乱码, 丢数据. 原来是两个screen都在访问/dev/ttyS0.

3, found a gic base addr error in sun6i.h, which used by mode_switch.S, but it remains error.

4, i have to write a small code for testing

9:29
arm lower power design.
ldpddr3 in nexus 10, galaxy s4.

