.LOG
10:12 2013-8-1
mailing list, virtualization, xen-devel; software skill, systemd
Configuring systemd to restart libvirtd on failure
Mooli Tayer
This will create a respawn behaviour in case libvirt process exits due to nonzero exit code, is terminated by a signal, an operation times out or the configured watchdog timeout is triggered. see http://www.freedesktop.org/software/systemd/man/systemd.service.html ---daemon/libvirtd.service.in | 1 + 1 file changed, 1 insertion(+)

diff --git a/daemon/libvirtd.service.in b/daemon/libvirtd.service.in index aa5913b..25979ef 100644 --- a/daemon/libvirtd.service.in +++ b/daemon/libvirtd.service.in @@ -15,6 +15,7 @@ EnvironmentFile=-/etc/sysconfig/libvirtd ExecStart=@sbindir@/libvirtd $LIBVIRTD_ARGS ExecReload=/bin/kill -HUP $MAINPID KillMode=process +Restart=on-failure # Override the maximum number of opened files #LimitNOFILE=2048

12:49 2013-08-01
GTD
0, 11:30

1, today
1), try to update os-prober script in order to support xen in other os.

11:11 2013-08-05
GTD
0, 10:40-11:40 12:20-13:45 16:30-18:20 18:42-21:10

1, today
1), mail.
2), 18:47-21:10 try exclusive operation in linux for sun6i. see"18:47 2013-08-05"

11:12 2013-08-05
company, colleague, openSUSE team, Antonio Larrosa Jiménez
"Agustin Benito Bethencourt <abebe@suse.com>"_email_"[devel] new openSUSE Team member: Antonio Larrosa"_20130802_1721
Hi,

I am happy to announce that Antonio Larrosa Jiménez joined yesterday the 
openSUSE Team at SUSE. He will work remotely from Spain.  He is not new at 
SUSE since he worked here for a year back in 2000.

Antonio is a KDE developer. Those of you who contributed to that project years 
ago will certainly know him. He will replace Will Stephenson as the KDE L3 
maintainer.

Antonio has been working the last 10 years in a company called Tedial that 
develop a real time backup system for multimedia-tv companies. The last years 
he also teached OS at Malaga College for IT students. 

Until August 9th he is in our offices in Nuremberg.

Welcome back Antonio.

Saludos
-- 
Agustin Benito Bethencourt
openSUSE Team Lead at SUSE
abebe@suse.com

11:13 2013-08-05
company, colleague, virtualization, Mike Latimer
1, "Jason Douglas <jdouglas@suse.com>"_email_"[devel] New Colleague in Virtualization Team -- Mike Latimer"
It is my pleasure to announce that Mike Latimer is the newest member of 
the Virtualization Team within the SLE Department. Mike lives in Utah 
and will join the SUSE team on the 5th floor in Provo.

Many of you might know Mike from NTS where he has spent nearly 20 years 
doing backline support on various products. We are confident that his 
experience will be a great asset to the team, and will allow him to hit 
the ground running as he transitions to development work around Xen and 
KVM.

Please join me in welcoming Mike to this new position.

Thanks!
Jason Douglas

2, (10:37 2013-08-09)
during this bi-week sync. Mike said he could speak Japanese.

12:28 2013-08-05
qemu, qcow2, qed
1, qed is Qemu Enhanced Disk
http://wiki.qemu.org/Features/QED
http://www.phoronix.com/scan.php?page=news_item&px=OTY0MQ

2, performance compare with qcow2, qed, QED with L2 Flush
http://wiki.qemu.org/Qcow2/PerformanceRoadmap

3, mount qcow2 through qemu-nbd
http://blog.loftninjas.org/2008/10/27/mounting-kvm-qcow2-qemu-disk-images/

18:00 2013-08-05
software skill, virtualization, qemu, qcow2, snapshot
【转】QCOW增量虚拟机制作
http://hi.baidu.com/chenshake/item/6b2a6327fa4ab7d6a517b6dd
kvm环境快照（snapshot）的使用方法
http://blog.csdn.net/gg296231363/article/details/6899533

18:06 2013-08-05
blog, virtualization, cloud
http://www.cnblogs.com/feisky/

18:08 2013-08-05
GTD, week review, week plan
1, week review
1), get console patch commit. WAITING OTHERS COMMENTS -> commit DONE
2), try ao_how: at least work when callback == NULL.  ref"11:00 2013-07-23"3.
THIS IS IMPORTANT. no progress.
3), try exclusive operation on sun6i. try sun6i upstream kernel. CANCEL
4), try rbd on libvirt libxl. 
(1), MINOR: report in week 30. CANCEL
(2), enable rbd cache? i am not sure whether it need or not. NEED. it is ok in current code.
(3), found chance to enhance xenlight rbd support. see"10:27 2013-07-29"5. CANCEL.
5), opensuse arm bug test and report. CANCEL
(1), ask help for run opensuse arm on cubie.
(2), arndale x11 not start. TRY AGAIN IN NEXT WEEK.

2, week plan
1), try exclusive operation on sun6i. try sun6i upstream kernel.
i wait it in two weeks. must do it this week.
2), try ao_how.
3), sr kvm patch to bruce with him suggestion.

3, other
1), xen: arm. add cpu in dts. add platform support for sun6i in xen.
ask linux-sunxi about u-boot.

18:47 2013-08-05
xen, arm, sun6i
1, try kernel 3.4 when could the ldrex/strex use?
2, bad crc
sunxi#fatload mmc 0:2 43000000 script.bin
reading script.bin

41068 bytes read
sunxi#fatload mmc 0:2 48000000 linux/uImage
reading linux/uImage

3464192 bytes read
sunxi#setenv bootargs "console=ttyS0,115200 root=/dev/mmcblk0p3 init=/init loglevel=8"
sunxi#bootm 48000000
## Booting kernel from Legacy Image at 48000000 ...
   Image Name:   Linux-3.3.0
   Image Type:   ARM Linux Kernel Image (uncompressed)
   Data Size:    3464128 Bytes = 3.3 MiB
   Load Address: 40008000
   Entry Point:  40008000
   Verifying Checksum ... Bad Data CRC
ERROR: can't get kernel image!
sunxi#

the actual kernel size: 
> ll arch/arm/boot/uImage
-rw-r--r-- 1 bamvor users 3464192 Aug  5 19:37 arch/arm/boot/uImage

install mkimage and rebuild the kernel(clean first).

3, modify gic according to Maxime Ripard patch
1), 
gic: interrupt-controller@01c81000 {
        compatible = "arm,cortex-a7-gic";
        reg = <0x01c81000 0x1000>,
              <0x01c82000 0x1000>,
              <0x01c84000 0x2000>,
              <0x01c86000 0x2000>;
        interrupt-controller;
        #interrupt-cells = <3>;
        interrupts = <1 9 0xf04>;
};

2), uart0
uart0: serial@01c28000 {
        compatible = "snps,dw-apb-uart";
        reg = <0x01c28000 0x400>;
        interrupts = <0 0 1>;
        reg-shift = <2>;
        reg-io-width = <4>;
        clocks = <&osc>;
        status = "disabled";
};

the following line is important:
        interrupts = <0 0 1>;
it will be pass after changing this.

4, \TODO fix this
(XEN) WARNING: Unrecognized/unsupported device tree compatible list
(XEN) Available platform support:
(XEN)     - VERSATILE EXPRESS
(XEN)     - SAMSUNG EXYNOS5

5, hang after local_irq_enable().
start_xen<509>
start_xen<511>
start_xen<514>
start_xen<517>
(XEN) Using scheduler: SMP Credit Scheduler (credit)
start_xen<520>
start_xen<523>
start_xen<526>
\TODO: which irq will araise after local_irq_enable()? 

6, \TODO: make sure console init ok.

10:45 2013-08-06
GTD
0, 10:40-11:40 15:40-18:10

1, today
1), mail.
2), 13:40-15:40. nap.
3), 15:40-17:30 ao_how. why event not return. see"15:42 2013-08-06"

10:51 2013-08-06
company, colleague, SLE Core Team, Pawel Wieczorkiewicz
"Stefan Fent <sf@suse.de>"_email_"[devel] Please welcome new memeber of the SLE Core Team Pawel Wieczorkiewicz"_20130805_2200
Hi,

I am very pleased to announce a new member of the SLE Core Team, Pawel 
Wieczorkiewicz.
Pawel has started working for SUSE on August 1st, coming from Intel working on 
networking  / wireless technologies. 
He lives in Nürnberg, and therefore can be found in office 2.3.21.

Please join me and welcome Pawel.

Regards,

Stefan
-- 
SUSE LINUX Products GmbH GF: Jeff Hawn, Jennifer Guild, Felix Imendörffer, HRB 
16746 (AG Nürnberg) 
Maxfeldstr. 5 / D-90409 Nürnberg / Phone: +49-911-740 53 - 0  
GPG 1024D/91614BBC B226 E3DA 37B0 2170 7403  D19C 18AF E579 9161 4BBC

15:42 2013-08-06
virtualization, xen, libxl, async, try ao_how, cont2, debug save, cont2
1, plan 
1), why the first time call libxl__ao_complete_check_progress_reports not report the complete. i need this.

2, 
helper_exited
helper_done
libxl__domain_suspend_device_model

3, i think i should add the libxl__fork_selfpipe_woken things to libxl_osevent_hooks.
because it is the only thing missing in libvirt but inplement in afterpoll_internal.

    int selfpipe = libxl__fork_selfpipe_active(CTX);
    if (selfpipe >= 0 &&
        afterpoll_check_fd(poller,fds,nfds, selfpipe, POLLIN)) {
        int e = libxl__self_pipe_eatall(selfpipe);
        if (e) LIBXL__EVENT_DISASTER(egc, "read sigchld pipe", e, 0);
        libxl__fork_selfpipe_woken(egc);
    }

09:00 2013-08-07
GTD
0, 8:50-11:30 12:30-17:10

1, today
1), 9:30-11:30 12:30- is it possible handle libxl__fork_selfpipe_woken in libxl? see"09:19 2013-08-07"
some time for personal stuff.
2), ask help about boot A31 kernel. send email?
3), Summary: 1hour for lunch, is it too long?

09:09 2013-08-07
mailing list, virtualization, xen, guest support
"Lars Pinne <lars.pinne@suse.com>"_email_"[virtualization-xen] SLES version is supported as guest on which SLES version as host?"_to_"XEN Hypervisor Technology Discussion"
1, "Antoine Ginies <aginies@suse.com>" reply
1), 
Lars Pinne:
> - we have a list of guest OS supported with Xen host SLES11sp3
> https://www.suse.com/documentation/sled11/book_xen/?page=/documentation/sled11/book_xen/data/book_xen.html
> 
> - we have a list of Xen hosts supported with guest SLES11sp2
> http://doc.opensuse.org/products/draft/SLES/SLES-xen_sd_draft/cha.xen.basics.html
> 
> Do we have an overview or a general rule for
> which SLES version is supported as guest on which SLES version as host?

There is no general rule. There is a white-paper on VT, he should help
you understand which host/guest scenario we support:

http://www.novell.com/docrep/2009/09/SUSE_Linux_Enterprise_Server_Virtualization_Technology_Support_en.pdf


-- 
Antoine Ginies <aginies@suse.com>
Project Manager
SUSE France

2), 
Lars Pinne:
> Hi Antoine,
> I did not find infos about running newer versions on older hosts.
> And in the paper's version for sp2, we did not mention sp3 as guest.
> 
> Or is it a rule, that we will support any SLES as guest on any
> older SLES, as long as both are under support?


This is true, we support any SLES as guest on any older SLES as long as
both are under support.
There is one exception: 
we are not able to boot a SLE11 SP3 PV guest on SLE10 SP4 (secure boot
issue).

> Such cases might be very common, since no customers wants to update
> its Xen hosts without urgent need.


regards
Antoine

-- 
Antoine Ginies <aginies@suse.com>
Project Manager
SUSE France

09:19 2013-08-07
virtualization, xen, libxl, async, try ao_how, cont2, debug save, cont3
1, 现在的关键问题是helper_exited没有人调用.
helper_exited will be called during childproc_reaped: ch->callback.

libxl__fork_selfpipe_woken -> childproc_reaped
libxl_childproc_reaped -> childproc_reaped

i could call libxl_childproc_reaped in libxl driver. but when?
1), read the doc about subprocess handling. in xen/tools/libxl/libxl_event.h
according to this doc, i should call libxl_childproc_setmode.
using libxl_sigchld_owner_mainloop or libxl_sigchld_owner_libxl_always?

2), if use libxl_sigchld_owner_libxl_always
 *     libxl_sigchld_owner_libxl_always:
 *       The application expects libxl to reap all of its children,
 *       and provides a callback to be notified of their exit
 *       statues.

sigchld_handler is installed when libxl_sigchld_owner_libxl_always set. sigchld_handler will write to sigchld_owner->sigchld_selfpipe[1]. who listen this?
i could register this to libvirt event loop then call the callback by myself.

3), if use libxl_sigchld_owner_mainloop 
i need to hand the signal in libvirt. it seems that there is no libvirt common function for this. except the virnetserver.c, the latter one is too complex for my requirement.

2, try libxl_sigchld_owner_libxl_always
1), register event to loop.
2), libxl_childproc_reaped need pid of child process.
should i get pid from fork_replacement? yes.
sigchld_selfpipe could not get from libxl outside. i need to modify the code.

3, currently, there are three choices for me, i am trying choice 2).
1), using ao_how without callback -> libxl_sigchld_owner_mainloop
2), using ao_how without callback -> libxl_sigchld_owner_libxl_always?
3), using ao_how with callback

22:08 2013-8-7
刚才看amba5介绍，看了两篇文章，没理解Coherent Hub Interface里面的hub是什么意思，有没有基于cortex-a5x和amba5的系统框图？
http://blogs.arm.com/soc-design/984-what-is-amba-5-chi-and-how-does-it-help/
http://www.arm.com/zh/about/newsroom/arm-announces-amba-5-chi-specification-to-enable-high-performance-highly-scalable-system-on-chip.php

9:12 2013-8-8
When a GIC that implements the GIC Security Extensions is connected to a processor that implements the ARM Security Extensions: •Group 0 interrupts are Secure interrupts, and Group 1 interrupts are Non-secure interrupts

12:59 2013-08-08
GTD
0, 11:10-11:40 14:40-17:56 19:12-20:58

1, today
1), email.
2), submit request to openSUSE 12.3 kvm package. see"17:47 2013-08-08"
3), 19:12-20:58 try to finish choice 2). mentioned in "09:19 2013-08-07"3-2). see"17:45 2013-08-08"
4), Summary
(1), too many personal stuff today. about 2h?

17:45 2013-08-08
virtualization, xen, libxl, async, try ao_how, cont2, debug save, cont4, try to finish without callback
0, ref"09:19 2013-08-07"3-2)
1, add libxl_get_pipe_handle, but still not work.
when i issue virsh list
2013-08-08T20:55:44.213124+08:00 linux-rd libvirtd[23744]: call libxl_childproc_reaped
2013-08-08T20:55:44.213222+08:00 linux-rd libvirtd[23744]: libvirtd: libxl_internal.h:2701: libxl__ctx_lock: Assertion `!r' failed.
2013-08-08T20:55:58.490216+08:00 linux-rd libvirtd[23744]: libxl_event_wait fail
2013-08-08T20:55:58.491282+08:00 linux-rd libvirtd[23744]: Caught abort signal dumping internal log buffer:
2, (11:31 2013-08-09)
check why libxl_sigchld_callback is not called after woken?
1), fault
Program received signal SIGABRT, Aborted.
0x00007f6bcba9f3d5 in raise () from /lib64/libc.so.6

2), 
(gdb) where
#0  0x00007f6bcba9f3d5 in raise () from /lib64/libc.so.6
#1  0x00007f6bcbaa0858 in abort () from /lib64/libc.so.6
#2  0x00007f6bcba982e2 in __assert_fail_base () from /lib64/libc.so.6
#3  0x00007f6bcba98392 in __assert_fail () from /lib64/libc.so.6
#4  0x00007f6bbf234c1e in libxl__ctx_lock (ctx=<optimized out>)
    at libxl_internal.h:2701
#5  0x00007f6bbf261376 in libxl_childproc_reaped (ctx=<optimized out>, 
    pid=2555, status=32619) at libxl_fork.c:279
#6  0x00007f6bcf0cda58 in virEventPollDispatchHandles (fds=<optimized out>, 
    nfds=<optimized out>) at util/vireventpoll.c:498
#7  virEventPollRunOnce () at util/vireventpoll.c:645
#8  0x00007f6bcf0cbfbb in virEventRunDefaultImpl () at util/virevent.c:273
#9  0x00007f6bcf1f8d4d in virNetServerRun (srv=0x7f6bd1a403b0)
    at rpc/virnetserver.c:1097
#10 0x00007f6bcfbdf57b in main (argc=<optimized out>, argv=<optimized out>)
    at libvirtd.c:1512
(gdb) frame 4
#4  0x00007f6bbf234c1e in libxl__ctx_lock (ctx=<optimized out>)
    at libxl_internal.h:2701
(gdb)      

3, (10:00 2013-08-14)
figure out why fault in libxl__ctx_lock

4, using the "-O0" flag as last week. restart the following process after re-install xen-tools, xen-libs: 
# zypper ps
The following running processes use deleted files:

PID  | PPID | UID | Login | Command                    | Service | Files                
-----+------+-----+-------+----------------------------+---------+----------------------
1057 | 1    | 0   | root  | xenstored                  |         | /usr/lib64/libxenct->
     |      |     |       |                            |         | /usr/sbin/xenstored->
1064 | 1    | 0   | root  | xenconsoled                |         | /usr/lib64/libxenct->
     |      |     |       |                            |         | /usr/lib64/libxenst->
     |      |     |       |                            |         | /usr/sbin/xenconsol->
1090 | 1    | 0   | root  | qemu-system-i386 (deleted) |         | /usr/lib64/libxenst->
     |      |     |       |                            |         | /usr/lib64/libxenct->
     |      |     |       |                            |         | /usr/lib64/libxengu->
     |      |     |       |                            |         | /usr/lib/xen/bin/qe->

/usr/sbin/xenstored --pid-file /var/run/xenstored.pid
xenconsoled --pid-file=/var/run/xenconsoled.pid
/usr/lib/xen/bin/qemu-system-i386 -xen-domid 0 -xen-attach -name dom0 -nographic -M xenpv -daemonize -monitor /dev/null

after enable "-O0", xen kernel module, xenstore, qemu not loaded. but 
/etc/rc.d/xencommons restart
successful.

5, remove CTX_LOCK and CTX_UNLOCK in libxl_childproc_reaped for test.
ctx is invalid in childproc_reaped, so this is why CTX_LOCK get 22(EINVAL).
$7 = {lg = 0x6b63617473, xch = 0x0, xsh = 0x6365537269760000, nogc_gc = {
    alloc_maxsize = 1953067637, alloc_ptrs = 0x73654e6464416b63, owner = 0x646574}, 
  event_hooks = 0x6365537269760000, event_hooks_user = 0x6174537974697275, lock = {
    __data = {__lock = 1699179363, __count = 1936019060, __owner = 6579572, 
      __nusers = 6512996, __kind = 1969448307, __spins = 2037672306, __list = {
        __prev = 0x746972756365732f, __next = 0x632e6361645f79}}, 
    __size = "ckGetNested\000dac\000security/security_dac.c", 
    __align = 8315138548831841123}, occurred = {tqh_first = 0x7220746f6e6e6163, 
    tqh_last = 0x732065766c6f7365}, osevent_in_hook = 1768713593, 
  osevent_hooks = 0x75253a75250073, osevent_user = 0x250074756f2e7325, poller_app = {
    entry = {le_next = 0x6e692e73, le_prev = 0x6e69747465530000}, 
    fd_polls = 0x7375204341442067, fd_polls_allocd = 1629516389,
    fd_rindices_allocd = 1730176110, fd_rindices = 0x206e6f2070756f72, wakeup_pipe = {
      661857575, 544175136}}, pollers_event = {lh_first = 0x646c253a646c2527}, 
  pollers_idle = {lh_first = 0x6e69747465530027}, hook_fd_nexi_idle = {
    slh_first = 0x6120726573752067}, hook_timeout_nexi_idle = {
    slh_first = 0x70756f726720646e}, efds = {lh_first = 0x646c2527206f7420}, etimes = {
    tqh_first = 0x6e6f2027646c253a, tqh_last = 0x6f6e202773252720}, 
  watch_slots = 0x726f707075732074, watch_nslots = 543450484, watch_freeslots = {
    slh_first = 0x6574737973656c69}, watch_counter = 1699938413, watch_efd = {
    fd = 1937055847, events = 29285, func = 0x70756f726720646e, entry = {
      le_next = 0x646c2527206f7420, le_prev = 0x6e6f2027646c253a}, 
    nexus = 0x6f6e202773252720}, death_list = {tqh_first = 0x74696d7265702074, 
    tqh_last = 0x646574}, death_reported = {tqh_first = 0x6e69747465530000, 
    tqh_last = 0x6120726573752067}, death_watch = {
    path = 0x70756f726720646e <Address 0x70756f726720646e out of bounds>, 
    callback = 0x646c2527206f7420, slotnum = 1684809018, counterval = 1852776487}, 
  disk_eject_evgens = {lh_first = 0x6f6e202773252720}, 
  childproc_hooks = 0x626973736f702074, childproc_user = 0x6572206e6f20656c, 
  sigchld_selfpipe = {1852793953, 1713404268}, children = {
    lh_first = 0x6574737973656c69}, version_info = {xen_version_major = 1853161581, 
    xen_version_minor = 1701601889, 
    xen_version_extra = 0x20746573206f7420 <Address 0x20746573206f7420 out of bounds>, 
    compiler = 0x646e612072657375 <Address 0x646e612072657375 out of bounds>, 
    compile_by = 0x742070756f726720 <Address 0x742070756f726720 out of bounds>, 
    compile_domain = 0x253a646c2527206f <Address 0x253a646c2527206f out of bounds>, 
    compile_date = 0x27206e6f2027646c <Address 0x27206e6f2027646c out of bounds>, 
    capabilities = 0x277325 <Address 0x277325 out of bounds>, 
    changeset = 0x726f747365520000 <Address 0x726f747365520000 out of bounds>, 
    virt_start = 2324773593510538857, pagesize = 1919251317, 
    commandline = 0x6f2070756f726720 <Address 0x6f2070756f726720 out of bounds>}}

6, check when the ctx is freed?
libxl_ctx_free breakpoints not entered. so, i using the wrong ctx???
yes. i not set the ctx to for info struct.
1), child_reaped pass after changing. but it entered several times. i should remove it.
2), i still could not recevice the event in libxl_check_event. check it tomorrow.

17:47 2013-08-08
virtualization, libvirt, kvm, bnc#815201, save hang, cont8, submit request to kvm package
1, using SIZE_MAX instead of UINT_MAX.
2, test 19times including 17times greater than 3G.
3, sr
> osc sr -m "fix xfer limit in buffered_close"
WARNING:
WARNING: Project does not accept submit request, request to open a NEW maintenance incident instead
WARNING:
created request id Request: #186365

  maintenance_incident: home:bjzhang:branches:openSUSE:12.3:Update/kvm4sr -> openSUSE:Maintenance (release in openSUSE:12.3:Update)


Message:
fix xfer limit in buffered_close

State:   new        2013-08-08T09:50:51 bjzhang
Comment: <no comment>

18:53 2013-08-08
cloud, openstack
http://docs.mirantis.com/fuel/fuel-3.1/index.html
This step-by-step guide takes you through this process of:
Configuring OpenStack and its supporting components into a robust cloud architecture
Deploying that architecture through an effective, well-integrated automation package that sets up and maintains the components and their configurations
Providing access to a well-integrated, up-to-date set of components known to work together

20:00 2013-08-08
sun6i, mkimage
/bin/sh /home/bamvor/sda5_rd/home/bamvor/work_bak/arm/Allwinner/source/sun6i/linux-A31-2v0/scripts/mkuboot.sh -A arm -O linux -T kernel -C none -a 0x40008000 -e 0x40008000 -n 'Linux-3.3.0' -d arch/arm/boot/zImage arch/arm/boot/uImage

i will use
mkimage -A arm -O linux -T kernel -C none -a 0x40008000 -e 0x40008000 -d arch/arm/boot/zImage arch/arm/boot/uImage

11:28 2013-08-09
GTD
0, 10:30-14:40 15:42-18:10

1, today
1), 40' virtualization sync.
2), report to Jiaju about virtualization sync.
3), discuss with Chunyan about migration fault.
4), 11:30-11:50 15:42-18:05 try to finish choice 2). mentioned in "09:19 2013-08-07"3-2). see"17:45 2013-08-08"2.
5), 12:15-13:30 lunch and learning. see"12:16 2013-8-9"
6), Summary
(1), two days not get my result. what a pity.

12:16 2013-8-9
lunch and learning
1, dongmao
1), y2log, showy2log
/var/log
2), webYaST
3), device mapper
   /            \
lvm           multipath(光纤, iscsi)

kpartx also use dm.

2, shawn
gnu/linux hardening(linux加固).

18:01 2013-08-09
(21:00 2013-08-15)
sent to Maxime Ripard(maxime.ripard@free-electrons.com) 
Hi, Maxime 

this is Bamvor Jian Zhang. currently, i work on port xen to sun6i. and i need a upstream kernel for sun6i.
i have had ping u at linux-sunxi in freenode last week, and got your github branch for sun6i(https://github.com/mripard/linux/tree/sunxi-next-a31). I also saw your A31 patch sent to linux-arm.
which one should i use for boot sun6i kernel?
i test your patch in my mele M9 box(A31 with 2G memory). but i fail on u-boot loading kernel.
i am not sure if the u-boot ship with my box is too old to using the dtb and kernel.
So, could u do me a favor to give me some instruction about how to boot your kernel, including proper u-boot, cmdline and filesystem.
BTW: do i need to use fex for booting your kernel?

i am so excited to boot your kernel in my board. and i hope i could make a opensuse image for sun6i. 

thanks

bamvor

10:15 2013-08-13
virtualization, nested, xen
http://www.slideshare.net/xen_com_mgr/nested-virtualization-update-from-intel
1, xiantao.zhang@intel.com
2, Why nested virtualization?
Ordinary OS are adopting  VMX now
    Windows 7 XP compatibility mode 
    Windows 8 Hyper-V
Other Commercial VMMs requires VMX for better performance
    vmware vmm
Anti-virus software depends on VMX
    McAfee Deep Defender
3, What is the goal ?
    To make VMX-based system software run smoothly in a Xen guest. 

14:34 2013-08-13
fate, virtualization, kvm, arm
Feature changed by: Michal Svec <msvec@suse.com>
Feature #314465, revision 10
  Title: Support the ARM architecture of KVM
   
- SLES-12: Rejected
+ SLES-12: Rejected by Michal Svec <msvec@suse.com>
+ reject date: 2013-08-09 15:41:18
+ reject reason: There are no plans to support ARMv7 in SLE 12. ARMv8
+ AArch64 is also not in the current plan of SLE 12, but we'd be open and
+ happy to have engagement on the BizDev side.
  Priority
      Requester: Desirable
   
  Requested by: yi li <yili@novell.com>
  Product Manager: Michal Svec <msvec@suse.com>
  Product Manager: Vladimir Botka <vbotka@suse.com>
  Partner organization: SUSE
   
  Categories:
  Virtualization, Virtualization / KVM
   
Description:
  Support ARM: create VM on ARM architecture, include passthrough the
  amba device to the guest os.
   
-- 
https://fate.novell.com/314465
More information about FATE on https://wiki.innerweb.novell.com/index.php/FATE
This feature is available to SUSE at: https://partnerfate.novell.com/314465

09:54 2013-08-14
GTD
0, 9:40-11:35 12:40-17:50

1, today
1), 10' mail.
2), 9:59-11:35 13:50-17:44 try to finish choice 2). mentioned in "09:19 2013-08-07"3-2). see"17:45 2013-08-08"3.
3), sun6i: reply to Bob. see"13:14 2013-08-14"

09:54 2013-08-14
virtualization, storage, storage motion
1, "Sebastian Martinez" <smartinez@suse.com>""
I have found this:  
http://wiki.xen.org/wiki/Storage_XenMotion and I would like to know if we support this kind of technology (storage live
migration without shared storage). 
And Is there any similar for KVM? 

Best regards, 

Sebastián Martínez
Business Development Manager
C/José Echegaray 8 Edif. III, 1ª, oficina 5 y 6.  
28232. Las Rozas. Spain.
+34 652 86 19 49
smartinez@suse.com
SUSE

2, Jim Fehlig
Sebastian Martinez wrote:
>
> I have found this:
>
> /_http://wiki.xen.org/wiki/Storage_XenMotion_/ and I would like to
> know if we support this kind of technology (storage live migration
> without shared storage).
>

Storage XenMotion is supported by the XCP toolstack from Citrix, which
is not provided in SLES.

> And Is there any similar for KVM?
>

libvirt's migrate API supports a VIR_MIGRATE_NON_SHARED_DISK flag, which
is implemented in the QEMU/KVM driver.  With virsh, you should be able
to do something like

virsh migrate vm-name --copy-storage-all ...

Regards,
Jim

3, Bruce Rogers
>>> On 8/12/2013 at 09:07 AM, Jim Fehlig <jfehlig@suse.com> wrote: 
> Sebastian Martinez wrote:
>>
>> I have found this:
>>
>> /_http://wiki.xen.org/wiki/Storage_XenMotion_/ and I would like to
>> know if we support this kind of technology (storage live migration
>> without shared storage).
>>
> 
> Storage XenMotion is supported by the XCP toolstack from Citrix, which
> is not provided in SLES.
> 
>> And Is there any similar for KVM?
>>
> 
> libvirt's migrate API supports a VIR_MIGRATE_NON_SHARED_DISK flag, which
> is implemented in the QEMU/KVM driver.  With virsh, you should be able
> to do something like
> 
> virsh migrate vm-name --copy-storage-all ...
> 
> Regards,
> Jim

Although available for KVM, we haven't stated support for storage migration.
We could certainly consider it if there is customer demand.

Bruce

12:40 2013-08-14
virtualization, xen, arm
[Xen-devel] How ARM Xen process the harddisk requests from DomU
1, Ian C
On Mon, 2013-08-12 at 12:06 +0800, Josh Zhao wrote:
> I am wondering how arm xen process the harddisk requests from DomU, is
> there a daemon in dom0 to do this work?
Xen on ARM supports only PV devices, so the PV disk backend will deal
with it. I'm not sure anyone has tried qdisk on ARM, although it should
work fine, but I expect most people are currently using the in-kernel
blkback driver in their driver domain.

2, Ian C
On Mon, 2013-08-12 at 14:23 +0800, Josh Zhao wrote:
> As the dom0 can use map_devices_from_device_tree() to map all devices
> into dom0 memory space , why we need to use the sysmmu ?
All ARM domains run with hardware nested page tables ("second stage
paging" in ARM speak, equivalent to HAP for x86 HVM guests). So an IOMMU
is needed to translate guest physical addresses into host physical
addresses for the device e.g. for doing DMA.

13:14 2013-08-14
allwinner, A31, mele M9
1, Bob Ham <rah@settrans.net>
Hi there,

I've just got a Mele A1000G which you stated is the same as the A1000
you unboxed here:

  http://xen_on_arm.farbox.com/post/mele_m9_quadcore

I'd like to get the serial output from u-boot in order to work on Linux
on the device.  In your hacking page, you noted a 3v3 uart: "the uart
pin is same as mele A1000, from left to right: 3v3, Tx, Rx, Gnd".

However, it isn't clear which connector you're referring to on the
board.  Could you possible tell me which connector is the UART? :-)

Any help is much appreciated.

Kind regards,

Bob Ham

2, reply
Hi, Bob

glad to see more and more people hacking A31. and sorry to late to reply to u.
my box is a engineering test version of mele M9. i am not sure it is same or not with
your box.

could u see the right-down connector in my inside picture(next to the last picture)?
that is the uart connector. there are four pins in that, 3v3, Tx, Rx, Gnd.
AFAIK, there is only one four pins connector in this board.

BTW, i am trying to port xen to A31. currently, i need a upstream kernel. and recently, 
Maxime Ripard(maxime.ripard@free-electrons.com) send the A31 patches to linux-arm-kernel
 and linux-sunxi mailing list. but i do not get a chance to test it.
will u try it?

and if u could get any kernel and filsystem running successful on A31. i could package 
it to opensuse arm. it would be useful for others one.

regards

bamvor

09:53 2013-08-15
GTD
0, 9:40-18:00

1, today
1), 10' jim email. CANCEL.
2), 17:00-17:54 ao_how
3), a31 email.

09:58 2013-08-15
mailing list, virtualization, libvirt, libxl, logging
1, [libvirt] [PATCH] libxl: Create per-domain log file 
1), Daniel reply to Jim.
> > Startup of libvirtd SEGVs with this change in GIT
> >
> > ==4706== For counts of detected and suppressed errors, rerun with: -v
> > ==4706== ERROR SUMMARY: 0 errors from 0 contexts (suppressed: 2 from 2)
> > ==4601== Thread 12:
> > ==4601== Invalid read of size 8
> > ==4601==    at 0x1E57964F: xtl_logv (in /usr/lib64/libxenctrl.so.4.2.0)
> > ==4601==    by 0x1E5796D3: xtl_log (in /usr/lib64/libxenctrl.so.4.2.0)
> > ==4601==    by 0x1E33258A: ??? (in /usr/lib64/libxenlight.so.2.0.0)
> > ==4601==    by 0x1E332641: ??? (in /usr/lib64/libxenlight.so.2.0.0)
> > ==4601==    by 0x1E317CD7: libxl_ctx_alloc (in /usr/lib64/libxenlight.so.2.0.0)
> >   
> 
> I should have looked at the xen code closer.  Seems libxl doesn't cope
> well with a NULL logger :(.
> 
> Hmm, should the logger for this driver-wide ctx (used for getting libxl
> version and the like, no domain ops) just dump messages to /dev/null or
> should they go to a driver-wide log file?

Depends if you think there's any useful info to be had from the
driver wide context object ? If so, then probably best to have a
driver-wide log file for those messages


Daniel

2), 
> > Daniel
> Eric
Daniel

> > Depends if you think there's any useful info to be had from the
> > driver wide context object ? If so, then probably best to have a
> > driver-wide log file for those messages
> 
> Or even just reply the data into the main libvirtd.log (ie. use existing
> virLog functionality, rather than creating a new file), since ideally
> the log will be relatively sparse: in my case, it would be just one
> message stating that libxl is not available, at which point the libxl
> driver no longer does anything else during the life of libvirtd.

I was going to suggest that, but IIUC, the libxl logger API requires
you to give it a FILE * instance to which it writes directly. To feed
it into our normal logs, we'd want it to let us give it a callback
for writing log messages.

Daniel

3), Jim reply to Daniel
> I was going to suggest that, but IIUC, the libxl logger API requires
> you to give it a FILE * instance to which it writes directly.

Right.

>  To feed
> it into our normal logs, we'd want it to let us give it a callback
> for writing log messages.
>   

I was going to pass the logger create function 'stderr' for the
driver-wide ctx.  Would that be safe?

Regards,
Jim

4), Eric reply to Daniel
> I was going to suggest that, but IIUC, the libxl logger API requires
> you to give it a FILE * instance to which it writes directly. To feed
> it into our normal logs, we'd want it to let us give it a callback
> for writing log messages.

Can we rely on open_memstream() being present on any platform with
libxl?  If so, that would give us a FILE* interface to libxl, while
still giving us access to the strings it prints which we can then turn
around and hand to our logger.

-- 
Eric Blake   eblake redhat com    +1-919-301-3266
Libvirt virtualization library http://libvirt.org

5), Jim
I should have tested this change on a system with libxl, but not booted
to Xen.  libxl would have then complained, and I would have seen the
crash.  Lesson learned...

I've sent a patch to fix the issue

https://www.redhat.com/archives/libvir-list/2013-August/msg00484.html

Regards,
Jim

6), Dario Faggioli reply to Jim
> I should have tested this change on a system with libxl, but not booted
> to Xen.  libxl would have then complained, and I would have seen the
> crash.  Lesson learned...
> 
Ups! I was wondering how that could happen, since I tested this too and
it worked, but yes, I tested it on Xen too... Did not think about doing
the above, although, yes, it definitely sounds like a reasonable thing
to do! :-P

Note taken for next time. :-)

Dario

2, example about how to use xtl_createlogger_stdiostream in libvirt.
[libvirt] [PATCH] libxl: fix libvirtd segfault
https://www.redhat.com/archives/libvir-list/2013-August/msg00484.html

@@ -1229,6 +1232,7 @@ libxlStateInitialize(bool privileged,
                      void *opaque ATTRIBUTE_UNUSED)
 {
     const libxl_version_info *ver_info;
+    char *log_file = NULL;
     virCommandPtr cmd;
     int status, ret = 0;
     unsigned int free_mem;
@@ -1308,6 +1312,17 @@ libxlStateInitialize(bool privileged,
         goto error;
     }
 
+    if (virAsprintf(&log_file, "%s/libxl-driver.log", libxl_driver->logDir) < 0)
+        goto error;
+
+    if ((libxl_driver->logger_file = fopen(log_file, "a")) == NULL)  {
+        virReportSystemError(errno,
+                             _("failed to create logfile %s"),
+                             log_file);
+        goto error;
+    }
+    VIR_FREE(log_file);
+
     /* read the host sysinfo */
     if (privileged)
         libxl_driver->hostsysinfo = virSysinfoRead();
@@ -1316,8 +1331,18 @@ libxlStateInitialize(bool privileged,
     if (!libxl_driver->domainEventState)
         goto error;
 
-    if (libxl_ctx_alloc(&libxl_driver->ctx, LIBXL_VERSION, 0, NULL)) {
-        VIR_INFO("cannot initialize libxenlight context, probably not running in a Xen Dom0, disabling driver");
+    libxl_driver->logger =
+            (xentoollog_logger *)xtl_createlogger_stdiostream(libxl_driver->logger_file, XTL_DEBUG, 0);
+    if (!libxl_driver->logger) {
+        VIR_INFO("cannot create logger for libxenlight, disabling driver");
+        goto fail;
+    }
+
+    if (libxl_ctx_alloc(&libxl_driver->ctx,
+                       LIBXL_VERSION, 0,
+                       libxl_driver->logger)) {
+        VIR_INFO("cannot initialize libxenlight context, probably not running "
+                 "in a Xen Dom0, disabling driver");
         goto fail;
     }
 
@@ -1383,6 +1408,7 @@ libxlStateInitialize(bool privileged,
 error:
     ret = -1;
 fail:
+    VIR_FREE(log_file);
     if (libxl_driver)
         libxlDriverUnlock(libxl_driver);
     libxlStateCleanup();

10:11 2013-08-15
title: about your per domain log patch
Hi, Jim

i read your per domain log patch and relative segfault patch.
IIRC, you said that it is relative to my jobs patch? but i am not understand this.


10:35 2013-08-15
bamvor@linux-rd:libvirt> sudo zypper in libvirt
Loading repository data...
Reading installed packages...
Resolving package dependencies...

The following NEW packages are going to be installed:
  libvirt libvirt-client libvirt-daemon libvirt-daemon-config-nwfilter 
  libvirt-daemon-driver-interface libvirt-daemon-driver-libxl libvirt-daemon-driver-lxc 
  libvirt-daemon-driver-network libvirt-daemon-driver-nodedev 
  libvirt-daemon-driver-nwfilter libvirt-daemon-driver-qemu 
  libvirt-daemon-driver-secret libvirt-daemon-driver-storage libvirt-daemon-driver-uml 
  libvirt-daemon-driver-vbox libvirt-daemon-driver-xen 

16 new packages to install.
Overall download size: 7.2 MiB. After the operation, additional 28.5 MiB will be used.
Continue? [y/n/?] (y): 

11:01 2013-08-15
mailing list, virtualization, xen
1, "ar16 <ar16@imapmail.org>"_email_"[opensuse-virtual] "EVTCHNOP failure" @ OS 12.3 + Xen 4.3 boot for some Guests; launch manually OK"_20130815_1018
I've recently upgraded pkgs an Opensuse 12.3 + XEN 4.3
(xen-4.3.0_08-264.1.x86_64) server.

It's got two guests set for auto-launch @ boot.

It's been working fine for awhile.  The guest cfg's have not changed in
ages.  Just the upgrade has occured recently.

Now, reproducibly after boot, one Guest is missing,

	xl list
		Name                                        ID   Mem
		VCPUs      State   Time(s)
		(null)                                       0   985    
		4     r-----      44.2             <====== Why "(null)"
		here? systemd?
		test2                                        2  1024    
		4     -b----      13.3

but launches manually 

	xl create /etc/xen/auto/test1.cfg
	xl list
		Name                                        ID   Mem
		VCPUs      State   Time(s)
		(null)                                       0   985    
		4     r-----      48.2
		test2                                        2  1024    
		4     -b----      13.8
		test1                                        3   768    
		2     -b----       2.3

and functions normally.

checking xen boot logs, I find these, new failures

	xl dmesg
		...
		[  OK  ] Started Haveged Entropy Gathering Daemon.
		[  OK  ] Started Restore Sound Card State.
		[  OK  ] Started LSB: irqbalance daemon providing irq
		balancing on MP-machines.
		[  OK  ] Started LSB: Framebuffer setup.
		[   35.614880] Event-channel device installed.
		[   35.677851] usbcore: registered new interface driver
		usbback
		[   35.711552] pciback: backend is vpci
		[   35.748410] blktap_device_init: blktap device major
		252

		Welcome to openSUSE 12.3 "Dartmouth" - Kernel
		3.7.10-1.16-xen (xvc0).


		testsvr login:

		(XEN) [2013-08-15 01:42:22] event_channel.c:233:d0
		EVTCHNOP failure: domain 2, error -22
		(XEN) [2013-08-15 01:42:22] event_channel.c:233:d0
		EVTCHNOP failure: domain 2, error -22
		(XEN) [2013-08-15 01:42:22] event_channel.c:233:d0
		EVTCHNOP failure: domain 2, error -22
		(XEN) [2013-08-15 01:42:22] event_channel.c:233:d0
		EVTCHNOP failure: domain 2, error -22
		(XEN) [2013-08-15 01:42:22] event_channel.c:233:d0
		EVTCHNOP failure: domain 2, error -22
		(XEN) [2013-08-15 01:42:22] event_channel.c:233:d0
		EVTCHNOP failure: domain 2, error -22
		(XEN) [2013-08-15 01:42:22] event_channel.c:233:d0
		EVTCHNOP failure: domain 2, error -22
		(XEN) [2013-08-15 01:42:22] event_channel.c:233:d0
		EVTCHNOP failure: domain 2, error -22
		(XEN) [2013-08-15 01:42:22] event_channel.c:233:d0
		EVTCHNOP failure: domain 2, error -22
		(XEN) [2013-08-15 01:42:22] event_channel.c:233:d0
		EVTCHNOP failure: domain 2, error -22
		[  OK  ] Started LSB: Configure network interfaces and
		set up routing.
		[  OK  ] Reached target Network.
		         Starting Command Scheduler...
		...

Those

	"event_channel.c:233:d0 EVTCHNOP failure: domain 2, error -22"

errors are new to me.

Looks like a XEN issue.  I've seen recent work on event channel deadlock
on the dev list, but my xen's logs don't mention anything evtchn-related
since ~ Nov 2011.

Before deciding to file a bug, I need to do some local troubleshooting.

Any suggestions as to what this might be about, or specific additional
info that might be enlightening?

AR
-- 
To unsubscribe, e-mail: opensuse-virtual+unsubscribe@opensuse.org
To contact the owner, e-mail: opensuse-virtual+owner@opensuse.org

1), bamvor: i got the same error. keep an eye on this bug report.

2, Jan reply
These being failures of Dom0 trying to bind inter-domain event
channels between itself and Dom2, these would quite likely be
accompanied by some log entries from the xen tools or the Dom0
kernel. In any case - the failure message here indicates that the
event channel either wasn't in "unbound" state, or wasn't
intended to be bound to by Dom0. For what it's worth, both seem
pretty unlikely...

Furthermore, you certainly realize that with the update to Xen 4.3,
which isn't part of 12.3, you also got switched from xend/xm to the
libxl based tools, which may be part of your problem. Thus it would
also be important to know what's so specific about this one failing
VM (there ought to be something, or else it wouldn't be always the
same VM that fails to come up).

Jan

11:29 2013-08-15
libxlEventHandler
LIBXL_EVENT_TYPE_OPERATION_COMPLETE

16:47 2013-08-15
virtualization, xen, arm, sun6i
1, Josh zhao <alephman@gmail.com>
你好 jian zhang,
我最近对xen arm很有兴趣，所以也关注 xen maillist. 发现除Arndale board 外，你发了一些针对全志A31的patchs。
我刚入手了一块A20(dual A7) 的开发板，我想应该区别不大，所以想把xen 移植 上去。我对xen是新手，所以请教几个问题：
1)  我在xen的主树（http://xenbits.xen.org/gitweb/?p=xen.git;a=summary）的master
branch中看不到你的代码，不知在什么地方？
2）在最新的3,8 以上的linux kernel中没有全志A31/A20的板子支持（只有A1X），不知哪里可以看到最新
针对A31/A20的Linux kernel 代码？

非常感谢！

-- 
Best regards!

Josh Zhao

2, 
Hi, Josh 
> 你好 jian zhang,
> 我最近对xen arm很有兴趣，所以也关注 xen maillist. 发现除Arndale board 外，你发了一些针对全志A31的patchs。
> 我刚入手了一块A20(dual A7) 的开发板，我想应该区别不大，所以想把xen 移植 上去。我对xen是新手，所以请教几个问题：
A20目前社区很活跃啊，你可以关注linux-sunxi mailing list. 其实我也有打算移植xen到A20，只是想买cubietruck(2G memory). 你用的什么板子？cubieboard2, OlinuXino, pad ,机顶盒?
> 1)  我在xen的主树（http://xenbits.xen.org/gitweb/?p=xen.git;a=summary）的master
> branch中看不到你的代码，不知在什么地方？
你搜索Bamvor看看。因为我有的patch也不是只针对A31，有些针对A31相关的patch不适合放在xen里面。最终的patch title并不是A31，所以你没搜到？
> 2）在最新的3,8 以上的linux kernel中没有全志A31/A20的板子支持（只有A1X），不知哪里可以看到最新
> 针对A31/A20的Linux kernel 代码？
linux-sunxi mailing list里面有Maxime Ripard基于upstream的A20/A31的patch: code name sun7i, sun6i.
> 
> 非常感谢！
很乐意和你一起把xen for sunxi做好，咱们可以多沟通。
我在IRC freenode: bjzhang
Google+ : bamv2005@gmail.com

regards

bamvor
> 
> -- 
> Best regards!
> 
> Josh Zhao

17:01 2013-08-15
company, colleague, SUSE labs, Shirish Pargaonkar
[devel] New Colleague in SUSE Labs: Shirish Pargaonkar
Hi all -

It's my pleasure to announce that we have a new member of the SUSE Labs
File Systems and Storage team: Shirish Pargaonkar. Shirish is located in
Austin (US) and will be joining us remotely.

He'll be primarily working on storage drivers and software RAID.

Welcome, Shirish!

-Jeff

-- 
Jeff Mahoney
SUSE Labs

18:08 2013-8-15
virtualization, xen, libxl, async, try ao_how, cont2, debug save, cont5, debug
1, hvm boot get domain id 0 in libvirt.
pv ok.
test precedure.
1), create pv. domain id 1.
2), create hvm, domain id 0.
3), destroy pv, create pv. domain id 3.
4), create another hvm, domain id 4.
So, the only the first hvm domain id is wrong.

21:14 2013-08-15
sorry, i could input Chinese right now.
here is the a20 cubie2 branch from Maxime, i do not know the exact status about this:
https://github.com/mripard/linux/tree/sunxi-next-a20-cubie2

Maxime send the patch to the three mailing lists: 
linux-arm-kernel@lists.infradead.org.
linux-kernel@vger.kernel.org.
linux-sunxi@googlegroups.com(https://groups.google.com/d/forum/linux-sunxi)

here is the link for v3 patch of a20.
http://lists.infradead.org/pipermail/linux-arm-kernel/2013-August/189046.html

09:55 2013-08-16
GTD
0, 9:40

1, today
1), 
mp3 editor in linux. ask YiFan.

