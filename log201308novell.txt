.LOG
10:12 2013-8-1
mailing list, virtualization, xen-devel; software skill, systemd
Configuring systemd to restart libvirtd on failure
Mooli Tayer
This will create a respawn behaviour in case libvirt process exits due to nonzero exit code, is terminated by a signal, an operation times out or the configured watchdog timeout is triggered. see http://www.freedesktop.org/software/systemd/man/systemd.service.html ---daemon/libvirtd.service.in | 1 + 1 file changed, 1 insertion(+)

diff --git a/daemon/libvirtd.service.in b/daemon/libvirtd.service.in index aa5913b..25979ef 100644 --- a/daemon/libvirtd.service.in +++ b/daemon/libvirtd.service.in @@ -15,6 +15,7 @@ EnvironmentFile=-/etc/sysconfig/libvirtd ExecStart=@sbindir@/libvirtd $LIBVIRTD_ARGS ExecReload=/bin/kill -HUP $MAINPID KillMode=process +Restart=on-failure # Override the maximum number of opened files #LimitNOFILE=2048

12:49 2013-08-01
GTD
0, 11:30

1, today
1), try to update os-prober script in order to support xen in other os.

11:11 2013-08-05
GTD
0, 10:40-11:40 12:20-13:45 16:30-18:20 18:42-21:10

1, today
1), mail.
2), 18:47-21:10 try exclusive operation in linux for sun6i. see"18:47 2013-08-05"

11:12 2013-08-05
company, colleague, openSUSE team, Antonio Larrosa Jiménez
"Agustin Benito Bethencourt <abebe@suse.com>"_email_"[devel] new openSUSE Team member: Antonio Larrosa"_20130802_1721
Hi,

I am happy to announce that Antonio Larrosa Jiménez joined yesterday the 
openSUSE Team at SUSE. He will work remotely from Spain.  He is not new at 
SUSE since he worked here for a year back in 2000.

Antonio is a KDE developer. Those of you who contributed to that project years 
ago will certainly know him. He will replace Will Stephenson as the KDE L3 
maintainer.

Antonio has been working the last 10 years in a company called Tedial that 
develop a real time backup system for multimedia-tv companies. The last years 
he also teached OS at Malaga College for IT students. 

Until August 9th he is in our offices in Nuremberg.

Welcome back Antonio.

Saludos
-- 
Agustin Benito Bethencourt
openSUSE Team Lead at SUSE
abebe@suse.com

11:13 2013-08-05
company, colleague, virtualization, Mike Latimer
1, "Jason Douglas <jdouglas@suse.com>"_email_"[devel] New Colleague in Virtualization Team -- Mike Latimer"
It is my pleasure to announce that Mike Latimer is the newest member of 
the Virtualization Team within the SLE Department. Mike lives in Utah 
and will join the SUSE team on the 5th floor in Provo.

Many of you might know Mike from NTS where he has spent nearly 20 years 
doing backline support on various products. We are confident that his 
experience will be a great asset to the team, and will allow him to hit 
the ground running as he transitions to development work around Xen and 
KVM.

Please join me in welcoming Mike to this new position.

Thanks!
Jason Douglas

2, (10:37 2013-08-09)
during this bi-week sync. Mike said he could speak Japanese.

12:28 2013-08-05
qemu, qcow2, qed
1, qed is Qemu Enhanced Disk
http://wiki.qemu.org/Features/QED
http://www.phoronix.com/scan.php?page=news_item&px=OTY0MQ

2, performance compare with qcow2, qed, QED with L2 Flush
http://wiki.qemu.org/Qcow2/PerformanceRoadmap

3, mount qcow2 through qemu-nbd
http://blog.loftninjas.org/2008/10/27/mounting-kvm-qcow2-qemu-disk-images/

18:00 2013-08-05
software skill, virtualization, qemu, qcow2, snapshot
【转】QCOW增量虚拟机制作
http://hi.baidu.com/chenshake/item/6b2a6327fa4ab7d6a517b6dd
kvm环境快照（snapshot）的使用方法
http://blog.csdn.net/gg296231363/article/details/6899533

18:06 2013-08-05
blog, virtualization, cloud
http://www.cnblogs.com/feisky/

18:08 2013-08-05
GTD, week review, week plan
1, week review
1), get console patch commit. WAITING OTHERS COMMENTS -> commit DONE
2), try ao_how: at least work when callback == NULL.  ref"11:00 2013-07-23"3.
THIS IS IMPORTANT. no progress.
3), try exclusive operation on sun6i. try sun6i upstream kernel. CANCEL
4), try rbd on libvirt libxl. 
(1), MINOR: report in week 30. CANCEL
(2), enable rbd cache? i am not sure whether it need or not. NEED. it is ok in current code.
(3), found chance to enhance xenlight rbd support. see"10:27 2013-07-29"5. CANCEL.
5), opensuse arm bug test and report. CANCEL
(1), ask help for run opensuse arm on cubie.
(2), arndale x11 not start. TRY AGAIN IN NEXT WEEK.

2, week plan
1), try exclusive operation on sun6i. try sun6i upstream kernel.
i wait it in two weeks. must do it this week.
2), try ao_how.
3), sr kvm patch to bruce with him suggestion.

3, other
1), xen: arm. add cpu in dts. add platform support for sun6i in xen.
ask linux-sunxi about u-boot.

18:47 2013-08-05
xen, arm, sun6i
1, try kernel 3.4 when could the ldrex/strex use?
2, bad crc
sunxi#fatload mmc 0:2 43000000 script.bin
reading script.bin

41068 bytes read
sunxi#fatload mmc 0:2 48000000 linux/uImage
reading linux/uImage

3464192 bytes read
sunxi#setenv bootargs "console=ttyS0,115200 root=/dev/mmcblk0p3 init=/init loglevel=8"
sunxi#bootm 48000000
## Booting kernel from Legacy Image at 48000000 ...
   Image Name:   Linux-3.3.0
   Image Type:   ARM Linux Kernel Image (uncompressed)
   Data Size:    3464128 Bytes = 3.3 MiB
   Load Address: 40008000
   Entry Point:  40008000
   Verifying Checksum ... Bad Data CRC
ERROR: can't get kernel image!
sunxi#

the actual kernel size: 
> ll arch/arm/boot/uImage
-rw-r--r-- 1 bamvor users 3464192 Aug  5 19:37 arch/arm/boot/uImage

install mkimage and rebuild the kernel(clean first).

3, modify gic according to Maxime Ripard patch
1), 
gic: interrupt-controller@01c81000 {
        compatible = "arm,cortex-a7-gic";
        reg = <0x01c81000 0x1000>,
              <0x01c82000 0x1000>,
              <0x01c84000 0x2000>,
              <0x01c86000 0x2000>;
        interrupt-controller;
        #interrupt-cells = <3>;
        interrupts = <1 9 0xf04>;
};

2), uart0
uart0: serial@01c28000 {
        compatible = "snps,dw-apb-uart";
        reg = <0x01c28000 0x400>;
        interrupts = <0 0 1>;
        reg-shift = <2>;
        reg-io-width = <4>;
        clocks = <&osc>;
        status = "disabled";
};

the following line is important:
        interrupts = <0 0 1>;
it will be pass after changing this.

4, \TODO fix this
(XEN) WARNING: Unrecognized/unsupported device tree compatible list
(XEN) Available platform support:
(XEN)     - VERSATILE EXPRESS
(XEN)     - SAMSUNG EXYNOS5

5, hang after local_irq_enable().
start_xen<509>
start_xen<511>
start_xen<514>
start_xen<517>
(XEN) Using scheduler: SMP Credit Scheduler (credit)
start_xen<520>
start_xen<523>
start_xen<526>
\TODO: which irq will araise after local_irq_enable()? 

6, \TODO: make sure console init ok.

10:45 2013-08-06
GTD
0, 10:40-11:40 15:40-18:10

1, today
1), mail.
2), 13:40-15:40. nap.
3), 15:40-17:30 ao_how. why event not return. see"15:42 2013-08-06"

10:51 2013-08-06
company, colleague, SLE Core Team, Pawel Wieczorkiewicz
"Stefan Fent <sf@suse.de>"_email_"[devel] Please welcome new memeber of the SLE Core Team Pawel Wieczorkiewicz"_20130805_2200
Hi,

I am very pleased to announce a new member of the SLE Core Team, Pawel 
Wieczorkiewicz.
Pawel has started working for SUSE on August 1st, coming from Intel working on 
networking  / wireless technologies. 
He lives in Nürnberg, and therefore can be found in office 2.3.21.

Please join me and welcome Pawel.

Regards,

Stefan
-- 
SUSE LINUX Products GmbH GF: Jeff Hawn, Jennifer Guild, Felix Imendörffer, HRB 
16746 (AG Nürnberg) 
Maxfeldstr. 5 / D-90409 Nürnberg / Phone: +49-911-740 53 - 0  
GPG 1024D/91614BBC B226 E3DA 37B0 2170 7403  D19C 18AF E579 9161 4BBC

15:42 2013-08-06
virtualization, xen, libxl, async, try ao_how, cont2, debug save, cont2
1, plan 
1), why the first time call libxl__ao_complete_check_progress_reports not report the complete. i need this.

2, 
helper_exited
helper_done
libxl__domain_suspend_device_model

3, i think i should add the libxl__fork_selfpipe_woken things to libxl_osevent_hooks.
because it is the only thing missing in libvirt but inplement in afterpoll_internal.

    int selfpipe = libxl__fork_selfpipe_active(CTX);
    if (selfpipe >= 0 &&
        afterpoll_check_fd(poller,fds,nfds, selfpipe, POLLIN)) {
        int e = libxl__self_pipe_eatall(selfpipe);
        if (e) LIBXL__EVENT_DISASTER(egc, "read sigchld pipe", e, 0);
        libxl__fork_selfpipe_woken(egc);
    }

09:00 2013-08-07
GTD
0, 8:50-11:30 12:30-17:10

1, today
1), 9:30-11:30 12:30- is it possible handle libxl__fork_selfpipe_woken in libxl? see"09:19 2013-08-07"
some time for personal stuff.
2), ask help about boot A31 kernel. send email?
3), Summary: 1hour for lunch, is it too long?

09:09 2013-08-07
mailing list, virtualization, xen, guest support
"Lars Pinne <lars.pinne@suse.com>"_email_"[virtualization-xen] SLES version is supported as guest on which SLES version as host?"_to_"XEN Hypervisor Technology Discussion"
1, "Antoine Ginies <aginies@suse.com>" reply
1), 
Lars Pinne:
> - we have a list of guest OS supported with Xen host SLES11sp3
> https://www.suse.com/documentation/sled11/book_xen/?page=/documentation/sled11/book_xen/data/book_xen.html
> 
> - we have a list of Xen hosts supported with guest SLES11sp2
> http://doc.opensuse.org/products/draft/SLES/SLES-xen_sd_draft/cha.xen.basics.html
> 
> Do we have an overview or a general rule for
> which SLES version is supported as guest on which SLES version as host?

There is no general rule. There is a white-paper on VT, he should help
you understand which host/guest scenario we support:

http://www.novell.com/docrep/2009/09/SUSE_Linux_Enterprise_Server_Virtualization_Technology_Support_en.pdf


-- 
Antoine Ginies <aginies@suse.com>
Project Manager
SUSE France

2), 
Lars Pinne:
> Hi Antoine,
> I did not find infos about running newer versions on older hosts.
> And in the paper's version for sp2, we did not mention sp3 as guest.
> 
> Or is it a rule, that we will support any SLES as guest on any
> older SLES, as long as both are under support?


This is true, we support any SLES as guest on any older SLES as long as
both are under support.
There is one exception: 
we are not able to boot a SLE11 SP3 PV guest on SLE10 SP4 (secure boot
issue).

> Such cases might be very common, since no customers wants to update
> its Xen hosts without urgent need.


regards
Antoine

-- 
Antoine Ginies <aginies@suse.com>
Project Manager
SUSE France

09:19 2013-08-07
virtualization, xen, libxl, async, try ao_how, cont2, debug save, cont3
1, 现在的关键问题是helper_exited没有人调用.
helper_exited will be called during childproc_reaped: ch->callback.

libxl__fork_selfpipe_woken -> childproc_reaped
libxl_childproc_reaped -> childproc_reaped

i could call libxl_childproc_reaped in libxl driver. but when?
1), read the doc about subprocess handling. in xen/tools/libxl/libxl_event.h
according to this doc, i should call libxl_childproc_setmode.
using libxl_sigchld_owner_mainloop or libxl_sigchld_owner_libxl_always?

2), if use libxl_sigchld_owner_libxl_always
 *     libxl_sigchld_owner_libxl_always:
 *       The application expects libxl to reap all of its children,
 *       and provides a callback to be notified of their exit
 *       statues.

sigchld_handler is installed when libxl_sigchld_owner_libxl_always set. sigchld_handler will write to sigchld_owner->sigchld_selfpipe[1]. who listen this?
i could register this to libvirt event loop then call the callback by myself.

3), if use libxl_sigchld_owner_mainloop 
i need to hand the signal in libvirt. it seems that there is no libvirt common function for this. except the virnetserver.c, the latter one is too complex for my requirement.

2, try libxl_sigchld_owner_libxl_always
1), register event to loop.
2), libxl_childproc_reaped need pid of child process.
should i get pid from fork_replacement? yes.
sigchld_selfpipe could not get from libxl outside. i need to modify the code.

3, currently, there are three choices for me, i am trying choice 2).
1), using ao_how without callback -> libxl_sigchld_owner_mainloop
2), using ao_how without callback -> libxl_sigchld_owner_libxl_always?
3), using ao_how with callback

22:08 2013-8-7
刚才看amba5介绍，看了两篇文章，没理解Coherent Hub Interface里面的hub是什么意思，有没有基于cortex-a5x和amba5的系统框图？
http://blogs.arm.com/soc-design/984-what-is-amba-5-chi-and-how-does-it-help/
http://www.arm.com/zh/about/newsroom/arm-announces-amba-5-chi-specification-to-enable-high-performance-highly-scalable-system-on-chip.php

9:12 2013-8-8
When a GIC that implements the GIC Security Extensions is connected to a processor that implements the ARM Security Extensions: •Group 0 interrupts are Secure interrupts, and Group 1 interrupts are Non-secure interrupts

12:59 2013-08-08
GTD
0, 11:10-11:40 14:40-17:56 19:12-20:58

1, today
1), email.
2), submit request to openSUSE 12.3 kvm package. see"17:47 2013-08-08"
3), 19:12-20:58 try to finish choice 2). mentioned in "09:19 2013-08-07"3-2). see"17:45 2013-08-08"
4), Summary
(1), too many personal stuff today. about 2h?

17:45 2013-08-08
virtualization, xen, libxl, async, try ao_how, cont2, debug save, cont3, try to finish without callback
0, ref"09:19 2013-08-07"3-2)
1, add libxl_get_pipe_handle, but still not work.
when i issue virsh list
2013-08-08T20:55:44.213124+08:00 linux-rd libvirtd[23744]: call libxl_childproc_reaped
2013-08-08T20:55:44.213222+08:00 linux-rd libvirtd[23744]: libvirtd: libxl_internal.h:2701: libxl__ctx_lock: Assertion `!r' failed.
2013-08-08T20:55:58.490216+08:00 linux-rd libvirtd[23744]: libxl_event_wait fail
2013-08-08T20:55:58.491282+08:00 linux-rd libvirtd[23744]: Caught abort signal dumping internal log buffer:
2, (11:31 2013-08-09)
check why libxl_sigchld_callback is not called after woken?
1), fault
Program received signal SIGABRT, Aborted.
0x00007f6bcba9f3d5 in raise () from /lib64/libc.so.6

2), 
(gdb) where
#0  0x00007f6bcba9f3d5 in raise () from /lib64/libc.so.6
#1  0x00007f6bcbaa0858 in abort () from /lib64/libc.so.6
#2  0x00007f6bcba982e2 in __assert_fail_base () from /lib64/libc.so.6
#3  0x00007f6bcba98392 in __assert_fail () from /lib64/libc.so.6
#4  0x00007f6bbf234c1e in libxl__ctx_lock (ctx=<optimized out>)
    at libxl_internal.h:2701
#5  0x00007f6bbf261376 in libxl_childproc_reaped (ctx=<optimized out>, 
    pid=2555, status=32619) at libxl_fork.c:279
#6  0x00007f6bcf0cda58 in virEventPollDispatchHandles (fds=<optimized out>, 
    nfds=<optimized out>) at util/vireventpoll.c:498
#7  virEventPollRunOnce () at util/vireventpoll.c:645
#8  0x00007f6bcf0cbfbb in virEventRunDefaultImpl () at util/virevent.c:273
#9  0x00007f6bcf1f8d4d in virNetServerRun (srv=0x7f6bd1a403b0)
    at rpc/virnetserver.c:1097
#10 0x00007f6bcfbdf57b in main (argc=<optimized out>, argv=<optimized out>)
    at libvirtd.c:1512
(gdb) frame 4
#4  0x00007f6bbf234c1e in libxl__ctx_lock (ctx=<optimized out>)
    at libxl_internal.h:2701
(gdb)      


17:47 2013-08-08
virtualization, libvirt, kvm, bnc#815201, save hang, cont8, submit request to kvm package
1, using SIZE_MAX instead of UINT_MAX.
2, test 19times including 17times greater than 3G.
3, sr
> osc sr -m "fix xfer limit in buffered_close"
WARNING:
WARNING: Project does not accept submit request, request to open a NEW maintenance incident instead
WARNING:
created request id Request: #186365

  maintenance_incident: home:bjzhang:branches:openSUSE:12.3:Update/kvm4sr -> openSUSE:Maintenance (release in openSUSE:12.3:Update)


Message:
fix xfer limit in buffered_close

State:   new        2013-08-08T09:50:51 bjzhang
Comment: <no comment>

18:53 2013-08-08
cloud, openstack
http://docs.mirantis.com/fuel/fuel-3.1/index.html
This step-by-step guide takes you through this process of:
Configuring OpenStack and its supporting components into a robust cloud architecture
Deploying that architecture through an effective, well-integrated automation package that sets up and maintains the components and their configurations
Providing access to a well-integrated, up-to-date set of components known to work together

20:00 2013-08-08
sun6i, mkimage
/bin/sh /home/bamvor/sda5_rd/home/bamvor/work_bak/arm/Allwinner/source/sun6i/linux-A31-2v0/scripts/mkuboot.sh -A arm -O linux -T kernel -C none -a 0x40008000 -e 0x40008000 -n 'Linux-3.3.0' -d arch/arm/boot/zImage arch/arm/boot/uImage

i will use
mkimage -A arm -O linux -T kernel -C none -a 0x40008000 -e 0x40008000 -d arch/arm/boot/zImage arch/arm/boot/uImage

11:28 2013-08-09
GTD
0, 10:30-14:40 15:42-18:10

1, today
1), 40' virtualization sync.
2), report to Jiaju about virtualization sync.
3), discuss with Chunyan about migration fault.
4), 11:30-11:50 15:42-18:05 try to finish choice 2). mentioned in "09:19 2013-08-07"3-2). see"17:45 2013-08-08"2.
5), 12:15-13:30 lunch and learning. see"12:16 2013-8-9"
6), Summary
(1), two days not get my result. what a pity.

12:16 2013-8-9
lunch and learning
1, dongmao
1), y2log, showy2log
/var/log
2), webYaST
3), device mapper
   /            \
lvm           multipath(光纤, iscsi)

kpartx also use dm.

2, shawn
gnu/linux hardening(linux加固).

18:01 2013-08-09
Hi, xxx

I saw your A31 patch sent to linux-arm.
i want to test your patch in my mele M9 box(A31 with 2G memory).
but i fail on u-boot loading kernel.
i am not sure if the u-boot ship with my box is too old to using the dtb and kernel.
So, if u could give me some instruction about how to make a bootable sd card and your u-boot and initfs. i will appreciate that, thasks.

