.LOG
14:32 2012-11-01
GTD
0, -18:20

1, today
1), 15:06-16:37 update my libxl lock patch. see"11:31 2012-10-29"
2), -18:16 try to add domainInterfaceStats in libxl api. see"16:38 2012-11-01"

16:38 2012-11-01
virtualization, libvirt, xenlight, add libxl api, cont1, domainInterfaceStats
1, modify and compile code success. and test fail: start vm fail.
2, after recompile, the former error does not exist. 
but there is not vif in xenlight(it is list as vif in xend with the same xml file).
linux-vm4:/etc/xen/vm # virsh domiflist 6
Interface  Type       Source     Model       MAC
-------------------------------------------------------
-          bridge     br0        -           00:16:3e:01:88:54
3, (15:33 2012-11-02)
linuxDomainInterfaceStats read the data from host "/proc/net/dev", i could found the vif device while using xenlight, but there is no packget counts. why? xenlight does not use vif? 

8:02 2012-11-02
company, virtualization, suse, xen, regular meeting: US / China Virtualization Sync, meeting
1, xen and kvm future. 
2, BoYang
macvtype. 
3, Lin Ma
1), Jim, sle11 sp3 will use libvirt 1.0.0

17:07 2012-11-02
software skill, SCM, git, external diff
http://technotales.wordpress.com/2009/05/17/git-diff-with-vimdiff/
1, .git/config
[diff]
    external = git_diff_wrapper

2, bamvor@linux-bjrd:~> cat bin/git_diff_wrapper
#!/bin/bash

gvimdiff --nofork $2 $5

"--nofork" could block the gvim. it will not create lots of gvim while git diff.

17:43 2012-11-02
GTD
1, today
1), summary: 当初遇到migration fail, 我如果想到追到xenlight library里面, 也许问题早就解决了. 

10:03 2012-11-05
arm, armv8, Cortex-A50, Cortex-A53, Cortex-A57
摘要: 延续大小核技术, 第一批芯片2013年出货(?), 内核空间64bit同时用户空间32bit
http://www.eet-china.com/ART_8800677493_617693_NT_7a9b2e89.HTM
20nm A50系列产品2013年生产，FinFET产品2013年流片，由台积电(TSMC)提供早期实现帮助。
海思是个非常好的例证！从最初在机顶盒方面的合作，到现在的网络系统、数据中心产品，正是以海思为代表的合作伙伴多样化的产品需求，推动了ARM的产品研发。有时候，我们能够听到客户更多的抱怨反而是研发进度过慢而不是过快。
ARM处理器部门负责Program Management的总监John Goodacre日前撰文称，正是AArch32和AArch64这两种处理器执行状态的融合，使得ARMv8成为倍受业界关注的架构。他解释称，从以往来看，当处理器架构要支持64位处理时，通常在以下两种演进方式中二选其一：创造一个全新架构，摒弃所有高效传统模式；或在现有32位架构的基础上添加64位处理功能，导致复杂性提高而且低效。而ARMv8的优势在于既可支持性能出众的传统模式，又采用全新64位设计，可以最大程度地提高两种状态的功效，同时还为软件提供渐进式路标图，从而按市场要求的步调采用新功能。
例如，在很多网络和企业市场，用户运行的应用要求具有2GB或3GB以上的RAM，这些市场将会直接采用特定架构的AArch64 状态。在某些合作伙伴的具体实施中，没有需要在处理器的特定模式下工作的传统软件，因此他们可以决定放弃架构对AArch32 状态的支持，而只提供64位的支持。
操作系统“内存不足”很可能是移动设备在64位支持方面遇到的第一个问题。John Goodacre表示，ARMv8 架构采用了简易合理的方法，允许操作系统在AArch64的64位虚拟地址模式下运行，而用户应用仍可在AArch32状态下运行。这使解决方案能够做到两全其美：既可运行无限数量的完全性能32位用户应用，同时又能使操作系统在ARMv8设备上的AArch64位模式下高效运行。

10:16 2012-11-05
community, linaro, arm Server
1, 
http://www.linaro.org/news/release/industry-leaders-collaborate-to-accelerate-software-ecosystem-for-arm-servers-and-join-linaro/en/
Santa Clara, US - 1 Nov 2012
AMD, AppliedMicro, Calxeda, Canonical, Cavium, Facebook, HP, Marvell and Red Hat join existing Linaro members ARM, HiSilicon, Samsung and ST-Ericsson to form new group focused on accelerating Linux development for ARM servers 
Linaro Enterprise Group (LEG) will build on Linaro’s experience of bringing competing companies together to work on common solutions and enable OEMs, commercial Linux providers and System on a Chip (SoC) vendors to collaborate in a neutral environment on the development and optimization of the core software needed by the rapidly emerging market for low-power hyperscale servers. 
2, Bamvor
众多公司加入ARM Server阵营
现在这么多公司都加入到LEG做服务器开发, 大家都看好arm server的前景.
IC company: AMD, AppliedMicro, ARM, Calxeda, Cavium, HiSilicon, Marvell, Samsung and ST-Ericsson.  
Linux Distrubution: Canonical, Red Hat. 
Server: HP
Other: Facebook
现在芯片公司还差TI, Qualcomm. Linux distribution公司还差suse. 

10:37 2012-11-05
GTD
0, 9:40-11:44 13:51-18:18

1, today
1), 40' armv8 and arm server, see"10:03 2012-11-05", "10:16 2012-11-05". 
\TODO: write a blog for this. 
2), 10' 14:25-17:00 add api in libvirt libxl driver. see"11:17 2012-11-05"
3), 20' work report. "17:36 2012-11-05"

11:17 2012-11-05
virtualization, libvirt, xenlight, add libxl api, cont2, domainBlockStats
1, do some investigation for domainBlockStats in last weekend. the qdisk is created by qemu through xenstore. So, if i could find how to get statics from qemu(if it is possible). i could implement the domainBlockStats api. It looks better than domainInterfaceStats, because vif statics in host "/proc/net/dev" is always zero while using xenlight. 
2, qemu-dm
1), command line(get after xen vm): 
qemu-dm -d 1 -domain-name sles11_hvm_10 -vnc 127.0.0.1:0 -serial pty -videoram 8 -boot c -acpi -vcpus 4 -vcpu_avail 0xf -net none -M xenfv
2), list block statics in qemu monitor: 
info blockstats
3), 虽然找到了统计信息在什么地方, 但是如果想从qemu monitor拿到这个数据并且返回给xenlight. 似乎要做很多事情. 
(1), 如果要通过qemu monitor得到信息的话, 目前xenlight里面没有这个功能, 需要新增. 为了一个block statics有必要么? 同时xen 4.3里面的PVH mode就不会使用qemu了. 这个修改也就没用了(所以xen upstream)不一定会收. 
(2), 如果不通过qemu monitor, 需要看看xenstore里面有没有其他方式.
似乎是xenbus? 
3, 
(gdb) break blk_event 
Breakpoint 1 at 0x479eb0: file /usr/src/debug/xen-4.1.2-testing/tools/ioemu-dir/hw/xen_disk.c, line 778.
(gdb) cont
Continuing.

Breakpoint 1, blk_event (xendev=0xadd280)
    at /usr/src/debug/xen-4.1.2-testing/tools/ioemu-dir/hw/xen_disk.c:778
778         struct XenBlkDev *blkdev = container_of(xendev, struct XenBlkDev, xendev);
(gdb) p xendev
$1 = (struct XenDevice *) 0xadd280
(gdb) p *xendev
$2 = {type = 0x4f855e "qdisk", dom = 1, dev = 768,
  name = "qdisk-768", '\000' <repeats 54 times>, debug = 0,
  be_state = XenbusStateConnected, fe_state = XenbusStateConnected,
  online = 1,
  be = "/local/domain/0/backend/qdisk/1/768", '\000' <repeats 988 times>,
  fe = 0xadae70 "/local/domain/1/device/vbd/768",
  protocol = 0xb096a0 "x86_64-abi", remote_port = 8, local_port = 69,
  evtchndev = 0xadd7e0, gnttabdev = 0xaddca0, ops = 0x72d820, next = {
    tqe_next = 0x0, tqe_prev = 0xadc4a0}}
4, it seems that both domainBlockStats and domainInterfaceStats is not eary to implement. So, find another api for this week!!!
But jiaju suggect me first improve lock patch. 
5, 
domainGetMaxVcpus
domainBlockStats
domainInterfaceStats
domainBlockPeek
nodeGetCellsFreeMemory
nodeDeviceDettach
nodeDeviceReAttach
nodeDeviceReset
domainOpenConsole
nodeSuspendForDuration
nodeGetMemoryParameters
nodeSetMemoryParameters
1), BlockPeek: 
(1), validate "path"
(2), open "path", lseek and saferead. 

17:36 2012-11-05
work report - week 44
1, [devel-server] work report - week 44
work for libvirt libxl driver: 
1), send lock patch version 1 and version2 to libvirt upstream after upstream response. 
2), continue to try to add domainBlockStats for libxl driver. 
I found that xenlight use qemu as disk backend while disk type is qdisk for both pv and hvm guest. I could get block statics from qemu through monitor command, but it seems that there is no such machanism in xenlight for this. while in the xen 4.3, a new vm type PVH type will be used which will not use the qemu daemon in xenlight. So, maybe it is not worth to add block statics in current xenlight drivers? 

16:16 2012-11-06
GTD
0, 16:00-18:50 20:35

1, today
1), Chunyan her api status. about BlockPeek: from her work report, her finish all the api except for interface and block stats. 
2), 1h read migration(domain suspend) in xen upstream. see"16:52 2012-11-06"

3), 20' Jiaju talk to me, about my performance.
4), 20:35- search one api which i could finish this week. 

16:52 2012-11-06
virtualization, libvirt, xen, libxl, read migration(domain suspend) in xen upstream
1, 现在的关键就是到底xenlight 4.2里面migration能不能打断，如果能打断，我现在就能干活了。如果不能，还得找其他事情。
简单看了看，原来migration里面的核心代码"xc_domain_save"放到了tools/libxl/libxl_save_helper.c
2, 从下面的分析看，目前suspend(to disk or to remote socket)都是建立的一个子进程做xc_domain_save的工作。但是没有看到任何异步打断的机制，看起来只是为了便于上层调用，允许同时调下来多个命令？如果是这样的话，qemu的monitor lock似乎xenlight也需要。
1), \TODO: discuss with Jim and Chunyan for xenlight event lock(similar to qemu monitor lock), 在适当的时候.
2), 具体分析

libxl__domain_suspend -> set dss->shs.callbacks: suspend, postcopy, checkpoint
                         set toolstack_save as libxl__toolstack_save
                         libxl__xc_domain_save
                         domain_suspend_done
libxl__xc_domain_save -> run_helper
                         libxl__xc_domain_save_done

libxl__toolstack_save: get phy status?

run_helper -> fork
              exec suspend in child
              libxl__ev_fd_register: register event for monitoring suspend 
                                     process? 

xc_domain_save -> suspend_and_state -> suspend
suspend is set by libxl__domain_suspend as remus or common suspend. 

12:52 2012-11-07
GTD
0, 10:00

1, today
1), 15:03 search one api which i could finish this week. see"15:16 2012-11-07"

2, next
3), test attach-disk command. see"10:41 2012-10-30"2

3, for Jim
1), xenlight event lock in libvirt. see"16:52 2012-11-06"2-1). 

4, next month
1), opensuse on MK802
(1), generate the 512MB version with opensuse12.2 RC2 which enable yast fist run. 
(2), try opensuse based on ubuntu kernel in order to solve the error from miniand. 
2), try armv8 emulator and read armv8 kernel code. 

13:01 2012-11-07
virtualization, libvirt, 1.0.0 release; localization
1, 1.0.0 release notes
https://www.redhat.com/archives/libvir-list/2012-November/msg00118.html
2, localization
https://www.transifex.com/projects/p/libvirt/

14:07 2012-11-07
arm, board, allwinner A10, cubie board
rumor said that cubie board guys come from VIA. 

14:59 2012-11-07
software skill, mount, network, nfs; rpc, rpcbind
1, mount fail because the rpcbind not started
linux-iwgo:/home/suse # mount.nfs 147.2.207.77:/home/bamvor/sda3/home sda3/home/ -v
mount.nfs: timeout set for Wed Nov  7 15:00:44 2012
mount.nfs: trying text-based options 'vers=4,addr=147.2.207.77,clientaddr=147.2.207.74'
mount.nfs: mount(2): No such file or directory
Starting rpc.statd ... portmapper not running                        failed
mount.nfs: rpc.statd is not running but is required for remote locking.
mount.nfs: Either use '-o nolock' to keep locks local, or start statd.
mount.nfs: an incorrect mount option was specified
2, check and start rpcbind
linux-iwgo:/home/suse # zypper se rpc
Loading repository data...
Reading installed packages...

S | Name                    | Summary                                  | Type
--+-------------------------+------------------------------------------+--------
  | geronimo-jaxrpc-1_1-api | Geronimo J2EE server J2EE specifications | package
  | libgfrpc0               | GlusterFS Remote Procedure Call library  | package
  | librpcsecgss-devel      | Library Implementing GSSAPI Security f-> | package
  | librpcsecgss3           | Library Implementing GSSAPI Security f-> | package
  | libtirpc-devel          | Transport Independent RPC Library        | package
i | libtirpc1               | Transport Independent RPC Library        | package
  | libtirpc1-32bit         | Transport Independent RPC Library        | package
  | nagios-plugins-rpc      | Check RPC service                        | package
  | perl-JSON-RPC           | Perl implementation of JSON-RPC 1.1 pr-> | package
i | perl-PlRPC              | Perl Extension for Writing PlRPC Servers | package
  | perl-RPC-XML            | A set of classes for core data, messag-> | package
  | php5-pear-Horde_Rpc     | PEAR: Horde RPC API                      | package
  | php5-xmlrpc             | PHP5 Extension Module                    | package
i | rpcbind                 | Transport independent RPC portmapper     | package
linux-iwgo:/home/suse # rcrpcbind status
redirecting to systemctl
rpcbind.service - RPC Bind
          Loaded: loaded (/lib/systemd/system/rpcbind.service; disabled)
          Active: inactive (dead)
          CGroup: name=systemd:/system/rpcbind.service

linux-iwgo:/home/suse # rcrpcbind restart
redirecting to systemctl
linux-iwgo:/home/suse # rcrpcbind status
redirecting to systemctl
rpcbind.service - RPC Bind
          Loaded: loaded (/lib/systemd/system/rpcbind.service; disabled)
          Active: active (running) since Wed, 07 Nov 2012 14:59:16 +0800; 1s ago
        Main PID: 21209 (rpcbind)
          CGroup: name=systemd:/system/rpcbind.service
                  └ 21209 /sbin/rpcbind -w -f

Nov 07 14:59:16 linux-iwgo rpcbind[21209]: Cannot open '/var/lib/rpcbind/rpc...)
Nov 07 14:59:16 linux-iwgo rpcbind[21209]: Cannot open '/var/lib/rpcbind/por...)
linux-iwgo:/home/suse # mount.nfs 147.2.207.77:/home/bamvor/sda3/home sda3/home/ -v
mount.nfs: timeout set for Wed Nov  7 15:01:21 2012
mount.nfs: trying text-based options 'vers=4,addr=147.2.207.77,clientaddr=147.2.207.74'
mount.nfs: mount(2): No such file or directory
Starting rpc.statd ...                                               done
mount.nfs: trying text-based options 'addr=147.2.207.77'
mount.nfs: prog 100003, trying vers=3, prot=6
mount.nfs: trying 147.2.207.77 prog 100003 vers 3 prot TCP port 2049
mount.nfs: prog 100005, trying vers=3, prot=17
mount.nfs: trying 147.2.207.77 prog 100005 vers 3 prot UDP port 33276
3, nfs mount successful
linux-iwgo:/home/suse # ls sda3/home/
novell

15:16 2012-11-07
domainMemoryPeek: not support in xenlight

18:17 2012-11-07
1, 
linux-vm4:/etc/xen/vm # virsh attach-disk sles11_hvm_10 /dev/sdb1 sda
Disk attached successfully

linux-vm4:/etc/xen/vm # xm
linux-vm4:/etc/xen/vm # virsh detach-disk sles11_hvm_10 sda
error: Failed to detach disk
error: End of file while reading data: Input/output error
error: Failed to reconnect to the hypervisor

2, xm support scsi-attach, scsi-detach, scsi-list

3, 原来的libxl是否支持ide，或者任何image或设备或lvm？

