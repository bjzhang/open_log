.LOG
14:11 2012-09-03
GTD
0, 14:00-22:10

1, today
1), work report. see"16:23 2012-09-03".
2), libxl patch. see"17:26 2012-09-03".
3), summary. better work then last week. 继续努力.

16:23 2012-09-03
work report - week 35
1, [devel-server] work report - week 35
[green]
1, libvirt libxl driver. 
1), improve the lock patch according to Jim's suggestion. 
2), debug libxl migration patch. it is ok on upstream libvirt. 
2, wireshark maintenance 
1), update wireshark to 1.4.15 on sle10 and sle11. 
2), fix security bug on sle9. four bugs need to patch. 3 of them has been finished. one patch could not apply directly and need to modified for wireshark 1.0.16

17:02 2012-09-03
virtualization, libvirt, xen
1, https://bugzilla.novell.com/show_bug.cgi?id=778006 
bamvor: i got the same error, but i do not try to fix it. it is a pity. 

2, Jim fixed this bug. commit info
commit f781e27653c7e50747c414a916c788cfc81760c4
Author: Jim Fehlig <jfehlig@suse.com>
Date:   Thu Aug 30 12:53:02 2012 -0600

    Fix xen driver following changes to make it stateful

    Recent work to improve support for loadable driver modules introduced
    a regression in the xen driver.  The legacy xen driver is now a
    stateful, libvirtd driver but was not being registered when building
    without driver modules.

    A slight behavior change was also noted in the xen drivers when
    built as driver modules.  Previously, explicitly specifying a
    connection URI was not necessary, but now

    Compiled against library: libvirt 0.10.0
    Using library: libvirt 0.10.0
    Using API: QEMU 0.10.0
    error: failed to get the hypervisor version
    error: internal error Cannot find suitable emulator for x86_64

    The xen drivers need to be registered before the qemu driver since
    the qemu driver will return success with a null connection URI.
    This ordering is safe since the xen drivers will decline when not
    running the xen kernel.

3, here is the patch, it is not difficult even for me(对我来书也不是很难). 
diff --git a/daemon/Makefile.am b/daemon/Makefile.am
index b00fc13..b45349c 100644
--- a/daemon/Makefile.am
+++ b/daemon/Makefile.am
@@ -131,6 +131,10 @@ if WITH_LXC
     libvirtd_LDADD += ../src/libvirt_driver_lxc.la
 endif
 
+if WITH_XEN
+    libvirtd_LDADD += ../src/libvirt_driver_xen.la
+endif
+
 if WITH_LIBXL
     libvirtd_LDADD += ../src/libvirt_driver_libxl.la
 endif
diff --git a/daemon/libvirtd.c b/daemon/libvirtd.c
index 352d4fe..6973df6 100644
--- a/daemon/libvirtd.c
+++ b/daemon/libvirtd.c
@@ -66,6 +66,9 @@
 # ifdef WITH_LXC
 #  include "lxc/lxc_driver.h"
 # endif
+# ifdef WITH_XEN
+#  include "xen/xen_driver.h"
+# endif
 # ifdef WITH_LIBXL
 #  include "libxl/libxl_driver.h"
 # endif
@@ -382,6 +385,12 @@ static void daemonInitialize(void)
 # ifdef WITH_NETCF
     virDriverLoadModule("interface");
 # endif
+# ifdef WITH_XEN
+    virDriverLoadModule("xen");
+# endif
+# ifdef WITH_LIBXL
+    virDriverLoadModule("libxl");
+# endif
 # ifdef WITH_QEMU
     virDriverLoadModule("qemu");
 # endif
@@ -391,12 +400,6 @@ static void daemonInitialize(void)
 # ifdef WITH_UML
     virDriverLoadModule("uml");
 # endif
-# ifdef WITH_XEN
-    virDriverLoadModule("xen");
-# endif
-# ifdef WITH_LIBXL
-    virDriverLoadModule("libxl");
-# endif
 #else
 # ifdef WITH_NETWORK
     networkRegister();
@@ -416,6 +419,9 @@ static void daemonInitialize(void)
 # ifdef WITH_NWFILTER
     nwfilterRegister();
 # endif
+# ifdef WITH_XEN
+    xenRegister();
+# endif
 # ifdef WITH_LIBXL
     libxlRegister();
 # endif

17:26 2012-09-03
virtualization, libvirt, migration, libxl(xenlight), lock, cont19, prepare send patch to upstream, debug, cont15, re-write new patch, cont1; send patch with git send-email
1, recreate the branch with track to remote master. this is easy to update code to my branch.  
bamvor@linux-bjrd:libvirt> git branch -f --track libxl_lock_implementation origin/master                                                                           
Branch libxl_lock_implementation set up to track remote branch master from origin.
bamvor@linux-bjrd:libvirt> patch -p1 < patch0903
bamvor@linux-bjrd:libvirt> git add src/libxl/libxl_conf.h src/libxl/libxl_driver.c
bamvor@linux-bjrd:libvirt> git commit -m "add libxl lock implemetation(NOT COMPILE)"
[master 14626cb] add libxl lock implemetation(NOT COMPILE)
 Committer: bamvor jian zhang <bamvor@linux-bjrd.bjz>
Your name and email address were configured automatically based
on your username and hostname. Please check that they are accurate.
You can suppress this message by setting them explicitly:

    git config --global user.name "Your Name"
    git config --global user.email you@example.com

After doing this, you may fix the identity used for this commit with:

    git commit --amend --reset-author

 2 files changed, 467 insertions(+)
1), add user name and user email. 
bamvor@linux-bjrd:libvirt> git config --global user.name "Bamvor Jian Zhang"
bamvor@linux-bjrd:libvirt> git config --global user.email "bjzhang@suse.com"
bamvor@linux-bjrd:libvirt> git commit --amend --reset-author
[master 9af44fc] add libxl lock implemetation(NOT COMPILE)
 2 files changed, 467 insertions(+)

2, fix configure and build error
1), modify autogen.sh
diff --git a/autogen.sh b/autogen.sh
index 13df98b..f405635 100755
--- a/autogen.sh
+++ b/autogen.sh
@@ -60,16 +65,9 @@ bootstrap_hash()
 # Only run bootstrap from a git checkout, never from a tarball.
 if test -d .git; then
     curr_status=.git-module-status
-    t=$(bootstrap_hash; git diff .gnulib)
-    if test "$t" = "$(cat $curr_status 2>/dev/null)" \
-        && test -f "po/Makevars"; then
-        # good, it's up to date, all we need is autoreconf
-        autoreconf -if
-    else
-        echo running bootstrap$no_git...
-        ./bootstrap$no_git --bootstrap-sync && bootstrap_hash > $curr_status \
-            || { echo "Failed to bootstrap, please investigate."; exit 1; }
-    fi
+     echo running bootstrap$no_git...
+     ./bootstrap$no_git --bootstrap-sync && bootstrap_hash > $curr_status \
+         || { echo "Failed to bootstrap, please investigate."; exit 1; }
 fi
 
 test -n "$NOCONFIGURE" && exit 0
2), autogen.sh error messsage: 
running: AUTOPOINT=true LIBTOOLIZE=true  autoreconf --verbose --install --no-recursive -I gnulib/m4
autoreconf: Entering directory `.'
autoreconf: running: true
autoreconf: running: aclocal -I m4 -I m4 -I m4 -I gnulib/m4
configure.ac:22: warning: macro `AM_SILENT_RULES' not found in library
autoreconf: configure.ac: tracing
autoreconf: running: true --copy
configure.ac:22: warning: macro `AM_SILENT_RULES' not found in library
autoreconf: running: /usr/bin/autoconf --include=gnulib/m4
autoreconf: running: /usr/bin/autoheader --include=gnulib/m4
autoreconf: running: automake --add-missing --copy --no-force
configure.ac:2976: required file `gnulib/lib/Makefile.in' not found
configure.ac:2976: required file `gnulib/tests/Makefile.in' not found
autoreconf: automake failed with exit status: 1
./bootstrap: autoreconf failed
Failed to bootstrap, please investigate.
3), manaul copy these two files from libvirt-0.9.13/gnulib
bamvor@linux-bjrd:libvirt> find gnulib/ -name Makefile.in
gnulib/lib/Makefile.in
gnulib/tests/Makefile.in
4), infinite loop: configure->make->configure->make ....
config.status: creating po/Makefile
INFO: gnulib update required; running ./autogen.sh first
make: Warning: File `Makefile' has modification time 24 s in the future
./autogen.sh
5), modify cfg.mk
diff --git a/cfg.mk b/cfg.mk
index 4cdfd1b..f49051c 100644
--- a/cfg.mk
+++ b/cfg.mk
@@ -689,10 +689,6 @@ ifeq (0,$(MAKELEVEL))
       stamp="$$($(_submodule_hash) $(_curr_status) 2>/dev/null)";	\
       test "$$stamp" = "$$actual"; echo $$?)
   _clean_requested = $(filter %clean,$(MAKECMDGOALS))
-  ifeq (1,$(_update_required)$(_clean_requested))
-    $(info INFO: gnulib update required; running ./autogen.sh first)
-Makefile: _autogen
-  endif
 endif
 
 # Give credit where due:

6), build error
libtool: compile:  gcc -std=gnu99 -DHAVE_CONFIG_H -I. -I.. -I../gnulib/lib -I../gnulib/lib -I../include -I../include -I../src/util -DIN_LIBVIRT -I../src/conf -export-dynamic -I/usr/include/libxml2 -Wall -W -Wformat-y2k -Wformat-security -Winit-self -Wmissing-include-dirs -Wunused -Wunknown-pragmas -Wstrict-aliasing -Wshadow -Wpointer-arith -Wbad-function-cast -Wcast-align -Wwrite-strings -Wlogical-op -Wstrict-prototypes -Wold-style-definition -Wmissing-noreturn -Wmissing-format-attribute -Wredundant-decls -Wnested-externs -Winline -Winvalid-pch -Wvolatile-register-var -Wdisabled-optimization -Wattributes -Wcoverage-mismatch -Wdeprecated-declarations -Wdiv-by-zero -Wendif-labels -Wextra -Wformat-contains-nul -Wformat-extra-args -Wformat-zero-length -Wformat=2 -Wmultichar -Wnormalized=nfc -Woverflow -Wpointer-to-int-cast -Wpragmas -Wno-missing-field-initializers -Wno-sign-compare -Wno-format-nonliteral -fstack-protector-all --param=ssp-buffer-size=4 -fexceptions -fasynchronous-unwind-tables -fdiagnostics-show-option -funit-at-a-time -fipa-pure-const -Werror -g -O2 -MT libvirt_driver_la-libvirt.lo -MD -MP -MF .deps/libvirt_driver_la-libvirt.Tpo -c libvirt.c  -fPIC -DPIC -o .libs/libvirt_driver_la-libvirt.o
cc1: warnings being treated as errors
libvirt.c: In function 'virDomainGetEmulatorPinInfo':
libvirt.c:8981: error: logical '&&' with non-zero constant will always evaluate as true [-Wlogical-op]
make[3]: *** [libvirt_driver_la-libvirt.lo] Error 1
make[3]: Leaving directory `/home/bamvor/sda3/home/novell/work/source/virtualization/libvirt/libvirt/src'
make[2]: *** [all] Error 2
make[2]: Leaving directory `/home/bamvor/sda3/home/novell/work/source/virtualization/libvirt/libvirt/src'
make[1]: *** [all-recursive] Error 1
make[1]: Leaving directory `/home/bamvor/sda3/home/novell/work/source/virtualization/libvirt/libvirt'
make: *** [all] Error 2
(1), remove all the "-Werror" with the command: 
for f in `find . -name Makefile`; do sed "s/\-Werror//" $f -i ; done
7), build complete. 
 
4, checking
1), make check
result
=======================================
1 of 67 tests failed
(4 tests were not run)
Please report to libvir-list@redhat.com
=======================================

fail case: 
TEST: libvirtdconftest
      .....!!!!!!...!!!!!!!!!!!!!!!!!!!!!!!!!  39  FAIL
FAIL: libvirtdconftest

2), make syntax-check
(1), check author fail
((1)), message
check_author_list
bjzhang@suse.com
maint.mk: committer(s) not listed in AUTHORS
((2)), check rull in cfg.mk
# Give credit where due:
# Ensure that each commit author email address (possibly mapped via
# git log's .mailmap) appears in our AUTHORS file.
((3)), add my name in AUTHORS file

(2), check empty line fail
((1)), 
prohibit_empty_lines_at_EOF
.gitignore
maint.mk: empty line(s) or no newline at EOF
((2)), delete empy line in .gitignore

(3), check tailing space fail
((1)), message
trailing_blank
src/libxl/libxl_driver.c:1937:        if (libxlDomainObjEndJob(driver, vm))
src/libxl/libxl_driver.c:2277:
src/libxl/libxl_driver.c:2400:        if (libxlDomainObjEndAsyncJob(driver, vm))
src/libxl/libxl_driver.c:3170:
maint.mk: found trailing blank(s)

(4), check CVE-2009-4029 fail, I could not understand it. skip.
vulnerable_makefile_CVE-2009-4029
./Makefile.in:2023:     -find $(distdir) -type d ! -perm -777 -exec chmod a+rwx {} \; -o \
maint.mk: the above files are vulnerable; beware of running
  "make dist*" rules, and upgrade to fixed automake
  see http://bugzilla.redhat.com/542609 for details

5, it looks like i need to regenerate the patch in the new branch. 

6, (15:24 2012-09-04)
try send patch
1), generate patch
git format-patch base
Switched to branch 'libxl_lock_impl'
Your branch is ahead of 'origin/master' by 3 commits.
bamvor@linux-bjrd:libvirt> git branch
* libxl_lock_impl
  libxl_lock_use
  libxl_migration
  master
  migration_lock
bamvor@linux-bjrd:libvirt> git format-patch master
0001-add-libxl-lock-implementation-NOT-COMPILE.patch
0002-update-.gitignore.patch
0003-add-ATTRIBUTE_UNUSED-for-fixing-compiling-warning.patch
2), send email
(1), 
bamvor@linux-bjrd:libvirt> git send-email 000* --to bjzhang@suse.com
...
Need MIME::Base64 and Authen::SASL todo auth at /usr/local/libexec/git-core/git-send-email line 1140.
(2), 
sudo zypper in perl-Authen-SASL
(3), git send email successful after install.

13:37 2012-09-04
GTD
0, 11:45-21:20

1, today
1), 1h eating.
2), test send email from git. see"17:26 2012-09-03"6.
3), test libvirt libxl patch. see"17:08 2012-09-04"

16:30 2012-09-04
embedded, arm board, omap5 wishlist; samsung exynos 5 analysis
1, omap5 wishlist
https://groups.google.com/forum/#!topic/pandaboard/mQxpEEDM6Ww
2, Samsung Announces A15/Mali-T604 Based Exynos 5 Dual
http://www.anandtech.com/show/6148/samsung-announces-a15malit604-based-exynos-5-dual 
1), memory interface: 128bit lpddr3 memory. 
With its A5X Apple introduced the first mobile SoC with a 128-bit wide memory controller. A look at the A5X die reveals four 32-bit LPDDR2 memory partitions. The four memory channels are routed to two LPDDR2 packages each with two 32-bit interfaces (and two DRAM die) per package. Samsung, having manufactured the A5X for Apple, learned from the best. The Exynos 5 Dual is referred to as having a two-port LPDDR3-800 controller delivering 12.8GB/s of memory bandwidth. Samsung isn't specific about the width of each port, but the memory bandwidth figure tells us all we need to know. Each port is either 64-bits wide or the actual LPDDR3 data rate is 1600MHz. If I had to guess I would assume the latter. I don't know that the 32nm Exynos 5 Dual die is big eough to accommodate a 128-bit memory interface (you need to carefully balance IO pins with die size to avoid ballooning your die to accommodate a really wide interface). Either way the Exynos 5 Dual will equal Apple's A5X in terms of memory bandwidth.
TI's OMAP 5 features a 2x32-bit LPDDR2/DDR3 interface and is currently rated for data rates of up to 1066MHz, although I suspect it wouldn't be too much of a stretch to get DDR3-1600 memory working with the SoC. Qualcomm's Krait based Snapdragon S4 also has a dual-channel LPDDR2 interface, although once again there's no word on what the upper bound will be for supported memory frequencies.
(1), by vasanthakumar on Saturday, August 11, 2012
LPDDR3 consumes more power than LPDDR2 ( some people confusingly inter-relate frequency and voltage), But conveniently overlook termination stuff.
2), arm: cortex-A15; gpu: mali T604; USB 3.0, SATA 3, HDMI 1.4 and eDP 

17:08 2012-09-04
virtualization, libvirt, migration, libxl(xenlight), lock, cont19, prepare send patch to upstream, debug, cont16, test new patch on libxl_migration
1, test patch on libxl_migration
1), test migration
2), test all the command i modified. 

2, write test case for libxl api
libxlDomainCreateWithFlags: start
libxlDomainCreateXML: create
libxlDomainSuspend: suspend
libxlDomainResume: resume
libxlDomainReboot: reboot
libxlShutdownFlags: shutdown
libxlDoDomainSave: save
libxlDomainRestoreFlags: restore
libxlDomainCoreDump: dump
libxlDomainDestroyFlags: destroy
libxlDomainSetMemoryFlags: setmem
libxlDomainSetVcpusFlags: setvpus
libxlDomainModifyDeviceFlags: detach-device, detach-disk, detach-interface, detach-device, detach-disk, detach-interface, update-device, domif-setlink, change-media

17:41 2012-09-04
"Antoine Ginies <aginies@suse.com>"_email_"QA process and regression tests"_20120904_1654
hi all,
i have asked the QA team for more information about virtualisation QA
process, benchmark process, and it seems there is no specific tests.
For SP3 and SLE12 it is plan to update Virtualization packages with new
features, perhaps switch some packages to a new version, and you know
this changes can have a deep impact on previous installation and usage
of our tools.

QA process is not our tasks, but we should provide a way to do QA on our
packages, explain the difference between packages (old and new one),
change in API, package restructuring, documentation update, new/obsolete
features, explain how to do the update without breaking an running
system, etc... 

So i was wondering if you have any documentations, external/internal
links, or whatever on this subject. All kind of documentation can help:
releases-notes, TODO list, Changelogs, know bugs, etc.... I know some of
them are trivial to find, but perhaps there is some other useful which
are not public.

The idea is to collect them, and create a "standard" QA process for
virtualization, and keep it up to date for each release/SP. The big
effort will be done the first time, then few changes and updates will be
enough.

regards

-- 
Antoine Giniès
SUSE Project Manager
France

20:48 2012-09-04
opensuse12.2 release; \TODO: check the relative email in order to know the release flow
1, gold
2, social media
http://en.opensuse.org/openSUSE:Social_media_launch_plan#General_approach

08:57 2012-09-05
GTD
0, 8:55-17:52

1, today
1), 8:57 personnal stuff.
2), 11:13 test libvirt libxl patch. see"11:14 2012-09-05".

10:29 2012-09-05
shell, bash, getopts, emample
> cat getopts.sh
#!/bin/bash

while getopts 'm:r:' OPT; do
    echo "parameter is $OPT, argument is $OPTARG, next parameter at num $OPTIND"
done

> ./getopts.sh -m 123 -r asd
parameter is m, argument is 123, next parameter at num 3
parameter is r, argument is asd, next parameter at num 5

11:14 2012-09-05
virtualization, libvirt, migration, libxl(xenlight), lock, cont19, prepare send patch to upstream, debug, cont17, git stuff; test new patch on libxl_migration
1, fix branch conflict
1), if conflict is encountered, fix the conflict then add and commit, e.g.
bamvor@linux-vm5:~/work/source/virtualization/libvirt/libvirt> git pull
From .
 * branch            libxl_lock_use -> FETCH_HEAD
Auto-merged .gitignore
CONFLICT (content): Merge conflict in .gitignore
Automatic merge failed; fix conflicts and then commit the result.
bamvor@linux-vm5:~/work/source/virtualization/libvirt/libvirt> vim .gitignore
bamvor@linux-vm5:~/work/source/virtualization/libvirt/libvirt> git add .gitignore
bamvor@linux-vm5:~/work/source/virtualization/libvirt/libvirt> git commit -m "fix conflict with libxl_lock_use"
Created commit b166fed: fix conflict with libxl_lock_use

2, update build.sh: add getopts and remte connection checking. 
#!/bin/bash

while getopts 'm:r:' opt; do
    case $opt in
        m)
            echo "make argument is $OPTARG"
            make_arg=$OPTARG
            ;;
        r)
            echo "remote is $OPTARG"
            remote=$OPTARG
            ;;
        *)
            echo "Internal error!"
            exit 1
            ;;
    esac
done

if [ -z $remote ]; then
    echo "Error: remote should not empty, exit"
    exit 1
fi

ssh $remote 'echo -n'
if [ $? -ne 0 ]; then
    echo "Error: remote connection fail, exit"
    exit 1
else
    echo "remote connection successful, start building"
fi

touch tools/virsh.c
make $make_arg && sudo make install && ssh $remote 'cd /home/bamvor/work/source/virtualization/libvirt/libvirt && make install'

3, migration test fail. it seems that some update in migraiton_lock is not introduced in libxl_migration branch. \TODO.

16:19 2012-09-05
maintenance, wireshark, update from 1.4.13 to 1.4.15, cont1
1, continue to fix bug on sle9: bnc#776083
1), http://www.wireshark.org/security/wnpa-sec-2012-17.html
https://bugs.wireshark.org/bugzilla/show_bug.cgi?id=7603
http://anonsvn.wireshark.org/viewvc/trunk/epan/dissectors/packet-afp.c?r1=44317&r2=44316&pathrev=44317
bamvor: 
(1), there is not similar logic in decode_kauth_acl. 
(2), the follow changes is useless if i ignore the expert_add_info_format in decode_kauth_acl. 
hf_afp_acl_entrycount: BASE_HEX to BASE_DEC
2), http://www.wireshark.org/security/wnpa-sec-2012-20.html
https://bugs.wireshark.org/bugzilla/show_bug.cgi?id=7570
no permisstion.
(1), get info from svn(wireshark1.8)
------------------------------------------------------------------------
r44360 | gerald | 2012-08-09 04:52:36 +0800 (Thu, 09 Aug 2012) | 12 lines

Copy over r44312 from the trunk:

  ------------------------------------------------------------------------
  r44312 | mmann | 2012-08-07 13:09:59 -0700 (Tue, 07 Aug 2012) | 1 line
  Changed paths:
     M /trunk/epan/dissectors/packet-cip.c

  Add a sanity check so we don't unnecessarily allocate memory for a Multiple Serv
ice Packet message.  Bugfix 7570 (https://bugs.wireshark.org/bugzilla/show_bug.cgi
?id=7570)
  ------------------------------------------------------------------------

Update the release notes.
(2), get revision tree for epan/dissectors/packet-cip.c: "svn log epan/dissectors/packet-cip.c | less", diff changes: 
svn diff -x -up epan/dissectors/packet-cip.c -r43258:44360 > patch
not affect in sle9. 
3), http://www.wireshark.org/security/wnpa-sec-2012-22.html
https://bugs.wireshark.org/bugzilla/show_bug.cgi?id=7562
http://anonsvn.wireshark.org/viewvc/trunk/plugins/ethercat/packet-ecatmb.c?r1=43149&r2=43148&pathrev=43149
4), http://www.wireshark.org/security/wnpa-sec-2012-23.html
https://bugs.wireshark.org/bugzilla/show_bug.cgi?id=7573
no permisstion.
(1), get info from svn(wireshark1.8)
------------------------------------------------------------------------
r44404 | gerald | 2012-08-10 06:12:51 +0800 (Fri, 10 Aug 2012) | 13 lines

Copy over r44403 from the trunk:

  ------------------------------------------------------------------------
  r44403 | gerald | 2012-08-09 15:04:46 -0700 (Thu, 09 Aug 2012) | 3 lines
  Changed paths:
     M /trunk/epan/dissectors/packet-ctdb.c

  Add a check for the number of nodes. Fixes a DoS in bug 7573 reported by
  Ben Schmidt.
  ------------------------------------------------------------------------

Update the release notes.
(2), get patch
svn diff -x -up epan/dissectors/packet-ctdb.c -r43119:44404 > patch

2, osc sr for CVE-2012-4049
bamvor@linux-bjrd:wireshark.SUSE_SLE-9-SP3_Update_Teradata_Test> osc sr -m "CVE-2012-4049"
created request id 21639

3, (13:23 2012-09-06)
bamvor@linux-bjrd:wireshark.SUSE_SLE-9-SP3_Update_Teradata_Test> osc sr -m "fix wireshark bug bnc#776083"
There are already following submit request: 21639.
Supersede the old requests? (y/n/c) y
created request id 21644

4, bugzilla
this bug has been fixed, submit request id is as follows: 
SLE9 SP3 teradata: request id 21644
SLE10 SP3: request id 21599
SLE11: request id 21600
the request of SLE10 SP3 and SLE11 has been acceptted. 

17:36 2012-09-05
company, sle11 sp3, release flow, kernel update rule
1, "Thorsten Kukuk <kukuk@suse.de>"_email_"Re: [kernel] kernel plans for SLE11 SP3"_20120905_1522
> Hi,
> 
> I heard yesterday that a decision was supposedly taken to not
> up-rev the kernel for SP3. Is that indeed the case?
> 
> And independently of the answer, is there a reason why once
> again this discussion is being (or has been) carried out without
> involving the virtualization team at all? Or maybe the KVM folks
> know, and just the Xen side of things is left (intentionally?)
> alone? Or am I not subscribed to the right mailing lists (where
> if not on this one would such a discussion be held)?

The reason is quite simple: the agreement is that we will
stay on the kernel version except kernel team requests, 
after evaluating all FATEs, a kernel version update.
There was never an agreement that we will now update the
kernel version with every Service-Pack.

So this means for you, that you should always plan without
a kernel version update. If you need one, you need convience
the Labs to request a kernel update.

13:23 2012-09-06
GTD
0, 12:40

1, today
1), 20' lunch.
2), wireshark bnc776083 submit request. see"16:19 2012-09-05"3.
3), check the mail: "[devel] SLE11 SP1 overlapping maintenance period ended"

13:43 2012-09-06
allwinner, A10, MK802, opensuse, arm; power management, AXP209
1, yestoday MK802 boot opensuse arm fail. after compare the PCB with mele A1000, I found that there is no PMIC in MK802, so cpufreq can not be used. 
if i disable cpufreq, MK802 should be OK. 
\TODO update code in order to check PMIC automatically in kernel. 

2, AXP209 PMIC material
1), datasheet location
http://hands.com/~lkcl/eoma/allwinner/AXP209%20Datasheet%20v1.0_cn.pdf
2), about AXP209 and otg power supply
http://bbs.mumayi.com/thread-310982-1-1.html
3), dcdc2 for vdd core; dcdc3 for vdd ddr

15:56 2012-09-06
allwinner, A10, running opensuse on 1G memory device, MK802
1, my log
[    0.000000] CPU: VIPT nonaliasing data cache, VIPT aliasing instruction cache
[    0.000000] Machine: sun4i
[    0.000000] CONFIG_SUNXI_IGNORE_ATAG_MEM set
[    0.000000] Total Detected Memory: 1024MB with 2 banks
[    0.000000] Total Detected Memory: 1024MB with 2 banks
[    0.000000] 64 MB reserved for MALI
[    0.000000] Ignoring unrecognised tag 0x00000000
[    0.000000] Memory Reserved:
[    0.000000]  SYS  : 0x43000000 - 0x4300ffff  (  64 kB)
[    0.000000]  VE   : 0x44000000 - 0x48ffffff  (  80 MB)
[    0.000000]  G2D  : 0x58000000 - 0x58ffffff  (  16 MB)
[    0.000000]  LCD  : 0x5a000000 - 0x5bffffff  (  32 MB)
[    0.000000] Memory policy: ECC disabled, Data cache writeback
[    0.000000] On node 0 totalpages: 245760
[    0.000000] free_area_init_node: node 0, pgdat c07fb46c, node_mem_map c08b9000
[    0.000000]   Normal zone: 1280 pages used for memmap
[    0.000000]   Normal zone: 0 pages reserved
[    0.000000]   Normal zone: 146176 pages, LIFO batch:31
[    0.000000]   HighMem zone: 768 pages used for memmap
[    0.000000]   HighMem zone: 97536 pages, LIFO batch:31
2, ubuntu log
[    0.000000] CPU: ARMv7 Processor [413fc082] revision 2 (ARMv7), cr=10c5387d
[    0.000000] CPU: VIPT nonaliasing data cache, VIPT aliasing instruction cache
[    0.000000] Machine: sun4i
[    0.000000] Total Detected Memory: 1024MB with 2 banks
[    0.000000] Ignoring unrecognised tag 0x00000000
[    0.000000] Ignoring unrecognised tag 0x00000000
[    0.000000] Memory Reserved(in bytes):
[    0.000000]  SYS: 0x43000000, 0x00010000
[    0.000000]  LCD: 0x5a000000, 0x02000000
[    0.000000]  G2D: 0x58000000, 0x01000000
[    0.000000]  VE : 0x44000000, 0x05000000
[    0.000000]  RAMCONSOLE : 0x5be00000, 0x00200000
[    0.000000] Memory policy: ECC disabled, Data cache writeback
[    0.000000] On node 0 totalpages: 245248
[    0.000000] free_area_init_node: node 0, pgdat c07877b4, node_mem_map c0949000
[    0.000000]   Normal zone: 1280 pages used for memmap
[    0.000000]   Normal zone: 0 pages reserved
[    0.000000]   Normal zone: 145664 pages, LIFO batch:31
[    0.000000]   HighMem zone: 768 pages used for memmap
[    0.000000]   HighMem zone: 97536 pages, LIFO batch:31

09:04 2012-09-07
allwinner, A10, running opensuse on 1G memory device, MK802, cont1
1, try opensuse from miniand 1G ubuntu image.
Allwinner/image/ubuntu/MK802/lubuntu-desktop-12.04-3-720p-1GB-miniand
1), try miniand uboot, kernel, modules with opensuse root
OK
2), try miniand uboot with my kernel, modules with opensuse root
OK. 
(1), add usbnet DM9601 support. OK
(2), backup image. 
linux-bjrd sda3 Allwinner/image/opensuse/of=opensuse_arm_0907_1104_MK802_auto_startxfce4__with_DM9601

14:36 2012-09-07
GTD
0, 8:00-18:15

1, today
1), 40' sync meeting. 
2), 20' breakfast. 
3), 1h try opensuse arm on MK802. see"09:04 2012-09-07"
4), 1h prepare slide for hackweek. doc: log/novell/opensuse_arm/opensuse_allwinner_arm.pdf
5), 17:43 test and send lock patch to Jim. see"14:38 2012-09-07".
6), create the git for my work log. see"18:12 2012-09-07"

14:38 2012-09-07
virtualization, libvirt, migration, libxl(xenlight), lock, cont19, prepare send patch to upstream, debug, cont18, test new patch on libxl_migration, cont1
1, plan
1), test each command I modified.
2), test each command with virsh list running. 
3), test each command with virsh migration(cannot test right now because of the migration bug). 

2, update libxlVmStart
the libxl driver lock shoube remove during libxlVmStart while the virDomainObjPtr should be locked. 


    virDomainObjUnlock(vm);
    libxlDriverUnlock(driver);
    ret = libxl_domain_suspend(&priv->ctx, &suspinfo, vm->def->id, sockfd);
    libxlDriverLock(driver);
    virDomainObjLock(vm);

3, all the function except libxlDomainModifyDeviceFlags test passed invidually without "virsh list". 
git commit 36aaa9d3a2c7f085014605b1c9a3313f6c979a32

18:12 2012-09-07
git, getting started
1, git init
git add
git commit
2, git clone /path/to/git/dir
git clone usr@/path/to/git/dir 

09:37 2012-09-10
GTD
0, 9:30-18:11

1, today
1), 09:37-09:45 check the mail.
2), continue to test libxl lock driver patch. see"09:45 2012-09-10"
3), work report. see"13:45 2012-09-10"

09:45 2012-09-10
virtualization, libvirt, migration, libxl(xenlight), lock, cont19, prepare send patch to upstream, debug, cont19, test new patch on libxl_migration, cont2
1, plan
all the api have been tested individually. 
1), test the api with "virsh list" and/or job/async job.

2, read the code about lock
there are two function about vir mutex init: virMutexInit and virMutexInitRecursive. the former one is PTHREAD_MUTEX_NORMAL. the latter one is PTHREAD_MUTEX_RECURSIVE which support recusive lock, but it is not called in linux virsh pthread. 
http://pubs.opengroup.org/onlinepubs/007908799/xsh/pthread_mutex_lock.html
If the mutex type is PTHREAD_MUTEX_RECURSIVE, then the mutex maintains the concept of a lock count. When a thread successfully acquires a mutex for the first time, the lock count is set to one. Every time a thread relocks this mutex, the lock count is incremented by one. Each time the thread unlocks the mutex, the lock count is decremented by one. When the lock count reaches zero, the mutex becomes available for other threads to acquire. If a thread attempts to unlock a mutex that it has not locked or a mutex which is unlocked, an error will be returned. 

3, add trylock before virMutexLock. in virDomainObjLock and libxlDriverLock.
1), libxlDomainDoSave. 

4, generate patch
1), all the patch
/home/bamvor/sda3/home/novell/log/novell/hypervisor_and_tools/migrate/201209/0910__test_and_send_to_Jim
create the right git log. 

13:45 2012-09-10
work report - week 36
1, [devel-server] work report - week 36
[green]
1, libvirt libxl driver. 
1), test and debug libxl lock patch on the laster upstream version. 

14:13 2012-09-10
allwinner, A10, MK802, bluetooth audio
1, connection refused
# aplay -D bluetooth alert.wav
bt_audio_service_open: connect() failed: Connection refused (111)
aplay: main:696: audio open error: Connection refusedth xxx.wav

2, ref: http://ubuntuforums.org/showthread.php?t=786640
but not work. 

3, download alsa source code from http://www.alsa-project.org/main/index.php/GIT_Server. bt_audio_service_open does not exist in alsa-lib  alsa-tools  alsa-utils.

4, it seems that this function is located in bluez package. download from http://www.bluez.org/development/git/

10:37 2012-09-11
GTD
0, 10:30-

1, today
1), 从上周开始，工作又是很不在状态。主要原因是困，生活不规律。patch的事情进展缓慢。从今天开始一定要注意了，不然怎么办呢？？？
2), 10:41- send libxl lock driver patch to Jim. see"10:39 2012-09-11"
sleep 1h

10:39 2012-09-11
virtualization, libvirt, migration, libxl(xenlight), lock, cont19, prepare send patch to upstream, debug, cont20, send patch to Jim
1, create new branch and do make check, make syntax check.
2, add AbortJob
1), do I need abort the "virsh dump" in libxl. it is not in qemu, I do not know why. But in libxl driver, dump call the different api compare with migrate and save. 
2), it seems that libxl suspend不允许被打断，否则xenlight就工作不正常。
give up abort job function. 

10:28 2012-09-12
software, skill, git, try git on android pad
bamvor@linux-bjrd:temp> git clone ssh://root@147.2.215.164:2222/external_sd/log
Cloning into 'log'...
SSHDroid
Use 'root' on rooted devices otherwise any username works
Default password is 'admin'
git-upload-pack: permission denied
fatal: Could not read from remote repository.

Please make sure you have the correct access rights
and the repository exists.

2, copy git-unload-pack to /system/bin
bamvor@linux-bjrd:temp> git clone ssh://root@147.2.215.89/data/data/berserker.android.apps.sshdroid/home/temp/
Cloning into 'temp'...
SSHDroid
Use 'root' as username
Default password is 'admin'
error: cannot run pack-objects: No such file or directory
fatal: git upload-pack: unable to fork git-pack-objects
fatal: The remote end hung up unexpectedly
fatal: early EOF
fatal: index-pack failed
1), create the simbol link with proper permission.
it is work.

3, git push(method one, not suggest).
1),
bamvor@linux-bjrd:log> git push
SSHDroid
Use 'root' on rooted devices otherwise any username works
Default password is 'admin'
Counting objects: 5, done.
Delta compression using up to 8 threads.
Compressing objects: 100% (3/3), done.
Writing objects: 100% (3/3), 844 bytes, done.
Total 3 (delta 2), reused 0 (delta 0)
remote: error: refusing to update checked out branch: refs/heads/master
remote: error: By default, updating the current branch in a non-bare repository
remote: error: is denied, because it will make the index and work tree inconsistent
remote: error: with what you pushed, and will require 'git reset --hard' to match
remote: error: the work tree to HEAD.
remote: error:
remote: error: You can set 'receive.denyCurrentBranch' configuration variable to
remote: error: 'ignore' or 'warn' in the remote repository to allow pushing into
remote: error: its current branch; however, this is not recommended unless you
remote: error: arranged to update its work tree to match what you pushed in some
remote: error: other way.
remote: error:
remote: error: To squelch this message and still keep the default behaviour, set
remote: error: 'receive.denyCurrentBranch' configuration variable to 'refuse'.
To ssh://root@147.2.215.164:2222/mnt/sdcard/external_sd/log
 ! [remote rejected] master -> master (branch is currently checked out)
error: failed to push some refs to 'ssh://root@147.2.215.164:2222/mnt/sdcard/external_sd/log'
2), on remote:
git config receive.denyCurrentBranch refure
3), remote has been changed, do pull then push
bamvor@linux-bjrd:log> git push
SSHDroid
Use 'root' on rooted devices otherwise any username works
Default password is 'admin'
To ssh://root@147.2.215.164:2222/mnt/sdcard/external_sd/log
 ! [rejected]        master -> master (non-fast-forward)
error: failed to push some refs to 'ssh://root@147.2.215.164:2222/mnt/sdcard/external_sd/log'
hint: Updates were rejected because the tip of your current branch is behind
hint: its remote counterpart. Merge the remote changes (e.g. 'git pull')
hint: before pushing again.
hint: See the 'Note about fast-forwards' in 'git push --help' for details.
bamvor@linux-bjrd:log> git pull
SSHDroid
Use 'root' on rooted devices otherwise any username works
Default password is 'admin'
remote: Counting objects: 12, done.
remote: Compressing objects: 100% (8/8), done.
remote: Total 8 (delta 5), reused 0 (delta 0)
Unpacking objects: 100% (8/8), done.
From ssh://147.2.215.164:2222/mnt/sdcard/external_sd/log
 + dfb5f0c...e9ea36d master     -> origin/master  (forced update)
Merge made by the 'recursive' strategy.
4), fail again
bamvor@linux-bjrd:log> git push
SSHDroid
Use 'root' on rooted devices otherwise any username works
Default password is 'admin'
Counting objects: 8, done.
Delta compression using up to 8 threads.
Compressing objects: 100% (5/5), done.
Writing objects: 100% (5/5), 1.14 KiB, done.
Total 5 (delta 3), reused 1 (delta 0)
remote: error: refusing to update checked out branch: refs/heads/master
To ssh://root@147.2.215.164:2222/mnt/sdcard/external_sd/log
 ! [remote rejected] master -> master (branch is currently checked out)
error: failed to push some refs to 'ssh://root@147.2.215.164:2222/mnt/sdcard/external_sd/log'
(1), on remote:
switch git to a branch other than master. then git push pass:
git branch --track work
git checkout work
(2), on bjrd
bamvor@linux-bjrd:log> git push -v
Pushing to ssh://root@147.2.215.164:2222/mnt/sdcard/external_sd/log
SSHDroid
Use 'root' on rooted devices otherwise any username works
Default password is 'admin'
Counting objects: 8, done.
Delta compression using up to 8 threads.
Compressing objects: 100% (5/5), done.
Writing objects: 100% (5/5), 1.14 KiB, done.
Total 5 (delta 3), reused 1 (delta 0)
To ssh://root@147.2.215.164:2222/mnt/sdcard/external_sd/log
   e9ea36d..01707e0  master -> master
updating local tracking ref 'refs/remotes/origin/master'

5), update on remote, git pull failed, using git fetch and git merge
/mnt/sdcard/external_sd/log $ git pull
From .
 * branch            master     -> FETCH_HEAD
exec: git-merge: permission denied
/mnt/sdcard/external_sd/log $ git fetch
From .
 * branch            master     -> FETCH_HEAD
/mnt/sdcard/external_sd/log $ git merge master
Updating 01707e0..d42864c
Fast-forward
 log201209novell.txt |   89 ++++++++++++++++++++++++++++++++++++++++++++++++++-
 1 files changed, 88 insertions(+), 1 deletions(-)
/mnt/sdcard/external_sd/log $

4, (10:17 2012-09-19)
git push: set bare git repo
1), change git repo to bare repo
(1), delete all the files except .git directory
(2), set bare true
git config --bool core.bare true
(3), git clone the new repo or modify the url in .git/config
[remote "origin"]
    url = bare git repo
(4), notes: git clone will checkout a branch which is checkout in git remote repo. it should be a "master" branch. 

10:47 2012-09-12
GTD
0, 9:50

1, today
1), 30' 1.5h try git on android pad. see"10:28 2012-09-12"
2), 14:00-19:58 send libxl lock driver patch to Jim. see"14:13 2012-09-12"

14:13 2012-09-12
virtualization, libvirt, migration, libxl(xenlight), lock, cont19, prepare send patch to upstream, debug, cont21, send patch to Jim, cont1
1, restore.
本来希望保护restore, 但是restore时还没有domain obj. 所以没法保护. 放弃. 
2, 测试:
1), 测试了save和dump都能保证不会被打断(一次Ctl+c, 连续两次的情况没有测试). 
3, make check && make syntax-check pass. 

14:27 2012-09-12
kiwi, suse studio, image creator, new script in order to easily maintanence the opensuse arm image, JeOS
1, "Dirk Müller<dmueller@suse.com>"_email_"[opensuse-arm] JeOS- kiwi files are now generated"_20120911_2040
Hi, 

I've changed the way we build the ARM images. previously we used to have 
copies of a kiwi build file, config.sh and root.tar.gz for various flavors in 
openSUSE:Factory:ARM, e.g. JeOS, JeOS-panda and so on. 

This was a bit tiresome to maintain, so I wrote a small wrapper that generates 
the kiwi configs for the flavors based on a master image. 

So the current workflow should be

a) modify the stuff in openSUSE:Factory:ARM/JeOS/Image.conf.in
b) run pre_checkin.sh
c) check the resulting generated *.kiwi files inside the JeOS package
d) commit

This way we can easily apply changes that are effective for all flavors. Also 
packagelists should be mostly idential now. 

Let me know if it caused any regressions. I've reviewed the panda flavor image 
and it should be better, but I haven't looked in detail at the other variants. 

Greetings,
Dirk

16:06 2012-09-12
arm SOC, 新闻, 讨论
1, http://bbs.imp3.net/thread-10733447-1-1.html
联发科MT6588采用的是28nm制程工艺，比现在的MT6577双核提成了一个台阶，基于Cortex-A7四核架构，主频为1.xGHz，支持双通道最大1066Mbps，GPU为Power VR SGX544，相比6577的SGX531性能提高了近一倍。MT6588最高可支持1280×800的分辨率，同时集成了WCDMA和TD多模modem，即可同时支持联通和移动3G网络。另外还可支持1200万摄像头和1080P的视频录制。
据了解目前MT6588已经成功流片，预计可能会在今年10月左右到来，而且MT6588的成本将会比MT6577更低。当然量产可能就需要等到2013年了。

2, http://www.coolaler.com/showthread.php/293319-A15%E6%9E%B6%E6%9E%84%E9%A6%96%E4%BD%9C%EF%BC%81%E4%B8%89%E6%98%9F%E6%AD%A3%E5%BC%8F%E5%8F%91%E5%B8%83%E5%8F%8C%E6%A0%B8Exynos-5-Dual/page2
Exynos系列基本上就是ARM的套餐(Cortex-A15 + Mali-604)，
加上Media與Memory等等的控制器開出來的產品，談特色....

實際上，在相同Cortex-A15架構下
Qualcomm
1. 最高度的通訊模組整合
2. 最佳功耗指令集
3. 最佳的軟體整合支援

Texas Instruments OMAP
1. 最悠久的類比與電源技術
2. 最著名的達芬奇DSP處理器
3. 使用OCP匯流排標準整合SoC
4. 對OPEN SOURCE社群支持最用力的廠商

NVIDIA Tegra3
1. 擁有最具擴充性的繪圖流水線架構

MTK
1. 擁有低價高整合度的通訊模組
2. 無限多的好肝

最後使用TSMC 28nm製程製造，是不是整體效率又更上一層樓? 

16:40 2012-09-12
libvirt, virt-viewer, vnc
virt-viewer -r -w sles11_hvm_10_2
wil wait for the vm while vm is poweroff or reboot.

10:18 2012-09-13
GTD
0, 10:05-19:08

1, today
1), 10:30-14:48 send libxl lock driver patch to Jim. see"10:28 2012-09-13".
1.5h lunch and rest 
2), opensuse arm 12.2 repo: http://download.opensuse.org/repositories/openSUSE:/12.2:/ARM/standard

10:28 2012-09-13
virtualization, libvirt, migration, libxl(xenlight), lock, cont19, prepare send patch to upstream, debug, cont22, send patch to Jim, cont2
1, plan
1), add migration patch. confirm it work or not. 
2), send Chunyan and Jim with my test status. 

2, add commit message for lock usage.

3, migration fail
1), 2012-09-13 05:06:22.511+0000: 23221: error : libxlDomainMigrateConfirm3:5033 : internal error migration failed, try to resume on our end
(1), this is failed because of finish exit with dom==0. which means libvirt could not get domain xml from xenlight. 

4, send patch to Chunyan and Jim: cover letter
From 1ee1d281cd786bfb7fdfbb0b698bfddd294e27f6 Mon Sep 17 00:00:00 2001
From: Bamvor Jian Zhang <bjzhang@suse.com>
Date: Thu, 13 Sep 2012 14:21:35 +0800
Subject: [PATCH 0/3] Implement the lock and migration of libxl driver

In these series patches, there are two types of job, one is normal job, the other is async job.
1), The asynchronization job is the long-running job.
(1), it includes migration, save, restore and dump in libxl. save and migration call the same api(ref my notes at the end of this mail).
(2), I add restore as async job compare with qemu driver because the restore is also a long-running job compare with create, list and other operation.
(3), The nested async job on the same domain is not allowed in my patch.
(4), in order to tracking the async job. I assign async job type for each async job.
     LIBXL_ASYNC_JOB_MIGRATION_OUT,
     LIBXL_ASYNC_JOB_MIGRATION_IN,
     LIBXL_ASYNC_JOB_SAVE,
     LIBXL_ASYNC_JOB_DUMP,

2), The normal job is very quick compare with async job. I add such type for allowing the normal while the async job is in process.
(1), whether the normal job is allowed or not while async job is doing depend on the normal job type.
usually, only destroy, abort and query is allowed. but for migration async job, migration is not allowed too(nested migration is not allowed).

     LIBXL_JOB_DESTROY,       /* Destroys the domain (cannot be masked out) */
     LIBXL_JOB_MODIFY,        /* May change state */
     LIBXL_JOB_ABORT,         /* Abort current async job */
     LIBXL_JOB_MIGRATION_OP,  /* Operation influencing outgoing migration */
     LIBXL_JOB_ASYNC,         /* Asynchronous job */

3), the abort job is created for async job. mainly for migration.
it will block the user interrupt(Ctrl+c) while the migration, save and dump job is running. But it could not abort job actually. Because I could not find out the api could cancel the migration or core dump.

5, git send-email
git send-email --cover-letter --no-chain-reply-to --annotate --to cyliu@suse.com --cc jfehlig@suse.com 000*.patch

16:16 2012-09-14
company, colleague, Bobbi Wu
"Alan Gao"_email_"New Event Manager"
Bobbi Wu join marketing team from this week as Senior event manager base at Beijing. Before she join us, Bobbi work at ACROSSCHINA as Account Manager and serviced Oracle and Microsoft marketing events. 
She in charge of all of sales events from now, and will focus on our SUSECon China 2012 conference at Xiamen from Nov. 8 - 10th. Please join me to welcome Bobbi and give your great help and support. Thanks so much. 
Bobbi Wu
Event Manager
bwu@novell.com
(86) 186-1848-6996
 
16:17 2012-09-14
GTD
0, 16:00-19:31 20:17-21:57

1, today
1), 18:00-20:30 debug libxl migration. see"18:24 2012-09-14"

18:24 2012-09-14
virtualization, libvirt, migration, libxl(xenlight), lock, cont20, debug migration
1, I found one error message, maybe it is the reason? 
2012-09-14 10:20:43.480+0000: 14021: error : virNetSocketReadWire:1184 : End of file while reading data: Input/output error
1), add debug info in migration function. 

2, 看xl list, 能看到挂之前, memory没有增加, 难道是因为memory不够造成的???
1), log
Fri Sep 14 19:21:26 CST 2012                                                    
Name                                        ID   Mem VCPUs      State   Time(s) 
Domain-0                                     0  1805     4     r-----     114.3 
sles11_hvm_15                                3     3     1     --p---       0.0 
Fri Sep 14 19:21:27 CST 2012                                                    
Name                                        ID   Mem VCPUs      State   Time(s) 
Domain-0                                     0  1805     4     r-----     115.5 
sles11_hvm_15                                3   127     1     --p---       0.0 
Fri Sep 14 19:21:28 CST 2012                                                    
Name                                        ID   Mem VCPUs      State   Time(s) 
Domain-0                                     0  1805     4     r-----     116.8 
sles11_hvm_15                                3   259     1     --p---       0.0 
Fri Sep 14 19:21:29 CST 2012                                                    
Name                                        ID   Mem VCPUs      State   Time(s) 
Domain-0                                     0  1805     4     r-----     118.2 
sles11_hvm_15                                3   391     1     --p---       0.0 
Fri Sep 14 19:21:31 CST 2012                                                    
Name                                        ID   Mem VCPUs      State   Time(s) 
Domain-0                                     0  1805     4     r-----     119.6 
sles11_hvm_15                                3   519     1     --p---       0.0 
Fri Sep 14 19:21:32 CST 2012                                                    
Name                                        ID   Mem VCPUs      State   Time(s) 
Domain-0                                     0  1805     4     r-----     121.1 
sles11_hvm_15                                3   651     1     --p---       0.0 
Fri Sep 14 19:21:33 CST 2012                                                    
Name                                        ID   Mem VCPUs      State   Time(s) 
Domain-0                                     0  1805     4     r-----     122.5 
sles11_hvm_15                                3   771     1     --p---       0.0 
Fri Sep 14 19:21:35 CST 2012                                                    
Name                                        ID   Mem VCPUs      State   Time(s) 
Domain-0                                     0  1805     4     r-----     123.9 
sles11_hvm_15                                3   901     1     --p---       0.0 
Fri Sep 14 19:21:36 CST 2012                                                    
Name                                        ID   Mem VCPUs      State   Time(s) 
Domain-0                                     0  1805     4     r-----     124.9 
sles11_hvm_15                                3   994     1     --p---       0.0 
Fri Sep 14 19:21:37 CST 2012                                                    
Name                                        ID   Mem VCPUs      State   Time(s) 
Domain-0                                     0  1805     4     r-----     125.0 
sles11_hvm_15                                3   994     1     --p---       0.0 
Fri Sep 14 19:21:38 CST 2012                                                    
Name                                        ID   Mem VCPUs      State   Time(s) 
Domain-0                                     0  1805     4     r-----     125.2 
sles11_hvm_15                                3   994     1     --p---       0.0 
Fri Sep 14 19:21:39 CST 2012                                                    
Name                                        ID   Mem VCPUs      State   Time(s) 
Domain-0                                     0  1805     4     r-----     126.1
2), 把memory改为786M. 还是快完成时挂了, 看xl migrate
ri Sep 14 19:30:13 CST 2012                                                    
Name                                        ID   Mem VCPUs      State   Time(s) 
Domain-0                                     0  1805     4     r-----     135.1 
sles11_hvm_15                                4    11     1     --p---       0.0 
Fri Sep 14 19:30:15 CST 2012                                                    
Name                                        ID   Mem VCPUs      State   Time(s) 
Domain-0                                     0  1805     4     r-----     136.6 
sles11_hvm_15                                4   131     1     --p---       0.0 
Fri Sep 14 19:30:16 CST 2012                                                    
Name                                        ID   Mem VCPUs      State   Time(s) 
Domain-0                                     0  1805     4     r-----     137.9 
sles11_hvm_15                                4   287     1     --p---       0.0 
Fri Sep 14 19:30:17 CST 2012                                                    
Name                                        ID   Mem VCPUs      State   Time(s) 
Domain-0                                     0  1805     4     r-----     139.1 
sles11_hvm_15                                4   423     1     --p---       0.0 
Fri Sep 14 19:30:18 CST 2012                                                    
Name                                        ID   Mem VCPUs      State   Time(s) 
Domain-0                                     0  1805     4     r-----     140.4 
sles11_hvm_15                                4   567     1     --p---       0.0 
Fri Sep 14 19:30:20 CST 2012                                                    
Name                                        ID   Mem VCPUs      State   Time(s) 
Domain-0                                     0  1805     4     r-----     141.6 
sles11_hvm_15                                4   703     1     --p---       0.0 
Fri Sep 14 19:30:21 CST 2012
Name                                        ID   Mem VCPUs      State   Time(s)
Domain-0                                     0  1805     4     r-----     142.0
sles11_hvm_15                                4   747     1     --p---       0.0
Fri Sep 14 19:30:22 CST 2012
Name                                        ID   Mem VCPUs      State   Time(s)
Domain-0                                     0  1805     4     r-----     142.2
sles11_hvm_15                                4   747     1     --p---       0.0
Fri Sep 14 19:30:23 CST 2012
Name                                        ID   Mem VCPUs      State   Time(s)
Domain-0                                     0  1805     4     r-----     142.3
sles11_hvm_15                                4   747     1     --p---       0.0

log in libvirtd.log
2012-09-14 11:30:18.369+0000: 9806: info : doMigrateSend:4642 : Enter           
2012-09-14 11:30:18.369+0000: 9804: info : libxlEventHandler:780 : Unhandled shutdown_reason 2                                                                  
2012-09-14 11:30:28.999+0000: 9806: info : doMigrateSend:4693 : Exit with ret: 0

3, try Chunyan patch on upstream libvirt.
1), try it next week. 

4, (17:21 2012-09-17)
try Chunyan patch on upstream libvirt.
1), libvirtd could not find hypervisor. reboot and try it again.
(1), the reason is same as "15:47 2012-08-22"4
2), 用Chunyan migration patch. vm4->vm6 pass. vm6->vm4 fail.
but the error message is dffierent
2012-09-17 12:57:03.598+0000: 7055: error : libxlVmStart:701 : internal error libxenlight failed to restore domain 'sles11_hvm_15'
2012-09-17 12:57:03.598+0000: 7055: error : doMigrateReceive:4062 : internal error Failed to restore domain with libxenlight

5, (12:58 2012-09-18)
continue test. 
详细比较migration, vm4->vm6 migration, libvirt和xl认为是成功了. 但是实际使用时, 总是打出大量backtrace, 机器肯定不正常. 

6, discuss with Chunyan
1), novell/im/NM20120918_Discuss_with_Chunyan_about_current_libxl_work.txt
test machine for me: 207.46 and 207.155. thanks to Chunyan and Lin ma. 
2), branch from sles11 sp3, it is test on sles11 sp2
https://build.suse.de/package/show?package=libvirt&project=Devel%3AVirt%3ASLE-11-SP3

7, \TODO
1), fix error: xl认为虚拟机挂了, 但是libvirt不知道.
e.g. my git 20b1a74049bbf010bd2805159376aca546ec1483 

18:45 2012-09-14
build 3.4 kernel for Allwinner A10
1, build error
  CC [M]  drivers/net/wireless/rtl8192cu/os_dep/osdep_service.o
drivers/net/wireless/rtl8192cu/os_dep/osdep_service.c: In function 'rtw_suspend_lock_uninit':
disable CONFIG_HAS_WAKELOCK, CONFIG_WAKELOCK in kernel/power/Kconfig

17:18 2012-09-17
GTD
0, 12:30

1, today
1), personal stuff.
2), debug libxl migration. see"18:24 2012-09-14"4

12:57 2012-09-18
GTD
0, 11:30-18:30

1, today
1), xen4.2 release. see"13:25 2012-09-18"
2), debug libxl migration. see"18:24 2012-09-14"5

13:25 2012-09-18
xen, release, xen4.2 releaae
1, http://xen.org/download/index_4.2.0.html 
The Xen 4.2 release contains a number of important new features and updates including:

The release incorporates many new features and improvements to existing features. There are improvements across the board including to Security, Scalability, Performance and Documentation.

    XL is now the default toolstack: Significant effort has gone in to the XL tool toolstack in this release and it is now feature complete and robust enough that we have made it the default. This toolstack can now replace xend in the majority of deployments, see XL vs Xend Feature Comparison. As well as improving XL the underlying libxl library has been significantly improved and supports the majority of the most common toolstack features. In addition the API has been declared stable which should make it even easier for external toolstack such as libvirt and XCP's xapi to make full use of this functionality in the future.
    Large Systems: Following on from the improvements made in 4.1 Xen now supports even larger systems, with up to 4095 host CPUs and up to 512 guest CPUs. In addition toolstack feature like the ability to automatically create a CPUPOOL per NUMA node and more intelligent placement of guest VCPUs on NUMA nodes have further improved the Xen experience on large systems. Other new features, such as multiple PCI segment support have also made a positive impact on such systems.
    Improved security: The XSM/Flask subsystem has seen several enhancements, including improved support for disaggregated systems and a rewritten example policy which is clearer and simpler to modify to suit local requirements.
    Documentation: The Xen documentation has been much improved, both the in-tree documentation and the wiki. This is in no small part down to the success of the Xen Document Days so thanks to all who have taken part.

2), Xen4.2 High Level features
Security:
    Support for Intel Supervisor Mode Execution Protection (SMEP), which prevents the execution of usermode pages by the Xen hypervisor, making many application-to-hypervisor exploits much harder.
    Various Xen Security Modules (XSM) / Flask improvements. The XSM framework and the Xen Flask security module is an application of the Flask architecture to the Xen hypervisor. 
Scalability:
    Increased VM density for VDI use-cases
    Up to 4095 Host CPUs for 64 bit hypervisor
    Up to 5TB host memory support for 64 bit hypervisor
    Up to 512 VCPUs per PV VM and 256 VCPUs per HVM VM
    Support for multiple PCI segments
    Prefer oxenstored when present 
Performance
    AMD SVM DecodeAssist support
    Scheduler improvements 
EFI boot support for hosts using the 64 bit hypervisor
XL improvements, XEND is formally deprecated
Documentation improvements (e.g. man pages)
RAS:
    Enhanced MCA support to include more failure types
    APEI support (ACPI Platform Error Interface) 

2, 以代码量看, suse以15%的贡献做第二的位置. citrix是47%的贡献.

16:34 2012-09-18
virtualization, Jason and Jim reply to Chunyan
>>> Jim Fehlig <jfehlig@suse.com> 9/11/2012 10:37 AM >>>
Jason Douglas wrote:
> Hi Chunyan,
>
> On Sep 9, 2012, at 23:31, "Chun Yan Liu" <cyliu@suse.com
> <mailto:cyliu@suse.com>> wrote:
>
>> Hi, Jason,
>>
>> I'm back to office today and prepared to start working.
>>
>
> Welcome back! We look forward to talking to you soon. Our next call
> will be in 3 weeks (moved back due to SUSECon).

Yes, welcome back Chunyan!  I hope your time off with your new family
addition was enjoyed :-).

>
>> Please contact me if there is anything.
>>
>
> To start with, I'd recommend that you and Bamvor work together on the
> libvirt changes that he has been implementing. I'm not sure of the
> exact status, but it would probably be helpful for you to become
> familiar with the changes he has made and figure out how you can work
> together on libvirt moving forward.

Right.  I'd like to get Bamvor's patches committed upstream, so any help
you can provide would be much appreciated!  He has a patch set to
implement finer-grained locking in the libxl driver, in addition to the
migration patch that you started :).  These need to be finished up and
submitted upstream for review.

> Also, I don't have details yet, but in the next few weeks, you'll
> probably receive some SLES 11 SP3  fate features to work on. As those
> get assigned, please add comments or questions to fate so that we can
> track the progress appropriately.
>
> Other than that, Jim might have some suggestions for work items. Thanks.

Now that Xen 4.2 is about wrapped up, we'll need to make the libvirt
libxl driver work with the libxl in 4.2.  We'll have to keep the 4.1
support working too.  IMO, we should get the locking and migration
patches committed to upstream libvirt in the existing libxl driver.
Then, before adding any more new features to the driver, get it working
with Xen 4.2.

Welcome back!
Jim

11:04 2012-09-19
GTD
0, 10:00-11:40 12:42-18:25

1, today
1), 11:00-11:40 12:42-18:25 test lock and migration with ibs libvirt. see"11:05 2012-09-19"

11:05 2012-09-19
virtualization, libvirt, migration, libxl(xenlight), lock, cont21, test with ibs libvirt
1, xenlight is not compiled. 
same reason mentioned in "13:40 2012-05-24"1-(1) 
2, libxlDomainAbortJob build error. fix it. 
osc ci -m "fix format-extra-args in libxlDomainAbortJob"
at revision 5.
3, fix the following error in libxl_conf.h
error: negative width in bit-field '_gl_verify_error_if_negative'

remove the LIBXL_ASYNC_JOB_RESTORE in libxl_conf.h

09:51 2012-09-20
libvirt, xen, attach-disk
1, error:
if i try xen disk, i got xenlight internal error: 
box10:/mnt/bamvor_jian_zhang_temp/iso # virsh attach-disk bjz_01_sles11_sp2 ubuntu-12.04-desktop-i386.iso xvdc
error: Failed to attach disk
error: internal error libxenlight failed to attach disk 'xvdc'

/var/log/libvirt/libxl/libxl.log
libxl: error: libxl.c:900:validate_virtual_disk failed to stat ubuntu-12.04-desktop-i386.iso: No such file or directory

2, (15:56 2012-09-21)
1), Chunyan suggestion
/usr/sbin/xm block-attach xm-domain-name file://path/to/my/ISO /dev/hdc r
virsh attach-disk Id-number /path/to/your/new/ISO hdc --driver file  
2), test libvirt xend
3), test xenlight
# xl list
Name                                        ID   Mem VCPUs      State   Time(s)
Domain-0                                     0  2063     4     r-----    1360.1
sles11_hvm_10                                9   498     4     -b----      71.1
# xl block-attach sles11_hvm_10 file:///home/bamvor/work/download/filesystem/gparted-live-0.12.1-5.iso hdc
# xl block-list sles11_hvm_10
768   0   9      4     8      8        /local/domain/0/backend/qdisk/9/768
5632  0   9      3     10     911      /local/domain/0/backend/qdisk/9/5632

15:24 2012-09-21
opensuse, allwinner, A10, remote control, droidmote
1, download
http://forum.xda-developers.com/showthread.php?t=1292627
2, faq
DroidMote Server and Client F.A.Q. 
http://www.videomap.it/droidmote-faq.html

15:55 2012-09-21
GTD
0, 10:00-18:31

1, today
1), continue to try attach-disk command. see"09:51 2012-09-20"2


1), 11:00-11:40 12:42-18:25 test lock and migration with ibs libvirt. see"11:05 2012-09-19"
2, next
1), libvirt patch bug: see"18:24 2012-09-14"7
2), create git hub account. clone xen-arm to it. start to coding. ref"10:45 2012-07-13"

2, next
1), update find_keyword. do not display the full patch in find_keyword. or do not display the filename and line number while slient mode enable. add logAssistant to git. 
2), pin out the uart for MK802. 
3), opensuse arm, generate the JeOS image through kiwi, ref"14:38 2012-04-26", "14:27 2012-09-12". 
4), update po/zh_CN.po for lock and migration. 

2, next
1), opensuse arm
(1), try bluetooth and finish wrap up. ref"16:11 2012-08-03"
(2), image and rpm. put kernel and X11 display adatper library to obs. put imgae to google code. put the opensuse image link to A1000 forum. 
2), check wireshark bug. do i need involve. 

3, next week
1), libvirt libxl driver
(1), continue reviewing the job.
(2), job abort will add in the migration patch. job about is useful for long-running job. 

3, next next
1), keep an eye on XenSummit. ref"11:35 2012-08-02"
1), check the mailing list. 
2), libvirt libxl driver(migration and lock):
(1), solve the todo in "10:41 2012-07-10"3
1), build opensuse arm kernel. ref"11:37 2012-07-09"4-3). 
2), coding exercises. pthread wait.
1), read libvirt and xen mailing list. 
2), openSUSE arm. ref TODO in "9:17 2012-6-15"3-1). 

2, next day
3), libvirt qemu migration study. 
3), check the "follow up" in mail. 

2, \TODO
read SLES12 plan, ref"11:34 2012-05-31".
read SUSE cloud doc. ref"15:40 2012-06-02"

2, Monday 3), try markdown. ref "17:31 2012-05-22"
4), write the script, search anything in each section(maybe add a ignore keyword line option?).
test pattern: "build.*service|osc"
5), check out opensuse-topic, see"17:38 2012-05-22"

3, next, next
0), working hour exceed 44 hours(8 x 3 + 10 x 2) except lunch and supper. 
2), summary about buildservice and gdb debug. 

4, next of next
(2), android python script for work log search.
(3), omap3530 pv port or other work. 

14:06 2012-09-24
GTD
0, 12:30

1, today

18:10 2012-09-24
1, how foolish am i. i encounter the same problem in March. ref"16:34 2012-3-23"1-3). 

13:53 2012-09-26
virtualization, xen, tools, udev rules
1, udev rules保存在两个地方"/etc/udev/rules.d"和"/lib/udev/rules.d/". 
2, xen的脚本都在xen tools包里面, 包括storage, network等等. 
这些脚本都会在"/etc/udev/rules.d/40-xen.rules"有kernel udev事件调用. 

9:27 2012-9-27
1, 
147.2.207.77(linux-work) i5 cpu flag:
fpu de tsc msr pae mce cx8 apic sep mtrr mca cmov pat clflush acpi mmx fxsr sse sse2 ss ht syscall nx lm constant_tsc rep_good nopl nonstop_tsc aperfmperf pni pclmulqdq est ssse3 cx16 sse4_1 sse4_2 popcnt aes hypervisor lahf_lm ida arat dts
147.2.207.34(box10) i3 cpu flag
fpu de tsc msr pae mce cx8 apic sep mtrr mca cmov pat clflush acpi mmx fxsr sse sse2 ss ht syscall nx lm constant_tsc rep_good nopl nonstop_tsc aperfmperf pni est ssse3 cx16 sse4_1 sse4_2 popcnt hypervisor lahf_lm arat dts

2, 
Chun Yan Liu  (2012-9-27 11:11:27): do tests for many times. 77 to 34 is always ok now (live and non-live), 34 to 77 fails (from gdb debug, it is very strange, since Perform3 ret=0, in logic, in target end, it should enter dconn Finish3, but my it doesn't enter my Finish3 breakpoint. in source end, it enters Confirm3 with cancelled=1, I couldn't track out how this value is set.)
Chun Yan Liu  (2012-9-27 11:12:39): maybe you can try 77 and 34 to have a look.  
Chun Yan Liu  (2012-9-27 11:13:28): I'll test on vmware machines for check.
Chun Yan Liu  (2012-9-27 11:14:37): currently I just test migration (not issue other virsh commands at the same time.)
Chun Yan Liu  (2012-9-27 12:18:43): Chun Yan Liu logged out at 12:18:43.
Chun Yan Liu  (2012-9-27 15:44:52): Chun Yan Liu logged in at 15:44:52.
  Previous Conversations Above

8:12 2012-9-28
1, Lin Ma
1), uas on windows 8?

2, bamvor
1), continue debug

3, sp3
1), libxl driver for xen4.2

12:33 2012-09-29
Starting Network Manager...
Failed to start Network Manager                                        [FAILED]
See 'systemctl status NetworkManager.service' for details.
Dependency failed. Aborted start of Network Manager Wait Online        [ ABORT]
