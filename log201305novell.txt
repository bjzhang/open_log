.LOG
15:41 2013-05-02
GTD

15:55 2013-05-02
work report
1, week 17(22,April--28,April)
discuss with Jim try to fix the segment fault. the upstream eventually accept this bug.
leave?
2, week 18(29,April--5,May)

1, work report - week 15, 16
1), hackweek
working on generate opensuse 12.3 image for cubieboard:
(1), build u-boot, kernel and board configuration and put them to obs.
(2), learn how to build image through kiwi. and eventually build JeOS and XFCE image successful.
BTW: it seems that cubieboard is very popular in this hackweek, me, Dirk Müller, Matt Chen all work on it.

2), working on fix bug on libvirt libxl driver.
this bug is reported by libvirt users in mailing list. it sometimes failed after save operation.
after some debug, it fail because pointer is not valid while the callback entered.
after modify the code, it test 24 round pass compare to fail within 3 rounds without this patch. 
thanks for Boyang and Chunyan's help.

3), 3 days off.

16:16 2013-05-03
sunxi#fatload mmc 0:2 43000000 script.bin
reading script.bin

41068 bytes read
sunxi#fatload mmc 0:2 48000000 linux/uImage
reading linux/uImage

3414760 bytes read
sunxi#setenv bootargs "console=ttyS0,115200 root=/dev/mmcblk0p3 init=/init loglevel=8"
sunxi#bootm 48000000

23:33 2013-05-04
1, add mmc config, including network.
mkconfig write include/config.h including "include/configs/xxx.h".
diff --git a/boards.cfg b/boards.cfg
index e1c7b65..2971673 100644
--- a/boards.cfg
+++ b/boards.cfg
@@ -190,6 +190,7 @@ sun4i                        arm         armv7       a10-evb             allwinn
sun5i_a12                    arm         armv7       a12-evb             allwinner      sunxi
sun5i_a13                    arm         armv7       a13-evb             allwinner      sunxi
sun6i                       arm         armv7       sun6i               allwinner      sunxi
+sun6i_mmc                   arm         armv7       sun6i_mmc   allwinner      sunxi
actux1_4_16                  arm         ixp         actux1              -              -           actux1:FLASH2X2
actux1_8_16                  arm         ixp         actux1              -              -           actux1:FLASH1X8
actux1_4_32                  arm         ixp         actux1              -              -           actux1:FLASH2X2,RAM_32MB

13:59 2013-05-05
1, try rootfs or nfs root.

fatload mmc 0:2 43000000 script.bin
fatload mmc 0:2 48000000 linux/uImage_noinitrd
setenv bootargs "console=ttyS0,115200 root=/dev/mmcblk0p3 init=/init loglevel=8"
bootm 48000000

fatload mmc 0:2 43000000 script.bin
fatload mmc 0:2 40007800 linux/uImage
setenv bootargs "console=ttyS0,115200 root=rootfs init=/init loglevel=8"
bootm 40007800

2, try 独立的initramfs
fatload mmc 0:2 43000000 script.bin
fatload mmc 0:2 40007800 linux/uImage_noinitrd
fatload mmc 0:2 41000000 linux/rootfs.cpio.gz
setenv bootargs "console=ttyS0,115200 init=/init loglevel=8 initrd=0x41000000,3541253 root=/dev/ram0"
bootm 40007800

3, try multi image
mkimage -A arm -O linux -T multi -C none -a 0x40008000 -e 0x40008000 -n 'Linux' -d Image uImage

4, (17:44 2013-05-09)
simple rootfs seems successful
[    2.875152] sun6i-rtc sun6i-rtc: sun6i_rtc_gettime
[    2.879952] sun6i-rtc sun6i-rtc: read time 1970-1-1 1:37:27
[    2.885566] sun6i-rtc sun6i-rtc: setting system clock to 1970-01-01 01:37:27 UTC (5847)
[    2.893727] Warning: unable to open an initial console.
[    2.899766] Freeing init memory: 492K
[    2.903455] Write protecting the kernel text section c0008000 - c05de000
[    2.910288] rodata_test: attempting to write to read-only section:
[    2.916486] write to read-only section trapped, success
[    3.301994] ====codec_resume_events===
[    3.606928] [mmc]: mmc 0 detect change, present 1
[    4.102006] [mmc]: sdc0 set ios: clk 0Hz bm PP pm UP vdd 3.3V width 1 timing LEGACY(SDR12) dt B
[    4.122005] [mmc]: sdc0 set ios: clk 400000Hz bm PP pm ON vdd 3.3V width 1 timing LEGACY(SDR12) dt B
[    4.209329] [mmc]: *** sw_mci_dump_errinfo(L559): smc 0 err, cmd 52,  RTO !!
[    4.217274] [mmc]: *** sw_mci_dump_errinfo(L559): smc 0 err, cmd 52,  RTO !!
[    4.224356] [mmc]: sdc0 set ios: clk 400000Hz bm PP pm ON vdd 3.3V width 1 timing LEGACY(SDR12) dt B
[    4.236043] [mmc]: sdc0 set ios: clk 400000Hz bm PP pm ON vdd 3.3V width 1 timing LEGACY(SDR12) dt B
[    4.247427] [mmc]: *** sw_mci_dump_errinfo(L559): smc 0 err, cmd 5,  RTO !!
[    4.255277] [mmc]: *** sw_mci_dump_errinfo(L559): smc 0 err, cmd 5,  RTO !!
[    4.263130] [mmc]: *** sw_mci_dump_errinfo(L559): smc 0 err, cmd 5,  RTO !!
[    4.270975] [mmc]: *** sw_mci_dump_errinfo(L559): smc 0 err, cmd 5,  RTO !!
[    4.278651] [mmc]: sdc0 set ios: clk 400000Hz bm PP pm ON vdd 3.3V width 1 timing LEGACY(SDR12) dt B
[    4.287834] [mmc]: sdc0 set ios: clk 400000Hz bm PP pm ON vdd 3.3V width 1 timing LEGACY(SDR12) dt B
[    4.299403] [mmc]: sdc0 set ios: clk 400000Hz bm PP pm ON vdd 3.3V width 1 timing LEGACY(SDR12) dt B
[    4.353958] [mmc]: sdc0 set ios: clk 25000000Hz bm PP pm ON vdd 3.3V width 1 timing LEGACY(SDR12) dt B
[    4.418407] [mmc]: sdc0 set ios: clk 25000000Hz bm PP pm ON vdd 3.3V width 4 timing LEGACY(SDR12) dt B
[    4.427773] mmc0: new SD card at address 8a08
[    4.432958] mmcblk0: mmc0:8a08 SD02G 1.84 GiB 
[    4.439327]  mmcblk0: p2 p3

5, disable verify while booting in order to avoid CRC error.
setenv verify n

6, try to compile busybox by myself.
1), u-boot
fatload mmc 0:2 43000000 script.bin
fatload mmc 0:2 48000000 linux/uImage
setenv bootargs "console=ttyS0,115200 root=rootfs init=/bin/sh loglevel=8"
bootm 48000000

1), it should be work, because it prompt about initial console:
[    3.758628] Warning: unable to open an initial console.
[    3.768112] Root-NFS: no NFS server address
[    3.775424] VFS: Unable to mount root fs via NFS, trying floppy.
[    3.790277] VFS: Cannot open root device "rootfs" or unknown-block(2,0)
Please append a correct "root=" boot option; here are the available partitions:
[    3.803567] Please append a correct "root=" boot option; here are the available partitions:
[    3.819127] Kernel panic - not syncing: VFS: Unable to mount root fs on unknown-block(2,0)



5, how to align the image before mkimage?

17:06 2013-05-07
1, Jim_email_20130503
libvirt 1.0.5 was released today.  I've packaged it and committed to
Devel:Virt:SLE-11-SP3.  It has passed libvirt-tck testing on kvm and
I've done a fair amount of testing on xen (legacy xend stack).  Please
give it a try.  If no issues are found, I will submit it for RC2
sometime Friday afternoon (MDT).

Lin,
You have been testing PCI passthrough recently, so maybe you are setup
to do some basic PCI passthrough testing on xen and kvm with 1.0.5.

Chunyan, Bamvor,
Please use 1.0.5 for any SP3 testing or SP3 bug investigations you are
doing.
Mark,
Can you give it a spin on s390?

I would like to ensure there are no regressions with 1.0.5 since it is
quite late in the cycle for new versions :).

BTW, as it currently stands, libvirt 1.0.5 will be the version in f19,
so we'll have the whole fedora machinery helping maintain the stable
branch of this release.

Thanks,
Jim
2, add repo
repo: http://download.suse.de/ibs/Devel:/Virt:/SLE-11-SP3/SLE_11_SP3/
3, \TODO
add SDK DVD to vm.
3, check whether all the patch is pushed into libvirt 1.0.5

10:52 2013-05-09
0, try qdisk on sles11 sp3 rc1 in xl. xen 4.2.2, libvirt 1.0.5
xl create successful.
disk=[ 'format=raw, vdev=xvda, access=rw, backendtype=qdisk, target=/var/lib/xen/images_2/sles11_sp2_pv/disk0.raw', ]
1, backend: qdisk
# xenstore-ls /local/domain/0/backend/qdisk
1 = ""
 51712 = ""
  frontend = "/local/domain/1/device/vbd/51712"
  params = "aio:/var/lib/xen/images_2/sles11_sp2_pv/disk0.raw"
  frontend-id = "1"
  online = "1"
  removable = "0"
  bootable = "1"
  state = "4"
  dev = "xvda"
  type = "qdisk"
  mode = "w"
  device-type = "disk"
  feature-barrier = "1"
  info = "0"
  hotplug-status = "connected"
  sector-size = "512"
  sectors = "4194304"

2, frontend
# xenstore-ls /local/domain/1/device/vbd/51712
backend = "/local/domain/0/backend/qdisk/1/51712"
backend-id = "0"
state = "4"
virtual-device = "51712"
device-type = "disk"
ring-ref = "8"
event-channel = "12"
protocol = "x86_64-abi"

3, try again on xen 4.3 on sles11 sp2.
xl create successful but xl vnc hang.
1), backend
# xenstore-ls /local/domain/0/backend/qdisk
1 = ""
 51712 = ""
  frontend = "/local/domain/1/device/vbd/51712"
  params = "aio:/var/lib/xen/images_2/sles11_sp2_pv/disk0.raw"
  frontend-id = "1"
  online = "1"
  removable = "0"
  bootable = "1"
  state = "4"
  dev = "xvda"
  type = "qdisk"
  mode = "w"
  device-type = "disk"
  feature-flush-cache = "1"
  feature-persistent = "1"
  info = "0"
  sector-size = "512"
  sectors = "4194304"
  hotplug-status = "connected"
2), frontend
# xenstore-ls /local/domain/1/device/vbd/51712
backend = "/local/domain/0/backend/qdisk/1/51712"
backend-id = "0"
state = "4"
virtual-device = "51712"
device-type = "disk"
ring-ref = "8"
event-channel = "12"
protocol = "x86_64-abi"

4, try xen 4.2.2 on sp2.
successful.

5, discuss with Jim:
  Previous Conversations Above
Jim Fehlig: I was probably using whatever was in SP3 beta4
Jim Fehlig: xen4.2.1 IIRC
Jim Fehlig: maybe 4.2.2
Jim Fehlig: but SP3 beta4 for sure
Bamvor Jian Zhang: in xen4.3, xl create succesful, but i could not connect to vm through vnc. 
Bamvor Jian Zhang: the backend is qdisk in xenstore-ls. i guess something go wrong in create. 
Jim Fehlig: you should try to track that down since xen4.3 is near release
Jim Fehlig: would be nice to know what the problem is before 4.3 final
Jim Fehlig: I haven't tried 4.3 yet
Jim Fehlig: maybe get around to it tomorrow or Friday
Jim Fehlig: let me know if you find anything
Bamvor Jian Zhang: ok. 
Jim Fehlig: I'm done for the day 
Jim Fehlig: talk to you later, have a good day
Bamvor Jian Zhang: sorry, just one question
Bamvor Jian Zhang: where could find the debug log for xl. xl -v ?
Bamvor Jian Zhang: i want to compare the log while vm create. i could get in libxl.log if i use libvirt. but i do not know in xl.
Jim Fehlig: hmm, I'm not sure
Jim Fehlig: don't see anything in xl or xl.cfg man pages
Jim Fehlig: or http://wiki.xen.org/wiki/XL
Jim Fehlig: the libvirt libxl driver fopens the logfile and calls xtl_createlogger_stdiostream() to wire up the logging
Jim Fehlig: you could see if xl does something similar via some undocumented option or env var
Jim Fehlig logged out at 12:05:07 PM.

3, try libvirt.
1), check the patch.

22:01 2013-05-09
1, error
[  213s] gcc-4.6 -P -E -Ui386 -DEFI -D__ASSEMBLY__ -include /usr/src/packages/BUILD/xen-4.3/xen/include/xen/config.h -O2 -fomit-frame-pointer -m64 -fno-strict-aliasing -Wall -Wstrict-prototypes -Wdeclaration-after-statement -Wno-unused-but-set-variable -DNDEBUG -fno-builtin -fno-common -Wredundant-decls -iwithprefix include -Werror -Wno-pointer-arith -pipe -I/usr/src/packages/BUILD/xen-4.3/xen/include -I/usr/src/packages/BUILD/xen-4.3/xen/include/asm-x86/mach-generic -I/usr/src/packages/BUILD/xen-4.3/xen/include/asm-x86/mach-default -msoft-float -fno-stack-protector -fno-exceptions -Wnested-externs -mno-red-zone -mno-sse -fpic -fno-asynchronous-unwind-tables -DGCC_HAS_VISIBILITY_ATTRIBUTE -nostdinc -g -D__XEN__ -include /usr/src/packages/BUILD/xen-4.3/xen/include/xen/config.h -DHAS_ACPI -DHAS_GDBSX -DHAS_PASSTHROUGH -DMAX_PHYS_CPUS=256 -MMD -MF .efi.lds.d -o efi.lds xen.lds.S
[  213s] boot.c: In function 'efi_init_memory':
[  213s] boot.c:1574:13: error: implicit declaration of function 'map_pages_to_xen' [-Werror=implicit-function-declaration]
[  213s] boot.c:1574:13: error: nested extern declaration of 'map_pages_to_xen' [-Werror=nested-externs]

1), the first try, not work:
> cat fix_efi_boot.patch
Index: xen-4.3/xen/arch/x86/efi/boot.c
===================================================================
--- xen-4.3.orig/xen/arch/x86/efi/boot.c
+++ xen-4.3/xen/arch/x86/efi/boot.c
@@ -25,6 +25,7 @@
 #include <asm/mm.h>
 #include <asm/msr.h>
 #include <asm/processor.h>
+#include <asm/page.h>

 #define SHIM_LOCK_PROTOCOL_GUID \
       { 0x605dab50, 0xe046, 0x4300, {0xab, 0xb6, 0x3d, 0xd8, 0x10, 0xdd, 0x8b, 0x23} }

2), pass, this time. but fail on stubdom
> cat fix_efi_boot.patch
Index: xen-4.3/xen/arch/x86/efi/boot.c
===================================================================
--- xen-4.3.orig/xen/arch/x86/efi/boot.c
+++ xen-4.3/xen/arch/x86/efi/boot.c
@@ -25,6 +25,7 @@
 #include <asm/mm.h>
 #include <asm/msr.h>
 #include <asm/processor.h>
+#include <xen/mm.h>

 #define SHIM_LOCK_PROTOCOL_GUID \
       { 0x605dab50, 0xe046, 0x4300, {0xab, 0xb6, 0x3d, 0xd8, 0x10, 0xdd, 0x8b, 0x23} }

3), error message:
[  242s] [ -d mini-os-x86_64-grub ] || \
[  242s]        for i in $(cd /usr/src/packages/BUILD/xen-4.3/stubdom/../extras/mini-os ; find . -type d) ; do \
[  242s]                 mkdir -p mini-os-x86_64-grub/$i ; \
[  242s]        done
[  242s] /usr/bin/wget -c http://xenbits.xen.org/xen-extfiles/polarssl-1.1.4-gpl.tgz
[  242s] --2013-05-09 14:42:18--  http://xenbits.xen.org/xen-extfiles/polarssl-1.1.4-gpl.tgz
[  242s] Resolving xenbits.xen.org... failed: Name or service not known.
[  242s] wget: unable to resolve host address `xenbits.xen.org'
[  242s] make[1]: *** [polarssl-1.1.4-gpl.tgz] Error 1

4), only make tools.
create fail.

09:00 2013-05-10
Hi, Jim

i am not sure whether i could meet u at im today, because i have to repair my car this morning.

as i said, i have test the qdisk backend on sles11 sp3 rc1 successful and test on sles11 sp2 fail.
i found that in sp2 i use xen4.3 with the old qemu-xen from sp1 xen-4.1.2 package. So, i update the qemu-xen to qemu xen 4.3 rc1, the lastest qemu xen version. but it still not work. just the different problem. 
1, when i using xen4.3 with old qemu-xen, xl create successful but the vm not actual run.
2, when i using xen4.3 with lastest qemu-xen, xl create fail.
3, test xen4.2.2 from sp3 repo on sp2 machine, it is worked. So, this issue should not relative to linux kernel.

i am compiling some old versions in xen-unstable in order to check which version is worked as u said yestoday. i will try it after i came back to office.

bamvor

15:36 2013-05-10
1, 才看到Ian Campbell在5月1日给我回了信.
reply to him: 
>On Tue, 2013-04-30 at 00:07 +0800, Bamvor Zhang wrote:
>>* hi, *
>>* *
>>* i have got the mele quad core STB. it is indeed has the same uart*
>>* connector as mele A1000. and the MP tools is out, it could support *
>>* make a bootable sd card. So, i am trying to put opensuse 12.3 on it.*
>>* the photos and bootlog, ref: *
>>* http://xen_on_arm.farbox.com/post/mele_m9_quadcore *
>Cool! Thanks for posting there. Are you still planning to try and get
>Xen running on this system?
yes. it is what i want.
>With my Xen.org hat on I'm quite interested in this platform (and in the
>A20/A31 generally),
So, do i. Currently, A20/A31 is only open source SOC in Cortex-A7 world.
i guess it is the cheapest device for arm virtualization.
>so I'll be keeping an eye on your progress. Good
>Luck & See you on xen-devel@ ;-)!
Thanks, i will.
right now, i only post some xen tools patches to xen-devel with the email:
bjzhang at suse.com. i hope i could participate the xen arm hypervisor
development too.
>Ian.

Bamvor

16:05 2013-05-10
try uart code on A31
1, which is the default mode for Cortex-A7? hyp?
how to setup the mininal environment for Cortex-A7.
do i need set the vector for Cortex-A7 in the front of the start? I guess So.
2, how to compile the asm code?
arm-none-eabi-gcc head.S -o head -T uart_test.lds

3, 
sunxi#fatload mmc 0:2 0x4000a000 linux/head.image
sunxi#bootm 0x4000a000
## Booting kernel from Legacy Image at 4000a000 ...
   Image Name:   uart_test
   Image Type:   ARM U-Boot Standalone Program (uncompressed)
   Data Size:    36277 Bytes = 35.4 KiB
   Load Address: 40008000
   Entry Point:  40008000
   Verifying Checksum ... OK
   Loading Standalone Program ... OK
OK
[      57.183] ERROR : swi entry mismatch[      57.183] The input swi number is 16777215, 0x00ffffff

4, 搞了半天居然是把elf文件打包了.
sunxi#fatload mmc 0:2 0x4000a000 linux/head
reading linux/head

37094 bytes read
sunxi#md 4000a000
4000a000: 464c457f 00010101 00000000 00000000    .ELF............
4000a010: 00280002 00000001 00000180 00000034    ..(.........4...
4000a020: 000084e0 05000002 00200034 00280001    ........4. ...(.
4000a030: 000b000e 00000001 00008000 00000000    ................
4000a040: 00000000 00000444 00000460 00000007    ....D...`.......

\TODO: check the elf header.

5, generate the bin file
        arm-none-eabi-gcc head.S -o head -T uart_test.lds
        arm-none-eabi-objcopy --gap-fill=0xff -O binary head head.bin
        mkimage -A arm -O u-boot -T standalone -C none -a 0x40008000 -e 0x40008000 -n 'uart_test' -d head.bin head.Image

6,
#fatload mmc 0:2 0x4000a000 linux/head.bin
#go 0x4000a000

fail

7, but the basic uart write test pass. with "mw 0x01c28000 0x61".

8, start modify from head.S
1), EARLY_UART_BASE_ADDRESS is defined in debug-xxx.inc. the latter one is selected in xen/arch/arm/Rules.mk
ref: docs/misc/arm/early-printk.txt
add debug-sun6i.inc
notes: for simple, i just skip the early_uart_init which is called by init_uart.
because the uart should be initiated successful by the u-boot.
2), proc-ca15.S, asm/processor-ca15.h. cortex_a15_init.
So, cortex-A7 should have the same code as cortex-A15, So, just skip it.
maybe i need add cortex-a7 id. 
3), PT_ means page table. PT_UPPER, PT_LOWER get the different page table attribute bits.
4), memory layout in include/asm-arm/config.h
/*
 * Memory layout:
 *  0  -   2M   Unmapped
 *  2M -   4M   Xen text, data, bss
 *  4M -   6M   Fixmap: special-purpose 4K mapping slots
 *  6M  -  8M   Early boot misc (see below)
 *
 * 32M - 128M   Frametable: 24 bytes per page for 16GB of RAM
 * 256M -  1G   VMAP: ioremap and early_ioremap use this virtual address
 *                    space
 *
 *  1G -   2G   Xenheap: always-mapped memory
 *  2G -   4G   Domheap: on-demand-mapped
 *
 * The early boot misc area is used:
 *   - in head.S for the DTB for device_tree_early_init().
 *   - in setup_pagetables() when relocating Xen.
 */

9, try build, if i saw the uart print, continue coding
ref: http://wiki.xen.org/wiki/Xen_ARM_with_Virtualization_Extensions
make dist-xen XEN_TARGET_ARCH=arm32 CROSS_COMPILE=arm-none-linux-gnueabi- CONFIG_EARLY_PRINTK=sun6i
1), fail
prelink.o:(.ARM.exidx+0x0): undefined reference to `__aeabi_unwind_cpp_pr1'
prelink.o:(.ARM.exidx+0x20): undefined reference to `__aeabi_unwind_cpp_pr0'
http://blog.csdn.net/feihongwang/article/details/7474813
http://blog.csdn.net/ce123/article/details/6621579
from gcc manpage: 
-nostdlib
    Do not use the standard system startup files or libraries when
    linking.  No startup files and only the libraries you specify will
    be passed to the linker, options specifying linkage of the system
    libraries, such as "-static-libgcc" or "-shared-libgcc", will be
    ignored.  The compiler may generate calls to "memcmp", "memset",
    "memcpy" and "memmove".  These entries are usually resolved by
    entries in libc.  These entry points should be supplied through
    some other mechanism when this option is specified.

    One of the standard libraries bypassed by -nostdlib and
    -nodefaultlibs is libgcc.a, a library of internal subroutines that
    GCC uses to overcome shortcomings of particular machines, or
    special needs for some languages.

    In most cases, you need libgcc.a even when you want to avoid other
    standard libraries.  In other words, when you specify -nostdlib or
    -nodefaultlibs you should usually specify -lgcc as well.  This
    ensures that you have no unresolved references to internal GCC
    library subroutines.  (For example, __main, used to ensure C++
    constructors will be called.)

add it in Config.mk:
Config.mk:EMBEDDED_EXTRA_CFLAGS += -nostdlib
\TODO: why no one found this? does the compile version too low?

2), generate the uImage
mkimage -A arm -T kernel -a 0x40200000 -e 0x40200000 -C none -d "xen/xen.bin" xen-uImage 

boot:
fatload mmc 0:2 40008000 linux/xen-uImage
bootm 40008000


3), hang. i found that i forget to modify the Rules.mk in xen/arch/arm

4), hang. from dissemble, i found that the link address is 0x80200000, So, we need change the link addr.

5), it looks like i need slow down. i plan to read the dissemble from u-boot.bin line by line and create a dedicated small environment.

10, (08:18 2013-05-12)
try arm-linux-gnueabihf- from linaro. it is ok. oh, i god, i waste a lots of time about compiler.
build command: 
make dist-xen XEN_TARGET_ARCH=arm32 CROSS_COMPILE=arm-linux-gnueabihf- CONFIG_EARLY_PRINTK=sun6i
link: http://releases.linaro.org/13.04/components/toolchain/binaries/gcc-linaro-arm-linux-gnueabihf-4.8-2013.04-20130417_linux.tar.bz2
and after update the compiler to 4.8 gnueabihf, there is no need to add -nostdlib while linking.
notes: there are two types of boot log: cpu 0 and other cpu.

sunxi#fatload mmc 0:2 40008000 linux/xen-uImage
reading linux/xen-uImage

590648 bytes read
sunxi#bootm 40008000
## Booting kernel from Legacy Image at 40008000 ...
Image Name:
Image Type:   ARM Linux Kernel Image (uncompressed)
Data Size:    590584 Bytes = 576.7 KiB
Load Address: 40200000
Entry Point:  40200000
Verifying Checksum ... OK
Loading Kernel Image ... OK
OK
[      28.570]

Starting kernel ...

cpu 0:
- UART enabled -
- CPU 00000000 booting -
- Machine ID 00000f34- Setting up control registers -
- Turning on paging -
- Ready 

other cpu: 
- CPU 00000007 booting -
- UART enabled -
- Setting up control registers -
- Turning on paging -
- Ready
1), crash after memory mapping in hyper mode. it is because the sun6i using 0x40000000 as phy base while others using 0x80000000. and the latter one is same as the ttb in hypermode.

14:15 2013-05-13
1, enter_hyp_mode is specific to VE model/Arndale.
update it.
1), add sun6i.h in xen/include/asm-arm/platforms
2), Interrupt Controller Type Reg is implementation defined. according to ARM_ARM.
but the implemnt in cortex-a7 and cortex-a15 is the same. it might be different in qualcomm processor.

2, cortex_a15_init.
currently, cortex_a15_init only enable SMP bit in ACTLR(Auxiliary Control Register).
it is as the same as cortex-a7.

3, current log
- UART enabled -
- CPU 00000000 booting -
- Machine ID 00000f34 -
- Started in Secure state -
- Entering Hyp mode -
- CPSR 400001da -
- Zero BSS -
- Setting up control registers -
- WARNING: using cortex_a15_init for Cortex-A7 -
- Turning on paging -
- Ready -

the mode is hyp mode. it seems that enter C code. 
but i need check the mapping.

4, Cortex-A7 and cortex-A15 do not implment the specific for HTCR. So, it is common code for them.

5, after some analysis, i know that the console addr will not be wrong. because the page table base address is get from array in mm.c, and the uart physical address is get from r11. r11 is set at the beginning of the head.S.

6, ensure that i enter start_xen. if so, maybe i need add device tree for sun6i.
it seems that dead in smp_clear_cpu_maps, but only c code in it. it should not happen. 
unless data abort???

13:12 2013-05-14
virtualization, libvirt
1, 
gcc -std=gnu99 -I/usr/include/libxml2 -I/usr/include/PolicyKit -I/usr/include/dbus-1.0 -I/usr/lib64/dbus-1.0/include -I/usr/include/dbus-1.0 -I/usr/lib64/dbus-1.0/include -W -Waddress -Wall -Warray-bounds -Wattributes -Wbad-function-cast -Wchar-subscripts -Wclobbered -Wcomment -Wcomments -Wcoverage-mismatch -Wdeprecated-declarations -Wdisabled-optimization -Wdiv-by-zero -Wempty-body -Wendif-labels -Wextra -Wformat-contains-nul -Wformat-extra-args -Wformat-security -Wformat-y2k -Wformat-zero-length -Wformat=2 -Wignored-qualifiers -Wimplicit -Wimplicit-function-declaration -Wimplicit-int -Winit-self -Winline -Wint-to-pointer-cast -Winvalid-pch -Wlogical-op -Wmain -Wmissing-braces -Wmissing-field-initializers -Wmissing-format-attribute -Wmissing-include-dirs -Wmissing-noreturn -Wmissing-parameter-type -Wmultichar -Wnested-externs -Wnonnull -Wnormalized=nfc -Wold-style-declaration -Wold-style-definition -Woverflow -Woverride-init -Wparentheses -Wpointer-arith -Wpointer-sign -Wpointer-to-int-cast -Wpragmas -Wreturn-type -Wsequence-point -Wshadow -Wstrict-aliasing -Wstrict-prototypes -Wswitch -Wtrigraphs -Wtype-limits -Wuninitialized -Wunknown-pragmas -Wunused -Wunused-function -Wunused-label -Wunused-parameter -Wunused-value -Wunused-variable -Wvariadic-macros -Wvolatile-register-var -Wwrite-strings -Wno-missing-field-initializers -Wno-sign-compare -Wno-format-nonliteral -fstack-protector-all --param=ssp-buffer-size=4 -fexceptions -fasynchronous-unwind-tables -fdiagnostics-show-option -funit-at-a-time -fipa-pure-const -fPIE -DPIE -DQEMUD_PID_FILE=\"\" -fmessage-length=0 -O2 -Wall -D_FORTIFY_SOURCE=2 -fstack-protector -funwind-tables -fasynchronous-unwind-tables -g -W -Waddress -Wall -Warray-bounds -Wattributes -Wbad-function-cast -Wchar-subscripts -Wclobbered -Wcomment -Wcomments -Wcoverage-mismatch -Wdeprecated-declarations -Wdisabled-optimization -Wdiv-by-zero -Wempty-body -Wendif-labels -Wextra -Wformat-contains-nul -Wformat-extra-args -Wformat-security -Wformat-y2k -Wformat-zero-length -Wformat=2 -Wignored-qualifiers -Wimplicit -Wimplicit-function-declaration -Wimplicit-int -Winit-self -Winline -Wint-to-pointer-cast -Winvalid-pch -Wlogical-op -Wmain -Wmissing-braces -Wmissing-field-initializers -Wmissing-format-attribute -Wmissing-include-dirs -Wmissing-noreturn -Wmissing-parameter-type -Wmultichar -Wnested-externs -Wnonnull -Wnormalized=nfc -Wold-style-declaration -Wold-style-definition -Woverflow -Woverride-init -Wparentheses -Wpointer-arith -Wpointer-sign -Wpointer-to-int-cast -Wpragmas -Wreturn-type -Wsequence-point -Wshadow -Wstrict-aliasing -Wstrict-prototypes -Wswitch -Wtrigraphs -Wtype-limits -Wuninitialized -Wunknown-pragmas -Wunused -Wunused-function -Wunused-label -Wunused-parameter -Wunused-value -Wunused-variable -Wvariadic-macros -Wvolatile-register-var -Wwrite-strings -Wno-missing-field-initializers -Wno-sign-compare -Wno-format-nonliteral -fstack-protector-all --param=ssp-buffer-size=4 -fexceptions -fasynchronous-unwind-tables -fdiagnostics-show-option -funit-at-a-time -fipa-pure-const -pie -Wl,-z -Wl,relro -Wl,-z -Wl,now -o .libs/libvirtd libvirtd-libvirtd.o libvirtd-libvirtd-config.o libvirtd-remote.o libvirtd-stream.o libvirtd-remote_protocol.o libvirtd-lxc_protocol.o libvirtd-qemu_protocol.o -fmessage-length=0 -O2 -Wall -D_FORTIFY_SOURCE=2 -fstack-protector -funwind-tables -fasynchronous-unwind-tables -g  -L/lib64 ../src/.libs/libvirt-lxc.so ../src/.libs/libvirt-qemu.so /usr/src/packages/BUILD/libvirt-1.0.5/src/.libs/libvirt.so ../src/.libs/libvirt_driver_xen.a -lxenstore ../src/.libs/libvirt_driver_libxl.a -lxenlight -lxenctrl ../src/.libs/libvirt_driver_storage.a -lblkid ../src/.libs/libvirt_driver_network.a ../src/.libs/libvirt_driver_interface.a -lnetcontrol ../src/.libs/libvirt_driver_nodedev.a -ludev /usr/lib64/libpciaccess.so ../src/.libs/libvirt_driver_secret.a ../src/.libs/libvirt_driver_nwfilter.a ../src/.libs/libvirt.so -lcap-ng -lyajl -lnl -laudit -ldevmapper /usr/lib64/libxml2.so -lz -lm -lnuma /usr/lib64/libavahi-client.so /usr/lib64/libavahi-common.so -lpolkit-dbus -lpolkit -ldbus-1 -lgnutls -lgcrypt /usr/lib64/libsasl2.so -lresolv -lselinux -lapparmor ../gnulib/lib/.libs/libgnu.a -lrt -lpthread -lutil -ldl -pthread
../src/.libs/libvirt_driver_libxl.a(libvirt_driver_libxl_impl_la-libxl_driver.o): In function `libxlVmReap':
/usr/src/packages/BUILD/libvirt-1.0.5/src/libxl/libxl_driver.c:697: undefined reference to `virHostdevManagerReAttachHostdevs'
../src/.libs/libvirt_driver_libxl.a(libvirt_driver_libxl_impl_la-libxl_driver.o): In function `libxlVmStart':
/usr/src/packages/BUILD/libvirt-1.0.5/src/libxl/libxl_driver.c:954: undefined reference to `virHostdevManagerPrepareHostdevs'
../src/.libs/libvirt_driver_libxl.a(libvirt_driver_libxl_impl_la-libxl_driver.o): In function `libxlDomainShutdownFlags':
/usr/src/packages/BUILD/libvirt-1.0.5/src/libxl/libxl_driver.c:1762: undefined reference to `virHostdevManagerReAttachHostdevs'
collect2: ld returned 1 exit status
2, this is because not modify the po/POTFILES.in
diff --git a/po/POTFILES.in b/po/POTFILES.in
index f3ea4da..a7c21bf 100644
--- a/po/POTFILES.in
+++ b/po/POTFILES.in
@@ -188,6 +188,7 @@ src/util/viruri.c
 src/util/virusb.c
 src/util/virutil.c
 src/util/virxml.c
+src/util/virhostdevmanager.c
 src/vbox/vbox_MSCOMGlue.c
 src/vbox/vbox_XPCOMCGlue.c
 src/vbox/vbox_driver.c

14:32 2013-05-14
company, about bonus
"LuAnn Johnson <LuAnn.Johnson@Attachmate.com>"_email_"Discretionary Bonus Payment"_20130514_0354
As a follow-up to Jeff Hawn’s email on May 6, 2013, here is some additional information concerning the discretionary bonus payment announced in that communication.
 
Because our financial results did not meet the minimum threshold required, there will be no payout issued under the FY13 Variable Pay Program (VPP).  However, as an acknowledgement of the many successes that did take place which are not reflected in our financial results, we will be making a one-time discretionary bonus payment to eligible employees.  The payout will be calculated at 20% of what an eligible employee would have received as payout under the FY13 VPP had profit attainment been 100%.
 
Eligibility
 
To be eligible to receive this bonus, an employee must meet all of the following criteria.
 
Be an active employee in good standing as of the date the payout is made. 
An active employee in good standing is defined as one who:
Has not tendered a voluntary resignation,
Is not on garden leave or in a notice or transition period prior to terminating employment for any cause,
Is not on a formal Performance Improvement Plan (PIP).
Not be a participant in a commission, sales or revenue based incentive plan or an individual bonus plan or program nor with agreements or contracts that exclude participation in a bonus plan.
 
 
Payout Calculation
 
FY13 Eligible earnings** X
 
Target bonus percentage as of March 31, 2013
 
X         20% =   Discretionary Bonus Payment
 
 
**Eligible earnings are defined as:
·         actual base earnings before taxes and other deductions
·         overtime pay
·         stand by, pager or beeper pay
·         shift differential pay
·         Eligible earnings are those paid between April 1, 2012 and March 31, 2013.

 
Eligible earnings do not include:
·         disability insurance payments
·         statutory sick pay (where provided by law)
·         compensation paid, regardless of the source, while on a leave of absence
·         relocation reimbursement
·         bonuses (e.g., VPP, referral, discretionary, etc.)
·         miscellaneous reimbursements  (expenses, dental, etc.)
 
 
Payout Schedule
 
Country
Pay day
Australia
May 29, 2013
Belgium
May 24, 2013
Brazil
May 24, 2013
Canada
May 31, 2013
China
May 30, 2013
Czech Republic
June 14, 2013
Denmark
May 24, 2013
France (Attachmate)
May 27, 2013
France (Novell)
May 29, 2013
Germany
May 24, 2013
Hong Kong
May 24, 2013
India
May 31, 2013
Ireland (Attachmate)
May 27, 2013
Ireland (Novell)
May 24, 2013
Italy
May 27, 2013
Japan
May 31, 2013
Mexico
May 31, 2013
Netherlands
May 24, 2013
Norway
May 24, 2013
Singapore
May 24, 2013
South Africa
May 24, 2013
Spain
May 27, 2013
Sweden
May 24, 2013
Switzerland
May 24, 2013
Taiwan
May 31, 2013
UK
May 24, 2013
USA
May 31, 2013
 
 
Our commitment to the company’s Total Compensation philosophy remains strong and we look forward to a successful and prosperous FY14.
 
14:35 2013-05-14
mailing list, virtualization
"Lars Kurth <lars.kurth@xen.org>"_email_"[XenARM] [Votes] Xen Project Governance v2 , Mailing List Conventions v1, 2014 Event Locations (open to all)"_20130513_1830
Dear Community Members,

as part of the move of Xen to the Linux Foundation, I have made a few 
proposals for Governance changes on the Xen Project mailing lists in the 
last few weeks. To avoid voting fatigue, several proposals are up for 
review or voting:

- For vote:Xen Project Governance v2 at 
http://www.xenproject.org/component/content/article/80-developers/136-governance-v2-proposal.html
- For vote:Mailing List Conventions v1 at 
http://www.xenproject.org/component/content/article/80-developers/139-mailing-list-conventions.html 

- For vote: Dates and Locations for 2014 Events (see below)

Regards
Lars

Voting for Proposals
====================
Two proposals Xen Project Governance v2 and Mailing List Conventions v1 
are up for vote using this voting form 
(http://www.xenproject.org/component/content/article/98-developers/vote/127-vote-governance-v2-and-mailing-list-conventions-v1.html). 
As the two proposals affect all Xen Project teams, all maintainers, 
committers and project leads of mature projects and the community 
manager can vote. The vote will be open until May 20, 2013.

Voting for Events
=================

As it is very hard to book event space on short notice, I wanted to ask 
you all where to hold Xen Project user and developer events in 2014. 
Earlier this year, there was a debate whether we should rotate Xen 
Events around the globe. The answer was a very strong*yes*. As we have a 
Hackathon and Xen Developer Summit in Europe this year, Europe will not 
be an option for a developer event in 2014.

Rather than creating a voting form, I decided to use the voting feature 
on the newxenproject.org website. To vote, you need to create an 
account. If you have difficulties, let me know. The poll isat 
http://www.xenproject.org/help/questions-and-answers/vote-on-2014-event-locations.html. 
The vote will stay open until the middle of June.

15:19 2013-05-14
virtualization, xen, arm, allwinner A31, sun6i
1,
1), hang in "cpumask_set_cpu(0, &cpu_online_map)"
start_xen:419
start_xen:422
smp_clear_cpu_maps:83
smp_clear_cpu_maps:85
smp_clear_cpu_maps:87
2), comment smp_clear_cpu_maps
start_xen:419
start_xen:422
start_xen:425
No valid device tree

2, 
log.sh make dist-xen XEN_TARGET_ARCH=arm32 CROSS_COMPILE=arm-linux-gnueabihf- CONFIG_EARLY_PRINTK=sun6i CONFIG_DTB_FILE=/home/bamvor/work_bak/arm/Allwinner/source/sun6i/linux-A31-2v0/arch/arm/boot/dts/sun6i.dtb

3, invalid dtb?
the dtb is generated by:
dtc -I dts -O dtb sun6i.dts > sun6i.dtb
downlaod arndale kernel check how dtbs is generated by kernel.

09:39 2013-05-15
GTD
0, 9:20-

1, today
1), work report

\TODO: install SLES11 SP3 RC1 and test this bug. the xen and libvirt package is not update. i need update libvirt at first.

2, next
1), console patch: do the make test and send it to Chunyan.

2, \TODO
1), subscribe LWN while my palpay account have enough money.
1), keep an eye on Xen Test Days. see"13:29 2013-02-22"1
2), do some work if jim gsoc is not selected by student and opensuse.org. see"18:08 2013-03-22"
3), is there any other changes in Jim libvirt libxl xen4.2 support patch. like console things?
在Jim xen4.2 patch里面有没有类似影响console的libxl功能的修改?

2, daily work
1), tracking xen-arm update.
2), read libvirt and xen-devel quickly, should less that 30minutes.
3), read linux news
http://www.linux.com/
http://www.phoronix.com/scan.php?page=home

3, week plan
1), send console patch to upstream.
2), finish libxl block status and relative functions.
3), libvirt libxl lock patch. see"14:24 2013-03-13"6.

4, next
1), read code about lastest kernel porting. see"11:49 2013-02-07".
1), coding excise for pthread_atfork.
2), rt-thread moto control driver in lua. first version do not use the PWM.

1), for libxl xen4.2 bug, figure out why virsh got event after libxl think its done. see"10:41 2013-01-24".
2), write code for libxl qmp. see"17:15 2013-01-23"
4), read jim patch on libvirt and xen.
3), debug libvirt libxl console. see"16:50 2013-01-04"
1), send xen libexec patch.
1), test Jim patch for libxl xen4.2 bug. see"11:00 2012-12-21"
3), re-read all the patch about libxl xen4.2.
1), got arm technical symposia pdf.
2), libvirt blkstats:
(1), add block stats in libxl_qmp.c, add cmd in xl.
(2), add patch in libvirt, send it to Jim. if the former patch only accept by xen-unstable not xen4.2-testing. i could not send patch to libvirt upstream.
3), try xen on kvm.
4), 对于vi不能方便查找keywords这个事情, 实在不能忍了, 如果这周能把managed save和bridge-utils bug fix, 就把这个做一个.

3, next week
1), work on lock patch.
2), try to build MK802 kernel on obs. speed up. i want it work on opensuse12.3
2), read kernel doc: "10:36 2012-11-23"
1), read code for patch. see"10:25 2012-11-23"2-2)-(2).
2), after "1)" finish. try xen on kvm.
3), read the mail on "Andrew Wafaa <awafaa@opensuse.org>"_email_"[opensuse-arm] Fwd: [fedora-arm] ARMv8 Bootstrap Project"_20121122
3), work on xen on ARM. ref"22:33 2012-11-19"
4), check the error from "10:18 2012-11-15"2
2012-11-15 04:02:45.318+0000: 4307: error : virNodeGetSecurityModel:9567 : this function is not supported by the connection driver: virNodeGetSecurityModel
5), ask jim to invite me to xen irc.

3, next next
1), gsoc: "22:23 2012-11-17"
1), notes about Huawei from eet-china.
2), read bug:https://bugzilla.novell.com/show_bug.cgi?id=781425

2, next
1), try to improve attach-disk, detach-disk in libxl driver, see"18:17 2012-11-07"4
2), test attach-disk command. see"10:41 2012-10-30"2
3), maybe libxl and qemu could communicate with qemu through xenstore?

libxl_dm.c:
        /* Find uuid and the write the vnc password to xenstore for qemu. */
        t = xs_transaction_start(ctx->xsh);
        vm_path = libxl__xs_read(&gc,t,libxl__sprintf(&gc, "%s/vm", p->dom_path));
        if (vm_path) {
            /* Now write the vncpassword into it. */
            pass_stuff = libxl__calloc(&gc, 3, sizeof(char *));
            pass_stuff[0] = "vncpasswd";
            pass_stuff[1] = info->vncpasswd;
            libxl__xs_writev(&gc,t,vm_path,pass_stuff);

3, for Jim
1), xenlight event lock in libvirt. see"16:52 2012-11-06"2-1).

4, next month
1), opensuse on MK802
(1), generate the 512MB version with opensuse12.2 RC2 which enable yast fist run.
(2), try opensuse based on ubuntu kernel in order to solve the error from miniand.
2), try qemu-dm instead of qemu xen
3), try xl create.

10:21 2013-05-15
software skill, Linux, X11, KDE, copy and paste
"Ctrl+;" select paste source.

12:48 2013-05-15
1, check how kernel compile dtb
git clone -b arndale git://xenbits.xen.org/people/julieng/linux-arm.git linux
cd linux
make xen_dom0_arndale_defconfig
make zImage
make dtbs
2, 
/home/bamvor/sda5_rd/home/bamvor/work_bak/arm/samsung_exynos/linux/scripts/dtc/dtc -O dtb -o arch/arm/boot/dts/exynos5440-ssdk5440.dtb -b 0  -d arch/arm/boot/dts/.exynos5440-ssdk5440.dtb.d arch/arm/boot/dts/exynos5440-ssdk5440.dts
3, compile for sun6i
/home/bamvor/sda5_rd/home/bamvor/work_bak/arm/samsung_exynos/linux/scripts/dtc/dtc -O dtb -o arch/arm/boot/dts/sun6i.dtb -b 0  -d arch/arm/boot/dts/.sun6i.dtb.d arch/arm/boot/dts/sun6i.dts
4, 
Starting kernel ...

- UART enabled -
- CPU 00000000 booting -
- Machine ID 00000f34 -
- Started in Secure state -
- Entering Hyp mode -
- Zero BSS -
- Setting up control registers -
- WARNING: using cortex_a15_init for Cortex-A7 -
- Turning on paging -
- Ready -
start_xen:419
start_xen:422
start_xen:425
fdt<00600100>
fdt[0]<5>
ret<-9>
No valid device tree
5, (17:34 2013-05-20)
the fdt is came from power PC. So, it is the BE.
#define FDT_MAGIC	0xd00dfeed	/* 4: version, 4: total size */
it will be "edfe0dd0" in image.

6, add debug print and compile:
log.sh make dist-xen XEN_TARGET_ARCH=arm32 CROSS_COMPILE=arm-linux-gnueabihf- CONFIG_EARLY_PRINTK=sun6i CONFIG_DTB_FILE=/home/bamvor/work_bak/arm/samsung_exynos/linux/arch/arm/boot/dts/sun6i.dts CONFIG_LOAD_ADDRESS=0x40000000
mkimage -A arm -T kernel -a 0x40200000 -e 0x40200000 -C none -d "xen/xen.bin" xen-uImage
1), !!!  wrong config, should be dtb not dts!!!

7, dead in scan dtb
start_xen:419
start_xen:422
start_xen:425
BOOT_MISC_VIRT_START<600000>, fdt_paddr<402d7700>, device_tree_flattened<6d7700>
fdt<006d7700>
fdt[0]<edfe0dd0>
device_tree_early_init:540
device_tree_for_each_node:250. node<0>, depth<0>.
device_tree_for_each_node:250. node<90>, depth<1>.
device_tree_for_each_node:250. node<14c>, depth<2>.
device_tree_for_each_node:250. node<158>, depth<3>.
device_tree_for_each_node:250. node<1bc>, depth<1>.
device_tree_for_each_node:250. node<21c>, depth<1>.
device_tree_for_each_node:250. node<24c>, depth<1>.
device_tree_for_each_node:250. node<278>, depth<2>.

8, next: check dts with arndale board.
get nothing.

9, (15:23 2013-05-21)
1), fail in cpu node:
start_xen:419
start_xen:422
start_xen:425
BOOT_MISC_VIRT_START<600000>, fdt_paddr<402d7700>, device_tree_flattened<6d7700>
fdt<006d7700>
fdt[0]<edfe0dd0>
device_tree_early_init:545
device_tree_for_each_node:250. node<0>, name<>, depth<0>.
early_scan_node return
device_tree_for_each_node:250. node<90>, name<chosen>, depth<1>.
early_scan_node return
device_tree_for_each_node:250. node<14c>, name<modules>, depth<2>.
early_scan_node return
device_tree_for_each_node:250. node<158>, name<module@0>, depth<3>.
xen,multiboot-module node
early_scan_node return
device_tree_for_each_node:250. node<1bc>, name<hypervisor>, depth<1>.
early_scan_node return
device_tree_for_each_node:250. node<21c>, name<aliases>, depth<1>.
early_scan_node return
device_tree_for_each_node:250. node<24c>, name<cpus>, depth<1>.
early_scan_node return
device_tree_for_each_node:250. node<278>, name<cpu@0>, depth<2>.
cpu node
2), after add debug info, i know that it fail at cpumask_set_cpu. same as cpumask_set_cpu in smp_clear_cpu_maps.
print SCR:
- System Control Register 0020056e -
the [1] should be 0 for both SCTLR and HSCTLR.
but it not work.

10, if i comment the bitop function, it will run to 
start_xen:435
Placing Xen at 0x00000000bfe00000-0x00000000c0000000

it seems a lots of problem. maybe, i missing something important?

11, 
- get dtb from xen image -
- dtb address 402d7700 -
- CPU 00000000 booting -
- Machine ID 00000f34 -
- Started in Secure state -
- Entering Hyp mode -
- Zero BSS -
- Setting up control registers -
- WARNING: using cortex_a15_init for Cortex-A7 -
- Turning on paging -
- Ready -
start_xen:419
start_xen:422
smp_clear_cpu_maps:100
smp_clear_cpu_maps:102
smp_clear_cpu_maps:104
cpumask_set_cpu_debug:91
cpu<0>, nr_cpu_ids<128>
cpumask_check_debug:84
dstp<2d4234>, bits<2d4234, 0, 0, 0, 0>
smp_clear_cpu_maps:106
cpumask_set_cpu_debug:91
cpu<0>, nr_cpu_ids<128>
cpumask_check_debug:84
dstp<2d4224>, bits<2d4224, 0, 0, 0, 0>
smp_clear_cpu_maps:108
start_xen:425
BOOT_MISC_VIRT_START<600000>, fdt_paddr<402d7700>, device_tree_flattened<6d7700>
fdt<006d7700>
fdt[0]<edfe0dd0>
device_tree_early_init:551
device_tree_for_each_node:250. node<0>, name<>, depth<0>.
early_scan_node return
device_tree_for_each_node:250. node<90>, name<chosen>, depth<1>.
early_scan_node return
device_tree_for_each_node:250. node<14c>, name<modules>, depth<2>.
early_scan_node return
device_tree_for_each_node:250. node<158>, name<module@0>, depth<3>.
xen,multiboot-module node
early_scan_node return
device_tree_for_each_node:250. node<1bc>, name<hypervisor>, depth<1>.
early_scan_node return
device_tree_for_each_node:250. node<21c>, name<aliases>, depth<1>.
early_scan_node return
device_tree_for_each_node:250. node<24c>, name<cpus>, depth<1>.
early_scan_node return
device_tree_for_each_node:250. node<278>, name<cpu@0>, depth<2>.
cpu node
process_cpu_node:426
process_cpu_node:434
process_cpu_node:436
process_cpu_node:443
process_cpu_node:446. start<0>, size<0>
process_cpu_node:449
early_scan_node return
device_tree_for_each_node:250. node<2c4>, name<cpu@1>, depth<2>.
cpu node
process_cpu_node:426
process_cpu_node:434
process_cpu_node:436
process_cpu_node:443
process_cpu_node:446. start<0>, size<1>
process_cpu_node:449
early_scan_node return
device_tree_for_each_node:250. node<314>, name<memory>, depth<1>.
memory node
early_scan_node return
device_tree_for_each_node:250. node<34c>, name<timer>, depth<1>.
early_scan_node return
device_tree_for_each_node:250. node<3b4>, name<interrupt-controller@01C81000>, depth<1>.
early_scan_node return
device_tree_for_each_node:250. node<490>, name<serial@01C28000>, depth<1>.
early_scan_node return
device_tree_for_each_node:250. node<534>, name<fixed-rate-clocks>, depth<1>.
early_scan_node return
device_tree_for_each_node:250. node<54c>, name<xxti>, depth<2>.
early_scan_node return
RAM: 0000000040000000 - 00000000bfffffff

MODULE[1]: 0000000060000000 - 0000000060400000 
start_xen:431
start_xen:435
Placing Xen at 0x00000000bfe00000-0x00000000c0000000

15:35 2013-05-17
software skill, resize filesystem, ext4, lvs, lv, vg, resize ext4 filesystem on lvs
1, requirement
/dev/system/root: 13->15.26G
/dev/system/home: 18.26->16G
2, reduce filesystem and then reduce vg.
extend vg and then reduce filesystem.
if the sequence wrong, e.g. first extend vg, reduce system and then reduce filesystem. it wil fail. because the filesystem could not read/write outside its vg. so, fsck.ext4 will fail.

linux-bjrd:/ # resize2fs /dev/system/home 16G
resize2fs 1.41.9 (22-Aug-2009)
Resizing the filesystem on /dev/system/home to 4194304 (4k) blocks.
The filesystem on /dev/system/home is now 4194304 blocks long.
linux-bjrd:/ # lvs
  LV   VG     Attr      LSize  Pool Origin Data%  Move Log Copy%  Convert
  home system -wi-a---- 19.00g
  root system -wi-a---- 12.00g
linux-bjrd:/ # vgs
  VG     #PV #LV #SN Attr   VSize  VFree
  system   2   2   0 wz--n- 31.26g 268.00m
linux-bjrd:/ # lvreduce -L 16G /mn
linux-bjrd:/ # vgchange -an system
  0 logical volume(s) in volume group "system" now active
linux-bjrd:/ # lvreduce -L 16G system/home
  Reducing logical volume home to 16.00 GiB
  Logical volume home successfully resized
linux-bjrd:/ # lvextend -L15626M system/root
  Rounding size to boundary between physical extents: 15.26 GiB
  Extending logical volume root to 15.26 GiB                   
  Logical volume root successfully resized                     
linux-bjrd:/ # vgchange -ay system
  2 logical volume(s) in volume group "system" now active
linux-bjrd:/ # mount /dev/system/home /mnt/               
linux-bjrd:/ # resize2fs /dev/system/root 15626M
resize2fs 1.41.9 (22-Aug-2009)                  
Resizing the filesystem on /dev/system/root to 4000256 (4k) blocks.
The filesystem on /dev/system/root is now 4000256 blocks long.    

15:52 2013-05-17
[  106s] + tar xfj /usr/src/packages/SOURCES/xen-utils-0.1.tar.bz2 -C /usr/src/packages/BUILD/xen-4.3/tools
[  106s] + mv polarssl-1.1.4-gpl.tgz /usr/src/packages/BUILD/xen-4.3/xen/stubdom
[  106s] mv: cannot stat `polarssl-1.1.4-gpl.tgz': No such file or directory


xen.spec
Source6:        xen-utils-0.1.tar.bz2
Source7:        polarssl-1.1.4-gpl.tgz

%prep
%setup -q -n %xen_build_dir -a 1 -a 2 -a 3 -a 4 -a 5 -a 20000
tar xfj %{SOURCE6} -C $RPM_BUILD_DIR/%{xen_build_dir}/tools
mv %{SOURCE7} $RPM_BUILD_DIR/%{xen_build_dir}/xen/stubdom

15:39 2013-05-20
1, 
[  457s] error: Installed (but unpackaged) file(s) found:
[  457s]    /usr/etc/qemu/target-x86_64.conf
[  457s]    /usr/libexec/qemu-bridge-helper
2, error again
[  449s] ... checking filelist
[  450s] xen-tools: "/usr/etc/qemu/target-x86_64.conf" is not allowed anymore in FHS 2.2.
[  450s] xen-tools: "/usr/libexec" is not allowed anymore in FHS 2.2.
[  450s] xen-tools: "/usr/libexec/qemu-bridge-helper" is not allowed anymore in FHS 2.2.
1), meaning
http://forums.opensuse.org/english/other-forums/development/open-build-service-obs/411537-error-prg-not-allowed-anymore-fhs-2-2-a.html
Hi
You need to have a read here;
<http://www.pathname.com/fhs/2.2/>

Basically it means /usr/local/bin is not allowed anymore. I think you
need to use /opt instead.
2), how to solve it.
http://lists.opensuse.org/opensuse-buildservice/2008-12/msg00022.html
On Tue, Dec 02, 2008 at 04:37:29PM +0100, Carsten Hoeger wrote:
>Hi,
>in order to install our stuff to /opt/open-xchange, I needed to add
>BuildRequires: -post-build-checks
>to my specfile (I found that solution into the obs ml archive).
>That, however, makes it impossible for me to build locally using rpmbuild:
Use
#!BuildIgnore: post-build-checks
instead.
Cheers,
Michael.

13:19 2013-05-22
software skill, ssh, remove all the keys for dedicate ip address
bamvor@linux-rd:~> ssh t9200
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@    WARNING: REMOTE HOST IDENTIFICATION HAS CHANGED!     @
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
IT IS POSSIBLE THAT SOMEONE IS DOING SOMETHING NASTY!
Someone could be eavesdropping on you right now (man-in-the-middle attack)!
It is also possible that a host key has just been changed.
The fingerprint for the RSA key sent by the remote host is
fa:ff:c8:37:dc:59:0c:10:87:36:99:30:fd:e3:0f:a0.
Please contact your system administrator.
Add correct host key in /home/bamvor/.ssh/known_hosts to get rid of this message.
Offending RSA key in /home/bamvor/.ssh/known_hosts:1
You can use following command to remove all keys for this IP:
ssh-keygen -R t9200 -f /home/bamvor/.ssh/known_hosts
RSA host key for t9200 has changed and you have requested strict checking.
Host key verification failed.

14:54 2013-05-22
1, crash on sles11 sp3 rc1 on vmware. 
2, xl create successful on physical machine(linux-work)
# xl -v create sles11_sp2_pv
Parsing config from sles11_sp2_pv                                          
libxl: detail: libxl_dom.c:195:numa_place_domain: NUMA placement candidate with 1 nodes, 4 cpus and 725 KB free selected                                        
domainbuilder: detail: xc_dom_allocate: cmdline="root=/dev/xvda2 resume=/dev/xvda1 splash=silent showopts  ", features="(null)"                                 
domainbuilder: detail: xc_dom_kernel_mem: called                                
domainbuilder: detail: xc_dom_malloc            : 11795 kB                      
domainbuilder: detail: xc_dom_do_gunzip: unzip ok, 0x33f2d5 -> 0xb84c90         
domainbuilder: detail: xc_dom_ramdisk_mem: called                               
domainbuilder: detail: xc_dom_boot_xen_init: ver 4.3, caps xen-3.0-x86_64 xen-3.0-x86_32p hvm-3.0-x86_32 hvm-3.0-x86_32p hvm-3.0-x86_64                         
domainbuilder: detail: xc_dom_parse_image: called                               
domainbuilder: detail: xc_dom_find_loader: trying ELF-generic loader ...        
domainbuilder: detail: loader probe OK                                          
xc: detail: elf_parse_binary: phdr: paddr=0x2000 memsz=0x6aa000                 
xc: detail: elf_parse_binary: phdr: paddr=0x6ac000 memsz=0x66680                
xc: detail: elf_parse_binary: phdr: paddr=0x713000 memsz=0xd68                  
xc: detail: elf_parse_binary: phdr: paddr=0x714000 memsz=0x9f80                 
xc: detail: elf_parse_binary: phdr: paddr=0x71e000 memsz=0x154000               
xc: detail: elf_parse_binary: memory: 0x2000 -> 0x872000                        
xc: detail: elf_xen_parse_note: GUEST_OS = "linux"                              
xc: detail: elf_xen_parse_note: GUEST_VERSION = "2.6"                           
xc: detail: elf_xen_parse_note: XEN_VERSION = "xen-3.0"                         
xc: detail: elf_xen_parse_note: VIRT_BASE = 0xffffffff80000000                  
xc: detail: elf_xen_parse_note: PADDR_OFFSET = 0x0                              
xc: detail: elf_xen_parse_note: ENTRY = 0xffffffff80002000                      
xc: detail: elf_xen_parse_note: HYPERCALL_PAGE = 0xffffffff80003000             
xc: detail: elf_xen_parse_note: unknown xen elf note (0xd)                      
xc: detail: elf_xen_parse_note: MOD_START_PFN = 0x1                             
xc: detail: elf_xen_parse_note: INIT_P2M = 0xffffea0000000000                   
xc: detail: elf_xen_parse_note: FEATURES = "writable_page_tables|writable_descriptor_tables|auto_translated_physmap|supervisor_mode_kernel"                     
xc: detail: elf_xen_parse_note: SUPPORTED_FEATURES = 0x80f                      
xc: detail: elf_xen_parse_note: LOADER = "generic"                              
xc: detail: elf_xen_parse_note: SUSPEND_CANCEL = 0x1                            
xc: detail: elf_xen_addr_calc_check: addresses:                                 
xc: detail:     virt_base        = 0xffffffff80000000                           
xc: detail:     elf_paddr_offset = 0x0                                          
xc: detail:     virt_offset      = 0xffffffff80000000                           
xc: detail:     virt_kstart      = 0xffffffff80002000                           
xc: detail:     virt_kend        = 0xffffffff80872000                           
xc: detail:     virt_entry       = 0xffffffff80002000                           
xc: detail:     p2m_base         = 0xffffea0000000000                           
domainbuilder: detail: xc_dom_parse_elf_kernel: xen-3.0-x86_64: 0xffffffff80002000 -> 0xffffffff80872000                                                        
domainbuilder: detail: xc_dom_mem_init: mem 512 MB, pages 0x20000 pages, 4k each
domainbuilder: detail: xc_dom_mem_init: 0x20000 pages                           
domainbuilder: detail: xc_dom_boot_mem_init: called                             
domainbuilder: detail: x86_compat: guest xen-3.0-x86_64, address size 64        
domainbuilder: detail: xc_dom_malloc            : 1024 kB                       
domainbuilder: detail: xc_dom_build_image: called                               
domainbuilder: detail: xc_dom_alloc_segment:   kernel       : 0xffffffff80002000 -> 0xffffffff80872000  (pfn 0x2 + 0x870 pages)                                 
domainbuilder: detail: xc_dom_pfn_to_ptr: domU mapping: pfn 0x2+0x870 at 0x7fe7f3fb3000                                                                         
xc: detail: elf_load_binary: phdr 0 at 0x0x7fe7f3fb3000 -> 0x0x7fe7f465d000     
xc: detail: elf_load_binary: phdr 1 at 0x0x7fe7f465d000 -> 0x0x7fe7f46c3680     
xc: detail: elf_load_binary: phdr 2 at 0x0x7fe7f46c4000 -> 0x0x7fe7f46c4d68     
xc: detail: elf_load_binary: phdr 3 at 0x0x7fe7f46c5000 -> 0x0x7fe7f46cef80     
xc: detail: elf_load_binary: phdr 4 at 0x0x7fe7f46cf000 -> 0x0x7fe7f4735000     
domainbuilder: detail: xc_dom_alloc_segment:   ramdisk      : 0xffffffff80872000 -> 0xffffffff817d5000  (pfn 0x872 + 0xf63 pages)                               
domainbuilder: detail: xc_dom_pfn_to_ptr: domU mapping: pfn 0x872+0xf63 at 0x7fe7f3050000                                                                       
domainbuilder: detail: xc_dom_do_gunzip: unzip ok, 0x6b3c82 -> 0xf62610         
domainbuilder: detail: xc_dom_alloc_segment:   phys2mach    : 0xffffffff817d5000 -> 0xffffffff818d5000  (pfn 0x17d5 + 0x100 pages)                              
domainbuilder: detail: xc_dom_pfn_to_ptr: domU mapping: pfn 0x17d5+0x100 at 0x7fe7f2f50000                                                                      
domainbuilder: detail: xc_dom_alloc_page   :   start info   : 0xffffffff818d5000 (pfn 0x18d5)                                                                   
domainbuilder: detail: xc_dom_alloc_page   :   xenstore     : 0xffffffff818d6000 (pfn 0x18d6)                                                                   
domainbuilder: detail: xc_dom_alloc_page   :   console      : 0xffffffff818d7000 (pfn 0x18d7)                                                                   
domainbuilder: detail: nr_page_tables: 0x0000ffffffffffff/48: 0xffff000000000000 -> 0xffffffffffffffff, 1 table(s)                                              
domainbuilder: detail: nr_page_tables: 0x0000007fffffffff/39: 0xffffff8000000000 -> 0xffffffffffffffff, 1 table(s)                                              
domainbuilder: detail: nr_page_tables: 0x000000003fffffff/30: 0xffffffff80000000 -> 0xffffffffbfffffff, 1 table(s)                                              
domainbuilder: detail: nr_page_tables: 0x00000000001fffff/21: 0xffffffff80000000 -> 0xffffffff81bfffff, 14 table(s)                                             
domainbuilder: detail: xc_dom_alloc_segment:   page tables  : 0xffffffff818d8000 -> 0xffffffff818e9000  (pfn 0x18d8 + 0x11 pages)                               
domainbuilder: detail: xc_dom_pfn_to_ptr: domU mapping: pfn 0x18d8+0x11 at 0x7fe7f2f3f000                                                                       
domainbuilder: detail: xc_dom_alloc_page   :   boot stack   : 0xffffffff818e9000 (pfn 0x18e9)                                                                   
domainbuilder: detail: xc_dom_build_image  : virt_alloc_end : 0xffffffff818ea000
domainbuilder: detail: xc_dom_build_image  : virt_pgtab_end : 0xffffffff81c00000
domainbuilder: detail: xc_dom_boot_image: called                                
domainbuilder: detail: arch_setup_bootearly: doing nothing                      
domainbuilder: detail: xc_dom_compat_check: supported guest type: xen-3.0-x86_64 <= matches                                                                     
domainbuilder: detail: xc_dom_compat_check: supported guest type: xen-3.0-x86_32p                                                                               
domainbuilder: detail: xc_dom_compat_check: supported guest type: hvm-3.0-x86_32
domainbuilder: detail: xc_dom_compat_check: supported guest type: hvm-3.0-x86_32p                                                                               
domainbuilder: detail: xc_dom_compat_check: supported guest type: hvm-3.0-x86_64
domainbuilder: detail: xc_dom_update_guest_p2m: dst 64bit, pages 0x20000        
domainbuilder: detail: clear_page: pfn 0x18d7, mfn 0x5f113                      
domainbuilder: detail: clear_page: pfn 0x18d6, mfn 0x5f114                      
domainbuilder: detail: xc_dom_pfn_to_ptr: domU mapping: pfn 0x18d5+0x1 at 0x7fe7f2f3c000                                                                        
domainbuilder: detail: start_info_x86_64: called                                
domainbuilder: detail: setup_hypercall_page: vaddr=0xffffffff80003000 pfn=0x3   
domainbuilder: detail: domain builder memory footprint                          
domainbuilder: detail:    allocated                                             
domainbuilder: detail:       malloc             : 12971 kB                      
domainbuilder: detail:       anon mmap          : 0 bytes                       
domainbuilder: detail:    mapped                                                
domainbuilder: detail:       file mmap          : 0 bytes                       
domainbuilder: detail:       domU mmap          : 25492 kB                      
domainbuilder: detail: arch_setup_bootlate: shared_info: pfn 0x0, mfn 0xdb47b   
domainbuilder: detail: shared_info_x86_64: called                               
domainbuilder: detail: vcpu_x86_64: called                                      
domainbuilder: detail: vcpu_x86_64: cr3: pfn 0x18d8 mfn 0x5f112                 
domainbuilder: detail: launch_vm: called, ctxt=0x7fff6b5ee4e0                   
domainbuilder: detail: xc_dom_release: called                                   
Daemon running with PID 28033                                                   
linux-work:/var/lib/xen/images_2/sles11_sp2_pv # xl list                        
Name                                        ID   Mem VCPUs      State   Time(s) 
Domain-0                                     0  3182     4     r-----     544.8 
sles11_sp2_pv                                2   512     2     -b----       5.6

3, try libvirt.
1), test on branch xen42_support_bugfix_20130419_review which include Jim and David patch.
2), compile
xl_impl_la-libxl_driver.Tpo -c libxl/libxl_driver.c  -fPIC -DPIC -o .libs/libvirt_driver_libxl_impl_la-libxl_driver.o
cc1: warnings being treated as errors
libxl/libxl_driver.c:766: error: initialization from incompatible pointer type
3), delete the const in libxl_driver.c
typedef struct libxl_event_hooks {
    uint64_t event_occurs_mask;
    void (*event_occurs)(void *user,
#ifndef LIBXL_HAVE_NONCONST_EVENT_OCCURS_EVENT_ARG
                         const
#endif
                         libxl_event *event);
    void (*disaster)(void *user, libxl_event_type type,
                     const char *msg, int errnoval);
} libxl_event_hooks;
4), basic test pass. test with test.sh
/home/bamvor/log/novell/hypervisor_and_tools/libvirt/xen4.2_support/20130205/test.sh
it seems that the libvirtd crash, using gdb next time.
Domain sles11_sp2_pv destroyed

test libxlDomainCreateXML: create
error: Failed to create domain from /var/lib/xen/images_2/sles11_sp2_pv/sles11_sp2_pv.xml
error: End of file while reading data: Input/output error
error: One or more references were leaked after disconnect from the hypervisor
error: Failed to reconnect to the hypervisor

error: failed to connect to the hypervisor
error: no valid connection
error: Failed to connect socket to '/var/run/libvirt/libvirt-sock': Connection refused
###Error: fail, exit
5), 
Program received signal SIGSEGV, Segmentation fault.
[Switching to Thread 0x7fc0482fd700 (LWP 4415)]     
0x00007fc04f05e0d8 in virClassIsDerivedFrom (klass=0x302f3634, parent=0x7fc04fe659a0) at util/virobject.c:166                                                   
166             if (klass->magic == parent->magic)                              
(gdb) p klaas
No symbol "klaas" in current context.
(gdb) p klass                        
$1128 = (virClass *) 0x302f3634      
(gdb) p *klass
Cannot access memory at address 0x302f3634
(gdb) p *parent                           
$1129 = {parent = 0x7fc04fe65ae0, magic = 3405643778, 
  name = 0x7fc04fe65ac0 "virObjectLockable", objectSize = 56, 
  dispose = 0x7fc04f05eb80 <virObjectLockableDispose>}        
(gdb) where
#0  0x00007fc04f05e0d8 in virClassIsDerivedFrom (klass=0x302f3634, 
    parent=0x7fc04fe659a0) at util/virobject.c:166                 
#1  0x00007fc04f05e2a4 in virObjectLock (anyobj=0x302f3634)        
    at util/virobject.c:316                                        
#2  0x00007fc0417333da in libxlTimeoutModifyEventHook (priv=<optimized out>, 
    hndp=0x7fc04fe659a0, abs_t=...) at libxl/libxl_driver.c:340              
#3  0x00007fc041500f65 in time_deregister (gc=0x7fc03800abc0,                
    ev=0x7fc03800be98) at libxl_event.c:294                                  
#4  0x00007fc041503cef in libxl__ev_time_deregister (gc=0x7fc03800abc0,      
    ev=0x7fc03800be98) at libxl_event.c:375                                  
#5  0x00007fc0414f6e89 in device_qemu_timeout (egc=0x7fc0482fc430,           
    ev=0x7fc03800be98, requested_abs=<optimized out>) at libxl_device.c:847  
#6  0x00007fc041502026 in afterpoll_internal (egc=0x7fc0482fc430,            
    poller=<optimized out>, nfds=7, fds=0x7fc038004820, now=...)             
    at libxl_event.c:1027                                                    
#7  0x00007fc041502b77 in eventloop_iteration (egc=0x7fc0482fc430,           
    poller=0x7fc038001600) at libxl_event.c:1440                             
#8  0x00007fc04150309a in libxl__ao_inprogress (ao=0x7fc03800abb0,           
    file=<optimized out>, line=<optimized out>, func=<optimized out>)        
    at libxl_event.c:1685                                                    
#9  0x00007fc0414e8b27 in do_domain_create (ctx=<optimized out>,             
    d_config=<optimized out>, domid=0x7fc0482fc63c, restore_fd=1,            
    ao_how=<optimized out>, aop_console_how=0x0) at libxl_create.c:1259      
---Type <return> to continue, or q <return> to quit---q
Quit                                                   
(gdb) frame 1                                          
#1  0x00007fc04f05e2a4 in virObjectLock (anyobj=0x302f3634)
    at util/virobject.c:316                                
316         if (!virObjectIsClass(obj, virObjectLockableClass)) {
(gdb) frame 0                                                    
#0  0x00007fc04f05e0d8 in virClassIsDerivedFrom (klass=0x302f3634, 
    parent=0x7fc04fe659a0) at util/virobject.c:166                 
166             if (klass->magic == parent->magic)                 
(gdb) help finish
Execute until selected stack frame returns.
Upon return, the value returned is printed and put in the value history.
(gdb) where
#0  0x00007fc04f05e0d8 in virClassIsDerivedFrom (klass=0x302f3634, 
    parent=0x7fc04fe659a0) at util/virobject.c:166                 
#1  0x00007fc04f05e2a4 in virObjectLock (anyobj=0x302f3634)        
    at util/virobject.c:316                                        
#2  0x00007fc0417333da in libxlTimeoutModifyEventHook (priv=<optimized out>, 
    hndp=0x7fc04fe659a0, abs_t=...) at libxl/libxl_driver.c:340              
#3  0x00007fc041500f65 in time_deregister (gc=0x7fc03800abc0,                
    ev=0x7fc03800be98) at libxl_event.c:294                                  
#4  0x00007fc041503cef in libxl__ev_time_deregister (gc=0x7fc03800abc0,      
    ev=0x7fc03800be98) at libxl_event.c:375                                  
#5  0x00007fc0414f6e89 in device_qemu_timeout (egc=0x7fc0482fc430,           
    ev=0x7fc03800be98, requested_abs=<optimized out>) at libxl_device.c:847  
#6  0x00007fc041502026 in afterpoll_internal (egc=0x7fc0482fc430,            
    poller=<optimized out>, nfds=7, fds=0x7fc038004820, now=...)             
    at libxl_event.c:1027
#7  0x00007fc041502b77 in eventloop_iteration (egc=0x7fc0482fc430,
    poller=0x7fc038001600) at libxl_event.c:1440
#8  0x00007fc04150309a in libxl__ao_inprogress (ao=0x7fc03800abb0,
    file=<optimized out>, line=<optimized out>, func=<optimized out>)
    at libxl_event.c:1685
#9  0x00007fc0414e8b27 in do_domain_create (ctx=<optimized out>,
    d_config=<optimized out>, domid=0x7fc0482fc63c, restore_fd=1,
    ao_how=<optimized out>, aop_console_how=0x0) at libxl_create.c:1259
---Type <return> to continue, or q <return> to quit---q
Quit
(gdb) frame 1
#1  0x00007fc04f05e2a4 in virObjectLock (anyobj=0x302f3634)
    at util/virobject.c:316
316         if (!virObjectIsClass(obj, virObjectLockableClass)) {
(gdb) p anyobj
$1130 = (void *) 0x302f3634
(gdb) p *(virObjectPtr)anyobj
Cannot access memory at address 0x302f3634
(gdb) p *(unsigned long*)anyobj
Cannot access memory at address 0x302f3634
(gdb)

15:33 2013-05-22
create Hyper mode exception table.
1, set vector base
MRC p15, 4, <Rt>, c12, c0, 0 ; Read HVBAR into Rt
MCR p15, 4, <Rt>, c12, c0, 0 ; Write Rt to HVBAR
2, vector
Table B1-3 The vector tables
Vector tables
Offset Hyp a Monitor b Secure Non-secure
0x00 Not used Not used Reset Not used
0x04 Undefined Instruction, from Hyp mode Not used Undefined Instruction Undefined Instruction
0x08 Hypervisor Call, from Hyp mode Secure Monitor Call Supervisor Call Supervisor Call
0x0C Prefetch Abort, from Hyp mode Prefetch Abort Prefetch Abort Prefetch Abort
0x10 Data Abort, from Hyp mode Data Abort Data Abort Data Abort
0x14 Hyp Trap, or Hyp mode entry c Not used Not used Not used
0x18 IRQ interrupt IRQ interrupt IRQ interrupt IRQ interrupt
0x1C FIQ interrupt FIQ interrupt FIQ interrupt FIQ interrupt
a. Non-secure state only. Implemented only if the implementation includes the Virtualization Extensions.
b. Secure state only. Implemented only if the implementation includes the Security Extensions.
c. See Use of offset 0x14 in the Hyp vector table on page B1-1167.

3, \TODO check kick_cpus

22:13 2013-5-22
virtualization, xen, arm, email to arm about HVBAR
set hyper mode vector base address fail in cortex-a7 SOC
hi, 

i am working on port xen to allwinner a31 soc -- a cortex-A7 powered quad core SOC.
for early stage debug, i want set up exception vector in hyper mode in order to debug in software hang during xen hypervisor start up.
but, the hvbar seems read only. 
is there some specific routine need to be done?

here is my code. first i check the processor mode in CPSR, it is 11010 hyper mode. then i want to set 0x40200000 to HVBAR.

        PRINT("- CPSR ")
        mrs   r0, cpsr
        bl    putn
        PRINT(" -\r\n")
        PRINT("- current HVBAR ")
        mcr   cp15, 4, r0, c12, c0, 0
        bl    putn
        PRINT(" -\r\n")
        ldr   r0, =0x40200000
        dsb
        isb
        mrc   cp15, 4, r0, c12, c0, 0
        dsb
        isb
        PRINT("- HVBAR ")
        mcr   cp15, 4, r0, c12, c0, 0
        bl    putn
        PRINT(" -\r\n")

thanks.

10:42 2013-05-23
1, the mcr is move coprocess from register. mrc is move register from coprocessor. 
i am wrong before. (之前这两个汇编用反了).
after change this, the exception handler is worked.
2, skill, asm: jump to virtual addresss:
_start: b	reset
        ldr	pc, _undefined_instruction
        ldr	pc, _hyper_call
        ldr	pc, _prefetch_abort
        ldr	pc, _data_abort
        ldr	pc, _not_used
        ldr	pc, _irq
        ldr	pc, _fiq
_undefined_instruction: .word (0x40000000 + undefined_instruction)
_hyper_call:            .word (0x40000000 + hyper_call)
_prefetch_abort:        .word (0x40000000 + prefetch_abort)
_data_abort:            .word (0x40000000 + data_abort)
_not_used:              .word (0x40000000 + not_used)
_irq:                   .word (0x40000000 + irq)
_fiq:                   .word (0x40000000 + fiq)

18:32 2013-05-23
virtualization, xen, arm, allwinner A31, sun6i
1, current log
- UART enabled -
- CPU 00000000 booting -
- Machine ID 00000f34 -
- Started in Secure state -
- Entering Hyp mode -
- Zero BSS -
- Setting up control registers -
- Turning on paging -
- Ready -
start_xen:419
start_xen:422
start_xen:425
BOOT_MISC_VIRT_START<600000>, fdt_paddr<402d7700>, device_tree_flattened<6d7700>
RAM: 0000000040000000 - 00000000bfffffff

MODULE[1]: 0000000060000000 - 0000000060400000 
start_xen:431
start_xen:435
Placing Xen at 0x00000000bfe00000-0x00000000c0000000

2, (16:11 2013-05-24)
email to arm about ldrex and strex hang
ldrex and strex hang in SMP

hi, 

i am working on port xen hypervisor to allwinner A31 which is powered by Cortex-A7 quad core.
when i using the ldrex and strex assemble, it hang without any exception encountered. 
i guess that there is something block it or some sort of SMP initialize. but i am not familiar the SMP thing.
if there is some doc or referenece code it would be great for me. 
thanks in advance.

Bamvor

3, arm reply 20130524_2203
[From Martin Weidmann - ARM Support]

Please quote the following support case reference number in any response: 549313

Dear Bamvor.

>
> i am working on port xen hypervisor to allwinner A31 which is powered by
> Cortex-A7 quad core.
> when i using the ldrex and strex assemble, it hang without any exception
> encountered.
> i guess that there is something block it or some sort of SMP initialize. but
> i am not familiar the SMP thing.
> if there is some doc or referenece code it would be great for me.
>

I am afraid that we do not one of these devices in Support, so I cannot answer specifically for this device.  You will have to contact the manufacturer (All Winner).

More generally: Depending on the attributes in the MMU's translation tables, exclusivity checking may be done within the processor (local monitor) or in the memory system (global monitor).  If it is a non-cacheable region, it may be that the memory system does not support exclusive accesses to this memory.  However, I would expect this to trigger an exception - not a hang.

Another possibility to check would be speculative accesses.  If you translation tables are incorrect you may speculative accesses to unexpected addresses.  In some cases this has been known to trigger system hangs.

If you have further questions we will need to verify your support status.  To do this please provide your ARM tools serial number or support contract reference.  Alternatively you could use a public resource such as the ARM forums (forums.arm.com) or contact All Winner.

Regards,

Martin




14:58 2013-05-24
0x5555558227d0

(gdb) p *(vm->def->hostdevs)@10
$6 = {0x5555558227d0, 0x1c00000100, 0x0, 0x1b1, 0x7ffff5602078, 0x555555822110, 
  0x0, 0x0, 0x555555824810, 0x0}

16:28 2013-05-24
virtualization, xen, arm, allwinner A31, sun6i, figure out what happened in setup_pagetables
1, continue from "18:32 2013-05-23". ref that log.
2, read get_xen_paddr
min_size is the xen image size excluding dtb and align to 2MBytes.

_start: 00200000
_end:   002d7700

12:39 2013-05-27
GTD

1, today
1), figure out which version will lead to crash in vmware player. see"14:06 2013-05-27"
2), prepare the patch for sun6i.

14:06 2013-05-27
virtualization, xen, xen hypervisor crash on vmware player
1, rpm dir: 
/home/bamvor/sda3/home/novell/work/source/virtualization/xen/backup/20130527_test_xen_on_vmware_player
1), 0522_6d243308: crash.
2), 0124_9f0443ba: hypervisor boot successful.
3), 0404_0d2e673a: crash.
4), 0222_7269eeae: crash and reboot.
5), 0215_efadaf95: pass: affect by arm patch?
6), (11:26 2013-05-28)
0215_7f388007: pass.
7), 0222_a0d11080. 0134*.patch: crash and reboot.
log/novell/hypervisor_and_tools/libvirt/xen4.2_support/20130528_test_xen/fail_0222_a0d11080.jpg
8), 0221_82639998. 0118*.patch: crash and reboot. same log.
还有不到20个commit, 今天一定要搞定. 
(09:57 2013-05-29)
这个事情已经拖了三天了, 实在没法接受自己.
9), 0215_73706033. 0089*.patch: pass.
10), 0218_825ea023. 0109*.patch: pass. test it again: pass.
11), 0215_2e814a01. 0103*.patch: pass.
12), 0215_174adc2c. 0101*.patch: pass.
13), 0222_aab4d1b2. 0114*.patch: crash. same log.
14), 0218_d5516063. 0111*.patch. Jan Beulich. AMD IO MMU. PASS. i WAS thought that i should be fail.
15), 0219_fb034f42. 0112*.patch. Jan Beulich. CRASH.

17:11 2013-05-27
software skill, SCM, git, apply patch while git am fail
http://lukas.zapletalovi.com/2011/11/gits-crying-patch-format-detection.html
Git's crying Patch format detection failed

If you get the following error message while applying git patch:

$ git am /path/to/0001-My-awesome-change.patch
Patch format detection failed.

It means that the patch was not generated with git format-patch and transmitted correctly. Either ask the contributor to try again using the above patch creation instructions, or apply each patch separately using git apply:

$ git apply --whitespace=fix /path/to/0001-My-awesome-change.patch
$ git commit --author='Contributor Name <contributor@thedomain.com>'

If the patch does not fit, check out older version. I usually checkout a version from the same date (or hour), that usually works.

Remember; writing is learning. That's all folks. At least for today. Cheers.

<<<<<<< HEAD
10:56 2013-05-28
work report
1, test the libvirt with xen upstream support.
found a bug in vm destroy. it is hard to reproduce compare to the previous bug i found in the similar code.

18:36 2013-05-29
virtualization, xen, arm
1, try on fast model
make clean XEN_TARGET_ARCH=arm32 CROSS_COMPILE=arm-linux-gnueabihf- 
make dist-xen XEN_TARGET_ARCH=arm32 CROSS_COMPILE=arm-linux-gnueabihf- CONFIG_EARLY_PRINTK=fastmodel CONFIG_DTB_FILE=/home/bamvor/sda3/home/novell/work/source/virtualization/xen/upstream/xen_arm/prebuilt/dtb/vexpress-v2p-ca15-tc1.dtb 
2, install fast model
1), FastModels_8-1-038_Linux/setup.bin
2), FastModels_8-1-038_Linux_install/FastModelsTools_8.1/source_all.sh

23:10 2013-5-29
1, Jaeyong reply to Ian C
[Xen-devel] Very strange behavior between balloon driver and network driver (Arndale)
Jaeyong Yoo jaeyong.yoo@samsung.com
>
> Of course if, as a Sumsung developer, you are able to gain access to the
> documentation necessary to write an IOMMU driver for the Arndale
> platform that would be great!

AFAIK Arndale board has sysMMU but it is placed between CPU and GPU for
performance purpose. So, I think it is not be able to use it for
virtualization.

2, Ian C reply to Jaeyong
> I guess the current work-around solution would be commenting out
> the following two lines, very nasty and introduces memory leak though.
> Memory leak gives more time than network error for testing xen on Arndale  :)

The kernel should reuse ballooned out pages where possible rather than
creating more so the leak is probably limited. Not ideal though.

I suspect the real answer is that the 1:1 workaround needs to be
cleverer when dom0 decreases and increases its reservation...

3, Stefano Stabellini stefano.stabellini@eu.citrix.com
> > AFAIK Arndale board has sysMMU but it is placed between CPU and GPU for
> > performance purpose. So, I think it is not be able to use it for
> > virtualization.
>
> Oh, that's interesting and unfortunate :-(

Am I getting this right that it not possible to use the sysMMU on the
Arndale board to translate DMA accesses from the network card?
FYI we wouldn't need two translation levels, just one.

23:18 2013-5-29
Dirk Müller dirk@dmllr.de reply to Andrew Wafaa <awafaa@opensuse.org>

> Problem is I have three packages that I'm trying to build and one of
> those three is a dep for the others. What's the best way to go about
> it?

if you let the server build it, it will all resolve that automatically
(unless there is a circular dependency, it does that all by itself).

When you build locally (you#d need native hardware then, of course),
you need to build it in the right order, and save away the build
results from the previous build in some directory and use that
directory with the -p  option for later osc build's. (for preferred
rpms)

14:57 2013-05-30
software skill, network, ssh, using ssh config specified the port and host
1, > cat ~/.ssh/config
Host u985
port 2222

notes: u985 should be defined in /etc/hosts or DHCP server.

15:46 2013-05-30
work, annual leave
0, total: 5+2+1+3+2=12.
1, 2012
1), 5 days: 0806-0810.
2, 2013:
1), 2 days: 0325-0326.
2), 1 day:  0401.
3), 3 days: 0415-0417.
4), 2 days: 0508-0509.

17:38 2013-05-30
software skill, network, filesystem, nfs, Read-only file system
tab和-未转义引起的mount read only.
/var/tmp/osbuild\-packagecache *(fsid=0,crossmnt,rw,no_root_squash,sync,no_subtree_check)
如果没有加反斜杠转义, 我exports里面下一行就会mount成这一行.
之前实验如果用tab而不是空格分隔目录和星号, 会导致read only file system提示. 但是没法复现.
网上很多人多星号(也就是client地址)和后面的属性之间如果有空格, 会导致"Read-only file system"
http://www.cnblogs.com/killkill/archive/2010/11/21/1883042.html

19:14 2013-05-30
arm, DS-5
http://ds.arm.com/ds-5-community-edition/getting-started/#linux
License with Activation Code
AC+706164213732

19:37 2013-05-30
Webserver @ reuuimllatech.com

This page is not associated with Reuuimlla Technology Co., Ltd.

If you have reached this domain because of reference to this company in your Allwinner Linux Kernel Sources, please advise Allwinner to stop twidiling the copyright notices. A clean-up script can be found here: https://github.com/amery/git-import-help/blob/master/reuuimlla.sh

You will be redirected shortly...

19:48 2013-05-30
1, skip 0003, 0006, 
0005. do not apply.
2, i just found that the ca15 and ca7 has lots different. for example in ACTLR register.
1), SMP
(1), ca15
Enables the processor to receive instruction cache, BTB, and TLB maintenance
operations from other processors. Clearing the SMP bit disables the processor
from receiving the instruction cache, BTB, and TLB maintenance operations
from other processors and is a required step when powering down the processor:
0
 Disables receiving of instruction cache, BTB, and TLB
maintenance operations. This is the reset value.
1
 Enables receiving of instruction cache, BTB, and TLB
maintenance operations.
Note
Any processor instruction cache, BTB, and TLB maintenance operations can execute the request, regardless of the value of the SMP bit.
This bit has no impact on data cache maintenance operations.
In the Cortex-A15 MPCore processor, the L1 data cache and L2 cache are always coherent, for shared or non-shared data, regardless of the value of the SMP bit.
You must set this bit before enabling the caches and MMU, or performing any cache and TLB maintenance operations. You must clear this bit during a processor powerdown sequence. See Power management on page 2-21.

3, maybe the following address should not change?
$(TARGET): $(TARGET)-syms $(TARGET).bin
    # XXX: VE model loads by VMA so instead of
    # making a proper ELF we link with LMA == VMA and adjust crudely
    $(OBJCOPY) --change-addresses +0x40000000 $< $@
    $(STRIP) $@

anyway, i should check the memory map. because all the fault point to this.

4, \TODO
1), test with --change-address +0x80000000, if enter c environment successful, prepare the patch and try to send it to upstream this week.


