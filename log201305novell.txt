.LOG
15:41 2013-05-02
GTD

\TODO: install SLES11 SP3 RC1 and test this bug. the xen and libvirt package is not update. i need update libvirt at first.

2, next
1), console patch: do the make test and send it to Chunyan.

2, \TODO
1), subscribe LWN while my palpay account have enough money.
1), keep an eye on Xen Test Days. see"13:29 2013-02-22"1
2), do some work if jim gsoc is not selected by student and opensuse.org. see"18:08 2013-03-22"
3), is there any other changes in Jim libvirt libxl xen4.2 support patch. like console things?
在Jim xen4.2 patch里面有没有类似影响console的libxl功能的修改?

2, daily work
1), tracking xen-arm update.
2), read libvirt and xen-devel quickly, should less that 30minutes.
3), read linux news
http://www.linux.com/
http://www.phoronix.com/scan.php?page=home

3, week plan
1), send console patch to upstream.
2), finish libxl block status and relative functions.
3), libvirt libxl lock patch. see"14:24 2013-03-13"6.

4, next
1), read code about lastest kernel porting. see"11:49 2013-02-07".
1), coding excise for pthread_atfork.
2), rt-thread moto control driver in lua. first version do not use the PWM.

1), for libxl xen4.2 bug, figure out why virsh got event after libxl think its done. see"10:41 2013-01-24".
2), write code for libxl qmp. see"17:15 2013-01-23"
4), read jim patch on libvirt and xen.
3), debug libvirt libxl console. see"16:50 2013-01-04"
1), send xen libexec patch.
1), test Jim patch for libxl xen4.2 bug. see"11:00 2012-12-21"
3), re-read all the patch about libxl xen4.2.
1), got arm technical symposia pdf.
2), libvirt blkstats:
(1), add block stats in libxl_qmp.c, add cmd in xl.
(2), add patch in libvirt, send it to Jim. if the former patch only accept by xen-unstable not xen4.2-testing. i could not send patch to libvirt upstream.
3), try xen on kvm.
4), 对于vi不能方便查找keywords这个事情, 实在不能忍了, 如果这周能把managed save和bridge-utils bug fix, 就把这个做一个.

3, next week
1), work on lock patch.
2), try to build MK802 kernel on obs. speed up. i want it work on opensuse12.3
2), read kernel doc: "10:36 2012-11-23"
1), read code for patch. see"10:25 2012-11-23"2-2)-(2).
2), after "1)" finish. try xen on kvm.
3), read the mail on "Andrew Wafaa <awafaa@opensuse.org>"_email_"[opensuse-arm] Fwd: [fedora-arm] ARMv8 Bootstrap Project"_20121122
3), work on xen on ARM. ref"22:33 2012-11-19"
4), check the error from "10:18 2012-11-15"2
2012-11-15 04:02:45.318+0000: 4307: error : virNodeGetSecurityModel:9567 : this function is not supported by the connection driver: virNodeGetSecurityModel
5), ask jim to invite me to xen irc.

3, next next
1), gsoc: "22:23 2012-11-17"
1), notes about Huawei from eet-china.
2), read bug:https://bugzilla.novell.com/show_bug.cgi?id=781425

2, next
1), try to improve attach-disk, detach-disk in libxl driver, see"18:17 2012-11-07"4
2), test attach-disk command. see"10:41 2012-10-30"2
3), maybe libxl and qemu could communicate with qemu through xenstore?

libxl_dm.c:
        /* Find uuid and the write the vnc password to xenstore for qemu. */
        t = xs_transaction_start(ctx->xsh);
        vm_path = libxl__xs_read(&gc,t,libxl__sprintf(&gc, "%s/vm", p->dom_path));
        if (vm_path) {
            /* Now write the vncpassword into it. */
            pass_stuff = libxl__calloc(&gc, 3, sizeof(char *));
            pass_stuff[0] = "vncpasswd";
            pass_stuff[1] = info->vncpasswd;
            libxl__xs_writev(&gc,t,vm_path,pass_stuff);

3, for Jim
1), xenlight event lock in libvirt. see"16:52 2012-11-06"2-1).

4, next month
1), opensuse on MK802
(1), generate the 512MB version with opensuse12.2 RC2 which enable yast fist run.
(2), try opensuse based on ubuntu kernel in order to solve the error from miniand.
2), try qemu-dm instead of qemu xen
3), try xl create.

15:55 2013-05-02
work report
1, week 17(22,April--28,April)
discuss with Jim try to fix the segment fault. the upstream eventually accept this bug.
leave?
2, week 18(29,April--5,May)

1, work report - week 15, 16
1), hackweek
working on generate opensuse 12.3 image for cubieboard:
(1), build u-boot, kernel and board configuration and put them to obs.
(2), learn how to build image through kiwi. and eventually build JeOS and XFCE image successful.
BTW: it seems that cubieboard is very popular in this hackweek, me, Dirk Müller, Matt Chen all work on it.

2), working on fix bug on libvirt libxl driver.
this bug is reported by libvirt users in mailing list. it sometimes failed after save operation.
after some debug, it fail because pointer is not valid while the callback entered.
after modify the code, it test 24 round pass compare to fail within 3 rounds without this patch. 
thanks for Boyang and Chunyan's help.

3), 3 days off.

16:16 2013-05-03
sunxi#fatload mmc 0:2 43000000 script.bin
reading script.bin

41068 bytes read
sunxi#fatload mmc 0:2 48000000 linux/uImage
reading linux/uImage

3414760 bytes read
sunxi#setenv bootargs "console=ttyS0,115200 root=/dev/mmcblk0p3 init=/init loglevel=8"
sunxi#bootm 48000000

23:33 2013-05-04
1, add mmc config, including network.
mkconfig write include/config.h including "include/configs/xxx.h".
diff --git a/boards.cfg b/boards.cfg
index e1c7b65..2971673 100644
--- a/boards.cfg
+++ b/boards.cfg
@@ -190,6 +190,7 @@ sun4i                        arm         armv7       a10-evb             allwinn
sun5i_a12                    arm         armv7       a12-evb             allwinner      sunxi
sun5i_a13                    arm         armv7       a13-evb             allwinner      sunxi
sun6i                       arm         armv7       sun6i               allwinner      sunxi
+sun6i_mmc                   arm         armv7       sun6i_mmc   allwinner      sunxi
actux1_4_16                  arm         ixp         actux1              -              -           actux1:FLASH2X2
actux1_8_16                  arm         ixp         actux1              -              -           actux1:FLASH1X8
actux1_4_32                  arm         ixp         actux1              -              -           actux1:FLASH2X2,RAM_32MB

13:59 2013-05-05
1, try rootfs or nfs root.

fatload mmc 0:2 43000000 script.bin
fatload mmc 0:2 48000000 linux/uImage_noinitrd
setenv bootargs "console=ttyS0,115200 root=/dev/mmcblk0p3 init=/init loglevel=8"
bootm 48000000

fatload mmc 0:2 43000000 script.bin
fatload mmc 0:2 40007800 linux/uImage
setenv bootargs "console=ttyS0,115200 root=rootfs init=/init loglevel=8"
bootm 40007800

2, try 独立的initramfs
fatload mmc 0:2 43000000 script.bin
fatload mmc 0:2 40007800 linux/uImage_noinitrd
fatload mmc 0:2 41000000 linux/rootfs.cpio.gz
setenv bootargs "console=ttyS0,115200 init=/init loglevel=8 initrd=0x41000000,3541253 root=/dev/ram0"
bootm 40007800

3, try multi image
mkimage -A arm -O linux -T multi -C none -a 0x40008000 -e 0x40008000 -n 'Linux' -d Image uImage

4, (17:44 2013-05-09)
simple rootfs seems successful
[    2.875152] sun6i-rtc sun6i-rtc: sun6i_rtc_gettime
[    2.879952] sun6i-rtc sun6i-rtc: read time 1970-1-1 1:37:27
[    2.885566] sun6i-rtc sun6i-rtc: setting system clock to 1970-01-01 01:37:27 UTC (5847)
[    2.893727] Warning: unable to open an initial console.
[    2.899766] Freeing init memory: 492K
[    2.903455] Write protecting the kernel text section c0008000 - c05de000
[    2.910288] rodata_test: attempting to write to read-only section:
[    2.916486] write to read-only section trapped, success
[    3.301994] ====codec_resume_events===
[    3.606928] [mmc]: mmc 0 detect change, present 1
[    4.102006] [mmc]: sdc0 set ios: clk 0Hz bm PP pm UP vdd 3.3V width 1 timing LEGACY(SDR12) dt B
[    4.122005] [mmc]: sdc0 set ios: clk 400000Hz bm PP pm ON vdd 3.3V width 1 timing LEGACY(SDR12) dt B
[    4.209329] [mmc]: *** sw_mci_dump_errinfo(L559): smc 0 err, cmd 52,  RTO !!
[    4.217274] [mmc]: *** sw_mci_dump_errinfo(L559): smc 0 err, cmd 52,  RTO !!
[    4.224356] [mmc]: sdc0 set ios: clk 400000Hz bm PP pm ON vdd 3.3V width 1 timing LEGACY(SDR12) dt B
[    4.236043] [mmc]: sdc0 set ios: clk 400000Hz bm PP pm ON vdd 3.3V width 1 timing LEGACY(SDR12) dt B
[    4.247427] [mmc]: *** sw_mci_dump_errinfo(L559): smc 0 err, cmd 5,  RTO !!
[    4.255277] [mmc]: *** sw_mci_dump_errinfo(L559): smc 0 err, cmd 5,  RTO !!
[    4.263130] [mmc]: *** sw_mci_dump_errinfo(L559): smc 0 err, cmd 5,  RTO !!
[    4.270975] [mmc]: *** sw_mci_dump_errinfo(L559): smc 0 err, cmd 5,  RTO !!
[    4.278651] [mmc]: sdc0 set ios: clk 400000Hz bm PP pm ON vdd 3.3V width 1 timing LEGACY(SDR12) dt B
[    4.287834] [mmc]: sdc0 set ios: clk 400000Hz bm PP pm ON vdd 3.3V width 1 timing LEGACY(SDR12) dt B
[    4.299403] [mmc]: sdc0 set ios: clk 400000Hz bm PP pm ON vdd 3.3V width 1 timing LEGACY(SDR12) dt B
[    4.353958] [mmc]: sdc0 set ios: clk 25000000Hz bm PP pm ON vdd 3.3V width 1 timing LEGACY(SDR12) dt B
[    4.418407] [mmc]: sdc0 set ios: clk 25000000Hz bm PP pm ON vdd 3.3V width 4 timing LEGACY(SDR12) dt B
[    4.427773] mmc0: new SD card at address 8a08
[    4.432958] mmcblk0: mmc0:8a08 SD02G 1.84 GiB 
[    4.439327]  mmcblk0: p2 p3

5, disable verify while booting in order to avoid CRC error.
setenv verify n

6, try to compile busybox by myself.
1), u-boot
fatload mmc 0:2 43000000 script.bin
fatload mmc 0:2 48000000 linux/uImage
setenv bootargs "console=ttyS0,115200 root=rootfs init=/bin/sh loglevel=8"
setenv bootargs "console=ttyS0,115200 init=/bin/sh loglevel=8"
bootm 48000000

1), it should be work, because it prompt about initial console:
[    3.758628] Warning: unable to open an initial console.
[    3.768112] Root-NFS: no NFS server address
[    3.775424] VFS: Unable to mount root fs via NFS, trying floppy.
[    3.790277] VFS: Cannot open root device "rootfs" or unknown-block(2,0)
Please append a correct "root=" boot option; here are the available partitions:
[    3.803567] Please append a correct "root=" boot option; here are the available partitions:
[    3.819127] Kernel panic - not syncing: VFS: Unable to mount root fs on unknown-block(2,0)



5, how to align the image before mkimage?

17:06 2013-05-07
1, Jim_email_20130503
libvirt 1.0.5 was released today.  I've packaged it and committed to
Devel:Virt:SLE-11-SP3.  It has passed libvirt-tck testing on kvm and
I've done a fair amount of testing on xen (legacy xend stack).  Please
give it a try.  If no issues are found, I will submit it for RC2
sometime Friday afternoon (MDT).

Lin,
You have been testing PCI passthrough recently, so maybe you are setup
to do some basic PCI passthrough testing on xen and kvm with 1.0.5.

Chunyan, Bamvor,
Please use 1.0.5 for any SP3 testing or SP3 bug investigations you are
doing.
Mark,
Can you give it a spin on s390?

I would like to ensure there are no regressions with 1.0.5 since it is
quite late in the cycle for new versions :).

BTW, as it currently stands, libvirt 1.0.5 will be the version in f19,
so we'll have the whole fedora machinery helping maintain the stable
branch of this release.

Thanks,
Jim
2, add repo
repo: http://download.suse.de/ibs/Devel:/Virt:/SLE-11-SP3/SLE_11_SP3/
3, \TODO
add SDK DVD to vm.
3, check whether all the patch is pushed into libvirt 1.0.5

10:52 2013-05-09
0, try qdisk on sles11 sp3 rc1 in xl. xen 4.2.2, libvirt 1.0.5
xl create successful.
disk=[ 'format=raw, vdev=xvda, access=rw, backendtype=qdisk, target=/var/lib/xen/images_2/sles11_sp2_pv/disk0.raw', ]
1, backend: qdisk
# xenstore-ls /local/domain/0/backend/qdisk
1 = ""
 51712 = ""
  frontend = "/local/domain/1/device/vbd/51712"
  params = "aio:/var/lib/xen/images_2/sles11_sp2_pv/disk0.raw"
  frontend-id = "1"
  online = "1"
  removable = "0"
  bootable = "1"
  state = "4"
  dev = "xvda"
  type = "qdisk"
  mode = "w"
  device-type = "disk"
  feature-barrier = "1"
  info = "0"
  hotplug-status = "connected"
  sector-size = "512"
  sectors = "4194304"

2, frontend
# xenstore-ls /local/domain/1/device/vbd/51712
backend = "/local/domain/0/backend/qdisk/1/51712"
backend-id = "0"
state = "4"
virtual-device = "51712"
device-type = "disk"
ring-ref = "8"
event-channel = "12"
protocol = "x86_64-abi"

3, try again on xen 4.3 on sles11 sp2.
xl create successful but xl vnc hang.
1), backend
# xenstore-ls /local/domain/0/backend/qdisk
1 = ""
 51712 = ""
  frontend = "/local/domain/1/device/vbd/51712"
  params = "aio:/var/lib/xen/images_2/sles11_sp2_pv/disk0.raw"
  frontend-id = "1"
  online = "1"
  removable = "0"
  bootable = "1"
  state = "4"
  dev = "xvda"
  type = "qdisk"
  mode = "w"
  device-type = "disk"
  feature-flush-cache = "1"
  feature-persistent = "1"
  info = "0"
  sector-size = "512"
  sectors = "4194304"
  hotplug-status = "connected"
2), frontend
# xenstore-ls /local/domain/1/device/vbd/51712
backend = "/local/domain/0/backend/qdisk/1/51712"
backend-id = "0"
state = "4"
virtual-device = "51712"
device-type = "disk"
ring-ref = "8"
event-channel = "12"
protocol = "x86_64-abi"

4, try xen 4.2.2 on sp2.
successful.

5, discuss with Jim:
  Previous Conversations Above
Jim Fehlig: I was probably using whatever was in SP3 beta4
Jim Fehlig: xen4.2.1 IIRC
Jim Fehlig: maybe 4.2.2
Jim Fehlig: but SP3 beta4 for sure
Bamvor Jian Zhang: in xen4.3, xl create succesful, but i could not connect to vm through vnc. 
Bamvor Jian Zhang: the backend is qdisk in xenstore-ls. i guess something go wrong in create. 
Jim Fehlig: you should try to track that down since xen4.3 is near release
Jim Fehlig: would be nice to know what the problem is before 4.3 final
Jim Fehlig: I haven't tried 4.3 yet
Jim Fehlig: maybe get around to it tomorrow or Friday
Jim Fehlig: let me know if you find anything
Bamvor Jian Zhang: ok. 
Jim Fehlig: I'm done for the day 
Jim Fehlig: talk to you later, have a good day
Bamvor Jian Zhang: sorry, just one question
Bamvor Jian Zhang: where could find the debug log for xl. xl -v ?
Bamvor Jian Zhang: i want to compare the log while vm create. i could get in libxl.log if i use libvirt. but i do not know in xl.
Jim Fehlig: hmm, I'm not sure
Jim Fehlig: don't see anything in xl or xl.cfg man pages
Jim Fehlig: or http://wiki.xen.org/wiki/XL
Jim Fehlig: the libvirt libxl driver fopens the logfile and calls xtl_createlogger_stdiostream() to wire up the logging
Jim Fehlig: you could see if xl does something similar via some undocumented option or env var
Jim Fehlig logged out at 12:05:07 PM.

3, try libvirt.
1), check the patch.


