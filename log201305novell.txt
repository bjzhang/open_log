.LOG
15:41 2013-05-02
GTD

\TODO: install SLES11 SP3 RC1 and test this bug. the xen and libvirt package is not update. i need update libvirt at first.

2, next
1), console patch: do the make test and send it to Chunyan.

2, \TODO
1), subscribe LWN while my palpay account have enough money.
1), keep an eye on Xen Test Days. see"13:29 2013-02-22"1
2), do some work if jim gsoc is not selected by student and opensuse.org. see"18:08 2013-03-22"
3), is there any other changes in Jim libvirt libxl xen4.2 support patch. like console things?
在Jim xen4.2 patch里面有没有类似影响console的libxl功能的修改?

2, daily work
1), tracking xen-arm update.
2), read libvirt and xen-devel quickly, should less that 30minutes.
3), read linux news
http://www.linux.com/
http://www.phoronix.com/scan.php?page=home

3, week plan
1), send console patch to upstream.
2), finish libxl block status and relative functions.
3), libvirt libxl lock patch. see"14:24 2013-03-13"6.

4, next
1), read code about lastest kernel porting. see"11:49 2013-02-07".
1), coding excise for pthread_atfork.
2), rt-thread moto control driver in lua. first version do not use the PWM.

1), for libxl xen4.2 bug, figure out why virsh got event after libxl think its done. see"10:41 2013-01-24".
2), write code for libxl qmp. see"17:15 2013-01-23"
4), read jim patch on libvirt and xen.
3), debug libvirt libxl console. see"16:50 2013-01-04"
1), send xen libexec patch.
1), test Jim patch for libxl xen4.2 bug. see"11:00 2012-12-21"
3), re-read all the patch about libxl xen4.2.
1), got arm technical symposia pdf.
2), libvirt blkstats:
(1), add block stats in libxl_qmp.c, add cmd in xl.
(2), add patch in libvirt, send it to Jim. if the former patch only accept by xen-unstable not xen4.2-testing. i could not send patch to libvirt upstream.
3), try xen on kvm.
4), 对于vi不能方便查找keywords这个事情, 实在不能忍了, 如果这周能把managed save和bridge-utils bug fix, 就把这个做一个.

3, next week
1), work on lock patch.
2), try to build MK802 kernel on obs. speed up. i want it work on opensuse12.3
2), read kernel doc: "10:36 2012-11-23"
1), read code for patch. see"10:25 2012-11-23"2-2)-(2).
2), after "1)" finish. try xen on kvm.
3), read the mail on "Andrew Wafaa <awafaa@opensuse.org>"_email_"[opensuse-arm] Fwd: [fedora-arm] ARMv8 Bootstrap Project"_20121122
3), work on xen on ARM. ref"22:33 2012-11-19"
4), check the error from "10:18 2012-11-15"2
2012-11-15 04:02:45.318+0000: 4307: error : virNodeGetSecurityModel:9567 : this function is not supported by the connection driver: virNodeGetSecurityModel
5), ask jim to invite me to xen irc.

3, next next
1), gsoc: "22:23 2012-11-17"
1), notes about Huawei from eet-china.
2), read bug:https://bugzilla.novell.com/show_bug.cgi?id=781425

2, next
1), try to improve attach-disk, detach-disk in libxl driver, see"18:17 2012-11-07"4
2), test attach-disk command. see"10:41 2012-10-30"2
3), maybe libxl and qemu could communicate with qemu through xenstore?

libxl_dm.c:
        /* Find uuid and the write the vnc password to xenstore for qemu. */
        t = xs_transaction_start(ctx->xsh);
        vm_path = libxl__xs_read(&gc,t,libxl__sprintf(&gc, "%s/vm", p->dom_path));
        if (vm_path) {
            /* Now write the vncpassword into it. */
            pass_stuff = libxl__calloc(&gc, 3, sizeof(char *));
            pass_stuff[0] = "vncpasswd";
            pass_stuff[1] = info->vncpasswd;
            libxl__xs_writev(&gc,t,vm_path,pass_stuff);

3, for Jim
1), xenlight event lock in libvirt. see"16:52 2012-11-06"2-1).

4, next month
1), opensuse on MK802
(1), generate the 512MB version with opensuse12.2 RC2 which enable yast fist run.
(2), try opensuse based on ubuntu kernel in order to solve the error from miniand.
2), try qemu-dm instead of qemu xen
3), try xl create.

15:55 2013-05-02
work report
1, week 17(22,April--28,April)
discuss with Jim try to fix the segment fault. the upstream eventually accept this bug.
leave?
2, week 18(29,April--5,May)

1, work report - week 15, 16
1), hackweek
working on generate opensuse 12.3 image for cubieboard:
(1), build u-boot, kernel and board configuration and put them to obs.
(2), learn how to build image through kiwi. and eventually build JeOS and XFCE image successful.
BTW: it seems that cubieboard is very popular in this hackweek, me, Dirk Müller, Matt Chen all work on it.

2), working on fix bug on libvirt libxl driver.
this bug is reported by libvirt users in mailing list. it sometimes failed after save operation.
after some debug, it fail because pointer is not valid while the callback entered.
after modify the code, it test 24 round pass compare to fail within 3 rounds without this patch. 
thanks for Boyang and Chunyan's help.

3), 3 days off.

16:16 2013-05-03
sunxi#fatload mmc 0:2 43000000 script.bin
reading script.bin

41068 bytes read
sunxi#fatload mmc 0:2 48000000 linux/uImage
reading linux/uImage

3414760 bytes read
sunxi#setenv bootargs "console=ttyS0,115200 root=/dev/mmcblk0p3 init=/init loglevel=8"
sunxi#bootm 48000000

23:33 2013-05-04
1, add mmc config, including network.
mkconfig write include/config.h including "include/configs/xxx.h".
diff --git a/boards.cfg b/boards.cfg
index e1c7b65..2971673 100644
--- a/boards.cfg
+++ b/boards.cfg
@@ -190,6 +190,7 @@ sun4i                        arm         armv7       a10-evb             allwinn
sun5i_a12                    arm         armv7       a12-evb             allwinner      sunxi
sun5i_a13                    arm         armv7       a13-evb             allwinner      sunxi
sun6i                       arm         armv7       sun6i               allwinner      sunxi
+sun6i_mmc                   arm         armv7       sun6i_mmc   allwinner      sunxi
actux1_4_16                  arm         ixp         actux1              -              -           actux1:FLASH2X2
actux1_8_16                  arm         ixp         actux1              -              -           actux1:FLASH1X8
actux1_4_32                  arm         ixp         actux1              -              -           actux1:FLASH2X2,RAM_32MB

13:59 2013-05-05
1, try rootfs or nfs root.

fatload mmc 0:2 43000000 script.bin
fatload mmc 0:2 48000000 linux/uImage_noinitrd
setenv bootargs "console=ttyS0,115200 root=/dev/mmcblk0p3 init=/init loglevel=8"
bootm 48000000

fatload mmc 0:2 43000000 script.bin
fatload mmc 0:2 40007800 linux/uImage
setenv bootargs "console=ttyS0,115200 root=rootfs init=/init loglevel=8"
bootm 40007800

2, try 独立的initramfs
fatload mmc 0:2 43000000 script.bin
fatload mmc 0:2 40007800 linux/uImage_noinitrd
fatload mmc 0:2 41000000 linux/rootfs.cpio.gz
setenv bootargs "console=ttyS0,115200 init=/init loglevel=8 initrd=0x41000000,3541253 root=/dev/ram0"
bootm 40007800

3, try multi image
mkimage -A arm -O linux -T multi -C none -a 0x40008000 -e 0x40008000 -n 'Linux' -d Image uImage

4, (17:44 2013-05-09)
simple rootfs seems successful
[    2.875152] sun6i-rtc sun6i-rtc: sun6i_rtc_gettime
[    2.879952] sun6i-rtc sun6i-rtc: read time 1970-1-1 1:37:27
[    2.885566] sun6i-rtc sun6i-rtc: setting system clock to 1970-01-01 01:37:27 UTC (5847)
[    2.893727] Warning: unable to open an initial console.
[    2.899766] Freeing init memory: 492K
[    2.903455] Write protecting the kernel text section c0008000 - c05de000
[    2.910288] rodata_test: attempting to write to read-only section:
[    2.916486] write to read-only section trapped, success
[    3.301994] ====codec_resume_events===
[    3.606928] [mmc]: mmc 0 detect change, present 1
[    4.102006] [mmc]: sdc0 set ios: clk 0Hz bm PP pm UP vdd 3.3V width 1 timing LEGACY(SDR12) dt B
[    4.122005] [mmc]: sdc0 set ios: clk 400000Hz bm PP pm ON vdd 3.3V width 1 timing LEGACY(SDR12) dt B
[    4.209329] [mmc]: *** sw_mci_dump_errinfo(L559): smc 0 err, cmd 52,  RTO !!
[    4.217274] [mmc]: *** sw_mci_dump_errinfo(L559): smc 0 err, cmd 52,  RTO !!
[    4.224356] [mmc]: sdc0 set ios: clk 400000Hz bm PP pm ON vdd 3.3V width 1 timing LEGACY(SDR12) dt B
[    4.236043] [mmc]: sdc0 set ios: clk 400000Hz bm PP pm ON vdd 3.3V width 1 timing LEGACY(SDR12) dt B
[    4.247427] [mmc]: *** sw_mci_dump_errinfo(L559): smc 0 err, cmd 5,  RTO !!
[    4.255277] [mmc]: *** sw_mci_dump_errinfo(L559): smc 0 err, cmd 5,  RTO !!
[    4.263130] [mmc]: *** sw_mci_dump_errinfo(L559): smc 0 err, cmd 5,  RTO !!
[    4.270975] [mmc]: *** sw_mci_dump_errinfo(L559): smc 0 err, cmd 5,  RTO !!
[    4.278651] [mmc]: sdc0 set ios: clk 400000Hz bm PP pm ON vdd 3.3V width 1 timing LEGACY(SDR12) dt B
[    4.287834] [mmc]: sdc0 set ios: clk 400000Hz bm PP pm ON vdd 3.3V width 1 timing LEGACY(SDR12) dt B
[    4.299403] [mmc]: sdc0 set ios: clk 400000Hz bm PP pm ON vdd 3.3V width 1 timing LEGACY(SDR12) dt B
[    4.353958] [mmc]: sdc0 set ios: clk 25000000Hz bm PP pm ON vdd 3.3V width 1 timing LEGACY(SDR12) dt B
[    4.418407] [mmc]: sdc0 set ios: clk 25000000Hz bm PP pm ON vdd 3.3V width 4 timing LEGACY(SDR12) dt B
[    4.427773] mmc0: new SD card at address 8a08
[    4.432958] mmcblk0: mmc0:8a08 SD02G 1.84 GiB 
[    4.439327]  mmcblk0: p2 p3

5, disable verify while booting in order to avoid CRC error.
setenv verify n

6, try to compile busybox by myself.
1), u-boot
fatload mmc 0:2 43000000 script.bin
fatload mmc 0:2 48000000 linux/uImage
setenv bootargs "console=ttyS0,115200 root=rootfs init=/bin/sh loglevel=8"
bootm 48000000

1), it should be work, because it prompt about initial console:
[    3.758628] Warning: unable to open an initial console.
[    3.768112] Root-NFS: no NFS server address
[    3.775424] VFS: Unable to mount root fs via NFS, trying floppy.
[    3.790277] VFS: Cannot open root device "rootfs" or unknown-block(2,0)
Please append a correct "root=" boot option; here are the available partitions:
[    3.803567] Please append a correct "root=" boot option; here are the available partitions:
[    3.819127] Kernel panic - not syncing: VFS: Unable to mount root fs on unknown-block(2,0)



5, how to align the image before mkimage?

17:06 2013-05-07
1, Jim_email_20130503
libvirt 1.0.5 was released today.  I've packaged it and committed to
Devel:Virt:SLE-11-SP3.  It has passed libvirt-tck testing on kvm and
I've done a fair amount of testing on xen (legacy xend stack).  Please
give it a try.  If no issues are found, I will submit it for RC2
sometime Friday afternoon (MDT).

Lin,
You have been testing PCI passthrough recently, so maybe you are setup
to do some basic PCI passthrough testing on xen and kvm with 1.0.5.

Chunyan, Bamvor,
Please use 1.0.5 for any SP3 testing or SP3 bug investigations you are
doing.
Mark,
Can you give it a spin on s390?

I would like to ensure there are no regressions with 1.0.5 since it is
quite late in the cycle for new versions :).

BTW, as it currently stands, libvirt 1.0.5 will be the version in f19,
so we'll have the whole fedora machinery helping maintain the stable
branch of this release.

Thanks,
Jim
2, add repo
repo: http://download.suse.de/ibs/Devel:/Virt:/SLE-11-SP3/SLE_11_SP3/
3, \TODO
add SDK DVD to vm.
3, check whether all the patch is pushed into libvirt 1.0.5

10:52 2013-05-09
0, try qdisk on sles11 sp3 rc1 in xl. xen 4.2.2, libvirt 1.0.5
xl create successful.
disk=[ 'format=raw, vdev=xvda, access=rw, backendtype=qdisk, target=/var/lib/xen/images_2/sles11_sp2_pv/disk0.raw', ]
1, backend: qdisk
# xenstore-ls /local/domain/0/backend/qdisk
1 = ""
 51712 = ""
  frontend = "/local/domain/1/device/vbd/51712"
  params = "aio:/var/lib/xen/images_2/sles11_sp2_pv/disk0.raw"
  frontend-id = "1"
  online = "1"
  removable = "0"
  bootable = "1"
  state = "4"
  dev = "xvda"
  type = "qdisk"
  mode = "w"
  device-type = "disk"
  feature-barrier = "1"
  info = "0"
  hotplug-status = "connected"
  sector-size = "512"
  sectors = "4194304"

2, frontend
# xenstore-ls /local/domain/1/device/vbd/51712
backend = "/local/domain/0/backend/qdisk/1/51712"
backend-id = "0"
state = "4"
virtual-device = "51712"
device-type = "disk"
ring-ref = "8"
event-channel = "12"
protocol = "x86_64-abi"

3, try again on xen 4.3 on sles11 sp2.
xl create successful but xl vnc hang.
1), backend
# xenstore-ls /local/domain/0/backend/qdisk
1 = ""
 51712 = ""
  frontend = "/local/domain/1/device/vbd/51712"
  params = "aio:/var/lib/xen/images_2/sles11_sp2_pv/disk0.raw"
  frontend-id = "1"
  online = "1"
  removable = "0"
  bootable = "1"
  state = "4"
  dev = "xvda"
  type = "qdisk"
  mode = "w"
  device-type = "disk"
  feature-flush-cache = "1"
  feature-persistent = "1"
  info = "0"
  sector-size = "512"
  sectors = "4194304"
  hotplug-status = "connected"
2), frontend
# xenstore-ls /local/domain/1/device/vbd/51712
backend = "/local/domain/0/backend/qdisk/1/51712"
backend-id = "0"
state = "4"
virtual-device = "51712"
device-type = "disk"
ring-ref = "8"
event-channel = "12"
protocol = "x86_64-abi"

4, try xen 4.2.2 on sp2.
successful.

5, discuss with Jim:
  Previous Conversations Above
Jim Fehlig: I was probably using whatever was in SP3 beta4
Jim Fehlig: xen4.2.1 IIRC
Jim Fehlig: maybe 4.2.2
Jim Fehlig: but SP3 beta4 for sure
Bamvor Jian Zhang: in xen4.3, xl create succesful, but i could not connect to vm through vnc. 
Bamvor Jian Zhang: the backend is qdisk in xenstore-ls. i guess something go wrong in create. 
Jim Fehlig: you should try to track that down since xen4.3 is near release
Jim Fehlig: would be nice to know what the problem is before 4.3 final
Jim Fehlig: I haven't tried 4.3 yet
Jim Fehlig: maybe get around to it tomorrow or Friday
Jim Fehlig: let me know if you find anything
Bamvor Jian Zhang: ok. 
Jim Fehlig: I'm done for the day 
Jim Fehlig: talk to you later, have a good day
Bamvor Jian Zhang: sorry, just one question
Bamvor Jian Zhang: where could find the debug log for xl. xl -v ?
Bamvor Jian Zhang: i want to compare the log while vm create. i could get in libxl.log if i use libvirt. but i do not know in xl.
Jim Fehlig: hmm, I'm not sure
Jim Fehlig: don't see anything in xl or xl.cfg man pages
Jim Fehlig: or http://wiki.xen.org/wiki/XL
Jim Fehlig: the libvirt libxl driver fopens the logfile and calls xtl_createlogger_stdiostream() to wire up the logging
Jim Fehlig: you could see if xl does something similar via some undocumented option or env var
Jim Fehlig logged out at 12:05:07 PM.

3, try libvirt.
1), check the patch.

22:01 2013-05-09
1, error
[  213s] gcc-4.6 -P -E -Ui386 -DEFI -D__ASSEMBLY__ -include /usr/src/packages/BUILD/xen-4.3/xen/include/xen/config.h -O2 -fomit-frame-pointer -m64 -fno-strict-aliasing -Wall -Wstrict-prototypes -Wdeclaration-after-statement -Wno-unused-but-set-variable -DNDEBUG -fno-builtin -fno-common -Wredundant-decls -iwithprefix include -Werror -Wno-pointer-arith -pipe -I/usr/src/packages/BUILD/xen-4.3/xen/include -I/usr/src/packages/BUILD/xen-4.3/xen/include/asm-x86/mach-generic -I/usr/src/packages/BUILD/xen-4.3/xen/include/asm-x86/mach-default -msoft-float -fno-stack-protector -fno-exceptions -Wnested-externs -mno-red-zone -mno-sse -fpic -fno-asynchronous-unwind-tables -DGCC_HAS_VISIBILITY_ATTRIBUTE -nostdinc -g -D__XEN__ -include /usr/src/packages/BUILD/xen-4.3/xen/include/xen/config.h -DHAS_ACPI -DHAS_GDBSX -DHAS_PASSTHROUGH -DMAX_PHYS_CPUS=256 -MMD -MF .efi.lds.d -o efi.lds xen.lds.S
[  213s] boot.c: In function 'efi_init_memory':
[  213s] boot.c:1574:13: error: implicit declaration of function 'map_pages_to_xen' [-Werror=implicit-function-declaration]
[  213s] boot.c:1574:13: error: nested extern declaration of 'map_pages_to_xen' [-Werror=nested-externs]

1), the first try, not work:
> cat fix_efi_boot.patch
Index: xen-4.3/xen/arch/x86/efi/boot.c
===================================================================
--- xen-4.3.orig/xen/arch/x86/efi/boot.c
+++ xen-4.3/xen/arch/x86/efi/boot.c
@@ -25,6 +25,7 @@
 #include <asm/mm.h>
 #include <asm/msr.h>
 #include <asm/processor.h>
+#include <asm/page.h>

 #define SHIM_LOCK_PROTOCOL_GUID \
       { 0x605dab50, 0xe046, 0x4300, {0xab, 0xb6, 0x3d, 0xd8, 0x10, 0xdd, 0x8b, 0x23} }

2), pass, this time. but fail on stubdom
> cat fix_efi_boot.patch
Index: xen-4.3/xen/arch/x86/efi/boot.c
===================================================================
--- xen-4.3.orig/xen/arch/x86/efi/boot.c
+++ xen-4.3/xen/arch/x86/efi/boot.c
@@ -25,6 +25,7 @@
 #include <asm/mm.h>
 #include <asm/msr.h>
 #include <asm/processor.h>
+#include <xen/mm.h>

 #define SHIM_LOCK_PROTOCOL_GUID \
       { 0x605dab50, 0xe046, 0x4300, {0xab, 0xb6, 0x3d, 0xd8, 0x10, 0xdd, 0x8b, 0x23} }

3), error message:
[  242s] [ -d mini-os-x86_64-grub ] || \
[  242s]        for i in $(cd /usr/src/packages/BUILD/xen-4.3/stubdom/../extras/mini-os ; find . -type d) ; do \
[  242s]                 mkdir -p mini-os-x86_64-grub/$i ; \
[  242s]        done
[  242s] /usr/bin/wget -c http://xenbits.xen.org/xen-extfiles/polarssl-1.1.4-gpl.tgz
[  242s] --2013-05-09 14:42:18--  http://xenbits.xen.org/xen-extfiles/polarssl-1.1.4-gpl.tgz
[  242s] Resolving xenbits.xen.org... failed: Name or service not known.
[  242s] wget: unable to resolve host address `xenbits.xen.org'
[  242s] make[1]: *** [polarssl-1.1.4-gpl.tgz] Error 1

4), only make tools.
create fail.

09:00 2013-05-10
Hi, Jim

i am not sure whether i could meet u at im today, because i have to repair my car this morning.

as i said, i have test the qdisk backend on sles11 sp3 rc1 successful and test on sles11 sp2 fail.
i found that in sp2 i use xen4.3 with the old qemu-xen from sp1 xen-4.1.2 package. So, i update the qemu-xen to qemu xen 4.3 rc1, the lastest qemu xen version. but it still not work. just the different problem. 
1, when i using xen4.3 with old qemu-xen, xl create successful but the vm not actual run.
2, when i using xen4.3 with lastest qemu-xen, xl create fail.
3, test xen4.2.2 from sp3 repo on sp2 machine, it is worked. So, this issue should not relative to linux kernel.

i am compiling some old versions in xen-unstable in order to check which version is worked as u said yestoday. i will try it after i came back to office.

bamvor

15:36 2013-05-10
1, 才看到Ian Campbell在5月1日给我回了信.
reply to him: 
>On Tue, 2013-04-30 at 00:07 +0800, Bamvor Zhang wrote:
>>* hi, *
>>* *
>>* i have got the mele quad core STB. it is indeed has the same uart*
>>* connector as mele A1000. and the MP tools is out, it could support *
>>* make a bootable sd card. So, i am trying to put opensuse 12.3 on it.*
>>* the photos and bootlog, ref: *
>>* http://xen_on_arm.farbox.com/post/mele_m9_quadcore *
>Cool! Thanks for posting there. Are you still planning to try and get
>Xen running on this system?
yes. it is what i want.
>With my Xen.org hat on I'm quite interested in this platform (and in the
>A20/A31 generally),
So, do i. Currently, A20/A31 is only open source SOC in Cortex-A7 world.
i guess it is the cheapest device for arm virtualization.
>so I'll be keeping an eye on your progress. Good
>Luck & See you on xen-devel@ ;-)!
Thanks, i will.
right now, i only post some xen tools patches to xen-devel with the email:
bjzhang at suse.com. i hope i could participate the xen arm hypervisor
development too.
>Ian.

Bamvor

16:05 2013-05-10
try uart code on A31
1, which is the default mode for Cortex-A7? hyp?
how to setup the mininal environment for Cortex-A7.
do i need set the vector for Cortex-A7 in the front of the start? I guess So.
2, how to compile the asm code?
arm-none-eabi-gcc head.S -o head -T uart_test.lds

3, 
sunxi#fatload mmc 0:2 0x4000a000 linux/head.image
sunxi#bootm 0x4000a000
## Booting kernel from Legacy Image at 4000a000 ...
   Image Name:   uart_test
   Image Type:   ARM U-Boot Standalone Program (uncompressed)
   Data Size:    36277 Bytes = 35.4 KiB
   Load Address: 40008000
   Entry Point:  40008000
   Verifying Checksum ... OK
   Loading Standalone Program ... OK
OK
[      57.183] ERROR : swi entry mismatch[      57.183] The input swi number is 16777215, 0x00ffffff

4, 搞了半天居然是把elf文件打包了.
sunxi#fatload mmc 0:2 0x4000a000 linux/head
reading linux/head

37094 bytes read
sunxi#md 4000a000
4000a000: 464c457f 00010101 00000000 00000000    .ELF............
4000a010: 00280002 00000001 00000180 00000034    ..(.........4...
4000a020: 000084e0 05000002 00200034 00280001    ........4. ...(.
4000a030: 000b000e 00000001 00008000 00000000    ................
4000a040: 00000000 00000444 00000460 00000007    ....D...`.......

\TODO: check the elf header.

5, generate the bin file
        arm-none-eabi-gcc head.S -o head -T uart_test.lds
        arm-none-eabi-objcopy --gap-fill=0xff -O binary head head.bin
        mkimage -A arm -O u-boot -T standalone -C none -a 0x40008000 -e 0x40008000 -n 'uart_test' -d head.bin head.Image

6,
#fatload mmc 0:2 0x4000a000 linux/head.bin
#go 0x4000a000

fail

7, but the basic uart write test pass. with "mw 0x01c28000 0x61".

8, start modify from head.S
1), EARLY_UART_BASE_ADDRESS is defined in debug-xxx.inc. the latter one is selected in xen/arch/arm/Rules.mk
ref: docs/misc/arm/early-printk.txt
add debug-sun6i.inc
notes: for simple, i just skip the early_uart_init which is called by init_uart.
because the uart should be initiated successful by the u-boot.
2), proc-ca15.S, asm/processor-ca15.h. cortex_a15_init.
So, cortex-A7 should have the same code as cortex-A15, So, just skip it.
maybe i need add cortex-a7 id. 
3), PT_ means page table. PT_UPPER, PT_LOWER get the different page table attribute bits.
4), memory layout in include/asm-arm/config.h
/*
 * Memory layout:
 *  0  -   2M   Unmapped
 *  2M -   4M   Xen text, data, bss
 *  4M -   6M   Fixmap: special-purpose 4K mapping slots
 *  6M  -  8M   Early boot misc (see below)
 *
 * 32M - 128M   Frametable: 24 bytes per page for 16GB of RAM
 * 256M -  1G   VMAP: ioremap and early_ioremap use this virtual address
 *                    space
 *
 *  1G -   2G   Xenheap: always-mapped memory
 *  2G -   4G   Domheap: on-demand-mapped
 *
 * The early boot misc area is used:
 *   - in head.S for the DTB for device_tree_early_init().
 *   - in setup_pagetables() when relocating Xen.
 */

9, try build, if i saw the uart print, continue coding
ref: http://wiki.xen.org/wiki/Xen_ARM_with_Virtualization_Extensions
make dist-xen XEN_TARGET_ARCH=arm32 CROSS_COMPILE=arm-none-linux-gnueabi- CONFIG_EARLY_PRINTK=sun6i
1), fail
prelink.o:(.ARM.exidx+0x0): undefined reference to `__aeabi_unwind_cpp_pr1'
prelink.o:(.ARM.exidx+0x20): undefined reference to `__aeabi_unwind_cpp_pr0'
http://blog.csdn.net/feihongwang/article/details/7474813
http://blog.csdn.net/ce123/article/details/6621579
from gcc manpage: 
-nostdlib
    Do not use the standard system startup files or libraries when
    linking.  No startup files and only the libraries you specify will
    be passed to the linker, options specifying linkage of the system
    libraries, such as "-static-libgcc" or "-shared-libgcc", will be
    ignored.  The compiler may generate calls to "memcmp", "memset",
    "memcpy" and "memmove".  These entries are usually resolved by
    entries in libc.  These entry points should be supplied through
    some other mechanism when this option is specified.

    One of the standard libraries bypassed by -nostdlib and
    -nodefaultlibs is libgcc.a, a library of internal subroutines that
    GCC uses to overcome shortcomings of particular machines, or
    special needs for some languages.

    In most cases, you need libgcc.a even when you want to avoid other
    standard libraries.  In other words, when you specify -nostdlib or
    -nodefaultlibs you should usually specify -lgcc as well.  This
    ensures that you have no unresolved references to internal GCC
    library subroutines.  (For example, __main, used to ensure C++
    constructors will be called.)

add it in Config.mk:
Config.mk:EMBEDDED_EXTRA_CFLAGS += -nostdlib
\TODO: why no one found this? does the compile version too low?

2), generate the uImage
mkimage -A arm -T kernel -a 0x40200000 -e 0x40200000 -C none -d "xen/xen.bin" xen-uImage 

boot:
fatload mmc 0:2 40008000 linux/xen-uImage
bootm 40008000


3), hang. i found that i forget to modify the Rules.mk in xen/arch/arm

4), hang. from dissemble, i found that the link address is 0x80200000, So, we need change the link addr.

5), it looks like i need slow down. i plan to read the dissemble from u-boot.bin line by line and create a dedicated small environment.

10, (08:18 2013-05-12)
try arm-linux-gnueabihf- from linaro. it is ok. oh, i god, i waste a lots of time about compiler.

sunxi#fatload mmc 0:2 40008000 linux/xen-uImage
reading linux/xen-uImage

590648 bytes read
sunxi#bootm 40008000
## Booting kernel from Legacy Image at 40008000 ...
Image Name:
Image Type:   ARM Linux Kernel Image (uncompressed)
Data Size:    590584 Bytes = 576.7 KiB
Load Address: 40200000
Entry Point:  40200000
Verifying Checksum ... OK
Loading Kernel Image ... OK
OK
[      28.570]

Starting kernel ...

- CPU 00000007 booting -
- UART enabled -
- Setting up control registers -
- Turning on paging -
- Ready
1), crash after memory mapping in hyper mode. it is because the sun6i using 0x40000000 as phy base while others using 0x80000000. and the latter one is same as the ttb in hypermode.


