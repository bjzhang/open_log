
10:13 2017-02-19
----------------
It is hard for to focus on doing something. I could be pushed to work or discuss. But if no one ping me, I just waste my time.
PLAN and DO.
I could think randomly. But I could not focus.
I feel I am dying. I am suicide.

14:39 2017-02-22
----------------
GTD
---
1.  today
    1.  slide for bud17.
        14:46-15:56
        19:18-19:26 晃悠一圈后，还没开始写。
        19:26-  Finish the draft before 19:50.
    2.  supper and rest
        18:00-18:25 supper
        18:25-18:52 rest
    3.  productivity tools. see"19:07 2017-02-22"
        18:52-19:18

19:07 2017-02-22
----------------
productivity, notes
-------------------
1.  similar to slack and trello.
    <https://quip.com/>
    maybe I should try this one? Does quip could sync message from other app like slack? If so, I could use it with my wife.
2.  evernote with markdown
    <http://www.wiz.cn/>
3.  mac/ios only notes and mindmap app:
    <http://www.betternotesapp.com/>
    <https://mindnode.com/>

11:00 2017-02-23
----------------
GTD
---
1.  today
    1.  verify etm range.
        11:01-11:39 It seems that ptm2human could not support the address range.
        TODO: try with trace32.
    2.  DONE: read slide of tee from xiemiao.
        It seems that the core code of CA is located in kernel. We do not need to protect the region in userspace which simiply our design.
    3.  Finish discuss our memory region protection.
        -16:30
    4.  disk partition and sync android code.
        16:31-16:44 Takes more time because I need to umount the partition to speed up the resize.
    5.  clone code.
        16:44-16:55 wait ssh public key valid.
    5.  slide for bud17.

15:01 2017-02-24
---------------
GTD
---
1.  today
    1.  14:10-14:55 CA, TA, Trustzone training.
    2.  tz: read the doc of authentication protocol and think about the flow.
        15:22-15:39 Tired.
    3.  trustzone: read teeos.
        17:07-18:16
        19:11-19:21 tired.
    4.  read arm doc and discussion.
        -18:34
    5.  18:34-19:07 supper.
    6.  19:07-19:11 rest.

10:07 2017-02-25
----------------
GTD
---
1.  today
    1.  try coresight etm range in trace32 simulation mode.
        10:07-10:32  d:\t32\bin\windows64\t32marm.exe -c d:\t32\configsim.t32
                     in simulator, the cpu is arm7TDMI. I could not load binary.
    2. could etm trace software maker？
        走神了。
        15:14-15:37
    3.  16:14-16:35 zone out.
    4.  teeos mm code. memory permission.
        16:38-17:05 工作总是做一些不重要的事情。比如wine安装office，只能安排到5分钟修改时间。
        17:19-17:57 Read the code roughly. Plan to modify it on Monday.

10:51 2017-02-27
----------------
GTD

1.  today
    1.  write coresight environment setup doc(huawei internal).
        10:02-10:40.
    2.  misc, rest
        10:40-10:55
    3.  free talk with my colleague.
        10:55-11:17.
    4.  activity.
        11:18-12:03 I think I should finish it within 20 minutes. The reason is I need to recheck the chat and log. It takes too much time. I should wrote summary everyday.
    5.  help colleague debug coresight:
        14:24-15:02
    6.  align access.
        15:03-15:31 My colleague want to discuss unalignment access of aarch32: vstr. I think it will be an issue when migarte to arm64 kernel no mattter aarch32 or aarch64.
    7.  ILP32: Steve Ellcey send the new version of glibc part.
    8.  read STRIDE doc in huawei.
    9.  check my bill
        15:52-16:00.
    10. I found that if no one ping me. I do not know what I should do. 真不是个自觉的人.
    11. read dmss register. est. 30'
        16:03-16:19
        17:11-18:12 with some discussion with nan wang about etm range filter.
        21:05-21:31
    12. 16:19-17:11 long rest. I am not actually tired. Focus, focus!
    13. performance test of 4k and 64k page. get perf stat.
        19:28-21:02 It takes too long. because I update the code without consistent and I forget this. It is too long to use the script.
                    Also discuss the slide with Mark during try to compile.

10:43 2017-02-28
----------------
GTD
---
1.  today
    1.  每次都是这样，刚刚有一天稍稍认真的工作。马上就要晃悠。感觉自己好没有希望，过了14年，仍然受很差的生活规律困然。
    2.  本周重点工作：
        1.  dmss和海思讨论清楚。
        2.  bud17胶片，手稿。
        3.  出差准备：欧元。
    3.  10:45-11:08 rest.
    4.  read dmss register and set a non-security region.
        11:11-12:30 fail. I suspect dmss could not be read during boot.
        15:41-16:06 fail again.
        16:16-17:11
        17:35-18:19
    5.  12:30-15:00 加上吃饭，睡觉，醒觉一共用了两个半小时。有点长了。我觉得一共一个半小时比较好，也就是半小时吃饭，40分钟睡觉，20分钟醒觉。
    6.  PBC
        15:05-15:41
    7.  bud17 slide.
        18:21-18:25
    8.  下班: 21:55
    6.  read ILP32 patches.
    7.  check perf result.
    8.  comment on bud17 slide: ask tlb hint internally.

2.  TODO
    1.  update STRIDE: 重点是coresight etr寄存器状态审计对于仿冒的防暑。dmss内存权限对于篡改的方式。考虑到打开kvm难度不大，建议审计时加入hyperviosr的HTBR和地址映射的审计(Secure EL3能否访问EL2). exception能不能被过滤?(如果确认了是exeption，可以问问mathieu能不能过滤).

22:05 2017-02-28
----------------
1.  to yury:
    These patches look good to me. Just two comments:
    1.  19/20
        "Adjusted to move the move data page before code pages in sync with"
        should be
        "Adjusted to move the data page before code pages in sync with"?

    2.  I usually use "Bamvor Jian Zhang" instead of "Bamvor Zhang Jian" as my name. It'd better update them in 9/20, 12/20, 14/20, 15/20, 18/20, 19/20 to:
        Signed-off-by: Bamvor Jian Zhang <bamvor.zhangjian@linaro.org>

    And do you plan to test the performance of lmbench and specint? I bisected the performance in lmbench. I think the 1-2 difference is lead by is_comapt_thread and/or exception handler. What do you think about it?

2.  check the status in our 4.1 kernel
    Subject: [PATCH 03/20] asm-generic: Drop getrlimit and setrlimit syscalls from default list

10:14 2017-03-01
----------------
GTD
---
1.  today
    1.  I actually sit down in my desk at 10 o'clock. But I start to work from 10:15. I should save this 15 minutes.
    2.  dmss: add ddr auto gate.
        10:15-10:38
        10:59-11:34
        11:39-12:15
        12:18-12:29 Read dmss register successful.
        17:21-18:19 Read DMSS RTL_INF3 sucessful.
        19:44-  Read current dmss uage.
    3.  lunch
        12:29-13:01
    4.  Fill the leave form.
        13:01-13:19
    5.  coresight cfi design discussion:
        14:30-15:30
    6.  supper and rest.
        18:19-19:24

10:54 2017-03-02
----------------
GTD
---
1.  today
    1.  discuss plan and mis with WANG Nan.
        10:52-11:20
    2.  dmss: set memory attribute.
        11:20-12:11 read asi=6,8 memory attribute.
        12:20-12:44 discuss with colleague.
        14:24-15:03 set dmss cssys attribute.
        15:19-16:14
        16:18-17:19 segfault at first begin. after move to kernel mode. it is ok. But I do not understand why I could read dmss in global task.
        17:55-18:40 update patch.
        1.  set ns cpu could not read.
            00:05-00:51 coding
            00:51-00:53 compile
            00:53-01:31 it not works.
            01:31-01:38 revert TA patch from zhangheng. it could output BAMVOR debug in global_task.c
            02:08-02:38 move coresight_check to trustedcore_src. compile pass.
            02:38-03:26 hang when i read before open_session.
            03:30   debug.
    3.  linaro
        17:35-17:55 1:1 with Mark Brown.
    4.  try CA->TA
        19:48-20:57 fail. 这样我只能在tee global task读etr buffer.
    5.  read and compare etr buffer.
        1.  map etr buffer.
            21:14-21:29 Do not find the memory map info.
            21:29-22:01 find some mapping. To be continued.
        2.  read etr in ta open session of global task.
            22:01-22:07
            22:12-22:38 finsih coding and compile pass.
            22:40-23:20 do not print date.
            23:41 could read etr buffer correctly.
    6.  try dmss permission for coresight.
    7.  23:53-00:04 confirm csdecoder usage.
    7.  rest
        23:47-23:50 收拾桌面.
        23:50-23:53 rest

08:24 2017-03-03
----------------
GTD
---
1.  today
    1.  cfi
        1.  planning.
            8:26-8:28
        1.  decoder.
            1.  try to integrate.
            2.  support exception by Yu Zhong Wen.
        2.  measurement.
            1.  add pmu register.
                8:32-8:35 do not know which one is.
            2.  set in ree. read counter in tee.
        3.  dmss memory protection.
            1.  read register and discuss with Cong Liu.
                8:37-8:51
                9:20-9:57 I set the wrong register: addr_size
                10:00-10:23
                12:01-12:40 do not find a clue.
            2.  debug with blacklog.
                17:20-18:30 Could not upload the log. try next time.
            3.  reorganzie the patch.
        4.  discuss with Shiyuan Hu about obs: ring, subproject and devel package.
            10:30-11:17 TODO write doc.
        5.  11:20-11:49 discuss with zhangheng about ca->ta process.
        6.  cont page hint: 4k THP and 64k comparision.
            12:40-12:47
        7.  plane
            16:17-

13:11 2017-03-04
----------------
GTD
---
1.  today
    1.  write draft for my presantation.
        13:12-???
        14:22-???
    2.  choose the schedule in bud17.
        18:40-19:01
    3.  gpio-mockup: does it support pinctrl? No
        18:34-18:40 19:01-19:04 No. Ask Bartosz if he is interested in it.


18:55 2017-03-04
----------------
plan, linaro connect, bud17
---------------------------
- cont page hint
    - design discussion
- coresight
    - d05 support? four etrs
    - cti use for continuous tracing?
    - perf per-thread buffer connect to etr which could trace multiple thread?
    - make use other resource? sequencer, event(other than viswinst), comparator.
    - make use of data trace, senario?

- trustzone/TEE. development and secure issue, and the following topic:
    - 0308 11:30 am - 11:55 pm BUD17-313 - BoF - Device Tree and Secure Firmware
    - 0309 10:00 am - 10:25 am BUD17-400 - Secure Data Path with OPTEE
    - 0309 12:00 pm - 12:25 pm BUD17-416 - Benchmark and profiling in OP-TEE

- ILP32
    - Upstreaming plan
    - Performance regression analysis.
- OS distribution maintainance
    - How to upgrade to new version: how to build the bootstrap.
    - How to make use of the ring and staging like openSUSE?

10:12 2017-03-05
----------------
1.  today
    1.  I planed to start to work in 10:00. But after I finish shower, I do not start it in time.
        I am hungry. Go to lunch early.
    2.  bud17
        10:20-10:40 try the presentation.
        10:47-11:07 take the notes: bjzhang.github.io/_drafts/2017-03-05-Implement-contiguous-page-hint-for-anonymous-page-in-user-space.md

22:44 2017-03-06
----------------
GTD
---
1.  today
    1.  do the plan
        15:47-15:49
    2.  bud17: finish the draft.
        1.  check the perf_stat and try to explain it.
            15:50-16:18 finish get the data through perf_stat.py
            16:41-16:50 It is hard to think about it.
            17:16-18:09 finish. write a few notes. Need discussw with Arnd later.
        2.  add page table attribute in slide.
        3.  think more about the idea.
        4.  discuss with Arnd(in dinner?) and Agraf(today or tomorror).
    2.  activity

2.  next
    1.  check if we have above page hint patches in our 4.4 kernel?
        if not, we could enable this feature for 4.4 kernel. And we may see good performance improvement with all these improvement(including my cont page hint).

14:36 2017-03-13
----------------
GTD
----
1.  today
    1.  13:30-14:13 Fee.
    2.  rest
        14:13-14:30
    2.  Regular meeting.
        14:30-16:19
        NetApp WAFL(very similar to Btrfs).
        NetApp WAFL: page protect for modifing data.
        1862 what's chip.

14:32 2017-03-14
----------------
GTD
1.  today
    1.  discuss with nan wang about the status of current project.
    2.  Expense Claim. TODO add name of reciever.
    3.  Read doc and discuss about how does should we trust the apps with teeos?
        15:20-

14:14 2017-03-15
----------------
GTD
---
1.  today
    1.  read email.
        14:15-14:23
    2.  STRIBE analysis.
        14:35-15:37
    3.  go back to home. 19:47.
    1.  send two email of people I know in connect.
        Satoru Okamoto <okamoto.satoru@socionext.com>
        Security Working Group:  etienne.carriere@linaro.org
    1.  Read doc and discuss about how does should we trust the apps with teeos?
        delay. Discuss with etienne
    1.  send two email of people I know in connect.

09:35 2017-03-16
----------------
GTD
---
1.  today
    1.  9:31- arrive my table in company.
    2.  read one of TEEOS design doc.
        9:53-9:55
    3.  discuss with Nan Wang and Yuzhong Wen.
        9:55-10:15
    4.  Ask the merge follow of DMSS.
        10:32 Gengyanping is mobile online. wait for a minute.
    5.  discuss with HongJiang Zhao and Nan Wang.
        10:32-11:31
    6.  print the photo in netease yxp.
        13:10-13:40
    7.  DMSS
        14:41-xxx draw mindmap.
    8.  store two name cards in evernote for the people I know last year. Linuxcon or Linaro connect.

22:40 2017-03-16
----------------
reply


On 15 March 2017 at 23:49, Etienne Carriere <etienne.carriere@linaro.org> wrote:
> Hello Bamvor,
>
> Before all, do we agree that the acronym "CA" refers to a "non secure Client
> Application running in the REE" ?
Yes.
>
> I would say it is pretty hard for a TEE to reliably identify a fake CA.
> How can TEE distinguish a rogue CA from a legitimate CA ?
> TEE gets request from non-secure but has no mean to be 100% sure of the CA
> identity.
> The REE could run a legitimate CA and a rogue CA at the same time, and both
> can invoke TEE with the exact same requests parameters (especially if the
> Linux OS was hacked).
Sure. We assume that Linux is already rooted. So, the question is could
we find a trust area even if the kernel is rooted?
>
> If you feel the REE is safe enough to really isolate Client Applications,
> then you application could get a secret (builtin, or provided through a
> secure network connection) and it could invoke the TEE using this secret to
> authentify itself. Of course the TEE shall also get the secret counter part
> from other means (built-in public key, public key received from a secure
> network link, ...).
As you said, the REE could make use of public key. But I am thinking how
to avoid a re-use the same key to do a fake request. At the beginning, I
think I could use random key to avoid it. But if the random key is stored
in memory, then it could be geted through other CPU. So, I suppose the
random key should be only existed in cpu register. But the interrupt
is also need to take into account.

So, go back to my question, is there a best pratice for the transaction
between REE and TEE?
>
> But maybe I don't really understand your need.
> (and remember I am not a security expert, rather a security-aware SW
> developer/integrator)
I think what we discussed is what I care.

Regards

Bamvor
>
> Regards,
> Etienne
>
>
>
>
> On 15 March 2017 at 15:19, Bamvor Zhang Jian <bamvor.zhangjian@linaro.org>
> wrote:
>>
>> Hi, Etienne
>>
>> It is a pity not to discuss with you in Budapest. I read the TEE
>> material recently. The issue is how to identify the fake CA. Could I
>> encrypt the data in an atomic context and use one-time key in REE?
>>
>> Is there a best practice in your hand?
>>
>> Thanks
>>
>> Bamvor
>
>

14:23 2017-03-17
----------------
GTD
---
1.  today
    1.  draw current mindmap for CFC project.
    1.  Summary: coresight and ILP32 of bud17.
        14:28-14:51 cont page hint.
        14:54-15:15 16:37-16:56 coresight.
    1.  read code of dev mem.
        15:15-15:27 dev/kmem for map kernel va. live patching need kernel symbols(not /proc/kallsyms) to do the works.
    1.  add attribute on page table doc.
        15:31-15:40
    1.  chat with Xinwei Hu and Bo LIU(container).
        15:56-16:30 Xinwei is interested in arm server in socionext. He said it is HPC senario.
        16:58-17:31 Send material to xinwei.
    1.  discuss design of CFC.
        --
        19:13-19:58
    1.  reply etienne.

10:52 2017-03-20
----------------
GTD
---
1.  today
    1.  miss the start of morning meeting of CFC.
    2.  discuss with Nan wang about current plan.
        11:16-12:03 update mind map.
    3.  kernel interface changes.
        10:54-11:07 run the script.
        15:06-15:20 15:56-16:04 16:13-16:37 17:30-18:03
    1.  patent: hw page table protection.
        14:18-14:41
    1.  Discuss with Kun LI. page table protection in EL2 with coresight.
        16:33-17:06
    1.  performance regression of ILP32.
        19:21-19:39

10:34 2017-03-21
----------------
GTD
---
1.  today
    1.  the first time I know divide by zero equal to zero.
        20'
    1.  help colleague debug ns bit of page table in secure world.
        11:10-11:30
    1.  move coresight driver to TEE side.
        10:47-11:10 environment setup.
        15:04-15:47 read tmc code. does status in sysfs in enought to config tmc?
        16:01-16:42
        19:27-20:08 20:33-21:04 add some registers in tee.
        call echo.
    1.  fix kselftest.
        14:20-15:00 no big progress.
        16:51-17:00 reply to Michael Ellerman.
    1.  a day of huawei mobile.
        19:05-19:24 document mode.
    1.  kwg activity.
        21:45-

10:45 2017-03-22
----------------
GTD
---
1.  today
    1.  rest
        13:22-14:10
    1.  9:35-10:45 discuss with Chengzhen Wan. The only blocker is whether CS could be opened in product.
    1.  fix kselftest(cont)
        1.  try add OUTPUT?=`pwd` in lib.mk
            10:53-12:00 It is ok for x86 with the help from Nan WANG.
        2.  finish patch and send out.
            14:12-15:00 It works except userfaultfd_hugetlb and userfaultfd_shmem in vm
        3.  fix the userfaultfd_hugetlb and userfaultfd_shmem
            15:05-15:12
        4.  update the vm patch. It could be written userfaultfd.c with header and libs
            DONE
        5.  send out patch
            DONE.
        6.  send a series to Shuah and Michael and cc to Mark. Dicuss with Mark about current situation.
    1.  move coresight driver to TEE side.
        1.  move etr to tee and make sure it works.
            1.  compile pass but not tested.
                15:15-16:15
    1.  arm32 meeting. "17:22 2017-03-22"
        17:05-17:42
    1.  parents' meeting of kindergarten.

09:58 2017-03-23
----------------
GTD
---
1.  today
    1.  discuss contiguous with my colleague(rtos).
        20'
    1.  review meeting for CFC.
        10:04-11:00
    1.  chat with my wife.
        11:00-11:40
    1.  pick up the package for my colleague.
        11:40-11:55
    1.  rest
        12:30-14:20
    1.  coresight tmc(must test pass today)
        14:33-15:08 read code from other colleague in order to know where I should put the code.
        15:22-15:59 complile not pass.
        17:40-18:30 check etr buffer correct or not. The buffer is changes but it is not a reserve memory I do not know if it is changed by etr.
        20:34-  reserve memory and try it again.
    1.  pbc
        16:00-16:05
    1.  Hu ziang presentation.
        16:10-17:00
    1.  send activity of linaro.

14:27 2017-03-24
----------------
GTD
---
1.  today
    1.  lunch and chat with Chunyan
        12:00-14:00
    1.  coresight:
        1.  seperate test code with review code.
        2.  coresight_stop and coresight_start.
            15:55-???
            16:24-16:57
            17:16-17:52
            18:04-18:17
            20:22-22:13 finish the audit function for tmc.
                        With some discussion with Nan WANG.
    1.  send photo of ID card to UPS China. wxueli@ups.com
        DONE.
    1.  discuss technology with colleague.
        30'

15:17 2017-03-27
----------------
GTD
---
1.  today
    1.  fix kselftest(cont): full test.
        1.  I found the ppc patch from Michael. I do not know why I miss this failure in my yesterday test.
        2.  send two fix patches to ML.
    2.  summary activty in huawei.
        5'
        15:40-16:04 16:10-16:40 activity discussion in huawei.
    3.  discuss page table protection with Colleague.
    3.  think about current cont page hint status.
        DELAY
    1.  coresight tmc.
        19:18-20:05 get the correct buffer from user space in tee.
        20:09-

14:54 2017-03-28
----------------
GTD
---
1.  today
    1.  coresight tmc. Why it hangs after write manual flush in FFCR? the writel in CS_LOCK is empty.
        14:55-15:38 Setup environment.
        15:51-16:06 16:51-17:03 split the patch
        17:03-17:05 test the split patch.
        17:14-17:19 commit
        17:20-18:05 18:59-19:09 add tmc stop code step by step. It seems that I wrote a empty writel in CS_LOCK, UNLOCK.
        19:53-20:44 finish tmc flush, stop and dump regs.
        20:48-21:35
    1.  read dmss register document.
        16:06-16:11
    1.  discusss specint with Majunhai.
        16:26-16:31
        19:34-19:53 He do not read the document in specint.
    1.  reply to kselftest relative patch.

11:11 2017-03-29
----------------
GTD
---
1.  today
    1.  test gpio patch.
        13:15-13:35
        19:57 try to fix the KBUILD_OUTPUT for gpio. it will fail in build gpio-utils.
    1.  rest
        13:35-14:25
    1.  cfc design meeting.
        20:02-22:30

10:20 2017-03-30
----------------
GTD
---
1.  today
    1.  CFC.
        10:25-11:00 discussion
        11:08-11:24 free talk.
        11:24-11:32 read android cve. https://cve.mitre.org/cgi-bin/cvekey.cgi?keyword=android, https://source.android.com/security/bulletin/2017-01-01.html. the latter seems better for me to get started.
        11:44-12:25 android security bulletin. read 201612, 201701, 201702, there are Elevation of privilege, Information disclosure, Remote code execution, Denial of service. not relatvie to the system after rooted.
    2.  lunch and walk. 12:25-13:16
        sleep 13:35-14:15
    3.  software skill: I could use simplemind in my mobile and mindmap(free version) in pc.
        5'
    4.  read trustzone bug in cve.
        -14:58. 15:03-15:21
    1.  gpio kselftest patch.
        1.  try to fix the KBUILD_OUTPUT for gpio. it will fail in build gpio-utils.
            19:22-19:46 19:57-20:27 no progress
        2.  eventually, I found that the variable name is wrong. I should use TEST_PROGS_EXTENDED instead of TEST_GEN_FILES.
            20:41-21:28
            Reply to Fathi for Makefile and config fragment.

11:46 2017-03-30
----------------
<https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=6b7339f4c31ad69c8e9c0b2859276e22cf72176d>

```
From 6b7339f4c31ad69c8e9c0b2859276e22cf72176d Mon Sep 17 00:00:00 2001
From: "Kirill A. Shutemov" <kirill.shutemov@linux.intel.com>
Date: Mon, 6 Jul 2015 23:18:37 +0300
Subject: mm: avoid setting up anonymous pages into file mapping

Reading page fault handler code I've noticed that under right
circumstances kernel would map anonymous pages into file mappings: if
the VMA doesn't have vm_ops->fault() and the VMA wasn't fully populated
on ->mmap(), kernel would handle page fault to not populated pte with
do_anonymous_page().

Let's change page fault handler to use do_anonymous_page() only on
anonymous VMA (->vm_ops == NULL) and make sure that the VMA is not
shared.

For file mappings without vm_ops->fault() or shred VMA without vm_ops,
page fault on pte_none() entry would lead to SIGBUS.

Signed-off-by: Kirill A. Shutemov <kirill.shutemov@linux.intel.com>
```

14:53 2017-03-30
----------------
<https://github.com/laginimaineb/cve-2016-2431>

16:51 2017-03-30
----------------
meeting, 1:1, with Mark
-----------------------
1.  report my work status of Huawei. I maybe continue working for internal task from Huawei.
    Mark said understand.
2.  I work on kselftest in last week, I will work on it in next week.
3.  discuss about cont page hint
    TODO
    1.  discuss with arnd with senario.
    2.  investigate the cont page hint host for vm

22:07 2017-03-30
----------------
KWG192
<https://books.google.co.id/books?id=aYioBQAAQBAJ&pg=RA2-SA3-PA4&lpg=RA2-SA3-PA4&dq=contiguous+page+hint+kernel&source=bl&ots=CkvaCeoa6B&sig=8SIuajGjSE_ySYn1zMAfbNuVEBs&hl=zh-CN&sa=X&ved=0ahUKEwje0ZGPsv7SAhWJPI8KHcmfCKYQ6AEITjAH#v=onepage&q=contiguous%20page%20hint%20kernel&f=false>

15:42 2017-03-31
----------------
op-tee
------
1.  Discuss with Jerome Forissier <jerome.forissier@linaro.org>(The maintainer of op-tee).

2.  Jerome suggest me open an issue <https://github.com/OP-TEE/optee_os/issues>:
    1.  I found this issue talk about the secure monitor mode.
        [Question regarding SMC](https://github.com/OP-TEE/optee_os/issues/1443)
        *   EL3(aarch32): sm_smc_entrk in optee_os/core/arch/arm/sm/sm_a32.S.
        *   EL3(aarch64): <https://github.com/ARM-software/arm-trusted-firmware>

3.  Gic and op-tee
    <https://github.com/OP-TEE/optee_os/issues/1244>
    <https://github.com/OP-TEE/optee_os/commit/5acb1bc>

    ```
    In GICv3 mode, the FIQ and IRQ have different definitions.
    * Secure Group 0 interrupts:
    Handled by EL3 and triggered by FIQ when running at Secure EL0/1.
    * Secure Group 1 interrupts:
    Handled by optee_os and triggered by IRQ when running at Secure EL0/1.
    * Non-secure Group1 interrupts:
    Handled by the rich os and triggered by FIQ when running at Secure EL0/1.

    The "Secure Group 1" interrupts are the "native" interrupts handled by optee_os. They are same as the "secure" interrupts used in optee_os for now. But they are triggered by FIQ in GICv2 mode while by IRQ in GICv3 mode.

    The "Secure Group 0" and "Non-secure Group1" interrupts are the "foreign" interrupts that will cause the exiting of optee_os. (e.g.  switch back to normal world) The "Non-secure Group1" interrupts are same as the "non-secure"interrupts used in optee_os for now. But they are triggered by IRQ in GICv2 mode while by FIQ in GICv3 mode.
    ```

19:39 2017-03-31
----------------
GTD
---
1.  today
    1.  reply to Mathieu and Mike Leach.
        19:45-20:16
    2.  reply email to kselftest.
        20:16-20:21
    3.  reply to Jerome Forissier.
        20:21-20:45

    1.  read etm doc.
    1.  coresight tmc: rebase to our master.
    1.  Summary tlb flush and discuss with colleague.

    1.  bud17 summary: finish coresight after discuss. Summary v8.1, v8.2 of toolchain, filesystem.

10:28 2017-04-01
----------------
GTD
---
1.  today
    1.  tee:
        10:30-10:47 search android tee attack blog. see"10:32 2017-04-01"
        1.  search qsee.
    1.  STRIDE
        16:05-
        17:45-
    1.  reply to Mathieu about buffer overflow.

10:32 2017-04-01
----------------
"What if we send a kernel pointer from user mode?"

09:17 2017-04-04
----------------
GTD
---
1.  today
    1.  Add review tag in Fathi gpio config.
    2.  Linaro activity.
    3.  STRIDE

09:50 2017-04-05
----------------
1.  today
    1.  misc
        1.  lunch and rest 12:25-13:32
        1.  have a rest. 13:32-14:10
        1.  wake up and walk. 14:10-14:30
        1.  do random work in the afternoon. I hope it only once per week.
        1.  supper and rest. 18:10-19:09
    1.  CFC STRIDE
        9:50-10:50
        11:00-11:09 documents discussion.
    2.  Huawei culture.
        11:11-11:21
    3.  ktest: see"22:16 2017-04-05"
    4.  check the status of rk3399.
    5.  submit a expense for the registration fee of linaro connect.
        15'
    6.  KWG-192:
    7.  arm32 meeting.
        17:00-17:40
    8.  cfc
        17:40-18:10
        19:13-20:19 merge all the patch. Est. 30'
                    It takes me 20' minutes to fix a overwrite of a variable.
        20:33-21:19 merge the 2nd patch. Est. 20'
                    Apply done.
                    compile
        -21:40 done.
    9.  huawei colleague.
        19:10-19:13

19:04 2017-04-05
----------------
[ARM SoC体系结构](https://book.douban.com/subject/1231973)
ebook: http://jsjyl.chd.edu.cn/ARMSoCchinese.pdf

22:17 2017-04-05
----------------
<https://www.slideshare.net/satorutakeuchi18/kernel-auto-testbyktest>
<http://elinux.org/Ktest>

10:10 2017-04-06
----------------
GTD
---
1.  today
    0.  misc
        1.  lunch and rest
            12:25-14:10
        2.  wake up.
            14:10-14:24
        3.  rest
            16:08-16:56 Too long rest. I should switch to other works.
    1.  cfc
        1.  fix the crash.
            10:10-10:38 write flexible test code.
            10:38-10:51 boot fail when I access the addr, +4, +8, +c.
            only read addr. it works when use *(unsigned int*), it might be some issue the readl I used.
                10:51-11:05
            Test stop trace
                11:05-11:44 update the test case to check the failure of audit.
                11:44-11:56 compile and test, Est. 10'
            Test start trace
                11:56-12:05
        2.  how to know the PID of apk ca:
            14:45-15:10 There is no clude in tzdriver login code.
            15:10-16:08
            16:57-17:21 Think about how to send CA pid in socket relative api.
                        socket, bind, accept, fcntl
            17:40-18:11 check sendmsg. see"18:58 2017-04-06"
            19:35-19:53 update sendmsg.

18:59 2017-04-06
----------------
network, api, socket, sendmsg
-----------------------------
send msg:
The manpage said that msg_flags is ignored. But I could saw that `__sys_sendmsg`(linux/net/socket.c) get the msg_flags.
unix_stream_sendmsg: use the following flags: MSG_OOB, MSG_DONTWAIT, MSG_NOSIGNAL.
It seems that I could make use one of the following: MSG_CONFIRM, MSG_MORE, MSG_WAITALL.

After dicuss with my colleague, I realize that even if the flags is not used right now, it is not safe to use these flags to specific purpose. The attacker may attack the system through this use case.

09:57 2017-04-07
----------------
remote year
I went to American, German, Hungary, Thailand for meeting and trip. I enjoy the different culture in different country. If I could get a chance to work remotely in the whole year, I think it is the valuable experience in my life and career.

09:58 2017-04-07
----------------
GTD
---
1.  today
    1.  misc
        5'(-9:57)  reply remote year.
        1.  software skill, putty, windows title: see"11:12 2017-04-07"
        2.  lunch 12:30-13:06
        3.  wakeup and recover. 14:22-15:31 I hope it is short than 30 minutes.
    1.  CFC: update sendmsg and open.
        1.  how about use seccomp to do this?
            10:04-10:41 It will lead to kernel code clean, but if seccomp is not enabled in our mobile. It is too heavy.
            11:15-11:32 write to xmind.
        2.  update sendmsg and open.
            1.  modify finish.
                11:32-12:26
            2.  compile and test.
                15:31-15:36 15:52-16:20 compile pass.
                16:37-xxx add log and test.
                20:10-20:26 hang at sendmsg. reset to default kernel.
    1.  memset downgration in arm64.
    1.  CFC etr patch review.
        19:40-20:05

11:12 2017-04-07
----------------
software skill, putty, windows title
------------------------------------
help colleague to figure out how to set putty title to $PWD.
1.  avoid <http://serverfault.com/questions/178469/set-puttys-window-title-to-name-of-loaded-session>
2.  do <http://stackoverflow.com/questions/19050611/putty-dynamic-title-with-pwd>

11:02 2017-04-10
----------------
GTD
---
1.  today
    1.  misc
        10:45-11:02 ?
        13:30-14:10 sleep
        14:10-14:50 ?
        Summary: 早起感觉状态不行啊，时间像音符般流淌。
    1.  discuss with little dog.
        10:23-10:45
    1.  CFC: move cs driver to trustzone.
        11:04-11:44
        14:51-15:03
        17:34-17:40
    1.  15:50-16:30 syscall migration from arm to arm64.
    1.  CFC: update sendmsg and open.

10:09 2017-04-11
----------------
GTD
---
1.  today
    1.  syscall.
        10:10-11:25 finish doc
        11:29-11:31 process the git log.

08:13 2017-04-12
----------------
GTD
---
1.  today
    1.  CFC discussion.
        8:13- 用二维代替稀疏矩阵.
    2.  CFC: set TIF flags and switch ETM.
        1.  review the code of TIF flags.
            5'
        2.  ETM switch.
            10:30-10:45
            13:47-14:20
            how do I know which cpu I am running? smp_processor_id
            14:20-15:09 code finish.
            15:08-15:32 environment prepare.
            15:33-15:45 test: crash in sendmsg.
            15:51-16:42 debug. no progress.
            19:45-20:32 struct pid and pid_t is different.
                        think about state machine.CANCEL: after discuss with wangnan I found easier way.
            20:36-21:06 finish modify the code. debug.
            21:06-22:05 there are lots of TIF_CS_TRACE flags in kernel which should not be happened.
            22:05-22:23 after disable my code. there are still TIF_CS_TRACE tagged thread. figure it out tomorrow.
        3.  if successful, add flags for ioctl to avoid other syscall.
    3.  CFC: discuss about schedule.
        9:29-10:23
    4.  CFC discuss audit
        10:45-11:45
    5.  read the email of kselftests from shuah
        DONE
    6.  Summary:
        for the struct pid and pit_t: care about the type instead of name. care about warning from compiler.

09:49 2017-04-13
----------------
GTD
---
1.  today
    1.  misc
        1.  rest room
            9:48-10:01
    1.  CFC
        1.  morning meeting.9:35-9:45
        2.  check if TIF_CS_TRACE exist without my patch. est 15'
            10:02-10:23
            could not connect to devices. it works after reboot.
            10:23-10:33
            there is no 23bit without my patch.
            10:33-10:37
        2.  re-apply my patch
            1.  only test sendmsg.
                10:37-10:45
                10:45-11:09 there are lots of process taged with TIF_CS_TRACE
                10:48-11:23 ???
                11:23-11:34 ???
            2.  add another flags to indicate from ioctl to smc message return.
                11:53-xxx
                14:15-14:34 analysis and add another TIF flags: TIF_CS_TRACE_IN_IOCTL
            3.  why there are lots of process taged with TIF_CS_TRACE
                14:41-14:53 print in the fork.
                15:14-15:30 why the TIF_CS_TRACE come before teecd start? add print.
                15:38-??? The thread_info located in stack and it will be copied during copy_process
                18:36-19:41 record the process tagged by af_unix.c
                binder?
            4.  try the patch in upstream kernel and arm64.
                18:34-18:36 CANCEL
            5.  after discuss with NAN Wang. I realize that I should check more information.
                1.  AF_UNIX, SOCK_STREAM with SOL_SOCKET and SCM_RIGHTS: scm_fp_copy.
                2.  fd opened by teecd.
                    20:20-20:25
                    20:30-20:45 finish coding.
                    5' the test result seems good.
            6.  apple the etm disable/enable patch.
                20:50-21:11 apply patch.
                21:11-21:49 testing. seems work.
                21:56-22:10 save on/off state in etm
                22:40 test
    1.  1:1 with Mark
        16:30-16:50

09:52 2017-04-14
contextidr enable.

10:40 2017-04-14
----------------
GTD
---
1.  today
    1.  misc
        1.  lunch and walk.
            12:04-12:52
        2.  nap 13:10-13:40
        3.  supper and walk.
            17:40-18:30
    1.  CFC
        1. prepare push "enable etm by CA"
            10:20-10:40 reorganize code
            10:40-11:28 test pass.
            11:28-12:04 merge with master.
            14:07-14:22 merge common kernel
            14:22-14:46 test. there are reasonable output.
            14:46-15:22 do not operate etm before coresight init done. enable contextidr and check pid with contextidr.
            16:39- figure out why it fail. After modify the code. it works. but I do not know why it failed.
            18:13-19:01 avoid the duplicate set TIF flags. test pass.
            19:01-19:18 rebase and test again.
            19:18-19:30 it works. give it to NAN Wang

10:12 2017-04-15
----------------
GTD
---
1.  today
    1.  debug coresight enable crash.
        10:12-11:17 still crash
        11:17-11:34  apply my original patch.
        11:34   it fail after apply address filter.
        15:25 try to apply my patch with TIF flag from NAN Wang.
        16:34 it still crash. I do not know why it works yesterday.
        16:54 There are lots of duplicated enable/disable of etm.
        15:54 try the branch I used yesterday. But I am not sure the name of the branch.
        16:40 TODO: restore all the patch to yesterday.
        18:59-19:20 rewrite the code base on NAN Wang.
            1.  check the etm on/off logic.
                19:20-19:56 It seems that the enable bit is conflict on switch on and switch off. But the same cpu should not have the consistent error.
                19:56-20:12
            2.  check why coresight enable/disable enter twice in the same process.
                20:12-20:34 no clue
            3.  etm boot enable.
                20:34-20:44
            4.  add address filter.
                20:44-


    2.  CFC Summary
        1.  set TIF to group leader is better than current. Because CA could open fd through process A and do ioctl in process B.
            I should think about the difference method.
        2.  I forgoet push the volatile for enable and stikey_enable. TODO: make use of stg?
        3.  there is etmdrvdata array. I should make use of this to avoid create a new array. I think the root cause is I do not read the whole code when I want to modify it.
        4.  I do not consider the etf in cpu cluster will be powered off when the cluster power off. I should consider it early.

10:42 2017-04-16
----------------
GTD
---
1.  today
    1.  misc
        1.  walk and buy snak.
            30'
        2.  nap
            15'
        3.  eat Pizzahot.
            -14:39
    1.  CFC
        1.  fix the issue in branch of yesterday.
            xxxx-10:42
        1.  check if etm4_enable/disable_hw is called in other function.
            *   10:43-10:48 I indeed miss some functions in cpu power manager functions.
            *   10:48-11:07 test. the ratio  of useful data come back to 1/20 after fix the issue. it is as same as the original ratio without our etm trigger in context switch.
        1.  try start stop filter.
            11:08-11:56 read doc and code.
            11:58-12:30 try to write the code.
            14:39-
        1.  We found that the prev and next will changed after cpu_switch_to(). TODO: write doc for it.
            when A call B, if A and B use the same arguemnts. Because x0-x7 is caller saved register. A must save the corresponding register before calling B.
            But it still hard to see why x0 and x1 will store to callee saved register. x0 and x1 should store to stack.
            The logic could be: if A call B, two functions use the same argument, A will store the argument of A to stack. And during cpu_switch_to, the stack will be swaped through x9. After context switch, the variable in stack will be swtich too.
            The question is why x0 and x1 save to x19 and x20? It relative to kernel compiler option.

09:27 2017-04-17
----------------
GTD
---
1.  today
    1.  CFC:
        1.  9:27-9:36 discussion
        2.  9:36-10:23 misc
        3.  10:23- write coresight with assembly macro. we probably could only write enable and timeout as assembly, but we are not sure about if the conf of etm changes during/after interrupt(think about cpu offline).
        1.  ask linaro why the long IS0 is usually useless? why there are so many "00000000 00000000" packages?
            Need work on the same hardware. Mathieu suggest Dragonboard.

14:19 2017-04-18
----------------
GTD
---
1.  today
    1.  read the open session process.
        14:20-14:35
    2.  discuss IC department about the bus monitor.
        14:35-14:54
        -15:19
        15:24-15:59 test bus operation monitor.
        -17:15 Eventually I got a working code. It is because I forget switch a branch(one in four).
        17:15-17:33 compile...
        17:33-17:44 testing: there is no "not-finish" message at all.
    3.  compare etm register. 15:19-15:24

09:25 2017-04-20
----------------
GTD
---
1.  today
    1.  misc
        -16:16
    1.  check interrupt routine between tee and ree.
        9:50-
    2.  cfc: review the patch.
    3.  cfc: do not divide the frequency of top coresight.
        18:29-


    1.  lsf 共享mmap的cache避免tlb flush.

14:40 2017-04-21
----------------
GTD
---
1.  today
    1.  cfc: code review and delete sysfs of coresight; empty etr en/dis.
        -14:40.
        14:47-14:57 code review.
        15:02-15:29 delete sysfs of coresight. coding done.
        15:40-15:45 add missing enum type.
        15:45-16:28 meeting.

10:00 2017-04-22
----------------
GTD
---
1.  today
    0.  最近笔记的少，提示我其实没干什么事情。
        睡醒后，13:30-14:40没有聚焦工作。
    1.  CFC: read teeos code.
        10:05-10:22
        10:30-10:51
        10:53-11:14
        11:26-12:01
        14:42-15:15
    1.  where does kthread set current?
        15:32-15:48 not sure.
    1.  CFC: read coresight code.
        15:55-16:10
        16:53-
    1.  kabi test script.
        16:14-16:43

08:24 2017-04-24
----------------
distrbution, ubuntu, dpkg, apt, error after upgrade
--------------------------------------
apt install failure after upgrade from ubuntu 12.04 to 14.04: "E: Internal Error, No file name for libpam-modules".
Found the following link:
<https://askubuntu.com/questions/266450/how-to-fix-e-internal-error-no-file-name-for-libc6>
```
just the dpkg --configure -a worked for me â gatoatigrado Nov 9 '13 at 23:13
```
It works for me:
```
Get:17 http://mirrors.cloud.aliyuncs.com/ubuntu/ trusty-updates/main python-wheel all 0.24.0-1~ubuntu1 [44.7 kB]
Fetched 1,775 kB in 0s (3,204 kB/s) 
E: Internal Error, No file name for libpam-modules
bamvor@iZwz9ddnvx1jmhxak0x32uZ:~$ dpkg --configure -a
dpkg: error: requested operation requires superuser privilege
bamvor@iZwz9ddnvx1jmhxak0x32uZ:~$ sudo dpkg --configure -a
Setting up libpam-modules (1.1.8-1ubuntu2.2) ...

Configuration file `/etc/security/limits.conf'
 ==> Modified (by you or by a script) since installation.
 ==> Package distributor has shipped an updated version.
   What would you like to do about it ?  Your options are:
    Y or I  : install the package maintainer's version
    N or O  : keep your currently-installed version
      D     : show the differences between the versions
      Z     : start a shell to examine the situation
 The default action is to keep your current version.
*** limits.conf (Y/I/N/O/D/Z) [default=N] ? D

Configuration file `/etc/security/limits.conf'
 ==> Modified (by you or by a script) since installation.
 ==> Package distributor has shipped an updated version.
   What would you like to do about it ?  Your options are:
    Y or I  : install the package maintainer's version
    N or O  : keep your currently-installed version
      D     : show the differences between the versions
      Z     : start a shell to examine the situation
 The default action is to keep your current version.
*** limits.conf (Y/I/N/O/D/Z) [default=N] ? Y
Installing new version of config file /etc/security/limits.conf ...
Installing new version of config file /etc/security/namespace.conf ...
Installing new version of config file /etc/security/time.conf ...
Installing new version of config file /etc/security/pam_env.conf ...
Installing new version of config file /etc/security/namespace.init ...
```

09:56 2017-04-24
----------------
GTD
---
1.  today
    1.  provide kabi-tools to my colleague. It takes time because I forget to upload all the script to git server.
        9:39-9:58
    2.  CFC: pressure test for teeos.
        9:58-10:24 understanding the script.
        10:27-10:56 burn and test the image. flash done but mobile is running out of power.

    1.  coresight driver.
    1.  git blame plugin for vim.

1.  learning
    1.  "rename-text-section-to"
        objdump rename-section

2.  next
    1.  enable ETM in ioctl and smcthread.
    1.  ping kselftests
    1.  finish mindmap for arm soc design.

    1.  CFC: move the function(not code) of coresight from Linux to TEEOS.
        DELAY
    1.  place cont page hint in code of apps.
    1.  reply to xinwei about cont page hint.
    1.  thunderbird auto add secure exception.
    1.  try google drive in Linux:
        <https://github.com/odeke-em/drive>
    1.  read the blog CORE team: http://c0reteam.org/blog.html.
    1.  lwn, lsf/mm
    1.  daily minor task(one day one five minute to clean up):
        1.  store two name cards in evernote for the people I know last year. Linuxcon or Linaro connect.
        2.  after 1 finish: delelet useless 20 auto notes of email in evernote.

3.  monthly
    1.  android security bulletin: <https://source.android.com/security/bulletin/index.html>

4.  future(delete after 14 days)
    1.  0323: transfer phone number for little dog.
    1.  0323: 680 coresight etr to ddr requirement.

10:37 2017-04-24
----------------
software skill, rsync
---------------------
1.  rsync -avz foo bar
    sync from foo to bar/foo. If bar/foo is missing, rsync will create it.
2.  rsync -avz foo/ bar
    sync from foo to bar
3.  rsync -avz foo/ .
    sync from foo to current directory.

01:16 2017-04-25
----------------
privoxy
```
listen-address  127.0.0.1:8228
listen-address  172.16.0.4:8228
```

11:23 2017-05-04
----------------
GTD
---
1.  today
    1.  CFC: llt.
        11:23-11:52
	11:58-12:23

14:42 2017-05-09
----------------
1. I found that it is hard for me to wrote a simple kernel module with file_operations.
2. how to allocate user space memory in kernel? I thought I saw it in y2038 works. But I could not find it now.
3. I do not know how to init a integer array in c language.
4. big endian and little endian.

15:10 2017-05-11
----------------
华为账户在电脑可以登录在手机无法登陆
bamvor: 前段时间忘了密码，修改密码后，我的华为账户在电脑上可以登录。但是手机上用同样密码无法登陆，也不提示错误，只是提示重复输入密码。如果在手机上输入错误密码，会提示密码错误，说明手机上认可了修改的密码。现在手机上无法登陆，华为账户所有功能都不能使用。
月野溜溜    花粉帮帮堂  发表于 昨天 17:00 来自：浏览器

月野溜溜: 
粉粉，手机无法登录华为账号的话，可以在设置~应用管理~会员服务（手机服务）~储存，清理一下数据。重启手机，再重新登录看看。或者更新下会员服务（手机服务）应用版本试试。

bamvor: 删除华为应用市场数据后，重启手机可以正常登陆了。谢谢。

10:24 2017-05-12
----------------
GTD
---
1.  today
    1.  早晨用了太多时间讨论非工作内容，开始讨论请假还有点价值。与公司制度无关的内容应该不参与讨论。例如公积金，租房等等。
    2.  c语言基本功不过关，每天都花点时间练练。今天是不知道`void*`不能和`void*`一起运算。

17:47 2017-05-20
---------------
compile kernel on ubuntu
------------------------
1.  <https://askubuntu.com/questions/454253/how-to-run-32-bit-app-in-ubuntu-64-bit>
    sudo apt-get install libc6:i386 libncurses5:i386 libstdc++6:i386
2.  <https://wiki.ubuntu.com/Kernel/BuildYourOwnKernel>
    sudo apt-get build-dep linux-image-$(uname -r)

17:35 2017-05-25
----------------
TODO
----
1.  android系统构建. 好久不用makefile，都搞不清楚了。

09:36 2017-06-17
----------------
GTD
---
1.  today
    0.  工作期间，手机数据和网络关闭，关闭微信。
    1.  华为工作6小时(含休息，打断共30'): 10:00-12:00, 14:30-18:00 19:00-20:00.
    1.  linaro activity.
    1.  写linuxcon.
    1.  尝试用dropbox+git在手机和机器之前同步。

14:50 2017-06-27
----------------
kernel, source, huawei; mate9; p10
----------------------------------
从[xds论坛](https://www.xda-developers.com/kernel-sources-released-for-the-huawei-mate-9-and-huawei-p10/)找到了[mate9](http://consumer.huawei.com/en/opensource/detail/index.htm?siteCode=worldwide&keywords=mate%209&fileType=openSourceSoftware&pageSize=10&curPage=1)和[p10](http://consumer.huawei.com/en/opensource/detail/index.htm?siteCode=worldwide&keywords=p10&fileType=openSourceSoftware&pageSize=10&curPage=1)的代码。
我下载了[MHA的代码](http://download-c1.huawei.com/download/downloadCenter?downloadId=95352&version=391424&siteCode=worldwide), 展开后，能看到完整的内核代码。

17:38 2017-06-28
send to conference report. with chunyanliu slide and coly li slide.

<https://www.slideshare.net/LCChina/presentations>
[Secure Containers with EPT Isolation(Huawei, Intel)](https://www.slideshare.net/LCChina/secure-containers-with-ept-isolation) build the containers with EPT page table protection. EPT is a memory virtualization technology used in kvm and xen by default. It could deployed in vm in the cloud compare with the kvm-containers(Intel: Clear Container or Huawei ).

