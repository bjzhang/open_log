.LOG
11:29 2013-10-09
1, compile A20 kernel
ref: http://linux-sunxi.org/Mainline_Kernel_Howto
ARCH=arm CROSS_COMPILE=<toolchain-prefix> LOADADDR=0x40008000 make uImage dtbs

log.sh make LOADADDR=0x40008000 uImage dtbs

2, u-boot spl boot fail
U-Boot SPL 2013.10-rc2-08390-g3d2fc4e (Oct 03 2013 - 10:06:48)
Board: Cubieboard2
DRAM: 1024 MiB
CPU: 960000000Hz, AXI/AHB/APB: 3/2/2
spl: not an uImage at 1600
spl: not an uImage at 80
### ERROR ### Please RESET the board ###

1), this is because i use the wrong u-boot binary and offset
ref: http://linux-sunxi.org/Bootable_SD_card 
Bootloader
1 dd if=spl/sunxi-spl.bin of=$card bs=1024 seek=8
2 dd if=u-boot.img of=$card bs=1024 seek=40
If using u-boot v2013.07 or earlier then the procedure is slightly different
1 dd if=spl/sunxi-spl.bin of=$card bs=1024 seek=8
2 dd if=u-boot.bin of=$card bs=1024 seek=32

3, 
http://linux-sunxi.org/Mainline_Kernel_Howto
Warning: Before giving control to the kernel the U-Boot will move the loaded binaries to some different addresses and ignore the fact, the kernel needs much more space for extracting itselt. This causes a dtb to be overwritten and failure to boot. This of course should be fixed in U-Boot but a workaround for now is to set fdt_high:
env set fdt_high ffffffff

4, try xen
U-Boot SPL 2013.10-rc2-08390-g3d2fc4e (Oct 03 2013 - 10:06:48)
Board: Cubieboard2
DRAM: 1024 MiB
CPU: 960000000Hz, AXI/AHB/APB: 3/2/2
spl: not an uImage at 1600


U-Boot 2013.10-rc2-00585-gb5a4ae8 (Oct 09 2013 - 16:31:44) Allwinner Technology

CPU:   Allwinner A20 (SUN7I)
Board: Cubieboard2
I2C:   ready
DRAM:  1 GiB
MMC:   SUNXI SD/MMC: 0
*** Warning - bad CRC, using default environment

In:    serial
Out:   serial
Err:   serial
Net:   emac
Hit any key to stop autoboot:  0 
sun7i# fatload mmc 0 45000000 xen<INTERRUPT>
sun7i# fatload mmc 0 50000000 xen-uImage        
reading xen-uImage
956136 bytes read in 88 ms (10.4 MiB/s)
sun7i# bootm 5000000
Wrong Image Format for bootm command
ERROR: can't get kernel image!
sun7i# bootm 50000000
## Booting kernel from Legacy Image at 50000000 ...
   Image Name:   
   Created:      2013-10-09   8:42:13 UTC
   Image Type:   ARM Linux Kernel Image (uncompressed)
   Data Size:    956072 Bytes = 933.7 KiB
   Load Address: 40200000
   Entry Point:  40200000
   Verifying Checksum ... OK
   Loading Kernel Image ... OK
WARNING: ignoring attempt to set core boot address 7ff88454 on core -1
WARNING: Not kicking secondary CPUs

Starting kernel ...

- UART enabled -
- CPU 00000000 booting -
- Xen starting in Hyp mode -
- Zero BSS -
- Setting up control registers -
- Turning on paging -
- Ready -
RAM: 0000000040000000 - 00000000bfffffff

MODULE[1]: 00000000402e7700 - 00000000402e96a8 
MODULE[2]: 0000000060000000 - 0000000060600000 
Placing Xen at 0x00000000bfe00000-0x00000000c0000000
Xen heap: 00000000ae000000-00000000be000000 (65536 pages)
Dom heap: 458752 pages
Looking for UART console serial0
 __  __            _  _   _  _                      _        _     _      
 \ \/ /___ _ __   | || | | || |     _   _ _ __  ___| |_ __ _| |__ | | ___ 
  \  // _ \ '_ \  | || |_| || |_ __| | | | '_ \/ __| __/ _` | '_ \| |/ _ \
  /  \  __/ | | | |__   _|__   _|__| |_| | | | \__ \ || (_| | |_) | |  __/
 /_/\_\___|_| |_|    |_|(_) |_|     \__,_|_| |_|___/\__\__,_|_.__/|_|\___|
                                                                          
(XEN) Xen version 4.4-unstable (bamvor@(none)) (arm-linux-gnueabihf-gcc (crosstool-NG linaro-1.13.1-4.8-2013.04-20130417 - Linaro GCC 2013.04) 4.8.1 20130401 (prerelease)) debug=y Wed Oct  9 16:40:45 CST 2013
(XEN) Latest ChangeSet: Mon Oct 7 09:42:51 2013 +0200 git:84f04d8
(XEN) Console output is synchronous.
(XEN) Processor: 410fc074: "ARM Limited", variant: 0x0, part 0xc07, rev 0x4
(XEN) 32-bit Execution:
(XEN)   Processor Features: 00001131:00011011
(XEN)     Instruction Sets: AArch32 Thumb Thumb-2 ThumbEE Jazelle
(XEN)     Extensions: GenericTimer Security
(XEN)   Debug Features: 02010555
(XEN)   Auxiliary Features: 00000000
(XEN)   Memory Model Features: 10101105 40000000 01240000 02102211
(XEN)  ISA Features: 02101110 13112111 21232041 11112131 10011142 00000000
(XEN) WARNING: Unrecognized/unsupported device tree compatible list
(XEN) Available platform support:
(XEN)     - VERSATILE EXPRESS
(XEN)     - SAMSUNG EXYNOS5
(XEN)     - CALXEDA MIDWAY
(XEN)     - TI OMAP5
(XEN) 
(XEN) ****************************************
(XEN) Panic on CPU 0:
(XEN) Unable to find a compatible timer in the device tree
(XEN) ****************************************
(XEN) 
(XEN) Reboot in five seconds...

5, hang after
(XEN) DOM0: init/main.c:755<do_initcall_level>: fn<c056b544>
[    7.972417] init/main.c:755<do_initcall_level>: fn<c056b544>
[    7.978012] drivers/rtc/hctosys.c: unable to open rtc device (rtc0)
(XEN) DOM0: init/main.c:755<do_initcall_level>: fn<c056b548>
[    7.989537] init/main.c:755<do_initcall_level>: fn<c056b548>
(XEN) DOM0: init/main.c:755<do_initcall_level>: fn<c056b54c>
[    8.000455] init/main.c:755<do_initcall_level>: fn<c056b54c>
(XEN) DOM0: init/main.c:755<do_initcall_level>: fn<c056b550>
[    8.011389] init/main.c:755<do_initcall_level>: fn<c056b550>
(XEN) DOM0: init/main.c:755<do_initcall_level>: fn<c056b554>
ï¿½    8.022318] init/main.c:755<do_initcall_level>: fn<c056b554>

c056b554 t __initcall_clk_disable_unused7s
it may be the same reasone why the native kernel boot fail. but it could not expain why there is no output. unless the console init is after the clk_disable_unused. 
using boot parameter clk_ignore_unused ignore this function.
(later, when i want to add clk_ignore_unused in native kernel, i found that there is no bootargs in sun7i dts, so no uart is set for printk, \TODO: a patch for linux-sunxi?)

6, xen: fail at mount fs
[    7.979703] drivers/rtc/hctosys.c: unable to open rtc device (rtc0)
(XEN) DOM0: init/main.c:755<do_initcall_level>: fn<c056b548>
[    7.991228] init/main.c:755<do_initcall_level>: fn<c056b548>
(XEN) DOM0: init/main.c:755<do_initcall_level>: fn<c056b54c>
[    8.002144] init/main.c:755<do_initcall_level>: fn<c056b54c>
(XEN) DOM0: init/main.c:755<do_initcall_level>: fn<c056b550>
[    8.013077] init/main.c:755<do_initcall_level>: fn<c056b550>
(XEN) DOM0: init/main.c:755<do_initcall_level>: fn<c056b554>
[    8.024007] init/main.c:755<do_initcall_level>: fn<c056b554>
[    8.029586] clk: Not disabling unused clocks
(XEN) DOM0: init/main.c:755<do_initcall_level>: fn<c056b558>
[    8.039141] init/main.c:755<do_initcall_level>: fn<c056b558>
(XEN) DOM0: init/main.c:794<do_basic_setup>
[    8.048608] init/main.c:794<do_basic_setup>
(XEN) DOM0: init/main.c:911<kernel_init_freeable>
[    8.057161] init/main.c:911<kernel_init_freeable>
(XEN) DOM0: init/main.c:918<kernel_init_freeable>
[    8.066756] init/main.c:918<kernel_init_freeable>
(XEN) DOM0: init/main.c:920<kernel_init_freeable>
[    8.075790] init/main.c:920<kernel_init_freeable>
(XEN) DOM0: init/main.c:930<kernel_init_freeable>
[    8.084856] init/main.c:930<kernel_init_freeable>
[    8.089589] Waiting for root device ...

7, try usb storage.

8, partition sdcard
dd if=/dev/zero of=$card bs=1M count=1
sfdisk -R $card
cat <<EOT | sfdisk --in-order -uM $card
1,100,c
,,L
EOT
mkfs.vfat ${card}1
mkfs.ext4 ${card}2

9, native kernel fail at load initrd
[    0.438615] Unpacking initramfs...
[    0.442118] Unable to handle kernel paging request at virtual address ffb90000
[    0.449414] pgd = c0004000
[    0.452203] [ffb90000] *pgd=00000000
[    0.455876] Internal error: Oops: 5 [#1] SMP ARM
[    0.460577] CPU: 0 PID: 1 Comm: swapper/0 Not tainted 3.12.0-rc1-00021-g086e532-dirty #13
[    0.468827] task: ef05c000 ti: ef056000 task.ti: ef056000
[    0.474313] PC is at unpack_to_rootfs+0xc8/0x2a0
[    0.479011] LR is at unpack_to_rootfs+0x54/0x2a0
[    0.483709] pc : [<c051eb94>]    lr : [<c051eb20>]    psr: 20000153
[    0.483709] sp : ef057e90  ip : 00000000  fp : c051e778
[    0.495340] r10: c0585240  r9 : c0544378  r8 : c0544378
[    0.500642] r7 : ffb90000  r6 : 002d7c00  r5 : c05aa7f0  r4 : c0544378
[    0.507245] r3 : ef1b8000  r2 : c051eb20  r1 : 00000000  r0 : ef026000
[    0.513849] Flags: nzCv  IRQs on  FIQs off  Mode SVC_32  ISA ARM  Segment kernel
[    0.521318] Control: 10c5387d  Table: 4000406a  DAC: 00000015
[    0.527140] Process swapper/0 (pid: 1, stack limit = 0xef056240)
[    0.533223] Stack: (0xef057e90 to 0xef058000)
[    0.537662] 7e80:                                     c05442ec c058523c c0585200 ef056028
[    0.545915] 7ea0: 00000000 00000000 00000000 c0408064 c04a34e8 c0585238 c0585238 c058523c
[    0.554169] 7ec0: c0585200 ef056028 c051f234 c05442fc 00000000 c051f29c 00000005 c05442ec
[    0.562422] 7ee0: c0585200 c051db18 ef011900 c04a99dc ef0ab480 c04113fc 00000000 00000001
[    0.570675] 7f00: 00000000 c055de60 60000153 00000001 00000003 00000000 c0dca5e1 c041fb24
[    0.578928] 7f20: 000000b1 c0034e50 c04f793c 00000005 c0dca5f2 00000005 c055de50 00000005
[    0.587182] 7f40: c05442ec c0585200 c0585200 c051d4dc 000000b1 c05442fc c054c800 c051de94
[    0.595435] 7f60: 00000005 00000005 c051d4dc ffffffff ffffffff ffffffff ffffffff 00000000
[    0.603688] 7f80: c0585200 00000000 00000000 00000000 00000000 00000000 00000000 c0406db8
[    0.611942] 7fa0: 00000000 00000000 c0406d8c c000e138 00000000 00000000 00000000 00000000
[    0.620195] 7fc0: 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000
[    0.628448] 7fe0: 00000000 00000000 00000000 00000000 00000013 00000000 ffffffff ffffffff
[    0.636719] [<c051eb94>] (unpack_to_rootfs+0xc8/0x2a0) from [<c051f29c>] (populate_rootfs+0x68/0xb4)
[    0.645930] [<c051f29c>] (populate_rootfs+0x68/0xb4) from [<c051db18>] (do_one_initcall+0x9c/0x13c)
[    0.655055] [<c051db18>] (do_one_initcall+0x9c/0x13c) from [<c051de94>] (kernel_init_freeable+0x2dc/0x45c)
[    0.664787] [<c051de94>] (kernel_init_freeable+0x2dc/0x45c) from [<c0406db8>] (kernel_init+0x2c/0x268)
[    0.674175] [<c0406db8>] (kernel_init+0x2c/0x268) from [<c000e138>] (ret_from_fork+0x14/0x3c)
[    0.682778] Code: e35c0000 1a000052 e3560000 0a000050 (e5d73000) 
[    0.688980] ---[ end trace b5ab4f577dfa413b ]---
[    0.693750] Kernel panic - not syncing: Attempted to kill init! exitcode=0x0000000b
[    0.693750] 

10, try xen with initrd in dt.
1), enable arch timer in sun7i.h
#define CONFIG_SYS_CLK_FREQ     24000000
2), add initrd in dt
3), fail after free memory
[    4.557412] Freeing unused kernel memory: 204K (c053a000 - c056d000)
[    4.563608] Internal error: Oops - undefined instruction: 0 [#1] SMP ARM
[    4.570245] CPU: 0 PID: 1 Comm: swapper/0 Not tainted 3.12.0-rc1-00021-g086e532-dirty #14
[    4.578327] task: cf85a000 ti: cf85c000 task.ti: cf85c000
[    4.583709] PC is at early_print+0x0/0x50
[    4.587712] LR is at kernel_init+0x88/0x268
[    4.591899] pc : [<c053cc44>]    lr : [<c041e040>]    psr: 60000153
[    4.591899] sp : cf85dfa0  ip : 00000001  fp : 00000000
[    4.603312] r10: 00000000  r9 : 00000000  r8 : 00000000
[    4.608514] r7 : 00000000  r6 : 00000000  r5 : c05a3dc0  r4 : 00000000
[    4.614998] r3 : c0427038  r2 : 00000342  r1 : c04bcd34  r0 : c04bce68
[    4.621479] Flags: nZCv  IRQs on  FIQs off  Mode SVC_32  ISA ARM  Segment kernel
[    4.628812] Control: 10c5387d  Table: 4000406a  DAC: 00000015
[    4.634525] Process swapper/0 (pid: 1, stack limit = 0xcf85c240)
[    4.640495] Stack: (0xcf85dfa0 to 0xcf85e000)
[    4.644849] dfa0: 00000000 00000000 c041dfb8 c000e4b8 00000000 00000000 00000000 00000000
[    4.652949] dfc0: 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000
[    4.661051] dfe0: 00000000 00000000 00000000 00000000 00000013 00000000 ffffffff ffffffff
[    4.669162] Code: e7fddef0 e7fddef0 e7fddef0 e7fddef0 (e7fddef0) 
[    4.675208] ---[ end trace a4e43cf9d0a5cb21 ]---
[    4.679999] Kernel panic - not syncing: Attempted to kill init! exitcode=0x0000000b
[    4.679999] 
(10:44 2013-10-10)
yestoday, i thought it is fail at early_print +0x50. how foolish am i. the mean is fail at the 0x0/0x50 of early_print.
"10:44 2013-10-10"end

11, \TODO
1), contact Josh and try to get him image.
or i should use the same version with Josh and Ian C.
2), try usb storage device as root.

13:27 2013-10-09
ä¹°æ¥æµè¯äºè§é¢æ­æ¾ç­åè½ï¼å¾æµçï¼æ çº¿ä¿¡å·ä¹ä¸éã
å¶å®ä¹°æ¥ä¸»è¦æ¯ä¸ºäºèªå·±å¼åç¨ï¼å·²ç»å¼åºäºä¸²å£ãæ­£å¨å®éªLinux kernelåxenã
æ»çæ¥è¯´æ¯ä¸æ¬¾æ§ä»·æ¯å¾é«ççå­ã

14:01 2013-10-09
GTD
0, 10:40

1, today
1), 30' discuss kiwi with Lidong zhong.

16:10 2013-10-09
yastéé¢è¯»ç½å¡åºè¯¥æ¯è¯»ç"/etc/sysconfig/network/if-xxx", å³ä½¿æ æéç½®æä»¶ä¹ä¼æ¾ç¤ºãä½æ¯ifconfigæ¯ä»åæ ¸è¯»åçä¿¡æ¯ï¼æä»¥ä¸ä¼ç°å®ä¸å­å¨çç½å¡ã

17:43 2013-10-09
[PATCH RFC 0/8] xen/arm: very initial cubieboard2 support.
The following patches are a very early set of cubieboard patches, based 
on latest staging, eb786f709249666e1f7364706f94be1a6c4e04da 

Several are not to be applied because they can be done better using 
infrastructure from Julien's "Allow Xen to boot with a raw Device Tree" 
patch. They are included for completeness. 

With this I can boot up until dom0 panics due to lack of a root 
filesystem. This is because upstream Linux currently lacks any useful 
storage drivers (SATA, USB host, MMC). Hopefully this will resolve 
itself soon! 

The bulk of this is the hacking around of the ns16550 driver to support 
ARM platforms and DTB. 

It's currently a bit of a faff to get going. Hopefully the following is 
helpful: 

u-boot 
====== 

https://github.com/linux-sunxi/u-boot-sunxi.git linux-sunxi/sunxi 
commit e94cff93c273b0825bea135e0f559f5580156fa6 

Plus git://git.linaro.org/people/aprzywara/u-boot.git hypmode_v4 
commit 5068b337518617586f2e51b6d616c54dbec4fa62 

Plus patches for hypmode on sunxi and to initialise CNTFRQ. 

All of which can be found in 
git://xenbits.xen.org/people/ianc/u-boot.git devel/cubieboard2 

Built with: 
make Cubieboard2_FEL CROSS_COMPILE=arm-linux-gnueabihf- 

Linux 
===== 

Linux tree: 
https://github.com/mripard/linux.git sunxi/dt-for-3.12 
commit 82abe5294aeadc42508c7944f3a9aec0eece214c 

Using in tree DTS arch/arm/boot/dts/sun7i-a20-cubieboard2.dts with the 
following patch. 

Build Image and dtbs in the usual way 

Xen 
=== 

Build in the usual way. 

Xen can use CONFIG_EARLY_PRINTK=sun7i. 

Booting 
======= 

I am using FEL boot per http://linux-sunxi.org/FEL/USBBoot and 
http://linux-sunxi.org/FEL using the fel-sdboot.sunxi on MMC 
mechanism. 

linux-sunxi tools from git://github.com/linux-sunxi/sunxi-tools.git 
commit b398456630b310dbf31c7515e8d6af37903c4975 and: 

./usb-boot ~/devel/u-boot.git/spl/u-boot-spl.bin ~/devel/u-boot.git/u-boot.bin \ 
bootxen.scr ~/devel/xen.git/xen/xen \ 
~/devel/linux.git/arch/arm/boot/dts/sun7i-a20-cubieboard2.dtb 
~/devel/linux.git/arch/arm/boot/zImage 

bootxen.scr is: 
$ cat bootxen 
setenv bootargs dtuart=serial0 earlyprint loglvl=all conswitch=x 
bootz 0x44000000 - 0x43000000 
$ mkimage -T script -A arm -d bootxen bootxen.scr 

DTS patch 
========= 


diff --git a/arch/arm/boot/dts/sun7i-a20-cubieboard2.dts b/arch/arm/boot/dts/sun7i-a20-cubieboard2.dts 
31b76f0..6c0c387 100644 
--- a/arch/arm/boot/dts/sun7i-a20-cubieboard2.dts 
+++ b/arch/arm/boot/dts/sun7i-a20-cubieboard2.dts 
@@ -18,6 +18,21 @@ 
model = "Cubietech Cubieboard2"; 
compatible = "cubietech,cubieboard2", "allwinner,sun7i-a20"; 

+ chosen { 
+ #address-cells = <1>; 
+ #size-cells = <1>; 
+ 
+ module@0 { 
+ compatible = "xen,linux-zimage", "xen,multiboot-module"; 
+ bootargs = "console=hvc0 earlyprintk "; 
+ reg = <0x50000000 0x800000>; 
+ }; 
+ }; 
+ 
+ aliases { 
+ serial0 = &uart0; 
+ }; 
+ 
soc [at] 01c0000 { 
pinctrl [at] 01c2080 { 
led_pins_cubieboard2: led_pins@0 { 
diff --git a/arch/arm/boot/dts/sun7i-a20.dtsi b/arch/arm/boot/dts/sun7i-a20.dtsi 
index f4e4524..bfc5dc2 100644 
--- a/arch/arm/boot/dts/sun7i-a20.dtsi 
+++ b/arch/arm/boot/dts/sun7i-a20.dtsi 
@@ -26,11 +26,6 @@ 
reg = <0>; 
}; 

- cpu@1 { 
- compatible = "arm,cortex-a7"; 
- device_type = "cpu"; 
- reg = <1>; 
- }; 
}; 

memory { 
@@ -55,6 +55,14 @@ 
}; 
}; 

+ timer { 
+ compatible = "arm,armv7-timer"; 
+ interrupts = <1 13 0xf08>, 
+ <1 14 0xf08>, 
+ <1 11 0xf08>, 
+ <1 10 0xf08>; 
+ }; 
+ 
soc [at] 01c0000 { 
compatible = "simple-bus"; 
#address-cells = <1>; 
@@ -94,17 +102,6 @@ 
}; 
}; 

- timer [at] 01c20c0 { 
- compatible = "allwinner,sun4i-timer"; 
- reg = <0x01c20c00 0x90>; 
- interrupts = <0 22 1>, 
- <0 23 1>, 
- <0 24 1>, 
- <0 25 1>, 
- <0 67 1>, 
- <0 68 1>; 
- clocks = <&osc24M>; 
- }; 

wdt: watchdog [at] 01c20c9 { 
compatible = "allwinner,sun4i-wdt"; 

22:34 2013-10-09
xen, arm
help from agraf and citrix.
1, Julien Grall <julien.grall@citrix.com> reply "Re: Arndale dts patch"
Hi Alexander and Bamvor,

The device tree support on Xen upstream is far better than in July. Most
of the instructions I gave you is not anymore relevant.

You can read the Arndale wiki page:
http://wiki.xen.org/wiki/Xen_ARM_with_Virtualization_Extensions/Arndale

I don't think the instructions will be very different for the A7 based
systems.

We have a #xenarm channel on Freenode. Feel free to join it and ask
questions.

Cheers,

On 10/04/2013 12:04 PM, Alexander Graf wrote:
> Hi Julien,
> 
> For next week's hackweek, Bamvor is planning to bring up Xen on ARM in OpenSUSE. IIUC he's looking at A7 based systems rather than Exynos5, but I'll let him speak about that for himself.
> 
> Bamvor, I'm sure Citrix would be more than happy to help you in your Hackweek project to get Xen on ARM up to speed for openSUSE!
> 
> 
> Alex
> 
> On 09.07.2013, at 12:21, Julien Grall wrote:
> 
>> Hi Alexander,
>>
>> As I told you on IRC, for the moment Xen is not able to remove automatically nodes
>> in the device tree.
>>
>> The patch in attachment will:
>>  - Remove non-working node with Dom0
>>  - Disable UART-2 which is used by Xen
>>  - Harcoded linux and Xen command lines
>>
>> For the latter, I have 2 patches (one for Xen, and one for Linux) to avoid that, but I did not have time
>> to test it.
>>
>> In order to boot xen on the arndale, you need to:
>>  - Apply my previous patch to only have one big u-boot memory bank
>>  - Create an uImage for Xen:
>> mkimage -A arm -T kernel -a 0x80200000 -e 0x80200000 -C none -d "$xen_src/xen/xen.bin" xen-uImage 
>>  - Modify U-boot environment to set up Xen boot command. For instance I'm using this environment:
>> setenv kernel_addr_r 0x60000000
>> setenv xen_addr_r 0x50000000
>> setenv bootcmd_load_linux_mmc 'ext2load mmc 1:0 $kernel_addr_r /zImage'
>> setenv boot_xen_mmc 'run bootcmd_load_linux_mmc; ext2load mmc 1:0 $xen_addr_r /xen-uImage; bootm $xen_addr_r -'
>> setenv bootcmd 'run boot_xen_mmc'
>>
>> The zImage NEEDS to be loaded at 0x60000000. The address is harcoded in the DTS as U-boot/Xen doesn't yet support
>> multiboot. As for Linux bare metal boot, you can give the dts directly to bootm.
>>
>> It's not possible to use an initrd with Linux. It's missing some plumbing in Xen to load
>> modules in Dom0 and tell to Linux where is the initrd. Is it a big issue for you?
>>
>> Cheers,
>>
>> -- 
>> Julien<xen-dts.patch>
> 


-- 
Julien Grall

2, reply
thanks your help in advance.
> Hi Alexander and Bamvor,
> 
> The device tree support on Xen upstream is far better than in July. Most
> of the instructions I gave you is not anymore relevant.
> 
> You can read the Arndale wiki page:
> http://wiki.xen.org/wiki/Xen_ARM_with_Virtualization_Extensions/Arndale
> 
> I don't think the instructions will be very different for the A7 based
> systems.
yes, i am following the above instruction. currently, it fail at rootfs mount
in both xen dom0 boot and native kernel boot. considering the dom0 boot is
successfull as Ian and Josh said in last month. I guess that there is something
wrong in kernel. 
> 
> We have a #xenarm channel on Freenode. Feel free to join it and ask
> questions.
i will, thanks.
> 
> Cheers,

regards

bamvor

10:32 2013-10-10
GTD
0, 9:50

1, today
1), 10:00-11:50 13:49- 20:50-23:13 xen on arm: a20. see"10:33 2013-10-10"

10:33 2013-10-10
xen, arm, sun7i
1, xen may be fail in early_print with a20 uart.
remove the early_print in xen dom0 kernel.

2, got the similar error on upstream kernel compare with yestoday result
[    0.292357] Unpacking initramfs...
[    0.295855] Unable to handle kernel paging request at virtual address ffa55000
[    0.303151] pgd = c0004000
[    0.305939] [ffa55000] *pgd=00000000
[    0.309613] Internal error: Oops: 5 [#1] SMP ARM
[    0.314314] CPU: 0 PID: 1 Comm: swapper/0 Not tainted 3.12.0-rc4-00029-g0e7a3ed #2
[    0.321958] task: ef05c000 ti: ef056000 task.ti: ef056000
[    0.327445] PC is at unpack_to_rootfs+0xc8/0x2a0
[    0.332142] LR is at unpack_to_rootfs+0x54/0x2a0
[    0.336840] pc : [<c0514914>]    lr : [<c05148a0>]    psr: 20000153
[    0.336840] sp : ef057e90  ip : 00000000  fp : c05144f8
[    0.348471] r10: c0579100  r9 : c05399f8  r8 : c05399f8
[    0.353773] r7 : ffa55000  r6 : 00412a00  r5 : c059e6b0  r4 : c05399f8
[    0.360376] r3 : ef1b8000  r2 : c05148a0  r1 : 00000000  r0 : ef026000
[    0.366980] Flags: nzCv  IRQs on  FIQs off  Mode SVC_32  ISA ARM  Segment kernel
[    0.374450] Control: 10c5387d  Table: 4000406a  DAC: 00000015
[    0.380272] Process swapper/0 (pid: 1, stack limit = 0xef056240)
[    0.386355] Stack: (0xef057e90 to 0xef058000)
[    0.390794] 7e80:                                     c053996c c05790fc c05134dc ef056028
[    0.399048] 7ea0: 00000000 00000000 00000000 c04026c4 c049cd6c c05790f8 c05790f8 c05790fc
[    0.407301] 7ec0: c05134dc ef056028 c0514fb4 c05790c0 00000000 c051501c 00000005 c053996c
[    0.415554] 7ee0: c05790c0 c0513b18 ef011900 c04a3358 ef0a9c80 c040b3b4 00000000 00000001
[    0.423807] 7f00: 00000000 c0551de0 60000153 00000001 00000003 00000000 c0dbe5e1 c0419ae4
[    0.432061] 7f20: 000000b1 c0035030 c04ed6f4 00000005 c0dbe5f2 00000005 c0551dd0 00000005
[    0.440314] 7f40: c053996c c05790c0 c05134dc c053997c 000000b1 c05790c0 c054196c c0513cf8
[    0.448567] 7f60: 00000005 00000005 c05134dc ffdfffff ffffffff ffffffff ffffffff 00000000
[    0.456820] 7f80: 000090c0 00000000 00000000 00000000 00000000 00000000 00000000 c04013e0
[    0.465073] 7fa0: 00000000 00000000 c04013d4 c000e1b8 00000000 00000000 00000000 00000000
[    0.473326] 7fc0: 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000
[    0.481579] 7fe0: 00000000 00000000 00000000 00000000 00000013 00000000 ffffffff fffffbff
[    0.489850] [<c0514914>] (unpack_to_rootfs+0xc8/0x2a0) from [<c051501c>] (populate_rootfs+0x68/0xb4)
[    0.499061] [<c051501c>] (populate_rootfs+0x68/0xb4) from [<c0513b18>] (do_one_initcall+0x9c/0x13c)
[    0.508185] [<c0513b18>] (do_one_initcall+0x9c/0x13c) from [<c0513cf8>] (kernel_init_freeable+0x140/0x1dc)
[    0.517918] [<c0513cf8>] (kernel_init_freeable+0x140/0x1dc) from [<c04013e0>] (kernel_init+0xc/0x160)
[    0.527222] [<c04013e0>] (kernel_init+0xc/0x160) from [<c000e1b8>] (ret_from_fork+0x14/0x3c)
[    0.535740] Code: e35c0000 1a000052 e3560000 0a000050 (e5d73000) 
[    0.541945] ---[ end trace aff3c26080dcb3b3 ]---
[    0.546713] Kernel panic - not syncing: Attempted to kill init! exitcode=0x0000000b
[    0.546713] 

3, try josh kernel(including rootfs).
1), try josh kernel(including rootfs).pass.
2), try my kernel(dt-for-3.12) with josh rootfs. pass.
log:
(XEN) DOM0: [    4.544097] Trying to unpack rootfs image as initramfs...
(XEN) DOM0: [    4.896439] rootfs image is not initramfs (junk in compressed archive); looks like an initrd
(XEN) DOM0: [    4.940295] Freeing initrd memory: 10240K (c8200000 - c8c00000)
(XEN) DOM0: [    4.947432] NetWinder Floating Point Emulator V0.97 (extended precision)
(XEN) DOM0: [    4.965281] NFS: Registering the id_resolver key type
(XEN) DOM0: [    4.971354] Key type id_resolver registered
(XEN) DOM0: [    4.976482] Key type id_legacy registered
(XEN) DOM0: [    4.981713] Block layer SCSI generic (bsg) driver version 0.4 loaded (major 251)
(XEN) DOM0: [    4.990053] io scheduler noop registered
(XEN) DOM0: [    4.994911] io scheduler deadline registered
(XEN) DOM0: [    5.000236] io scheduler cfq registered (default)
(XEN) DOM0: [    5.007141] xen:xen_evtchn: Event-channel device installed
[    5.060854] console [hvc0] enabled, bootconsole disabled
(XEN) DOM0: [    5.060854] console [hvc0] enabled, bootconsole disabled
[    5.072380] Serial: IMX driver

[    5.216771] drivers/rtc/hctosys.c: unable to open rtc device (rtc0)
[    5.223023] clk: Not disabling unused clocks
[    5.233318] Freeing unused kernel memory: 5180K (c0662000 - c0b71000)

login[47]: root login on 'hvc0'
#

3), xen: try my kernel(dt-for-3.12) with my rootfs.
fail
[    4.739263] clk: Not disabling unused clocks
[    4.744347] RAMDISK: Couldn't find valid RAM disk image starting at 0.
[    4.750773] Waiting for root device ...

èªå·±åçrootfsæä¹ä¹ä¸è¡ï¼æç¤º
[    4.656094] clk: Not disabling unused clocks
[    4.663238] Freeing unused kernel memory: 2072K (c0662000 - c0868000)
Starting logging: OK
Initializing random number generator... done.
Starting network...
can't open /dev/hvc0: No such file or directory

4), when my native kernel rootfs in uImage.
it fail at 
Starting kernel ...

Uncompressing Linux... done, booting the kernel.

Error: unrecognized/unsupported machine ID (r1 = 0x000010bb).

Available machine support:

this need a workaround:
env set fdt_high ffffffff
because: http://linux-sunxi.org/Mainline_Kernel_Howto
Warning: Before giving control to the kernel the U-Boot will move the loaded binaries to some different addresses and ignore the fact, the kernel needs much more space for extracting itselt. This causes a dtb to be overwritten and failure to boot. This of course should be fixed in U-Boot but a workaround for now is to set fdt_high:

5), xen dom0 successful config
log/novell/hypervisor_and_tools/xen/arm/20131010/xen_successful
kernel version: 82abe5294 remotes/mripard/sunxi/dt-for-3.12
xen: staging: c4d3ccbf
u-boot: 
3d2fc4e8 remotes/origin/sunxi 
with remotes/aprzywara/hypmode_v4
with Ian C patch from http://lists.xen.org/archives/html/xen-devel/2013-08/msg03040.html, save in local.
(10:53 2013-10-15)
i forgot the save the dts for xen dom0...
"10:53 2013-10-15"end

6), boot xen dom0 with usb driver. 
1), without binding to a100. successful.

4, try network
# mount -v -t nfs 147.2.207.77:/home/bamvor/sda3/home /mnt 
[  255.466416] svc: failed to register lockdv1 RPC service (errno 5).
mount: mounting 147.2.207.77:/home/bamvor/sda3/home on /mnt failed: Input/output error
# 

ref: http://blog.163.com/yihui_wang/blog/static/186215490201151114941634/
mount -v -o nolock -t nfs 147.2.207.77:/home/bamvor/sda3/home /mnt

but could not reach the outside subnet. only 147.2.207.xxx is ok.

1), try to build xen tools through nfs.

5, NFS boot options.
https://www.kernel.org/doc/Documentation/filesystems/nfs/nfsroot.txt

6, (21:33 2013-10-10)
try to build xen-tools, found a network issue: http://permalink.gmane.org/gmane.linux.network/240598, could be fix: http://git.kernel.org/cgit/linux/kernel/git/torvalds/linux.git/commit/?id=1ca7ee30630e1022dbcf1b51be20580815ffab73
suggest add this in linux-sunxi.

7, nfs server, not reponsing. maybe solved by using tcp instead udp protocol and limit the package size(?) when a embedded board communcate with pc.
there is no this problem in office.

10:25 2013-10-11
GTD
0, 9:50

1, today
1), Shawn. FM, GSMæå.
2), 10:25-11:54 xen: arm: sun7i. see"10:25 2013-10-11"

10:25 2013-10-11
xen, arm, sun7i
1, try xen tools on sun7i.
1), 
# /usr/local/sbin/xenstored --pid-file /var/run/xenstored.pid
/usr/local/sbin/xenstored: error while loading shared libraries: libxenctrl.so.4.3: cannot open shared object file: No such file or directory

# echo $LD_LIBRARY_PATH
# export LD_LIBRARY_PATH=/usr/local/lib
2), 
# /etc/init.d/xencommons start
Starting C xenstored....WARNING: Failed to open connection to gnttab
FATAL: Failed to open evtchn device: No such file or directory

3), æ¨å¤©æ¢äºkernelç¼è¯è¿ä¸è¡ï¼è¦éå¯¹å½åçæ¬kernelç¼è¯æå¯ä»¥.
æåéäºï¼koè¯å®æ¯ç¼è¯kernelæ¶çæçï¼æ·è¿æ¥å°±è¡äºã 
ä½æ¯æ¨å¤©ç¼è¯çæ¶åæ²¡æå¼module:
Enable loadable module support

4), if i do not mount nfs as root, lots of sript will not run. 

2, mount nfs not work when rootfs included in kernel.
1), remove the rootfs, retry, fail, the log
[    0.000000] Kernel command line: noinitrd rootfstype=nfs console=hvc0,115200n8 debug ignore_loglevel rw rootwait earlyprintk=xen clk_ignore_unused root=/dev/nfs nfsroot=147.2.207.160:/mnt/opensuse_root,no_lock,tcp ip=147.2.207.79:147.2.207.160:147.2.207.254:255.255.255.0

[    4.597655] IPv6: ADDRCONF(NETDEV_UP): eth0: link is not ready
[    4.833771] usb 1-1: new high-speed USB device number 2 using sunxi-ehci
[    6.703354] libphy: 1c0b080.mdio-mii:01 - Link is Up - 100/Full
[    6.709128] IPv6: ADDRCONF(NETDEV_CHANGE): eth0: link becomes ready
[    6.723386] IP-Config: Complete:
[    6.726495]      device=eth0, hwaddr=16:46:82:0c:ee:f4, ipaddr=147.2.207.79, mask=255.255.255.0, gw=147.2.207.254
[    6.736775]      host=147.2.207.79, domain=, nis-domain=(none)
[    6.742439]      bootserver=147.2.207.160, rootserver=147.2.207.160, rootpath=

2), using result while mount nfs after boot.
147.2.207.160:/mnt/opensuse_root on /mnt type nfs (rw,relatime,vers=3,rsize=1048576,wsize=1048576,namlen=255,hard,nolock,proto=tcp,port=2049,timeo=70,retrans=3,sec=sys,local_lock=all,addr=147.2.207.160)
2), using result while mount nfs after boot.
147.2.207.160:/mnt/opensuse_root on /mnt type nfs (rw,relatime,vers=3,rsize=1048576,wsize=1048576,namlen=255,hard,nolock,proto=tcp,port=2049,timeo=70,retrans=3,sec=sys,local_lock=all,addr=147.2.207.160)

3, 
FATAL: Failed to initialize dom0 state: Inappropriate ioctl for device

4, ä¼¼ä¹è¶è¿è·¯ä¸è¡ï¼try to use opensuse initrd and opensuse nfs root fs.
and later try compile xen module instead of compile into kernel.
1), 
[    5.055580] drivers/rtc/hctosys.c: unable to open rtc device (rtc0)
[    5.061782] clk: Not disabling unused clocks
[    5.066672] RAMDISK: gzip image found at block 0
[    5.192861] RAMDISK: incomplete write (1199 != 7747)
[    5.197693] write error
[    5.200354] Waiting for root device ...

2), enlarge the ramdisk size in kernel, got another error
[    5.066717] init/main.c:906<kernel_init_freeable>: sys_access fail
[    5.072513] init/do_mounts.c:575<prepare_namespace>: call initrd_loadinit/do_mounts_initrd.c:127<initrd_load>
[    5.082284] init/do_mounts_initrd.c:129<initrd_load>: noinitrd not setinit/do_mounts_rd.c:198<rd_load_image>
[    5.092114] RAMDISK: gzip image found at block 0
[    5.096853] init/do_mounts_rd.c:352<crd_load>[    5.317456] usb 1-1: new high-speed USB device number 2 using sunxi-ehci

[    6.334657] uncompression error
[    6.338047] init/do_mounts_initrd.c:144<initrd_load>
[    6.342709] Waiting for root device ...

3), try to use the no compress image.
fail because i do not use the ext4 format. in current kernel, ext2 and ext3 is not supported:
[    5.420060] drivers/rtc/hctosys.c: unable to open rtc device (rtc0)
[    5.426264] clk: Not disabling unused clocks
[    5.431056] init/main.c:906<kernel_init_freeable>: sys_access fail
[    5.437108] init/do_mounts.c:575<prepare_namespace>: call initrd_load
[    5.443455] init/do_mounts_initrd.c:127<initrd_load>
[    5.448417] init/do_mounts_initrd.c:129<initrd_load>: noinitrd not set
[    5.454940] init/do_mounts_rd.c:198<rd_load_image>
[    5.459750] RAMDISK: ext2 filesystem found at block 0
[    5.464747] RAMDISK: Loading 98304KiB [1 disk] into ram disk... [    5.681270] usb 1-1: new high-speed USB device number 2 using sunxi-ehci
done.
[    7.058015] init/do_mounts_initrd.c:138<initrd_load>
[    7.251267] EXT4-fs (ram0): couldn't mount as ext3 due to feature incompatibilities
[    7.259373] EXT4-fs (ram0): mounting ext2 file system using the ext4 subsystem
[    7.267550] EXT4-fs (ram0): mounted filesystem without journal. Opts: (null)
[    7.274474] VFS: Mounted root (ext2 filesystem) on device 1:0.
[    7.280942] EXT4-fs error (device ram0): ext4_get_branch:169: inode #19: block 1734439765: comm kworker/u2:1: invalid block
[    7.292670] VFS: Cannot open root device "(null)" or unknown-block(0,0): error -6
[    7.300009] Please append a correct "root=" boot option; here are the available partitions:
[    7.308313] Kernel panic - not syncing: VFS: Unable to mount root fs on unknown-block(0,0)
[    7.316422] CPU: 0 PID: 1 Comm: swapper/0 Not tainted 3.12.0-rc1-00024-g31f10b1-dirty #20
[    7.324555] [<c0020100>] (unwind_backtrace+0x0/0xf4) from [<c001b9a8>] (show_stack+0x10/0x14)
[    7.332975] [<c001b9a8>] (show_stack+0x10/0x14) from [<c04e37cc>] (dump_stack+0x84/0x94)
[    7.341005] [<c04e37cc>] (dump_stack+0x84/0x94) from [<c04e1240>] (panic+0xa4/0x1f0)
[    7.348662] [<c04e1240>] (panic+0xa4/0x1f0) from [<c06e1fc8>] (mount_block_root+0x1a0/0x230)
[    7.357018] [<c06e1fc8>] (mount_block_root+0x1a0/0x230) from [<c06e224c>] (mount_root+0x108/0x110)
[    7.365887] [<c06e224c>] (mount_root+0x108/0x110) from [<c06e2f74>] (initrd_load+0x278/0x388)
[    7.374329] [<c06e2f74>] (initrd_load+0x278/0x388) from [<c06e235c>] (prepare_namespace+0x108/0x1f4)
[    7.383380] [<c06e235c>] (prepare_namespace+0x108/0x1f4) from [<c06e1c84>] (kernel_init_freeable+0x1ec/0x1fc)
[    7.393177] [<c06e1c84>] (kernel_init_freeable+0x1ec/0x1fc) from [<c04dedc8>] (kernel_init+0xc/0x160)
[    7.402302] [<c04dedc8>] (kernel_init+0xc/0x160) from [<c0018538>] (ret_from_fork+0x14/0x3c)

2), fail again, why?
[    7.224151] EXT3-fs (ram0): error: couldn't mount because of unsupported optional features (240)
[    7.233171] EXT2-fs (ram0): error: couldn't mount because of unsupported optional features (240)
[    7.243357] EXT4-fs (ram0): mounted filesystem with ordered data mode. Opts: (null)
[    7.250891] VFS: Mounted root (ext4 filesystem) on device 1:0.
[    7.269919] VFS: Cannot open root device "(null)" or unknown-block(0,0): error -6
[    7.277295] Please append a correct "root=" boot option; here are the available partitions:
[    7.285522] Kernel panic - not syncing: VFS: Unable to mount root fs on unknown-block(0,0)
[    7.293693] CPU: 0 PID: 1 Comm: swapper/0 Not tainted 3.12.0-rc1-00024-g31f10b1-dirty #21
[    7.301811] [<c0020100>] (unwind_backtrace+0x0/0xf4) from [<c001b9a8>] (show_stack+0x10/0x14)
[    7.310233] [<c001b9a8>] (show_stack+0x10/0x14) from [<c050f84c>] (dump_stack+0x84/0x94)
[    7.318247] [<c050f84c>] (dump_stack+0x84/0x94) from [<c050d080>] (panic+0xa4/0x1f0)
[    7.325934] [<c050d080>] (panic+0xa4/0x1f0) from [<c0717fc8>] (mount_block_root+0x1a0/0x230)
[    7.334276] [<c0717fc8>] (mount_block_root+0x1a0/0x230) from [<c071824c>] (mount_root+0x108/0x110)
[    7.343144] [<c071824c>] (mount_root+0x108/0x110) from [<c0718f74>] (initrd_load+0x278/0x388)
[    7.351587] [<c0718f74>] (initrd_load+0x278/0x388) from [<c071835c>] (prepare_namespace+0x108/0x1f4)
[    7.360628] [<c071835c>] (prepare_namespace+0x108/0x1f4) from [<c0717c84>] (kernel_init_freeable+0x1ec/0x1fc)
[    7.370436] [<c0717c84>] (kernel_init_freeable+0x1ec/0x1fc) from [<c050ac08>] (kernel_init+0xc/0x160)
[    7.379571] [<c050ac08>] (kernel_init+0xc/0x160) from [<c0018538>] (ret_from_fork+0x14/0x3c)

3), need limit the block
mkfs.ext3 -vm0 initrd.ext3 97280
but still fail.

5, notes: pemission denied if not su after mount nfs.
# mount -t nfs -o nolock,tcp,rsize=1024,wsize=1024 192.168.1.104:/mnt/opensuse_r
oot /mnt/
# pivot_root /mnt /mnt/initrd/
# mount -t sysfs sysfs /sys
# mount -t proc proc /proc
# chroot . /sbin/init
Couldn't find an alternative telinit implementation to spawn.
\TODO: ask help about this output.

6, xl hang
# /usr/local/sbin/xl  list
Name                                        ID   Mem VCPUs      State   Time(s)
[  949.027768] INFO: task xl:160 blocked for more than 120 seconds.
[  949.033609]       Not tainted 3.12.0-rc1-00024-g31f10b1-dirty #23
[  949.039687] "echo 0 > /proc/sys/kernel/hung_task_timeout_secs" disables this message.
[  949.047435] xl              D c04be768     0   160    135 0x00000001
[  949.053778] [<c04be768>] (__schedule+0x1e8/0x514) from [<c023ab4c>] (read_reply+0xb0/0x14c)
[  949.062041] [<c023ab4c>] (read_reply+0xb0/0x14c) from [<c023b480>] (xenbus_dev_request_and_reply+0x84/0x98)
[  949.071672] [<c023b480>] (xenbus_dev_request_and_reply+0x84/0x98) from [<c023d7e4>] (xenbus_file_write+0x240/0x4cc)
[  949.081982] [<c023d7e4>] (xenbus_file_write+0x240/0x4cc) from [<c00d1fe8>] (vfs_write+0xb4/0x190)
[  949.090765] [<c00d1fe8>] (vfs_write+0xb4/0x190) from [<c00d2178>] (SyS_write+0x3c/0x78)
[  949.098707] [<c00d2178>] (SyS_write+0x3c/0x78) from [<c000e6e0>] (ret_fast_syscall+0x0/0x30)

22:28 2013-10-11
watch
PA9 TX
PA10 RX

æ²¡ååº, ä¹è®¸æ¯BS1, BS2é½çæ¥äº? æå¤©ç¹å¼è¯è¯.

15:23 2013-10-12
hackweek V
open board
openbrd.org

shawn:
fflush, fsyncåæè½ä¿è¯åå°ç¡¬ç.

21:31 2013-10-12
xen, arm, sun7i
1, discuss nfs root mount fail with Boyang, got 2 suggests:
1), permission, mount as root need rw, ro will fail.
2), capture the package check where it fails.
2, for 1-1):
i was mount it in /mnt/opensuse_root which is owned by root. no sure if it will affect the nfs client as ro. 
mount it under /home/bamvor and try it again.

fail with the same error:
# chroot . /sbin/init
Couldn't find an alternative telinit implementation to spawn.

2), 
# ps aux|grep xenstore
missing btime in /proc/stat

the reason is because btime is empty. 

# date -s 20131012
Sat Oct 12 00:00:00 CEST 2013
# date -s 21:52
Sat Oct 12 21:52:00 CEST 2013

it will ok after set the date.

# ps aux|grep xenstored
root       111  0.0  0.1   2332   564 /initrd/dev/hvc0 S+ 21:53   0:00 grep xenstored
# 

2), try xen tools
(1), 
# xenstore-ls
xenstore-ls: error while loading shared libraries: libxenstore.so.3.0: cannot open shared object file: No such file or directory
# export LD_LIBRARY_PATH=/usr/local/lib
# xenstore-ls
xenstore-ls: xs_open: No such file or directory

(2), 
# /usr/local/sbin/xenstored --pid-file /var/run/xenstored.pid
# FATAL: Opening pid file /var/run/xenstored.pid: Permission denied

i fount that i could not create anything except the "/", according to 
http://yupianer.iteye.com/blog/815071
should use no_root_squash instead of root_squash in /etc/export

mount -t nfs -o nolock,tcp,rsize=10240,wsize=10240 192.168.1.104:/home/bamvor/opensuse_root /mnt

error not change
# pivot_root /mnt/ /mnt/initrd/
# cd /
# ls
bin                             etc     kiwi-hooks  opt   run      sys
boot                            home    lib         proc  sbin     tmp
bootincluded_archives.filelist  image   media       qemu  selinux  usr
dev                             initrd  mnt         root  srv      var
# ls initrd/
bin   dev  home  lib      lost+found  opt   root  sys  usr
boot  etc  init  linuxrc  mnt         proc  sbin  tmp  var
# chroot . /sbin/init
Couldn't find an alternative telinit implementation to spawn.
# 

(3), try xen-tools
# /usr/local/sbin/xenstored --pid-file /var/run/xenstored.pid
# xc: error: Could not obtain handle on privileged command interface (2 = No such file or directory): Internal error
FATAL: Failed to open connection to hypervisor: No such file or directory

this is because missing /proc/xen/privcmd(and /proc/xen) in proc. 
and i miss the important step, before start xenstored.
mount -t xenfs xenfs /proc/xen

# mkdir /proc/xen
# mount -t xenfs xenfs /proc/xen
# ls /proc/xen/
capabilities  privcmd  xenbus  xsd_kva  xsd_port

(4), another failure
# /usr/local/sbin/xenstored --pid-file /var/run/xenstored.pid
# FATAL: Failed to initialize dom0 state: Invalid argument

great, i finally got the same result in the company in yestoday.

(5), using gdb to debug it.
(gdb) n
292             rc = xc_evtchn_bind_interdomain(xce_handle, domid, port);
(gdb) s

Program received signal SIGSEGV, Segmentation fault.
0xe7f001f0 in ?? ()

((1)), re-run it
(gdb) s
101         return xce->ops->u.evtchn.bind_interdomain(xce, xce->ops_handle, domid, remote_port);
(gdb) p xce
$1 = (xc_evtchn *) 0x343c8
(gdb) p xce->ops_handle
$2 = 15
(gdb) p domid
$3 = 0
(gdb) p remote_port
$4 = 1
(gdb) s
linux_evtchn_bind_interdomain (xce=0x343c8, h=15, domid=domid@entry=0, 
    remote_port=remote_port@entry=1) at xc_linux_osdep.c:486
486         bind.remote_domain = domid;
(gdb) 

failed in 
    return ioctl(fd, IOCTL_EVTCHN_BIND_INTERDOMAIN, &bind);

the errno is 22.

    #define EINVAL      22  /* Invalid argument */

the fd is point to the 
lrwx------ 1 root root 64 Oct 12 23:15 15 -> /dev/xen/evtchn

is it because the device node is created by hand?

(6), yes, the device number is changes.
# ls /dev/xen -l
total 0
crw-------    1 root     root       10,  61 Jan  1 00:00 evtchn
crw-------    1 root     root       10,  59 Jan  1 00:00 gntalloc
crw-------    1 root     root       10,  60 Jan  1 00:00 gntdev
crw-------    1 root     root       10,  58 Jan  1 00:00 privcmd
crw-------    1 root     root       10,  63 Jan  1 00:00 xenbus
crw-------    1 root     root       10,  62 Jan  1 00:00 xenbus_backend

((1)), cmd list: init
ifconfig eth0 192.168.1.105 netmask 255.255.255.0 up
sleep 1
route add default 192.168.1.1export LD_LIBRARY_PATH=/usr/local/lib
sleep 1
export server_ip=192.168.1.104
mount -t nfs -o nolock,tcp,rsize=10240,wsize=10240 ${server_ip}:/mnt/opensuse_root /mnt
pivot_root /mnt /mnt/initrd
chroot /
mount -t proc proc /proc
mount -t sysfs sysfs /sys
export LD_LIBRARY_PATH=/usr/local/lib

((2)), xen device 
cd /dev/xen
mknod evtchn c 10 61
mknod gntalloc c 10 59
mknod gntdev c 10 60
mknod privcmd c 10 58
mknod xenbus c 10 63
mknod xenbus_backend c 10 62

(15:54 2013-10-14)
follow the initrd mount result, i found that after i mount devtmpfs, the device will appear in /dev, i also mount devpts and tmpfs:
mount -t devtmpfs devtmpfs /dev
mount -t devpts devpts /dev/pts
mount -t tmpfs tmps /tmp/
"15:54 2013-10-14"end

((3)), xenfs
mount -t xenfs xenfs /proc/xen

((4)), xenstored start successful
# /usr/local/sbin/xenstored --pid-file /var/run/xenstored.pid
# xenstore-ls
tool = ""
 xenstored = ""
local = "

7), 
# /etc/init.d/xencommons start
Starting xenconsoled...
Starting QEMU as disk backend for dom0
/etc/init.d/xencommons: line 120: /usr/local/lib/xen/bin/qemu-system-i386: No such file or directory

# ps aux|grep xen
root        14  0.0  0.0      0     0 ?        S    23:49   0:00 [xenwatch]
root        15  0.0  0.0      0     0 ?        S    23:49   0:00 [xenbus]
root        19  0.0  0.0      0     0 ?        S<   23:49   0:00 [xenbus_frontend]
root        78  0.0  0.0      0     0 ?        Zs   23:51   0:00 [xenstored] <defunct>
root        79  0.0  0.1   2380   600 ?        S    23:51   0:00 /usr/local/sbin/xenstored --pid-file /var/run/xenstored.pid
root       103  0.0  0.0      0     0 ?        Zs   23:52   0:00 [xenconsoled] <defunct>
root       105  0.0  0.1   3416   524 ?        SLl  23:52   0:00 /usr/local/sbin/xenconsoled --pid-file=/var/run/xenconsoled.pid
root       111  0.0  0.1   2332   564 /initrd/dev/hvc0 S+ 23:53   0:00 grep xen
# 

(15:57 2013-10-14)
after set domain name in xenstored, xl list will show the dom0 name as "Domain-0"
    echo Setting domain 0 name...
    ${BINDIR}/xenstore-write "/local/domain/0/name" "Domain-0"
# xenstore-ls
tool = ""
 xenstored = ""
local = ""
 domain = ""
  0 = ""
   name = "Domain-0"
# xl list
sh: xl: command not found
# export PATH=$PATH:/usr/local/bin
# export PATH=$PATH:/usr/local/sbin
# xl list
Name                                        ID   Mem VCPUs      State   Time(s)
Domain-0                                     0   384     1     r-----       9.2
"15:57 2013-10-14"end

8), xl list successful
# /usr/local/sbin/xl list
Name                                        ID   Mem VCPUs      State   Time(s)
(null)                                       0   384     1     r-----       4.9
# 

3, \TODO
1), try nfs root
192.168.1.104:/home/bamvor/opensuse_root on / type nfs (rw,relatime,vers=3,rsize=1024,wsize=1024,namlen=255,hard,nolock,proto=tcp,port=2049,timeo=70,retrans=3,sec=sys,local_lock=all,addr=192.168.1.104)

i need update the xen device tree. get it from company.

2), i found that i could login only after i enable the autologin:
hvc0::respawn:/sbin/getty -n -l/bin/autologin -L hvc0 115200 vt100
why?

21:56 2013-10-13
xen, arm, sun7i, compile domU kernel
1, check the dom0 config
remove the followings
CONFIG_XEN_XENBUS_FRONTEND=y
CONFIG_HVC_XEN_FRONTEND=y
CONFIG_XEN_FBDEV_FRONTEND=y
CONFIG_XEN_BLKDEV_FRONTEND=y
CONFIG_XEN_NETDEV_FRONTEND=y


--- .config	2013-10-11 18:04:07.369842503 +0800
+++ arch/arm/configs/sun7i_dom0_defconfig	2013-10-14 11:26:42.483325824 +0800
@@ -853,13 +689,13 @@
 # CONFIG_BLK_DEV_NBD is not set
 CONFIG_BLK_DEV_RAM=y
 CONFIG_BLK_DEV_RAM_COUNT=2
 CONFIG_BLK_DEV_RAM_SIZE=262144
 # CONFIG_BLK_DEV_XIP is not set
 # CONFIG_CDROM_PKTCDVD is not set
 # CONFIG_ATA_OVER_ETH is not set
 # CONFIG_MG_DISK is not set
-CONFIG_XEN_BLKDEV_FRONTEND=y
-# CONFIG_XEN_BLKDEV_BACKEND is not set
+# CONFIG_XEN_BLKDEV_FRONTEND is not set
+CONFIG_XEN_BLKDEV_BACKEND=y
 # CONFIG_BLK_DEV_RBD is not set
 
 #
@@ -882,7 +718,6 @@
 # CONFIG_HMC6352 is not set
 # CONFIG_DS1682 is not set
 # CONFIG_TI_DAC7512 is not set
-# CONFIG_ARM_CHARLCD is not set
 # CONFIG_BMP085_I2C is not set
 # CONFIG_BMP085_SPI is not set
 # CONFIG_USB_SWITCH_FSA9480 is not set
@@ -955,7 +790,6 @@
 # CONFIG_SCSI_DEBUG is not set
 # CONFIG_SCSI_DH is not set
 # CONFIG_SCSI_OSD_INITIATOR is not set
-CONFIG_HAVE_PATA_PLATFORM=y
 CONFIG_ATA=y
 # CONFIG_ATA_NONSTANDARD is not set
 CONFIG_ATA_VERBOSE_ERROR=y
@@ -984,12 +818,10 @@
 # PATA SFF controllers with BMDMA
 #
 # CONFIG_PATA_ARASAN_CF is not set
-# CONFIG_PATA_IMX is not set
 
 #
 # PIO-only SFF controllers
 #
-# CONFIG_PATA_PLATFORM is not set
 
 #
 # Generic fallback / legacy drivers
@@ -1042,14 +874,10 @@
 CONFIG_NET_VENDOR_FARADAY=y
 # CONFIG_FTMAC100 is not set
 # CONFIG_FTGMAC100 is not set
-CONFIG_NET_VENDOR_FREESCALE=y
-CONFIG_FEC=y
 CONFIG_NET_VENDOR_INTEL=y
 CONFIG_NET_VENDOR_I825XX=y
 CONFIG_NET_VENDOR_MARVELL=y
-# CONFIG_MV643XX_ETH is not set
 # CONFIG_MVMDIO is not set
-# CONFIG_MVNETA is not set
 CONFIG_NET_VENDOR_MICREL=y
 # CONFIG_KS8842 is not set
 CONFIG_KS8851=y
@@ -1072,18 +900,11 @@
 CONFIG_STMMAC_PLATFORM=y
 # CONFIG_STMMAC_DEBUG_FS is not set
 # CONFIG_STMMAC_DA is not set
-CONFIG_NET_VENDOR_TI=y
-# CONFIG_TI_DAVINCI_EMAC is not set
-# CONFIG_TI_DAVINCI_MDIO is not set
-# CONFIG_TI_DAVINCI_CPDMA is not set
-# CONFIG_TI_CPSW is not set
 CONFIG_NET_VENDOR_VIA=y
 # CONFIG_VIA_VELOCITY is not set
 CONFIG_NET_VENDOR_WIZNET=y
 # CONFIG_WIZNET_W5100 is not set
 # CONFIG_WIZNET_W5300 is not set
-CONFIG_NET_VENDOR_XILINX=y
-# CONFIG_XILINX_EMACLITE is not set
 CONFIG_PHYLIB=y
 
 #
@@ -1134,8 +955,8 @@
 # Enable WiMAX (Networking options) to see the WiMAX drivers
 #
 # CONFIG_WAN is not set
-CONFIG_XEN_NETDEV_FRONTEND=y
-# CONFIG_XEN_NETDEV_BACKEND is not set
+# CONFIG_XEN_NETDEV_FRONTEND is not set
+CONFIG_XEN_NETDEV_BACKEND=y
 # CONFIG_ISDN is not set
 
 #
@@ -1293,12 +1095,12 @@
 CONFIG_HVC_DRIVER=y
 CONFIG_HVC_IRQ=y
 CONFIG_HVC_XEN=y
-CONFIG_HVC_XEN_FRONTEND=y
+# CONFIG_HVC_XEN_FRONTEND is not set
 # CONFIG_HVC_DCC is not set
 # CONFIG_IPMI_HANDLER is not set
 CONFIG_HW_RANDOM=y
 # CONFIG_HW_RANDOM_TIMERIOMEM is not set
 # CONFIG_HW_RANDOM_ATMEL is not set
 # CONFIG_HW_RANDOM_EXYNOS is not set
 # CONFIG_R3964 is not set
 # CONFIG_RAW_DRIVER is not set
@@ -1831,16 +1567,16 @@
 #
 # Frame buffer hardware drivers
 #
 # CONFIG_FB_S1D13XXX is not set
 # CONFIG_FB_SMSCUFX is not set
 # CONFIG_FB_UDL is not set
 # CONFIG_FB_GOLDFISH is not set
 # CONFIG_FB_VIRTUAL is not set
-CONFIG_XEN_FBDEV_FRONTEND=y
+# CONFIG_XEN_FBDEV_FRONTEND is not set
 # CONFIG_FB_METRONOME is not set
 # CONFIG_FB_BROADSHEET is not set
 # CONFIG_FB_AUO_K190X is not set
 CONFIG_FB_SIMPLE=y
 # CONFIG_EXYNOS_VIDEO is not set
 # CONFIG_BACKLIGHT_LCD_SUPPORT is not set
 
@@ -1946,7 +1673,6 @@
 #
 # CONFIG_I2C_HID is not set
 CONFIG_USB_OHCI_LITTLE_ENDIAN=y
-CONFIG_USB_ARCH_HAS_EHCI=y
 CONFIG_USB_SUPPORT=y
 CONFIG_USB_COMMON=y
 CONFIG_USB_ARCH_HAS_HCD=y
@@ -1971,8 +1697,8 @@
 CONFIG_USB_EHCI_HCD=y
 CONFIG_USB_EHCI_ROOT_HUB_TT=y
 CONFIG_USB_EHCI_TT_NEWSCHED=y
 CONFIG_USB_EHCI_HCD_PLATFORM=y
-# CONFIG_USB_SUNXI_EHCI is not set
+CONFIG_USB_SUNXI_EHCI=y
 # CONFIG_USB_OXU210HP_HCD is not set
 # CONFIG_USB_ISP116X_HCD is not set
 CONFIG_USB_ISP1760_HCD=y
@@ -2279,7 +1950,6 @@
 CONFIG_XENFS=y
 CONFIG_XEN_COMPAT_XENFS=y
 CONFIG_XEN_SYS_HYPERVISOR=y
-CONFIG_XEN_XENBUS_FRONTEND=y
 CONFIG_XEN_GNTDEV=y
 CONFIG_XEN_GRANT_DEV_ALLOC=y
 CONFIG_XEN_PRIVCMD=y

2, \TODO
1), compile dom0 kernel base on julieng arndale kernel.

10:07 2013-10-14
GTD
0, 9:50-18:38

1, today
1), 30' hackweek: about the power of watch, i should do this in next week.
2), 30' personal stuff.
3), 11:19-11:40 14:00-18:37 xen: arm: sun7i: domU. see"11:18 2013-10-14"
1h: personal stuff.
4), \TODO:
(1), send email to xen-devel for help.

10:08 2013-10-14
GTD, week plan
1, week plan
1), hackweek
(1), Monday as hackweek project.
(2), in the rest day of this week, i could only use the night as my hackweek.
(3), i hope i could get the watch prototype works this week.
2), libvirt: finish ao_how with job patch.
3), send the xen-devel about ao_how patch.

10:31 2013-10-14
hackweek, watch
1, power
1), CR2032 or other button cell battery.
2), 2/3 F6 or other F6 battery
2/3 F6 about 30mm length. it could provide the more output current. but it is less safe than CR2032, because no big vendor.

11:18 2013-10-14
xen, arm, sun7i, domU
1, ref: 
Problems when creating domU on OMAP5
http://www.gossamer-threads.com/lists/xen/devel/298167

2, check the dom0 config. finished in "21:56 2013-10-13"1.

3, check the domU config.
\TODO: question. why CONFIG_XEN_BACKEND=y is in xen_domU_arndale_defconfig, comment it for now.

4, change the xenvm dst
1), ref: chen in OMAP5:
--- a/arch/arm/boot/dts/xenvm-4.2.dts
+++ b/arch/arm/boot/dts/xenvm-4.2.dts
@@ -49,13 +49,13 @@
                reg = <0 0x80000000 0 0x08000000>;
        };

-       gic: interrupt-controller@2c001000 {
+       gic: interrupt-controller@48211000 {
                compatible = "arm,cortex-a15-gic", "arm,cortex-a9-gic";
                #interrupt-cells = <3>;
                #address-cells = <0>;
                interrupt-controller;
-               reg = <0 0x10481000 0 0x1000>,
-                     <0 0x10482000 0 0x100>;
+               reg = <0 0x48211000 0 0x1000>,
+                     <0 0x48212000 0 0x1000>;
        };

        timer {

2), diff
i update the cpu, gic, memory base and remove motherboard.
does the gic should have the same address for hardware. i found the old gic combine with vexpress(0x2c001000) and exynos5250(0x10481000) base address, is it a typo?
	gic: interrupt-controller@2c001000 {
		compatible = "arm,cortex-a15-gic", "arm,cortex-a9-gic";
 		#interrupt-cells = <3>;
 		#address-cells = <0>;
 		interrupt-controller;
		reg = <0 0x10481000 0 0x1000>,
		      <0 0x10482000 0 0x100>;
 	};

diff --git a/arch/arm/boot/dts/xenvm-4.2.dts b/arch/arm/boot/dts/xenvm-4.2.dts
index 2f4136b..db12d20 100644
--- a/arch/arm/boot/dts/xenvm-4.2.dts
+++ b/arch/arm/boot/dts/xenvm-4.2.dts
@@ -26,36 +26,30 @@
 
 		cpu@0 {
 			device_type = "cpu";
-			compatible = "arm,cortex-a15";
+			compatible = "arm,cortex-a7";
 			reg = <0>;
 		};
-
-		cpu@1 {
-			device_type = "cpu";
-			compatible = "arm,cortex-a15";
-			reg = <1>;
-		};
 	};
 
 	psci {
 		compatible      = "arm,psci";
 		method          = "hvc";
-		cpu_on          = <2>;
+		cpu_on          = <1>;
 	};
 
-	memory@80000000 {
+	memory@40000000 {
 		device_type = "memory";
 		/* this field is going to be adjusted by the hypervisor */
-		reg = <0 0x80000000 0 0x08000000>;
+		reg = <0 0x40000000 0 0x08000000>;
 	};
 
-	gic: interrupt-controller@2c001000 {
-		compatible = "arm,cortex-a15-gic", "arm,cortex-a9-gic";
+	gic: interrupt-controller@1c481000 {
+		compatible = "arm,cortex-a7-gic", "arm,cortex-a15-gic";
 		#interrupt-cells = <3>;
 		#address-cells = <0>;
 		interrupt-controller;
-		reg = <0 0x10481000 0 0x1000>,
-		      <0 0x10482000 0 0x100>;
+		reg = <0 0x1c481000 0 0x1000>,
+		      <0 0x1c482000 0 0x1000>;
 	};
 
 	timer {
@@ -73,8 +67,4 @@
 		/* this field is going to be adjusted by the hypervisor */
 		interrupts = <1 15 0xf08>;
 	};
-
-	motherboard {
-		arm,v2m-memory-map = "rs1";
-	};
 };

5, i need enable loop in dom0 kernel. othervise i could not use the disk.
\TODO how to use initrd in xen domU?
1), domU boot successful, but i do not know how to connect to it.
# xl create domU_test -d
Parsing config from domU_test
unable to format domain config as JSON (YAJL:1)

[ 1357.167915] Failed to unmap pfn:4c61d rc:-2
[ 1357.172804] Failed to unmap pfn:4bf33 rc:-2
[ 1357.177537] Failed to unmap pfn:4c61d rc:-2
[ 1357.182305] Failed to unmap pfn:4bf33 rc:-2
[ 1357.186930] Failed to unmap pfn:4c61b rc:-2
[ 1357.194761] Failed to unmap pfn:4c61a rc:-2
Daemon running with PID 151
# 
# xl list
Name                                        ID   Mem VCPUs      State   Time(s)
Domain-0                                     0   383     1     r-----      13.0
domU                                         1   128     1     ------       3.5
# xl list
Name                                        ID   Mem VCPUs      State   Time(s)
Domain-0                                     0   383     1     r-----      13.1
domU                                         1   128     1     ------       6.2

2), xenstore-ls
# xenstore-ls
tool = ""
 xenstored = ""
local = ""
 domain = ""
  0 = ""
   name = "Domain-0"
   libxl = ""
    disable_udev = "1"
   backend = ""
    console = ""
     1 = ""
      0 = ""
       frontend = "/local/domain/1/console"
       frontend-id = "1"
       online = "1"
       state = "1"
       domain = "domU"
       protocol = "vt100"
  1 = ""
   vm = "/vm/9a65f38d-7e40-4491-9179-47eec5a5d54c"
   name = "domU"
   cpu = ""
    0 = ""
     availability = "online"
   memory = ""
    static-max = "131072"
    target = "131073"
    videoram = "-1"
   device = ""
    suspend = ""
     event-channel = ""
   control = ""
    shutdown = ""
    platform-feature-multiprocessor-suspend = "1"
    platform-feature-xs_reset_watches = "1"
   data = ""
   domid = "1"
   store = ""
    port = "1"
    ring-ref = "557057"
   console = ""
    backend = "/local/domain/0/backend/console/1/0"
    backend-id = "0"
    limit = "1048576"
    type = "xenconsoled"
    output = "pty"
    tty = "/dev/pts/0"
    port = "2"
    ring-ref = "557056"
vm = ""
 9a65f38d-7e40-4491-9179-47eec5a5d54c = ""
  uuid = "9a65f38d-7e40-4491-9179-47eec5a5d54c"
  name = "domU"
  image = ""
   ostype = "linux"
   kernel = "/root/zImage_dtb"
   cmdline = ""
  start_time = "1374.92"
libxl = ""
 1 = ""
  dm-version = "qemu_xen_traditional"
# 

(1), \TODO: why there is a qqemu_xen_traditional in dm-version?

3), destroy warning:
# xl destroy 1
(XEN) mm.c:1250:d0 gnttab_mark_dirty not implemented yet

13:43 2013-10-14
software skill, how to know the hostname from ip
http://stackoverflow.com/questions/657482/how-to-find-host-name-from-ip-with-out-login-to-the-host
but i do not successful.

4), add console="pty", but xl console still hang:
# xl -v create domU_test -d       
Parsing config from domU_test
unable to format domain config as JSON (YAJL:1)
libxl: detail: libxl_dom.c:195:numa_place_domain: NUMA placement candidate with 1 nodes, 1 cpus and 1629 KB free selected
domainbuilder: detail: xc_dom_allocate: cmdline="", features="(null)"
domainbuilder: detail: xc_dom_kernel_file: filename="/root/zImage_dtb"
domainbuilder: detail: xc_dom_malloc_filemap    : 2029 kB
domainbuilder: detail: xc_dom_boot_xen_init: ver 4.4, caps xen-3.0-armv7l 
domainbuilder: detail: xc_dom_parse_image: called
domainbuilder: detail: xc_dom_find_loader: trying multiboot-binary loader ... 
domainbuilder: detail: loader probe failed
domainbuilder: detail: xc_dom_find_loader: trying Linux zImage (ARM) loader ... 
domainbuilder: detail: xc_dom_probe_zimage_kernel: found an appended DTB
domainbuilder: detail: loader probe OK
domainbuilder: detail: xc_dom_parse_zimage_kernel: called
domainbuilder: detail: xc_dom_parse_zimage_kernel: xen-3.0-armv7l: RAM starts at 80000
domainbuilder: detail: xc_dom_parse_zimage_kernel: xen-3.0-armv7l: 0x80008000 -> 0x80203487
domainbuilder: detail: xc_dom_mem_init: mem 128 MB, pages 0x8000 pages, 4k each
domainbuilder: detail: xc_dom_mem_init: 0x8000 pages
domainbuilder: detail: xc_dom_boot_mem_init: called
domainbuilder: detail: xc_dom_malloc            : 256 kB
domainbuilder: detail: xc_dom_build_image: called
domainbuilder: detail: xc_dom_alloc_segment:   kernel       : 0x80008000 -> 0x80204000  (pfn 0x80008 + 0x1fc pages)
domainbuilder: detail: xc_dom_pfn_to_ptr_retcount: domU mapping: pfn 0x80008+0x1fc at 0xb680a000
domainbuilder: detail: xc_dom_load_zimage_kernel: called
domainbuilder: detail: xc_dom_load_zimage_kernel: kernel sed 0x80008000-0x80204000
domainbuilder: detail: xc_dom_load_zimage_kernel: copy 2077831 bytes from blob 0xb6a47000 to dst 0xb680a000
domainbuilder: detail: alloc_magic_pages: called
[ 4828.469153] Failed to unmap pfn:4c12e rc:-2
[ 4828.473412] Failed to unmap pfn:4c60e rc:-2
domainbuilder: detail: count_pgtables_arm: called
domainbuilder: detail: xc_dom_build_image  : virt_alloc_end : 0x80204000
domainbuilder: detail: xc_dom_build_image  : virt_pgtab_end : 0x0
domainbuilder: detail: xc_dom_boot_image: called
domainbuilder: detail: arch_setup_bootearly: doing nothing
domainbuilder: detail: xc_dom_compat_check: supported guest type: xen-3.0-armv7l <= matches
domainbuilder: detail: setup_pgtables_arm: called
domainbuilder: detail: clear_page: pfn 0x88000, mfn 0x88000
[ 4828.522835] Failed to unmap pfn:4c12e rc:-2
domainbuilder: detail: clear_page: pfn 0x88001, mfn 0x88001
[ 4828.532799] Failed to unmap pfn:4c60e rc:-2
domainbuilder: detail: start_info_arm: called
domainbuilder: detail: domain builder memory footprint
domainbuilder: detail:    allocated
domainbuilder: detail:       malloc             : 269 kB
domainbuilder: detail:       anon mmap          : 0 bytes
domainbuilder: detail:    mapped
domainbuilder: detail:       file mmap          : 2029 kB
domainbuilder: detail:       domU mmap          : 2032 kB
domainbuilder: detail: vcpu_arm: called
domainbuilder: detail: Initial state CPSR 0x1d3 PC 0x80008000
[ 4828.582532] Failed to unmap pfn:4c12c rc:-2
domainbuilder: detail: launch_vm: called, ctxt=0xb6f18004
[ 4828.594749] Failed to unmap pfn:4c12b rc:-2
domainbuilder: detail: xc_dom_release: called
Daemon running with PID 197
# 
# xl list
Name                                        ID   Mem VCPUs      State   Time(s)
Domain-0                                     0   383     1     r-----      28.8
domU                                         2   128     1     ------       6.3
# xl console 2
# 

5), shoud i change the memory address according to the following output?
domainbuilder: detail: Initial state CPSR 0x1d3 PC 0x80008000

6), add disk in vm:
    losetup /dev/loop0 /root/domU/rootfs.ext3 

add disk in cfg:
    disk = [ 'phy:/dev/loop0,xvda,w' ]

7), i want to use ifup manage the network. but i could not change this in yast.
(1), change /etc/sysconfig/network
cubiebox:/etc/sysconfig/network # cat ifcfg-br0
BOOTPROTO='dhcp'
BRIDGE='yes'
BRIDGE_FORWARDDELAY='0'
BRIDGE_PORTS='eth0'
BRIDGE_STP='off'
BROADCAST=''
ETHTOOL_OPTIONS=''
IPADDR=''
MTU=''
NAME=''
NETMASK=''
NETWORK=''
REMOTE_IPADDR=''
STARTMODE='auto'
USERCONTROL='no'
cubiebox:/etc/sysconfig/network # diff -urN ifcfg-eth0.old1014 ifcfg-eth0
--- ifcfg-eth0.old1014  2013-03-27 01:22:00.610595001 +0100
+++ ifcfg-eth0  2013-10-14 11:33:43.391320148 +0200
@@ -1,4 +1,5 @@
-BOOTPROTO='dhcp'
+BOOTPROTO='static'
 MTU=''
+IPADDR='0.0.0.0/32'
 REMOTE_IPADDR=''
 STARTMODE='onboot'

(2), but when i try to down and up the eth0, the nfs will hang. how should i do this?
or could i create the br0 in initrd?

# brctl addbr virbr0
add bridge failed: Package not installed

cubiebox:/etc/xen/vm # gunzip < /proc/config.gz | grep BRIDGE
# CONFIG_ARCH_FOOTBRIDGE is not set
# CONFIG_BRIDGE is not set


8), 
(1), xl log
cubiebox:/etc/xen/vm # xl -v create domU_test -d 
Parsing config from domU_test
unable to format domain config as JSON (YAJL:1)
libxl: detail: libxl_dom.c:195:numa_place_domain: NUMA placement candidate with 1 nodes, 1 cpus and 1629 KB free selected
domainbuilder: detail: xc_dom_allocate: cmdline="", features="(null)"
domainbuilder: detail: xc_dom_kernel_file: filename="/root/domU/zImage_dtb"
domainbuilder: detail: xc_dom_malloc_filemap    : 2029 kB
domainbuilder: detail: xc_dom_boot_xen_init: ver 4.4, caps xen-3.0-armv7l 
domainbuilder: detail: xc_dom_parse_image: called
domainbuilder: detail: xc_dom_find_loader: trying multiboot-binary loader ... 
domainbuilder: detail: loader probe failed
domainbuilder: detail: xc_dom_find_loader: trying Linux zImage (ARM) loader ... 
domainbuilder: detail: xc_dom_probe_zimage_kernel: found an appended DTB
domainbuilder: detail: loader probe OK
domainbuilder: detail: xc_dom_parse_zimage_kernel: called
domainbuilder: detail: xc_dom_parse_zimage_kernel: xen-3.0-armv7l: RAM starts at 80000
domainbuilder: detail: xc_dom_parse_zimage_kernel: xen-3.0-armv7l: 0x80008000 -> 0x80203487
domainbuilder: detail: xc_dom_mem_init: mem 128 MB, pages 0x8000 pages, 4k each
domainbuilder: detail: xc_dom_mem_init: 0x8000 pages
domainbuilder: detail: xc_dom_boot_mem_init: called
domainbuilder: detail: xc_dom_malloc            : 256 kB
domainbuilder: detail: xc_dom_build_image: called
domainbuilder: detail: xc_dom_alloc_segment:   kernel       : 0x80008000 -> 0x80204000  (pfn 0x80008 + 0x1fc pages)
domainbuilder: detail: xc_dom_pfn_to_ptr_retcount: domU mapping: pfn 0x80008+0x1fc at 0xb6873000
domainbuilder: detail: xc_dom_load_zimage_kernel: called
domainbuilder: detail: xc_dom_load_zimage_kernel: kernel sed 0x80008000-0x80204000
domainbuilder: detail: xc_dom_load_zimage_kernel: copy 2077831 bytes from blob 0xb6ab0000 to dst 0xb6873000
domainbuilder: detail: alloc_magic_pages: called
domainbuilder: detail: count_pgtables_arm: called
domainbuilder: detail: xc_dom_build_image  : virt_alloc_end : 0x80204000
domainbuilder: detail: xc_dom_build_image  : virt_pgtab_end : 0x0
domainbuilder: detail: xc_dom_boot_image: called
domainbuilder: detail: arch_setup_bootearly: doing nothing
domainbuilder: detail: xc_dom_compat_check: supported guest type: xen-3.0-armv7l <= matches
domainbuilder: detail: setup_pgtables_arm: called
domainbuilder: detail: clear_page: pfn 0x88000, mfn 0x88000
domainbuilder: detail: clear_page: pfn 0x88001, mfn 0x88001
domainbuilder: detail: start_info_arm: called
domainbuilder: detail: domain builder memory footprint
domainbuilder: detail:    allocated
domainbuilder: detail:       malloc             : 269 kB
domainbuilder: detail:       anon mmap          : 0 bytes
domainbuilder: detail:    mapped
domainbuilder: detail:       file mmap          : 2029 kB
domainbuilder: detail:       domU mmap          : 2032 kB
domainbuilder: detail: vcpu_arm: called
domainbuilder: detail: Initial state CPSR 0x1d3 PC 0x80008000
domainbuilder: detail: launch_vm: called, ctxt=0xb6f81004
domainbuilder: detail: xc_dom_release: called
Daemon running with PID 231

(2), kernel message duing xl create:
# [  540.202580] Failed to unmap pfn:4c025 rc:-2
[  540.208174] Failed to unmap pfn:4c024 rc:-2
[  540.220047] Failed to unmap pfn:4c025 rc:-2
[  540.225907] Failed to unmap pfn:4c024 rc:-2
[  540.236635] Failed to unmap pfn:4c022 rc:-2
[  540.245590] Failed to unmap pfn:4c021 rc:-2

(3), 
cubiebox:/etc/xen/vm # xenstore-ls
tool = ""
 xenstored = ""
local = ""
 domain = ""
  0 = ""
   name = "Domain-0"
   libxl = ""
    disable_udev = "1"
   backend = ""
    vbd = ""
     1 = ""
      51712 = ""
       frontend = "/local/domain/1/device/vbd/51712"
       params = "/dev/loop0"
       script = "/etc/xen/scripts/block"
       physical-device = "7:0"
       frontend-id = "1"
       online = "1"
       removable = "0"
       bootable = "1"
       state = "2"
       dev = "xvda"
       type = "phy"
       mode = "w"
       device-type = "disk"
    console = ""
     1 = ""
      0 = ""
       frontend = "/local/domain/1/console"
       frontend-id = "1"
       online = "1"
       state = "1"
       domain = "domU"
       protocol = "vt100"
  1 = ""
   vm = "/vm/d03ecd47-3359-4f7b-9077-7a3f0f293cfa"
   name = "domU"
   cpu = ""
    0 = ""
     availability = "online"
   memory = ""
    static-max = "131072"
    target = "131073"
    videoram = "-1"
   device = ""
    suspend = ""
     event-channel = ""
    vbd = ""
     51712 = ""
      backend = "/local/domain/0/backend/vbd/1/51712"
      backend-id = "0"
      state = "1"
      virtual-device = "51712"
      device-type = "disk"
      protocol = "arm-abi"
   control = ""
    shutdown = ""
    platform-feature-multiprocessor-suspend = "1"
    platform-feature-xs_reset_watches = "1"
   data = ""
   domid = "1"
   store = ""
    port = "1"
    ring-ref = "557057"
   console = ""
    backend = "/local/domain/0/backend/console/1/0"
    backend-id = "0"
    limit = "1048576"
    type = "xenconsoled"
    output = "pty"
    tty = "/dev/pts/1"
    port = "2"
    ring-ref = "557056"
vm = ""
 d03ecd47-3359-4f7b-9077-7a3f0f293cfa = ""
  uuid = "d03ecd47-3359-4f7b-9077-7a3f0f293cfa"
  name = "domU"
  image = ""
   ostype = "linux"
   kernel = "/root/domU/zImage_dtb"
   cmdline = ""
  start_time = "544.66"
libxl = ""
 1 = ""
  dm-version = "qemu_xen_traditional"
cubiebox:/etc/xen/vm # 

9), try this one:
ref: http://blog.csdn.net/starshine/article/details/6990599
   ä¿®æ¹åçéç½®æä»¶åå®¹å¦ä¸ï¼

   1ï¼ifcfg-eth0

      DEVICE=eth0
      ONBOOT=yes
      BRIDGE=virbr0
      BOOTPROTO=dhcp
      TYPE=Ethernet

   2ï¼ifcfg-virbr0
      
      DEVICE=virbr0
      TYPE=Bridge 
      ONBOOT=yes
      DELAY=0
      BOOTPROTO=none
      IPADDR=10.100.0.3
      NETMASK=255.255.255.0
      GATEWAY=10.100.0.254     

10), \TODO: try libvirt?

21:58 2013-10-14
1, about xen debug tools
http://www-archive.xenproject.org/files/xensummit_intel09/xen-debugging.pdf
1), console
2), xentrace
3), gdbsx

2, debug why no console
ref: http://www.gossamer-threads.com/lists/xen/devel/301400 

3, error when compile staging.
diff --git a/xen/common/event_fifo.c b/xen/common/event_fifo.c
index eb0b97c..f2a28e4 100644
--- a/xen/common/event_fifo.c
+++ b/xen/common/event_fifo.c
@@ -17,6 +17,7 @@
 #include <xen/paging.h>
 #include <xen/mm.h>
 
+#include <xen/domain_page.h>
 #include <public/event_channel.h>
 
 static inline event_word_t *evtchn_fifo_word_from_port(struct domain *d,
diff --git a/xen/include/xen/sched.h b/xen/include/xen/sched.h
index c2588a5..25bf637 100644
--- a/xen/include/xen/sched.h
+++ b/xen/include/xen/sched.h
@@ -24,6 +24,7 @@
 #include <public/sysctl.h>
 #include <public/vcpu.h>
 #include <public/mem_event.h>
+#include <public/event_channel.h>
 
 #ifdef CONFIG_COMPAT
 #include <compat/vcpu.h>

4, guest crash
# xl -v create -d -c domU_test 
Parsing config from domU_test
unable to format domain config as JSON (YAJL:1)
libxl: detail: libxl_dom.c:195:numa_place_domain: NUMA placement candidate with 1 nodes, 1 cpus and 1629 KB free selected
domainbuilder: detail: xc_dom_allocate: cmdline="", features="(null)"
domainbuilder: detail: xc_dom_kernel_file: filename="/root/domU/zImage_dtb"
domainbuilder: detail: xc_dom_malloc_filemap: failed (on file `/root/domU/zImage_dtb')
libxl: error: libxl_dom.c:353:libxl__build_pv: xc_dom_kernel_file failed: No such file or directory
domainbuilder: detail: xc_dom_release: called
libxl: error: libxl_create.c:903:domcreate_rebuild_done: cannot (re-)build domain: -3
# xl -v create -d -c domU_test
Parsing config from domU_test
unable to format domain config as JSON (YAJL:1)
libxl: detail: libxl_dom.c:195:numa_place_domain: NUMA placement candidate with 1 nodes, 1 cpus and 1629 KB free selected
domainbuilder: detail: xc_dom_allocate: cmdline="", features="(null)"
domainbuilder: detail: xc_dom_kernel_file: filename="/root/domU/zImage_dtb"
domainbuilder: detail: xc_dom_malloc_filemap    : 2030 kB
domainbuilder: detail: xc_dom_boot_xen_init: ver 4.4, caps xen-3.0-armv7l 
domainbuilder: detail: xc_dom_parse_image: called
domainbuilder: detail: xc_dom_find_loader: trying multiboot-binary loader ... 
domainbuilder: detail: loader probe failed
domainbuilder: detail: xc_dom_find_loader: trying Linux zImage (ARM) loader ... 
domainbuilder: detail: xc_dom_probe_zimage_kernel: found an appended DTB
domainbuilder: detail: loader probe OK
domainbuilder: detail: xc_dom_parse_zimage_kernel: called
domainbuilder: detail: xc_dom_parse_zimage_kernel: xen-3.0-armv7l: RAM starts at 80000
domainbuilder: detail: xc_dom_parse_zimage_kernel: xen-3.0-armv7l: 0x80008000 -> 0x80203933
domainbuilder: detail: xc_dom_mem_init: mem 128 MB, pages 0x8000 pages, 4k each
domainbuilder: detail: xc_dom_mem_init: 0x8000 pages
domainbuilder: detail: xc_dom_boot_mem_init: called
domainbuilder: detail: xc_dom_malloc            : 256 kB
domainbuilder: detail: xc_dom_build_image: called
domainbuilder: detail: xc_dom_alloc_segment:   kernel       : 0x80008000 -> 0x80204000  (pfn 0x80008 + 0x1fc pages)
domainbuilder: detail: xc_dom_pfn_to_ptr_retcount: domU mapping: pfn 0x80008+0x1fc at 0xb68da000
domainbuilder: detail: xc_dom_load_zimage_kernel: called
domainbuilder: detail: xc_dom_load_zimage_kernel: kernel sed 0x80008000-0x80204000
domainbuilder: detail: xc_dom_load_zimage_kernel: copy 2079027 bytes from blob 0xb6b17000 to dst 0xb68da000
domainbuilder: detail: alloc_magic_pages: called
[  374.672591] Failed to unmap pfn:4c607 rc:-2
[  374.677774] Failed to unmap pfn:4c606 rc:-2
domainbuilder: detail: count_pgtables_arm: called
domainbuilder: detail: xc_dom_build_image  : virt_alloc_end : 0x80204000
domainbuilder: detail: xc_dom_build_image  : virt_pgtab_end : 0x0
domainbuilder: detail: xc_dom_boot_image: called
domainbuilder: detail: arch_setup_bootearly: doing nothing
domainbuilder: detail: xc_dom_compat_check: supported guest type: xen-3.0-armv7l <= matches
domainbuilder: detail: setup_pgtables_arm: called
domainbuilder: detail: clear_page: pfn 0x88000, mfn 0x88000
[  374.726799] Failed to unmap pfn:4c607 rc:-2
domainbuilder: detail: clear_page: pfn 0x88001, mfn 0x88001
[  374.736408] Failed to unmap pfn:4c606 rc:-2
domainbuilder: detail: start_info_arm: called
domainbuilder: detail: domain builder memory footprint
domainbuilder: detail:    allocated
domainbuilder: detail:       malloc             : 269 kB
domainbuilder: detail:       anon mmap          : 0 bytes
domainbuilder: detail:    mapped
domainbuilder: detail:       file mmap          : 2030 kB
domainbuilder: detail:       domU mmap          : 2032 kB
domainbuilder: detail: vcpu_arm: called
domainbuilder: detail: Initial state CPSR 0x1d3 PC 0x80008000
[  374.785408] Failed to unmap pfn:4c604 rc:-2
domainbuilder: detail: launch_vm: called, ctxt=0xb6fe8004
[  374.797618] Failed to unmap pfn:4c603 rc:-2
domainbuilder: detail: xc_dom_release: called
Daemon running with PID 143
(XEN) Guest data abort: Translation fault at level 2
(XEN)     gva=c8800004
(XEN)     gpa=000000001c481004
(XEN)     size=2 sign=0 write=0 reg=3
(XEN)     eat=0 cm=0 s1ptw=0 dfsc=6
(XEN) dom2 IPA 0x000000001c481004
(XEN) P2M @ 02ffcdc0 mfn:0xbfe6e
(XEN) 1ST[0x0] = 0x0000000095d386ff
(XEN) 2ND[0xe2] = 0x0000000000000000
(XEN) ----[ Xen-4.4-unstable  arm32  debug=y  Tainted:    C ]----
(XEN) CPU:    0
(XEN) PC:     c03ab098
(XEN) CPSR:   600001d3 MODE:32-bit Guest SVC
(XEN)      R0: 00000000 R1: ffffffff R2: c03ccd84 R3: 00000008
(XEN)      R4: ffffffff R5: c03cc7f0 R6: 00000010 R7: c8800000
(XEN)      R8: c050da38 R9: 00100100 R10:00200200 R11:c03c5f90 R12:00000063
(XEN) USR: SP: 00000000 LR: 00000000
(XEN) SVC: SP: c03c5f48 LR: c03ab34c SPSR:000001d3
(XEN) ABT: SP: c03e750c LR: c03e750c SPSR:00000000
(XEN) UND: SP: c03e7518 LR: c03e7518 SPSR:00000000
(XEN) IRQ: SP: c03e7500 LR: c03e7500 SPSR:00000000
(XEN) FIQ: SP: 00000000 LR: ffffffff SPSR:00000000
(XEN) FIQ: R8: 00000000 R9: 00000000 R10:00000000 R11:00000000 R12:00000000
(XEN) 
(XEN)      SCTLR: 10c53c7d
(XEN)        TCR: 00000000
(XEN)      TTBR0: 000000008000406a
(XEN)      TTBR1: 000000008000406a
(XEN)       IFAR: 00000000, IFSR: 00000000
(XEN)       DFAR: 00000000, DFSR: 00000000
(XEN) 
(XEN)   VTCR_EL2: 80002558
(XEN)  VTTBR_EL2: 00020000bfe6e000
(XEN) 
(XEN)  SCTLR_EL2: 30cd187f
(XEN)    HCR_EL2: 0000000000282835
(XEN)  TTBR0_EL2: 00000000bfedf000
(XEN) 
(XEN)    ESR_EL2: 93830006
(XEN)  HPFAR_EL2: 00000000001c4810
(XEN)      HDFAR: c8800004
(XEN)      HIFAR: 3fe752e0
(XEN) 
(XEN) No stack trace for 32-bit guest kernel-mode
(XEN) domain_crash_sync called from traps.c:1385
(XEN) Domain 2 (vcpu#0) crashed on cpu#0:
(XEN) ----[ Xen-4.4-unstable  arm32  debug=y  Tainted:    C ]----
(XEN) CPU:    0
(XEN) PC:     c03ab098
(XEN) CPSR:   600001d3 MODE:32-bit Guest SVC
(XEN)      R0: 00000000 R1: ffffffff R2: c03ccd84 R3: 00000008
(XEN)      R4: ffffffff R5: c03cc7f0 R6: 00000010 R7: c8800000
(XEN)      R8: c050da38 R9: 00100100 R10:00200200 R11:c03c5f90 R12:00000063
(XEN) USR: SP: 00000000 LR: 00000000
(XEN) SVC: SP: c03c5f48 LR: c03ab34c SPSR:000001d3
(XEN) ABT: SP: c03e750c LR: c03e750c SPSR:00000000
(XEN) UND: SP: c03e7518 LR: c03e7518 SPSR:00000000
(XEN) IRQ: SP: c03e7500 LR: c03e7500 SPSR:00000000
(XEN) FIQ: SP: 00000000 LR: ffffffff SPSR:00000000
(XEN) FIQ: R8: 00000000 R9: 00000000 R10:00000000 R11:00000000 R12:00000000
(XEN) 
(XEN)      SCTLR: 10c53c7d
(XEN)        TCR: 00000000
(XEN)      TTBR0: 000000008000406a
(XEN)      TTBR1: 000000008000406a
(XEN)       IFAR: 00000000, IFSR: 00000000
(XEN)       DFAR: 00000000, DFSR: 00000000
(XEN) 
(XEN)   VTCR_EL2: 80002558
(XEN)  VTTBR_EL2: 00020000bfe6e000
(XEN) 
(XEN)  SCTLR_EL2: 30cd187f
(XEN)    HCR_EL2: 0000000000282835
(XEN)  TTBR0_EL2: 00000000bfedf000
(XEN) 
(XEN)    ESR_EL2: 93830006
(XEN)  HPFAR_EL2: 00000000001c4810
(XEN)      HDFAR: c8800004
(XEN)      HIFAR: 3fe752e0
(XEN) 
(XEN) No stack trace for 32-bit guest kernel-mode
# (XEN) mm.c:1250:d0 gnttab_mark_dirty not implemented yet

1), it is only fail with the kernel i compile at home, for the company version, it create without error but no console output
# xl -vvv create -d -c domU_test
Parsing config from domU_test
unable to format domain config as JSON (YAJL:1)
libxl: debug: libxl_create.c:1233:do_domain_create: ao 0x3cd50: create: how=(nil) callback=(nil) poller=0x3cd98
libxl: verbose: libxl_create.c:130:libxl__domain_build_info_setdefault: qemu-xen is unavailable, use qemu-xen-traditional instead: No such file or directory
libxl: debug: libxl_device.c:257:libxl__device_disk_set_backend: Disk vdev=xvda spec.backend=unknown
libxl: debug: libxl_device.c:296:libxl__device_disk_set_backend: Disk vdev=xvda, using backend phy
libxl: debug: libxl_create.c:678:initiate_domain_create: running bootloader
libxl: debug: libxl_bootloader.c:327:libxl__bootloader_run: no bootloader configured, using user supplied kernel
libxl: debug: libxl_event.c:608:libxl__ev_xswatch_deregister: watch w=0x36f30: deregister unregistered
libxl: debug: libxl_numa.c:475:libxl__get_numa_candidate: New best NUMA placement candidate found: nr_nodes=1, nr_cpus=1, nr_vcpus=2, free_memkb=1629
libxl: detail: libxl_dom.c:195:numa_place_domain: NUMA placement candidate with 1 nodes, 1 cpus and 1629 KB free selected
domainbuilder: detail: xc_dom_allocate: cmdline="", features="(null)"
libxl: debug: libxl_dom.c:341:libxl__build_pv: pv kernel mapped 0 path /root/domU/zImage_dtb

domainbuilder: detail: xc_dom_kernel_file: filename="/root/domU/zImage_dtb"
domainbuilder: detail: xc_dom_malloc_filemap    : 2029 kB
domainbuilder: detail: xc_dom_boot_xen_init: ver 4.4, caps xen-3.0-armv7l 
domainbuilder: detail: xc_dom_parse_image: called
domainbuilder: detail: xc_dom_find_loader: trying multiboot-binary loader ... 
domainbuilder: detail: loader probe failed
domainbuilder: detail: xc_dom_find_loader: trying Linux zImage (ARM) loader ... 
domainbuilder: detail: xc_dom_probe_zimage_kernel: found an appended DTB
domainbuilder: detail: loader probe OK
domainbuilder: detail: xc_dom_parse_zimage_kernel: called
domainbuilder: detail: xc_dom_parse_zimage_kernel: xen-3.0-armv7l: RAM starts at 80000
domainbuilder: detail: xc_dom_parse_zimage_kernel: xen-3.0-armv7l: 0x80008000 -> 0x80203487
domainbuilder: detail: xc_dom_mem_init: mem 128 MB, pages 0x8000 pages, 4k each
domainbuilder: detail: xc_dom_mem_init: 0x8000 pages
domainbuilder: detail: xc_dom_boot_mem_init: called
domainbuilder: detail: xc_dom_malloc            : 256 kB
domainbuilder: detail: xc_dom_build_image: called
domainbuilder: detail: xc_dom_alloc_segment:   kernel       : 0x80008000 -> 0x80204000  (pfn 0x80008 + 0x1fc pages)
domainbuilder: detail: xc_dom_pfn_to_ptr_retcount: domU mapping: pfn 0x80008+0x1fc at 0xb683c000
domainbuilder: detail: xc_dom_load_zimage_kernel: called
domainbuilder: detail: xc_dom_load_zimage_kernel: kernel sed 0x80008000-0x80204000
domainbuilder: detail: xc_dom_load_zimage_kernel: copy 2077831 bytes from blob 0xb6a79000 to dst 0xb683c000
domainbuilder: detail: alloc_magic_pages: called
[  706.135013] Failed to unmap pfn:4bcb7 rc:-2
[  706.140190] Failed to unmap pfn:4c64d rc:-2
domainbuilder: detail: count_pgtables_arm: called
domainbuilder: detail: xc_dom_build_image  : virt_alloc_end : 0x80204000
domainbuilder: detail: xc_dom_build_image  : virt_pgtab_end : 0x0
domainbuilder: detail: xc_dom_boot_image: called
domainbuilder: detail: arch_setup_bootearly: doing nothing
domainbuilder: detail: xc_dom_compat_check: supported guest type: xen-3.0-armv7l <= matches
domainbuilder: detail: setup_pgtables_arm: called
domainbuilder: detail: clear_page: pfn 0x88000, mfn 0x88000
[  706.189320] Failed to unmap pfn:4bcb7 rc:-2
domainbuilder: detail: clear_page: pfn 0x88001, mfn 0x88001
[  706.198941] Failed to unmap pfn:4c64d rc:-2
domainbuilder: detail: start_info_arm: called
domainbuilder: detail: domain builder memory footprint
domainbuilder: detail:    allocated
domainbuilder: detail:       malloc             : 269 kB
domainbuilder: detail:       anon mmap          : 0 bytes
domainbuilder: detail:    mapped
domainbuilder: detail:       file mmap          : 2029 kB
domainbuilder: detail:       domU mmap          : 2032 kB
domainbuilder: detail: vcpu_arm: called
domainbuilder: detail: Initial state CPSR 0x1d3 PC 0x80008000
[  706.247923] Failed to unmap pfn:4bcb5 rc:-2
domainbuilder: detail: launch_vm: called, ctxt=0xb6f4a004
[  706.260095] Failed to unmap pfn:4bcb4 rc:-2
domainbuilder: detail: xc_dom_release: called
libxl: debug: libxl_device.c:257:libxl__device_disk_set_backend: Disk vdev=xvda spec.backend=phy
libxl: debug: libxl_event.c:559:libxl__ev_xswatch_register: watch w=0x377e0 wpath=/local/domain/0/backend/vbd/3/51712/state token=3/0: register slotnum=3
libxl: debug: libxl_create.c:1246:do_domain_create: ao 0x3cd50: inprogress: poller=0x3cd98, flags=i
libxl: debug: libxl_event.c:503:watchfd_callback: watch w=0x377e0 wpath=/local/domain/0/backend/vbd/3/51712/state token=3/0: event epath=/local/domain/0/backend/vbd/3/51712/state
libxl: debug: libxl_event.c:647:devstate_watch_callback: backend /local/domain/0/backend/vbd/3/51712/state wanted state 2 still waiting state 1
libxl: debug: libxl_event.c:503:watchfd_callback: watch w=0x377e0 wpath=/local/domain/0/backend/vbd/3/51712/state token=3/0: event epath=/local/domain/0/backend/vbd/3/51712/state
libxl: debug: libxl_event.c:643:devstate_watch_callback: backend /local/domain/0/backend/vbd/3/51712/state wanted state 2 ok
libxl: debug: libxl_event.c:596:libxl__ev_xswatch_deregister: watch w=0x377e0 wpath=/local/domain/0/backend/vbd/3/51712/state token=3/0: deregister slotnum=3
libxl: debug: libxl_event.c:608:libxl__ev_xswatch_deregister: watch w=0x377e0: deregister unregistered
libxl: debug: libxl_device.c:959:device_hotplug: calling hotplug script: /etc/xen/scripts/block add
libxl: debug: libxl_event.c:1748:libxl__ao_progress_report: ao 0x3cd50: progress report: callback queued aop=0x38948
libxl: debug: libxl_event.c:1570:libxl__ao_complete: ao 0x3cd50: complete, rc=0
libxl: debug: libxl_event.c:1160:egc_run_callbacks: ao 0x3cd50: progress report: callback aop=0x38948
libxl: debug: libxl_event.c:1542:libxl__ao__destroy: ao 0x3cd50: destroy
Daemon running with PID 186
xc: debug: hypercall buffer: total allocations:98 total releases:98
xc: debug: hypercall buffer: current allocations:0 maximum allocations:4
xc: debug: hypercall buffer: cache current size:4
xc: debug: hypercall buffer: cache hits:90 misses:4 toobig:4

5, xentrace fail
# ls -l  trace.raw 
-rw-r--r-- 1 root root 0 Oct 14  2013 trace.raw
# xentrace -S 256 -T 1 trace.raw
[  945.495447] Failed to map pfn to mfn rc:0:-3 pfn:4c180 mfn:ae03d
[  945.501336] Failed to unmap pfn:4c180 rc:-2
ERROR: Failed to mmap trace buffers (14 = Bad address)

6, gdbsx need patch
cubiebox:~/work/source/virtualization/xen/upstream/xen/tools/debugger/gdbsx # ./gdbsx -a 3 32 9999
ERROR:_check_hyp:Hyp is NOT enabled for gdbsx
ERROR: failed to attach to domain:3 errno:38

7, \TODO
try patch console_io then send email to xen. 
diff --git a/xen/drivers/char/console.c b/xen/drivers/char/console.c
index 508f845..15501b6 100644
--- a/xen/drivers/char/console.c
+++ b/xen/drivers/char/console.c
@@ -425,6 +425,7 @@ static long guest_console_write(XEN_GUEST_HANDLE_PARAM(char) buffer, int count)
             {
                 kcount = kin - kbuf;
                 cd->pbuf[cd->pbuf_idx] = '\0';
+                printk("%s%s\n", cd->pbuf, kbuf);
                 guest_printk(cd, XENLOG_G_DEBUG "%s%s\n", cd->pbuf, kbuf);
                 cd->pbuf_idx = 0;
             }
@@ -437,6 +438,7 @@ static long guest_console_write(XEN_GUEST_HANDLE_PARAM(char) buffer, int count)
             else
             {
                 cd->pbuf[cd->pbuf_idx] = '\0';
+                printk("%s%s\n", cd->pbuf, kbuf);
                 guest_printk(cd, XENLOG_G_DEBUG "%s%s\n", cd->pbuf, kbuf);
                 cd->pbuf_idx = 0;
             }

should finish before noon.

10:14 2013-10-15
GTD
0, 10:10-18:06

1, today
1), 10:15-11:40 12:56-14:42 16:46-19:18 xen: arm: sun7i: domU console. see"10:28 2013-10-15"
interruptted by "2)".
2), 50' reply to bnc#820873. discuss with Chunyan.
3), \TODO: send patch to linux-arm about a20 only include 1G memory.
4), \TODO: ianc said that the upstream kernel for domU is works too. i could try it later.

send work report.

10:28 2013-10-15
xen, arm, sun7i, domU console
1, there is no output after i use the above patch. "21:58 2013-10-14"7.
this patch should not affect this, does the dts of cubieboard2-xen changes?

2, follow the config in "10:33 2013-10-10"3-5). got the failure.
(XEN) Freed 264kB init memory.
(XEN) DOM0: Uncompressing Linux... done, booting the kernel.
(XEN) Hypervisor Trap. HSR=0x80000006 EC=0x20 IL=0 Syndrome=6
(XEN) CPU0: Unexpected Trap: Hypervisor
(XEN) ----[ Xen-4.4-unstable  arm32  debug=y  Tainted:    C ]----
(XEN) CPU:    0
(XEN) PC:     00000008
(XEN) CPSR:   600001d3 MODE:32-bit Guest SVC
(XEN)      R0: 00000000 R1: ffffffff R2: 48000000 R3: 4000807c
(XEN)      R4: 80000000 R5: edfe0dd0 R6: edfe0dd0 R7: 00b5e6c0
(XEN)      R8: 40000000 R9: 410fc074 R10:404cf06c R11:47e132f0 R12:47600268
(XEN) USR: SP: 00000000 LR: 00000000
(XEN) SVC: SP: 47e14310 LR: 40662398 SPSR:600001d3
(XEN) ABT: SP: 00000000 LR: 00000000 SPSR:00000000
(XEN) UND: SP: 00000000 LR: 00000000 SPSR:00000000
(XEN) IRQ: SP: 00000000 LR: 00000000 SPSR:00000000
(XEN) FIQ: SP: 00000000 LR: 00000000 SPSR:00000000
(XEN) FIQ: R8: 00000000 R9: 00000000 R10:00000000 R11:00000000 R12:00000000
(XEN) 
(XEN)      SCTLR: 00c51878
(XEN)        TCR: 00000000
(XEN)      TTBR0: 0000000040004000
(XEN)      TTBR1: 0000000000000000
(XEN)       IFAR: 00000000, IFSR: 00000000
(XEN)       DFAR: 00000000, DFSR: 00000000
(XEN) 
(XEN)   VTCR_EL2: 80002558
(XEN)  VTTBR_EL2: 00010000bfdfc000
(XEN) 
(XEN)  SCTLR_EL2: 30cd187f
(XEN)    HCR_EL2: 0000000000282835
(XEN)  TTBR0_EL2: 00000000bfedf000
(XEN) 
(XEN)    ESR_EL2: 80000006
(XEN)  HPFAR_EL2: 0000000000000000
(XEN)      HDFAR: 01c28014
(XEN)      HIFAR: 00000008
(XEN) 
(XEN) No stack trace for 32-bit guest kernel-mode
(XEN) FIQ: R8: 00000000 R9: 00000000 R10:00000000 R11:00000000 R12:00000000
(XEN)
(XEN)      SCTLR: 00c51878
(XEN)        TCR: 00000000
(XEN)      TTBR0: 0000000040004000
(XEN)      TTBR1: 0000000000000000
(XEN)       IFAR: 00000000, IFSR: 00000000
(XEN)       DFAR: 00000000, DFSR: 00000000
(XEN)
(XEN)   VTCR_EL2: 80002558
(XEN)  VTTBR_EL2: 00010000bfdfc000
(XEN)
(XEN)  SCTLR_EL2: 30cd187f
(XEN)    HCR_EL2: 0000000000282835
(XEN)  TTBR0_EL2: 00000000bfedf000
(XEN)
(XEN)    ESR_EL2: 80000006
(XEN)  HPFAR_EL2: 0000000000000000
(XEN)      HDFAR: 01c28014
(XEN)      HIFAR: 00000008
(XEN)
(XEN) No stack trace for 32-bit guest kernel-mode
(XEN) FIQ: R8: 00000000 R9: 00000000 R10:00000000 R11:00000000 R12:00000000
(XEN)
(XEN)      SCTLR: 00c51878
(XEN)        TCR: 00000000
(XEN)      TTBR0: 0000000040004000
(XEN)      TTBR1: 0000000000000000
(XEN)       IFAR: 00000000, IFSR: 00000000
(XEN)       DFAR: 00000000, DFSR: 00000000
(XEN)
(XEN)   VTCR_EL2: 80002558
(XEN)  VTTBR_EL2: 00010000bfdfc000
(XEN)
(XEN)  SCTLR_EL2: 30cd187f
(XEN)    HCR_EL2: 0000000000282835
(XEN)  TTBR0_EL2: 00000000bfedf000
(XEN)
(XEN)    ESR_EL2: 80000006
(XEN)  HPFAR_EL2: 0000000000000000
(XEN)      HDFAR: 01c28014
(XEN)      HIFAR: 00000008
(XEN)
(XEN) No stack trace for 32-bit guest kernel-mode
(XEN) FIQ: R8: 00000000 R9: 00000000 R10:00000000 R11:00000000 R12:00000000
(XEN)
(XEN)      SCTLR: 00c51878
(XEN)        TCR: 00000000
(XEN)      TTBR0: 0000000040004000
(XEN)      TTBR1: 0000000000000000
(XEN)       IFAR: 00000000, IFSR: 00000000
(XEN)       DFAR: 00000000, DFSR: 00000000
(XEN)
(XEN)   VTCR_EL2: 80002558
(XEN)  VTTBR_EL2: 00010000bfdfc000
(XEN)
(XEN)  SCTLR_EL2: 30cd187f
(XEN)    HCR_EL2: 0000000000282835
(XEN)  TTBR0_EL2: 00000000bfedf000
(XEN)
(XEN)    ESR_EL2: 80000006
(XEN)  HPFAR_EL2: 0000000000000000
(XEN)      HDFAR: 01c28014
(XEN)      HIFAR: 00000008
(XEN)
(XEN) No stack trace for 32-bit guest kernel-mode
(XEN) FIQ: R8: 00000000 R9: 00000000 R10:00000000 R11:00000000 R12:00000000
(XEN)
(XEN)      SCTLR: 00c51878
(XEN)        TCR: 00000000
(XEN)      TTBR0: 0000000040004000
(XEN)      TTBR1: 0000000000000000
(XEN)       IFAR: 00000000, IFSR: 00000000
(XEN)       DFAR: 00000000, DFSR: 00000000
(XEN)
(XEN)   VTCR_EL2: 80002558
(XEN)  VTTBR_EL2: 00010000bfdfc000
(XEN)
(XEN)  SCTLR_EL2: 30cd187f
(XEN)    HCR_EL2: 0000000000282835
(XEN)  TTBR0_EL2: 00000000bfedf000
(XEN)
(XEN)    ESR_EL2: 80000006
(XEN)  HPFAR_EL2: 0000000000000000
(XEN)      HDFAR: 01c28014
(XEN)      HIFAR: 00000008
(XEN)
(XEN) No stack trace for 32-bit guest kernel-mode
(XEN) FIQ: R8: 00000000 R9: 00000000 R10:00000000 R11:00000000 R12:00000000
(XEN)
(XEN)      SCTLR: 00c51878
(XEN)        TCR: 00000000
(XEN)      TTBR0: 0000000040004000
(XEN)      TTBR1: 0000000000000000
(XEN)       IFAR: 00000000, IFSR: 00000000
(XEN)       DFAR: 00000000, DFSR: 00000000
(XEN)
(XEN)   VTCR_EL2: 80002558
(XEN)  VTTBR_EL2: 00010000bfdfc000
(XEN)
(XEN)  SCTLR_EL2: 30cd187f
(XEN)    HCR_EL2: 0000000000282835
(XEN)  TTBR0_EL2: 00000000bfedf000
(XEN)
(XEN)    ESR_EL2: 80000006
(XEN)  HPFAR_EL2: 0000000000000000
(XEN)      HDFAR: 01c28014
(XEN)      HIFAR: 00000008
(XEN)
(XEN) No stack trace for 32-bit guest kernel-mode
0
(XEN)
(XEN)      SCTLR: 00c51878
(XEN)        TCR: 00000000
(XEN)      TTBR0: 0000000040004000
(XEN)      TTBR1: 0000000000000000
(XEN)       IFAR: 00000000, IFSR: 00000000
(XEN)       DFAR: 00000000, DFSR: 00000000
(XEN)
(XEN)   VTCR_EL2: 80002558
(XEN)  VTTBR_EL2: 00010000bfdfc000
(XEN)
(XEN)  SCTLR_EL2: 30cd187f
(XEN)    HCR_EL2: 0000000000282835
(XEN)  TTBR0_EL2: 00000000bfedf000
(XEN)
(XEN)    ESR_EL2: 80000006
(XEN)  HPFAR_EL2: 0000000000000000
(XEN)      HDFAR: 01c28014
(XEN)      HIFAR: 00000008
(XEN)
(XEN) No stack trace for 32-bit guest kernel-mode
0000
(XEN)
(XEN)      SCTLR: 00c51878
(XEN)        TCR: 00000000
(XEN)      TTBR0: 0000000040004000
(XEN)      TTBR1: 0000000000000000
(XEN)       IFAR: 00000000, IFSR: 00000000
(XEN)       DFAR: 00000000, DFSR: 00000000
(XEN)
(XEN)   VTCR_EL2: 80002558
(XEN)  VTTBR_EL2: 00010000bfdfc000
(XEN)
(XEN)  SCTLR_EL2: 30cd187f
(XEN)    HCR_EL2: 0000000000282835
(XEN)  TTBR0_EL2: 00000000bfedf000
(XEN)
(XEN)    ESR_EL2: 80000006
(XEN)  HPFAR_EL2: 0000000000000000
(XEN)      HDFAR: 01c28014
(XEN)      HIFAR: 00000008
(XEN)
(XEN) No stack trace for 32-bit guest kernel-mode
0000000
(XEN)
(XEN)      SCTLR: 00c51878
(XEN)        TCR: 00000000
(XEN)      TTBR0: 0000000040004000
(XEN)      TTBR1: 0000000000000000
(XEN)       IFAR: 00000000, IFSR: 00000000
(XEN)       DFAR: 00000000, DFSR: 00000000
(XEN)
(XEN)   VTCR_EL2: 80002558
(XEN)  VTTBR_EL2: 00010000bfdfc000
(XEN)
(XEN)  SCTLR_EL2: 30cd187f
(XEN)    HCR_EL2: 0000000000282835
(XEN)  TTBR0_EL2: 00000000bfedf000
(XEN)
(XEN)    ESR_EL2: 80000006
(XEN)  HPFAR_EL2: 0000000000000000
(XEN)      HDFAR: 01c28014
(XEN)      HIFAR: 00000008
(XEN)
(XEN) No stack trace for 32-bit guest kernel-mode
R12:00000000
(XEN)
(XEN)      SCTLR: 00c51878
(XEN)        TCR: 00000000
(XEN)      TTBR0: 0000000040004000
(XEN)      TTBR1: 0000000000000000
(XEN)       IFAR: 00000000, IFSR: 00000000
(XEN)       DFAR: 00000000, DFSR: 00000000
(XEN)
(XEN)   VTCR_EL2: 80002558
(XEN)  VTTBR_EL2: 00010000bfdfc000
(XEN)
(XEN)  SCTLR_EL2: 30cd187f
(XEN)    HCR_EL2: 0000000000282835
(XEN)  TTBR0_EL2: 00000000bfedf000
(XEN)
(XEN)    ESR_EL2: 80000006
(XEN)  HPFAR_EL2: 0000000000000000
(XEN)      HDFAR: 01c28014
(XEN)      HIFAR: 00000008
(XEN)
(XEN) No stack trace for 32-bit guest kernel-mode
0 R12:00000000
(XEN)
(XEN)      SCTLR: 00c51878
(XEN)        TCR: 00000000
(XEN)      TTBR0: 0000000040004000
(XEN)      TTBR1: 0000000000000000
(XEN)       IFAR: 00000000, IFSR: 00000000
(XEN)       DFAR: 00000000, DFSR: 00000000
(XEN)
(XEN)   VTCR_EL2: 80002558
(XEN)  VTTBR_EL2: 00010000bfdfc000
(XEN)
(XEN)  SCTLR_EL2: 30cd187f
(XEN)    HCR_EL2: 0000000000282835
(XEN)  TTBR0_EL2: 00000000bfedf000
(XEN)
(XEN)    ESR_EL2: 80000006
(XEN)  HPFAR_EL2: 0000000000000000
(XEN)      HDFAR: 01c28014
(XEN)      HIFAR: 00000008
(XEN)
(XEN) No stack trace for 32-bit guest kernel-mode
0000 R12:00000000
(XEN)
(XEN)      SCTLR: 00c51878
(XEN)        TCR: 00000000
(XEN)      TTBR0: 0000000040004000
(XEN)      TTBR1: 0000000000000000
(XEN)       IFAR: 00000000, IFSR: 00000000
(XEN)       DFAR: 00000000, DFSR: 00000000
(XEN)
(XEN)   VTCR_EL2: 80002558
(XEN)  VTTBR_EL2: 00010000bfdfc000
(XEN)
(XEN)  SCTLR_EL2: 30cd187f
(XEN)    HCR_EL2: 0000000000282835
(XEN)  TTBR0_EL2: 00000000bfedf000
(XEN)
(XEN)    ESR_EL2: 80000006
(XEN)  HPFAR_EL2: 0000000000000000
(XEN)      HDFAR: 01c28014
(XEN)      HIFAR: 00000008
(XEN)
(XEN) No stack trace for 32-bit guest kernel-mode
000000 R12:00000000
(XEN)
(XEN)      SCTLR: 00c51878
(XEN)        TCR: 00000000
(XEN)      TTBR0: 0000000040004000
(XEN)      TTBR1: 0000000000000000
(XEN)       IFAR: 00000000, IFSR: 00000000
(XEN)       DFAR: 00000000, DFSR: 00000000
(XEN)
(XEN)   VTCR_EL2: 80002558
(XEN)  VTTBR_EL2: 00010000bfdfc000
(XEN)
(XEN)  SCTLR_EL2: 30cd187f
(XEN)    HCR_EL2: 0000000000282835
(XEN)  TTBR0_EL2: 00000000bfedf000
(XEN)
(XEN)    ESR_EL2: 80000006
(XEN)  HPFAR_EL2: 0000000000000000
(XEN)      HDFAR: 01c28014
(XEN)      HIFAR: 00000008
(XEN)
(XEN) No stack trace for 32-bit guest kernel-mode
00000000 R12:00000000
(XEN)
(XEN)      SCTLR: 00c51878
(XEN)        TCR: 00000000
(XEN)      TTBR0: 0000000040004000
(XEN)      TTBR1: 0000000000000000
(XEN)       IFAR: 00000000, IFSR: 00000000
(XEN)       DFAR: 00000000, DFSR: 00000000
(XEN)
(XEN)   VTCR_EL2: 80002558
(XEN)  VTTBR_EL2: 00010000bfdfc000
(XEN)
(XEN)  SCTLR_EL2: 30cd187f
(XEN)    HCR_EL2: 0000000000282835
(XEN)  TTBR0_EL2: 00000000bfedf000
(XEN)
(XEN)    ESR_EL2: 80000006
(XEN)  HPFAR_EL2: 0000000000000000
(XEN)      HDFAR: 01c28014
(XEN)      HIFAR: 00000008
(XEN)
(XEN) No stack trace for 32-bit guest kernel-mode
:00000000 R12:00000000
(XEN)
(XEN)      SCTLR: 00c51878
(XEN)        TCR: 00000000
(XEN)      TTBR0: 0000000040004000
(XEN)      TTBR1: 0000000000000000
(XEN)       IFAR: 00000000, IFSR: 00000000
(XEN)       DFAR: 00000000, DFSR: 00000000
(XEN)
(XEN)   VTCR_EL2: 80002558
(XEN)  VTTBR_EL2: 00010000bfdfc000
(XEN)
(XEN)  SCTLR_EL2: 30cd187f
(XEN)    HCR_EL2: 0000000000282835
(XEN)  TTBR0_EL2: 00000000bfedf000
(XEN)
(XEN)    ESR_EL2: 80000006
(XEN)  HPFAR_EL2: 0000000000000000
(XEN)      HDFAR: 01c28014
(XEN)      HIFAR: 00000008
(XEN)
(XEN) No stack trace for 32-bit guest kernel-mode
1:00000000 R12:00000000
(XEN)
(XEN)      SCTLR: 00c51878
(XEN)        TCR: 00000000
(XEN)      TTBR0: 0000000040004000
(XEN)      TTBR1: 0000000000000000
(XEN)       IFAR: 00000000, IFSR: 00000000
(XEN)       DFAR: 00000000, DFSR: 00000000
(XEN)
(XEN)   VTCR_EL2: 80002558
(XEN)  VTTBR_EL2: 00010000bfdfc000
(XEN)
(XEN)  SCTLR_EL2: 30cd187f
(XEN)    HCR_EL2: 0000000000282835
(XEN)  TTBR0_EL2: 00000000bfedf000
(XEN)
(XEN)    ESR_EL2: 80000006
(XEN)  HPFAR_EL2: 0000000000000000
(XEN)      HDFAR: 01c28014
(XEN)      HIFAR: 00000008
(XEN)
(XEN) No stack trace for 32-bit guest kernel-mode
11:00000000 R12:00000000
(XEN)
(XEN)      SCTLR: 00c51878
(XEN)        TCR: 00000000
(XEN)      TTBR0: 0000000040004000
(XEN)      TTBR1: 0000000000000000
(XEN)       IFAR: 00000000, IFSR: 00000000
(XEN)       DFAR: 00000000, DFSR: 00000000
(XEN)
(XEN)   VTCR_EL2: 80002558
(XEN)  VTTBR_EL2: 00010000bfdfc000
(XEN)
(XEN)  SCTLR_EL2: 30cd187f
(XEN)    HCR_EL2: 0000000000282835
(XEN)  TTBR0_EL2: 00000000bfedf000
(XEN)
(XEN)    ESR_EL2: 80000006
(XEN)  HPFAR_EL2: 0000000000000000
(XEN)      HDFAR: 01c28014
(XEN)      HIFAR: 00000008
(XEN)
(XEN) No stack trace for 32-bit guest kernel-mode
R11:00000000 R12:00000000
(XEN)
(XEN)      SCTLR: 00c51878
(XEN)        TCR: 00000000
(XEN)      TTBR0: 0000000040004000
(XEN)      TTBR1: 0000000000000000
(XEN)       IFAR: 00000000, IFSR: 00000000
(XEN)       DFAR: 00000000, DFSR: 00000000
(XEN)
(XEN)   VTCR_EL2: 80002558
(XEN)  VTTBR_EL2: 00010000bfdfc000
(XEN)
(XEN)  SCTLR_EL2: 30cd187f
(XEN)    HCR_EL2: 0000000000282835
(XEN)  TTBR0_EL2: 00000000bfedf000
(XEN)
(XEN)    ESR_EL2: 80000006
(XEN)  HPFAR_EL2: 0000000000000000
(XEN)      HDFAR: 01c28014
(XEN)      HIFAR: 00000008
(XEN)
(XEN) No stack trace for 32-bit guest kernel-mode
11:00000000 R12:00000000
(XEN)
(XEN)      SCTLR: 00c51878
(XEN)        TCR: 00000000
(XEN)      TTBR0: 0000000040004000
(XEN)      TTBR1: 0000000000000000
(XEN)       IFAR: 00000000, IFSR: 00000000
(XEN)       DFAR: 00000000, DFSR: 00000000
(XEN)
(XEN)   VTCR_EL2: 80002558
(XEN)  VTTBR_EL2: 00010000bfdfc000
(XEN)
(XEN)  SCTLR_EL2: 30cd187f
(XEN)    HCR_EL2: 0000000000282835
(XEN)  TTBR0_EL2: 00000000bfedf000
(XEN)
(XEN)    ESR_EL2: 80000006
(XEN)  HPFAR_EL2: 0000000000000000
(XEN)      HDFAR: 01c28014
(XEN)      HIFAR: 00000008
(XEN)
(XEN) No stack trace for 32-bit guest kernel-mode
000000 R12:00000000
(XEN)
(XEN)      SCTLR: 00c51878
(XEN)        TCR: 00000000
(XEN)      TTBR0: 0000000040004000
(XEN)      TTBR1: 0000000000000000
(XEN)       IFAR: 00000000, IFSR: 00000000
(XEN)       DFAR: 00000000, DFSR: 00000000
(XEN)
(XEN)   VTCR_EL2: 80002558
(XEN)  VTTBR_EL2: 00010000bfdfc000
(XEN)
(XEN)  SCTLR_EL2: 30cd187f
(XEN)    HCR_EL2: 0000000000282835
(XEN)  TTBR0_EL2: 00000000bfedf000
(XEN)
(XEN)    ESR_EL2: 80000006
(XEN)  HPFAR_EL2: 0000000000000000
(XEN)      HDFAR: 01c28014
(XEN)      HIFAR: 00000008
(XEN)
(XEN) No stack trace for 32-bit guest kernel-mode
:00000000
(XEN)
(XEN)      SCTLR: 00c51878
(XEN)        TCR: 00000000
(XEN)      TTBR0: 0000000040004000
(XEN)      TTBR1: 0000000000000000
(XEN)       IFAR: 00000000, IFSR: 00000000
(XEN)       DFAR: 00000000, DFSR: 00000000
(XEN)
(XEN)   VTCR_EL2: 80002558
(XEN)  VTTBR_EL2: 00010000bfdfc000
(XEN)
(XEN)  SCTLR_EL2: 30cd187f
(XEN)    HCR_EL2: 0000000000282835
(XEN)  TTBR0_EL2: 00000000bfedf000
(XEN)
(XEN)    ESR_EL2: 80000006
(XEN)  HPFAR_EL2: 0000000000000000
(XEN)      HDFAR: 01c28014
(XEN)      HIFAR: 00000008
(XEN)
(XEN) No stack trace for 32-bit guest kernel-mode
000
(XEN)
(XEN)      SCTLR: 00c51878
(XEN)        TCR: 00000000
(XEN)      TTBR0: 0000000040004000
(XEN)      TTBR1: 0000000000000000
(XEN)       IFAR: 00000000, IFSR: 00000000
(XEN)       DFAR: 00000000, DFSR: 00000000
(XEN)
(XEN)   VTCR_EL2: 80002558
(XEN)  VTTBR_EL2: 00010000bfdfc000
(XEN)
(XEN)  SCTLR_EL2: 30cd187f
(XEN)    HCR_EL2: 0000000000282835
(XEN)  TTBR0_EL2: 00000000bfedf000
(XEN)
(XEN)    ESR_EL2: 80000006
(XEN)  HPFAR_EL2: 0000000000000000
(XEN)      HDFAR: 01c28014
(XEN)      HIFAR: 00000008
(XEN)
(XEN) No stack trace for 32-bit guest kernel-mode
(XEN) FIQ: R8: 00000000 R9: 00000000 R10:00000000 R11:00000000 R12:00000000
(XEN)
(XEN)      SCTLR: 00c51878
(XEN)        TCR: 00000000
(XEN)      TTBR0: 0000000040004000
(XEN)      TTBR1: 0000000000000000
(XEN)       IFAR: 00000000, IFSR: 00000000
(XEN)       DFAR: 00000000, DFSR: 00000000
(XEN)
(XEN)   VTCR_EL2: 80002558
(XEN)  VTTBR_EL2: 00010000bfdfc000
(XEN)
(XEN)  SCTLR_EL2: 30cd187f
(XEN)    HCR_EL2: 0000000000282835
(XEN)  TTBR0_EL2: 00000000bfedf000
(XEN)
(XEN)    ESR_EL2: 80000006
(XEN)  HPFAR_EL2: 0000000000000000
(XEN)      HDFAR: 01c28014
(XEN)      HIFAR: 00000008
(XEN)
(XEN) No stack trace for 32-bit guest kernel-mode
(XEN) FIQ: R8: 00000000 R9: 00000000 R10:00000000 R11:00000000 R12:00000000
(XEN)
(XEN)      SCTLR: 00c51878
(XEN)        TCR: 00000000
(XEN)      TTBR0: 0000000040004000
(XEN)      TTBR1: 0000000000000000
(XEN)       IFAR: 00000000, IFSR: 00000000
(XEN)       DFAR: 00000000, DFSR: 00000000
(XEN)
(XEN)   VTCR_EL2: 80002558
(XEN)  VTTBR_EL2: 00010000bfdfc000
(XEN)
(XEN)  SCTLR_EL2: 30cd187f
(XEN)    HCR_EL2: 0000000000282835
(XEN)  TTBR0_EL2: 00000000bfedf000
(XEN)
(XEN)    ESR_EL2: 80000006
(XEN)  HPFAR_EL2: 0000000000000000
(XEN)      HDFAR: 01c28014
(XEN)      HIFAR: 00000008
(XEN)
(XEN) No stack trace for 32-bit guest kernel-mode
(XEN) FIQ: R8: 00000000 R9: 00000000 R10:00000000 R11:00000000 R12:00000000
(XEN)
(XEN)      SCTLR: 00c51878
(XEN)        TCR: 00000000
(XEN)      TTBR0: 0000000040004000
(XEN)      TTBR1: 0000000000000000
(XEN)       IFAR: 00000000, IFSR: 00000000
(XEN)       DFAR: 00000000, DFSR: 00000000
(XEN)
(XEN)   VTCR_EL2: 80002558
(XEN)  VTTBR_EL2: 00010000bfdfc000
(XEN)
(XEN)  SCTLR_EL2: 30cd187f
(XEN)    HCR_EL2: 0000000000282835
(XEN)  TTBR0_EL2: 00000000bfedf000
(XEN)
(XEN)    ESR_EL2: 80000006
(XEN)  HPFAR_EL2: 0000000000000000
(XEN)      HDFAR: 01c28014
(XEN)      HIFAR: 00000008
(XEN)
(XEN) No stack trace for 32-bit guest kernel-mode

this is because i use other soc ll debug. switch to sunxi uart0:
(XEN) *** Serial input -> DOM0 (type 'CTRL-a' three times to switch input to Xen)
(XEN) Freed 264kB init memory.
(XEN) DOM0: Uncompressing Linux...
(XEN) DOM0: 
(XEN) DOM0: uncompression error
(XEN) DOM0: 

3, it works! 
1), change the memory from 2G to 1G:
diff --git a/arch/arm/boot/dts/sun7i-a20-xen.dtsi b/arch/arm/boot/dts/sun7i-a20-xen.dtsi
index 80e04a5..d8b50be 100644
--- a/arch/arm/boot/dts/sun7i-a20-xen.dtsi
+++ b/arch/arm/boot/dts/sun7i-a20-xen.dtsi
@@ -33,7 +33,7 @@
        };
 
        memory {
-               reg = <0x40000000 0x80000000>;
+               reg = <0x40000000 0x40000000>;
        };
 
        clocks {

\TODO: find out why. 

4, xl create log
# xl -vvv create -d domU_test 
Parsing config from domU_test
unable to format domain config as JSON (YAJL:1)
libxl: debug: libxl_create.c:1233:do_domain_create: ao 0x3cd50: create: how=(nil) callback=(nil) poller=0x3cd98
libxl: verbose: libxl_create.c:130:libxl__domain_build_info_setdefault: qemu-xen is unavailable, use qemu-xen-traditional instead: No such file or directory
libxl: debug: libxl_device.c:257:libxl__device_disk_set_backend: Disk vdev=xvda spec.backend=unknown
libxl: debug: libxl_device.c:296:libxl__device_disk_set_backend: Disk vdev=xvda, using backend phy
libxl: debug: libxl_create.c:678:initiate_domain_create: running bootloader
libxl: debug: libxl_bootloader.c:327:libxl__bootloader_run: no bootloader configured, using user supplied kernel
libxl: debug: libxl_event.c:608:libxl__ev_xswatch_deregister: watch w=0x36f30: deregister unregistered
libxl: debug: libxl_numa.c:475:libxl__get_numa_candidate: New best NUMA placement candidate found: nr_nodes=1, nr_cpus=1, nr_vcpus=2, free_memkb=476
libxl: detail: libxl_dom.c:195:numa_place_domain: NUMA placement candidate with 1 nodes, 1 cpus and 476 KB free selected
domainbuilder: detail: xc_dom_allocate: cmdline="", features="(null)"
libxl: debug: libxl_dom.c:341:libxl__build_pv: pv kernel mapped 0 path /root/domU/zImage_dtb

domainbuilder: detail: xc_dom_kernel_file: filename="/root/domU/zImage_dtb"
domainbuilder: detail: xc_dom_malloc_filemap    : 2029 kB
domainbuilder: detail: xc_dom_boot_xen_init: ver 4.4, caps xen-3.0-armv7l 
domainbuilder: detail: xc_dom_parse_image: called
domainbuilder: detail: xc_dom_find_loader: trying multiboot-binary loader ... 
domainbuilder: detail: loader probe failed
domainbuilder: detail: xc_dom_find_loader: trying Linux zImage (ARM) loader ... 
domainbuilder: detail: xc_dom_probe_zimage_kernel: found an appended DTB
domainbuilder: detail: loader probe OK
domainbuilder: detail: xc_dom_parse_zimage_kernel: called
domainbuilder: detail: xc_dom_parse_zimage_kernel: xen-3.0-armv7l: RAM starts at 80000
domainbuilder: detail: xc_dom_parse_zimage_kernel: xen-3.0-armv7l: 0x80008000 -> 0x80203487
domainbuilder: detail: xc_dom_mem_init: mem 128 MB, pages 0x8000 pages, 4k each
domainbuilder: detail: xc_dom_mem_init: 0x8000 pages
domainbuilder: detail: xc_dom_boot_mem_init: called
domainbuilder: detail: xc_dom_malloc            : 256 kB
domainbuilder: detail: xc_dom_build_image: called
domainbuilder: detail: xc_dom_alloc_segment:   kernel       : 0x80008000 -> 0x80204000  (pfn 0x80008 + 0x1fc pages)
domainbuilder: detail: xc_dom_pfn_to_ptr_retcount: domU mapping: pfn 0x80008+0x1fc at 0xb6855000
domainbuilder: detail: xc_dom_load_zimage_kernel: called
domainbuilder: detail: xc_dom_load_zimage_kernel: kernel sed 0x80008000-0x80204000
domainbuilder: detail: xc_dom_load_zimage_kernel: copy 2077831 bytes from blob 0xb6a92000 to dst 0xb6855000
domainbuilder: detail: alloc_magic_pages: called
[  866.756625] Failed to unmap pfn:5b7de rc:-2
[  866.760847] Failed to unmap pfn:5b7dd rc:-2
domainbuilder: detail: count_pgtables_arm: called
domainbuilder: detail: xc_dom_build_image  : virt_alloc_end : 0x80204000
domainbuilder: detail: xc_dom_build_image  : virt_pgtab_end : 0x0
domainbuilder: detail: xc_dom_boot_image: called
domainbuilder: detail: arch_setup_bootearly: doing nothing
domainbuilder: detail: xc_dom_compat_check: supported guest type: xen-3.0-armv7l <= matches
domainbuilder: detail: setup_pgtables_arm: called
domainbuilder: detail: clear_page: pfn 0x88000, mfn 0x88000
[  866.810052] Failed to unmap pfn:5b7de rc:-2
domainbuilder: detail: clear_page: pfn 0x88001, mfn 0x88001
[  866.819773] Failed to unmap pfn:5b7dd rc:-2
domainbuilder: detail: start_info_arm: called
domainbuilder: detail: domain builder memory footprint
domainbuilder: detail:    allocated
domainbuilder: detail:       malloc             : 269 kB
domainbuilder: detail:       anon mmap          : 0 bytes
domainbuilder: detail:    mapped
domainbuilder: detail:       file mmap          : 2029 kB
domainbuilder: detail:       domU mmap          : 2032 kB
domainbuilder: detail: vcpu_arm: called
domainbuilder: detail: Initial state CPSR 0x1d3 PC 0x80008000
[  866.868827] Failed to unmap pfn:5b7da rc:-2
domainbuilder: detail: launch_vm: called, ctxt=0xb6f63004
[  866.881076] Failed to unmap pfn:5b7d9 rc:-2
domainbuilder: detail: xc_dom_release: called
libxl: debug: libxl_device.c:257:libxl__device_disk_set_backend: Disk vdev=xvda spec.backend=phy
libxl: debug: libxl_event.c:559:libxl__ev_xswatch_register: watch w=0x377c8 wpath=/local/domain/0/backend/vbd/1/51712/state token=3/0: register slotnum=3
libxl: debug: libxl_create.c:1246:do_domain_create: ao 0x3cd50: inprogress: poller=0x3cd98, flags=i
libxl: debug: libxl_event.c:503:watchfd_callback: watch w=0x377c8 wpath=/local/domain/0/backend/vbd/1/51712/state token=3/0: event epath=/local/domain/0/backend/vbd/1/51712/state
libxl: debug: libxl_event.c:647:devstate_watch_callback: backend /local/domain/0/backend/vbd/1/51712/state wanted state 2 still waiting state 1
libxl: debug: libxl_event.c:503:watchfd_callback: watch w=0x377c8 wpath=/local/domain/0/backend/vbd/1/51712/state token=3/0: event epath=/local/domain/0/backend/vbd/1/51712/state
libxl: debug: libxl_event.c:643:devstate_watch_callback: backend /local/domain/0/backend/vbd/1/51712/state wanted state 2 ok
libxl: debug: libxl_event.c:596:libxl__ev_xswatch_deregister: watch w=0x377c8 wpath=/local/domain/0/backend/vbd/1/51712/state token=3/0: deregister slotnum=3
libxl: debug: libxl_event.c:608:libxl__ev_xswatch_deregister: watch w=0x377c8: deregister unregistered
libxl: debug: libxl_device.c:959:device_hotplug: calling hotplug script: /etc/xen/scripts/block add
libxl: debug: libxl_event.c:1738:libxl__ao_progress_report: ao 0x3cd50: progress report: ignored
libxl: debug: libxl_event.c:1570:libxl__ao_complete: ao 0x3cd50: complete, rc=0
libxl: debug: libxl_event.c:1542:libxl__ao__destroy: ao 0x3cd50: destroy
Daemon running with PID 228
xc: debug: hypercall buffer: total allocations:98 total releases:98
xc: debug: hypercall buffer: current allocations:0 maximum allocations:4
xc: debug: hypercall buffer: cache current size:4
xc: debug: hypercall buffer: cache hits:90 misses:4 toobig:4
# 
# xl list
Name                                        ID   Mem VCPUs      State   Time(s)
Domain-0                                     0   511     1     r-----      12.2
domU                                         1   128     1     ------       6.9
# xl list
Name                                        ID   Mem VCPUs      State   Time(s)
Domain-0                                     0   511     1     r-----      12.2
domU                                         1   128     1     ------       9.0
# 

5, xl debug-keys
1), d: dump register
(XEN) 'd' pressed -> dumping registers
(XEN) 
(XEN) *** Dumping CPU0 guest state (d0:v0): ***
(XEN) ----[ Xen-4.4-unstable  arm32  debug=y  Tainted:    C ]----
(XEN) CPU:    0
(XEN) PC:     c000e2cc
(XEN) CPSR:   60000013 MODE:32-bit Guest SVC
(XEN)      R0: b6fb2004 R1: 00000000 R2: 00000001 R3: b6fb8b50
(XEN)      R4: b6fb8b50 R5: cc28d000 R6: 00000000 R7: bef922e8
(XEN)      R8: cc28d000 R9: cc2b0000 R10:df44f988 R11:bef922e8 R12:00000023
(XEN) USR: SP: bef922b4 LR: b6f1524c
(XEN) SVC: SP: cc2b1ea4 LR: c0216b28 SPSR:60000010
(XEN) ABT: SP: c058d98c LR: c0012760 SPSR:60000193
(XEN) UND: SP: c058d998 LR: c00125e0 SPSR:a0000093
(XEN) IRQ: SP: c058d980 LR: c0012400 SPSR:60000193
(XEN) FIQ: SP: 00000000 LR: 00000000 SPSR:00000000
(XEN) FIQ: R8: 00000000 R9: 00000000 R10:00000000 R11:00000000 R12:00000000
(XEN) 
(XEN)      SCTLR: 10c5387d
(XEN)        TCR: 00000000
(XEN)      TTBR0: 000000005fb9406a
(XEN)      TTBR1: 000000004000406a
(XEN)       IFAR: b6f0b36c, IFSR: 00000007
(XEN)       DFAR: 00025568, DFSR: 00000017
(XEN) 
(XEN)   VTCR_EL2: 80002558
(XEN)  VTTBR_EL2: 00010000402e4000
(XEN) 
(XEN)  SCTLR_EL2: 30cd187f
(XEN)    HCR_EL2: 0000000000282835
(XEN)  TTBR0_EL2: 000000007fedf000
(XEN) 
(XEN)    ESR_EL2: 4a000ea1
(XEN)  HPFAR_EL2: 000000000001c810
(XEN)      HDFAR: e0800854
(XEN)      HIFAR: b98790a0
(XEN) 
(XEN) No stack trace for 32-bit guest kernel-mode
(XEN) 

2), q: 
(XEN) 'q' pressed -> dumping domain info (now=0x124:9AF19255)
(XEN) General information for domain 0:
(XEN)     refcnt=3 dying=0 pause_count=0
(XEN)     nr_pages=131070 xenheap_pages=2 shared_pages=0 paged_pages=0 dirty_cpus={} max_pages=4294967295
(XEN)     handle=00000000-0000-0000-0000-000000000000 vm_assist=00000000
(XEN) GICH_LRs (vcpu 0) mask=0
(XEN)    HW_LR[0]=1a08001b
(XEN)    HW_LR[1]=0
(XEN)    HW_LR[2]=0
(XEN)    HW_LR[3]=0
(XEN) Inflight irq=27
(XEN) Rangesets belonging to domain 0:
(XEN)     Interrupts { }
(XEN)     I/O Memory { }
(XEN) NODE affinity for domain 0: [0]
(XEN) VCPU information and callbacks for domain 0:
(XEN)     VCPU0: CPU0 [has=T] poll=0 upcall_pend = 00, upcall_mask = 00 dirty_cpus={} cpu_affinity={0-127}
(XEN)     pause_count=0 pause_flags=0
(XEN)     No periodic timer
(XEN) General information for domain 1:
(XEN)     refcnt=3 dying=0 pause_count=0
(XEN)     nr_pages=32770 xenheap_pages=2 shared_pages=0 paged_pages=0 dirty_cpus={} max_pages=33024
(XEN)     handle=b1bfb6f3-aac8-41b2-8661-647b4ab9d1e2 vm_assist=00000000
(XEN) GICH_LRs (vcpu 0) mask=0
(XEN)    VCPU_LR[0]=0
(XEN)    VCPU_LR[1]=0
(XEN)    VCPU_LR[2]=0
(XEN)    VCPU_LR[3]=0
(XEN) Rangesets belonging to domain 1:
(XEN)     Interrupts { }
(XEN)     I/O Memory { }
(XEN) NODE affinity for domain 1: [0]
(XEN) VCPU information and callbacks for domain 1:
(XEN)     VCPU0: CPU0 [has=F] poll=0 upcall_pend = 00, upcall_mask = 00 dirty_cpus={} cpu_affinity={0-127}
(XEN)     pause_count=0 pause_flags=0
(XEN)     No periodic timer
(XEN) Notifying guest 0:0 (virq 1, port 0, stat 0/1/0)
(XEN) Notifying guest 1:0 (virq 1, port 0, stat 0/0/0)

3), all:
(XEN) '*' pressed -> firing all diagnostic keyhandlers
(XEN) [d: dump registers]
(XEN) 'd' pressed -> dumping registers
(XEN) 
(XEN) *** Dumping CPU0 guest state (d0:v0): ***
(XEN) ----[ Xen-4.4-unstable  arm32  debug=y  Tainted:    C ]----
(XEN) CPU:    0
(XEN) PC:     c000e2cc
(XEN) CPSR:   60000013 MODE:32-bit Guest SVC
(XEN)      R0: b6f7d004 R1: 00000000 R2: 00000001 R3: b6f83b50
(XEN)      R4: b6f83b50 R5: dfb98c00 R6: 00000000 R7: bee0d2e8
(XEN)      R8: dfb98c00 R9: cc2b0000 R10:df44f988 R11:bee0d2e8 R12:00000023
(XEN) USR: SP: bee0d2b4 LR: b6ee024c
(XEN) SVC: SP: cc2b1ea4 LR: c0216b28 SPSR:60000010
(XEN) ABT: SP: c058d98c LR: c0012760 SPSR:60000193
(XEN) UND: SP: c058d998 LR: c00125e0 SPSR:a0000093
(XEN) IRQ: SP: c058d980 LR: c0012400 SPSR:60000193
(XEN) FIQ: SP: 00000000 LR: 00000000 SPSR:00000000
(XEN) FIQ: R8: 00000000 R9: 00000000 R10:00000000 R11:00000000 R12:00000000
(XEN) 
(XEN)      SCTLR: 10c5387d
(XEN)        TCR: 00000000
(XEN)      TTBR0: 000000004c2ac06a
(XEN)      TTBR1: 000000004000406a
(XEN)       IFAR: b6ed636c, IFSR: 00000007
(XEN)       DFAR: 00025568, DFSR: 00000017
(XEN) 
(XEN)   VTCR_EL2: 80002558
(XEN)  VTTBR_EL2: 00010000402e4000
(XEN) 
(XEN)  SCTLR_EL2: 30cd187f
(XEN)    HCR_EL2: 0000000000282835
(XEN)  TTBR0_EL2: 000000007fedf000
(XEN) 
(XEN)    ESR_EL2: 4a000ea1
(XEN)  HPFAR_EL2: 000000000001c810
(XEN)      HDFAR: e0800854
(XEN)      HIFAR: b98790a0
(XEN) 
(XEN) No stack trace for 32-bit guest kernel-mode
(XEN) 
(XEN) [0: dump Dom0 registers]
(XEN) '0' pressed -> dumping Dom0's registers
(XEN) *** Dumping Dom0 vcpu#0 state: ***
(XEN) ----[ Xen-4.4-unstable  arm32  debug=y  Tainted:    C ]----
(XEN) CPU:    0
(XEN) PC:     c000e2cc
(XEN) CPSR:   60000013 MODE:32-bit Guest SVC
(XEN)      R0: 00000000 R1: deadbeef R2: 00000001 R3: b6f83b50
(XEN)      R4: b6f83b50 R5: dfb98c00 R6: 00000000 R7: bee0d2e8
(XEN)      R8: dfb98c00 R9: cc2b0000 R10:df44f988 R11:bee0d2e8 R12:deadbeef
(XEN) USR: SP: bee0d2b4 LR: b6ee024c
(XEN) SVC: SP: cc2b1ea4 LR: c0216b28 SPSR:60000010
(XEN) ABT: SP: c058d98c LR: c0012760 SPSR:60000193
(XEN) UND: SP: c058d998 LR: c00125e0 SPSR:a0000093
(XEN) IRQ: SP: c058d980 LR: c0012400 SPSR:60000193
(XEN) FIQ: SP: 00000000 LR: 00000000 SPSR:00000000
(XEN) FIQ: R8: 00000000 R9: 00000000 R10:00000000 R11:00000000 R12:00000000
(XEN) 
(XEN)      SCTLR: 10c5387d
(XEN)        TCR: 00000000
(XEN)      TTBR0: 000000004c2ac06a
(XEN)      TTBR1: 000000004000406a
(XEN)       IFAR: b6ed636c, IFSR: 00000007
(XEN)       DFAR: 00025568, DFSR: 00000017
(XEN) 
(XEN)   VTCR_EL2: 80002558
(XEN)  VTTBR_EL2: 00010000402e4000
(XEN) 
(XEN)  SCTLR_EL2: 30cd187f
(XEN)    HCR_EL2: 0000000000282835
(XEN)  TTBR0_EL2: 000000007fedf000
(XEN) 
(XEN)    ESR_EL2: 4a000ea1
(XEN)  HPFAR_EL2: 000000000001c810
(XEN)      HDFAR: e0800854
(XEN)      HIFAR: b98790a0
(XEN) 
(XEN) No stack trace for 32-bit guest kernel-mode
(XEN) [H: dump heap info]
(XEN) 'H' pressed -> dumping heap info (now-0x139:9424174B)
(XEN) heap[node=0][zone=0] -> 32694 pages
(XEN) heap[node=0][zone=1] -> 0 pages
(XEN) heap[node=0][zone=2] -> 0 pages
(XEN) heap[node=0][zone=3] -> 0 pages
(XEN) heap[node=0][zone=4] -> 0 pages
(XEN) heap[node=0][zone=5] -> 0 pages
(XEN) heap[node=0][zone=6] -> 0 pages
(XEN) heap[node=0][zone=7] -> 0 pages
(XEN) heap[node=0][zone=8] -> 0 pages
(XEN) heap[node=0][zone=9] -> 0 pages
(XEN) heap[node=0][zone=10] -> 0 pages
(XEN) heap[node=0][zone=11] -> 0 pages
(XEN) heap[node=0][zone=12] -> 0 pages
(XEN) heap[node=0][zone=13] -> 0 pages
(XEN) heap[node=0][zone=14] -> 0 pages
(XEN) heap[node=0][zone=15] -> 0 pages
(XEN) heap[node=0][zone=16] -> 0 pages
(XEN) heap[node=0][zone=17] -> 0 pages
(XEN) heap[node=0][zone=18] -> 0 pages
(XEN) heap[node=0][zone=19] -> 56562 pages
(XEN) heap[node=0][zone=20] -> 0 pages
(XEN) heap[node=0][zone=21] -> 0 pages
(XEN) heap[node=0][zone=22] -> 0 pages
(XEN) heap[node=0][zone=23] -> 0 pages
(XEN) heap[node=0][zone=24] -> 0 pages
(XEN) heap[node=0][zone=25] -> 0 pages
(XEN) heap[node=0][zone=26] -> 0 pages
(XEN) heap[node=0][zone=27] -> 0 pages
(XEN) heap[node=0][zone=28] -> 0 pages
(XEN) [a: dump timer queues]
(XEN) Dumping timer queues:
(XEN) CPU00:
(XEN)   ex=   -1598us timer=002b3568 cb=00241fa0(0026475c) ns16550_poll+0/0xcc
(XEN)   ex=    7404us timer=47ff8448 cb=0021979c(00000000) csched_tick+0/0x44c
(XEN)   ex=   27408us timer=47ff8158 cb=002180a0(47ff8140) csched_acct+0/0x5e0
(XEN) [e: dump evtchn info]
(XEN) 'e' pressed -> dumping event-channel info
(XEN) Event channel information for domain 0:
(XEN) Polling vCPUs: {}
(XEN)     port [p/m]
(XEN)        1 [0/0]: s=3 n=0 x=0 d=0 p=3
(XEN)        2 [0/0]: s=5 n=0 x=0 v=2
(XEN)        3 [0/0]: s=3 n=0 x=0 d=0 p=1
(XEN)        4 [0/0]: s=5 n=0 x=0 v=3
(XEN)        5 [0/0]: s=3 n=0 x=0 d=1 p=1
(XEN)        6 [0/0]: s=3 n=0 x=0 d=1 p=2
(XEN) Event channel information for domain 1:
(XEN) Polling vCPUs: {}
(XEN)     port [p/m]
(XEN)        1 [0/0]: s=3 n=0 x=0 d=0 p=5
(XEN)        2 [0/0]: s=3 n=0 x=0 d=0 p=6
(XEN) [g: print grant table usage]
(XEN) gnttab_usage_print_all [ key 'g' pressed
(XEN)       -------- active --------       -------- shared --------
(XEN) [ref] localdom mfn      pin          localdom gmfn     flags
(XEN) grant-table for remote domain:    0 ... no active grant table entries
(XEN)       -------- active --------       -------- shared --------
(XEN) [ref] localdom mfn      pin          localdom gmfn     flags
(XEN) grant-table for remote domain:    1 (v1)
(XEN) [  0]        0 0x059cf4 0x00000001          0 0x088000 0x19
(XEN) [  1]        0 0x072c08 0x00000001          0 0x088001 0x19
(XEN) gnttab_usage_print_all ] done
(XEN) [m: memory info]
(XEN) Physical memory information:
(XEN)     Xen heap: 130776kB free
(XEN)     heap[19]: 226248kB free
(XEN)     Dom heap: 226248kB free
(XEN) [q: dump domain (and guest debug) info]
(XEN) 'q' pressed -> dumping domain info (now=0x139:A3A35ED4)
(XEN) General information for domain 0:
(XEN)     refcnt=3 dying=0 pause_count=0
(XEN)     nr_pages=131070 xenheap_pages=2 shared_pages=0 paged_pages=0 dirty_cpus={} max_pages=4294967295
(XEN)     handle=00000000-0000-0000-0000-000000000000 vm_assist=00000000
(XEN) GICH_LRs (vcpu 0) mask=3
(XEN)    VCPU_LR[0]=1a08001b
(XEN)    VCPU_LR[1]=1a080057
(XEN)    VCPU_LR[2]=0
(XEN)    VCPU_LR[3]=0
(XEN) Inflight irq=27
(XEN) Inflight irq=87
(XEN) Rangesets belonging to domain 0:
(XEN)     Interrupts { }
(XEN)     I/O Memory { }
(XEN) NODE affinity for domain 0: [0]
(XEN) VCPU information and callbacks for domain 0:
(XEN)     VCPU0: CPU0 [has=F] poll=0 upcall_pend = 00, upcall_mask = 00 dirty_cpus={} cpu_affinity={0-127}
(XEN)     pause_count=0 pause_flags=0
(XEN)     No periodic timer
(XEN) General information for domain 1:
(XEN)     refcnt=3 dying=0 pause_count=0
(XEN)     nr_pages=32770 xenheap_pages=2 shared_pages=0 paged_pages=0 dirty_cpus={} max_pages=33024
(XEN)     handle=b1bfb6f3-aac8-41b2-8661-647b4ab9d1e2 vm_assist=00000000
(XEN) GICH_LRs (vcpu 0) mask=0
(XEN)    VCPU_LR[0]=0
(XEN)    VCPU_LR[1]=0
(XEN)    VCPU_LR[2]=0
(XEN)    VCPU_LR[3]=0
(XEN) Rangesets belonging to domain 1:
(XEN)     Interrupts { }
(XEN)     I/O Memory { }
(XEN) NODE affinity for domain 1: [0]
(XEN) VCPU information and callbacks for domain 1:
(XEN)     VCPU0: CPU0 [has=F] poll=0 upcall_pend = 00, upcall_mask = 00 dirty_cpus={} cpu_affinity={0-127}
(XEN)     pause_count=0 pause_flags=0
(XEN)     No periodic timer
(XEN) Notifying guest 0:0 (virq 1, port 0, stat 0/1/0)
(XEN) Notifying guest 1:0 (virq 1, port 0, stat 0/0/0)
(XEN) [r: dump run queues]
(XEN) sched_smt_power_savings: disabled
(XEN) NOW=0x00000139ACAEF1F0
(XEN) Idle cpupool:
(XEN) Scheduler: SMP Credit Scheduler (credit)
(XEN) info:
(XEN)   ncpus              = 1
(XEN)   master             = 0
(XEN)   credit             = 300
(XEN)   credit balance     = 0
(XEN)   weight             = 0
(XEN)   runq_sort          = 15733
(XEN)   default-weight     = 256
(XEN)   tslice             = 30ms
(XEN)   ratelimit          = 1000us
(XEN)   credits per msec   = 10
(XEN)   ticks per tslice   = 3
(XEN)   migration delay    = 0us
(XEN) idlers: 00000000,00000000,00000000,00000000
(XEN) active vcpus:
(XEN) Cpupool 0:
(XEN) Scheduler: SMP Credit Scheduler (credit)
(XEN) info:
(XEN)   ncpus              = 1
(XEN)   master             = 0
(XEN)   credit             = 300
(XEN)   credit balance     = 0
(XEN)   weight             = 0
(XEN)   runq_sort          = 15733
(XEN)   default-weight     = 256
(XEN)   tslice             = 30ms
(XEN)   ratelimit          = 1000us
(XEN)   credits per msec   = 10
(XEN)   ticks per tslice   = 3
(XEN)   migration delay    = 0us
(XEN) idlers: 00000000,00000000,00000000,00000000
(XEN) active vcpus:
(XEN) CPU[00]  sort=15733, sibling=00000000,00000000,00000000,00000001, core=00000000,00000000,00000000,00000001
(XEN)   run: [32767.0] pri=0 flags=0 cpu=0
(XEN)     1: [1.0] pri=-1 flags=0 cpu=0 credit=208 [w=256]
(XEN)     2: [0.0] pri=-1 flags=0 cpu=0 credit=241 [w=256]
(XEN) [t: display multi-cpu clock info]
(XEN) Synced stime skew: max=0ns avg=0ns samples=1 current=0ns
(XEN) Synced cycles skew: max=0 avg=0 samples=1 current=0

4), hang in 
PC:     c000e2cc
(XEN) SVC: SP: cc2b1ea4 LR: c0216b28 SPSR:60000010

c000e190 T sys_oabi_socketcall
c000e328 t unwind_get_byte

c0216ac8 t i2c_check_mux_parents
c0216b34 t i2c_check_addr_busy

(1), it seems that fail in i2c_check_mux_parents. 
disable all the device driver except for block and network for xen frontend driver.
(2), after re-compile, the error message is same. re-boot system

5), 
(XEN) Guest data abort: Translation fault at level 2
(XEN)     gva=c8800004
(XEN)     gpa=000000001c481004
(XEN)     size=2 sign=0 write=0 reg=3
(XEN)     eat=0 cm=0 s1ptw=0 dfsc=6
(XEN) dom1 IPA 0x000000001c481004
(XEN) P2M @ 023dbe80 mfn:0x5edf4
(XEN) 1ST[0x0] = 0x00000000402e96ff
(XEN) 2ND[0xe2] = 0x0000000000000000
(XEN) ----[ Xen-4.4-unstable  arm32  debug=y  Tainted:    C ]----
(XEN) CPU:    0
(XEN) PC:     c032ce1c
(XEN) CPSR:   600001d3 MODE:32-bit Guest SVC
(XEN)      R0: 00000000 R1: ffffffff R2: c034cd84 R3: 00000008
(XEN)      R4: ffffffff R5: c034c7f0 R6: 00000010 R7: c8800000
(XEN)      R8: c0487a38 R9: 00100100 R10:00200200 R11:c0345f88 R12:00000063
(XEN) USR: SP: 00000000 LR: 00000000
(XEN) SVC: SP: c0345f40 LR: c032d0d0 SPSR:000001d3
(XEN) ABT: SP: c036508c LR: c036508c SPSR:00000000
(XEN) UND: SP: c0365098 LR: c0365098 SPSR:00000000
(XEN) IRQ: SP: c0365080 LR: c0365080 SPSR:00000000
(XEN) FIQ: SP: 00000000 LR: ffffffff SPSR:00000000
(XEN) FIQ: R8: 00000000 R9: 00000000 R10:00000000 R11:00000000 R12:00000000
(XEN) 
(XEN)      SCTLR: 10c53c7d
(XEN)        TCR: 00000000
(XEN)      TTBR0: 000000008000406a
(XEN)      TTBR1: 000000008000406a
(XEN)       IFAR: 00000000, IFSR: 00000000
(XEN)       DFAR: 00000000, DFSR: 00000000
(XEN) 
(XEN)   VTCR_EL2: 80002558
(XEN)  VTTBR_EL2: 000200005edf4000
(XEN) 
(XEN)  SCTLR_EL2: 30cd187f
(XEN)    HCR_EL2: 0000000000282835
(XEN)  TTBR0_EL2: 000000007fedf000
(XEN) 
(XEN)    ESR_EL2: 93830006
(XEN)  HPFAR_EL2: 00000000001c4810
(XEN)      HDFAR: c8800004
(XEN)      HIFAR: 9f7ffee6
(XEN) 
(XEN) No stack trace for 32-bit guest kernel-mode
(XEN) domain_crash_sync called from traps.c:1385
(XEN) Domain 1 (vcpu#0) crashed on cpu#0:
(XEN) ----[ Xen-4.4-unstable  arm32  debug=y  Tainted:    C ]----
(XEN) CPU:    0
(XEN) PC:     c032ce1c
(XEN) CPSR:   600001d3 MODE:32-bit Guest SVC
(XEN)      R0: 00000000 R1: ffffffff R2: c034cd84 R3: 00000008
(XEN)      R4: ffffffff R5: c034c7f0 R6: 00000010 R7: c8800000
(XEN)      R8: c0487a38 R9: 00100100 R10:00200200 R11:c0345f88 R12:00000063
(XEN) USR: SP: 00000000 LR: 00000000
(XEN) SVC: SP: c0345f40 LR: c032d0d0 SPSR:000001d3
(XEN) ABT: SP: c036508c LR: c036508c SPSR:00000000
(XEN) UND: SP: c0365098 LR: c0365098 SPSR:00000000
(XEN) IRQ: SP: c0365080 LR: c0365080 SPSR:00000000
(XEN) FIQ: SP: 00000000 LR: ffffffff SPSR:00000000
(XEN) FIQ: R8: 00000000 R9: 00000000 R10:00000000 R11:00000000 R12:00000000
(XEN) 
(XEN)      SCTLR: 10c53c7d
(XEN)        TCR: 00000000
(XEN)      TTBR0: 000000008000406a
(XEN)      TTBR1: 000000008000406a
(XEN)       IFAR: 00000000, IFSR: 00000000
(XEN)       DFAR: 00000000, DFSR: 00000000
(XEN) 
(XEN)   VTCR_EL2: 80002558
(XEN)  VTTBR_EL2: 000200005edf4000
(XEN) 
(XEN)  SCTLR_EL2: 30cd187f
(XEN)    HCR_EL2: 0000000000282835
(XEN)  TTBR0_EL2: 000000007fedf000
(XEN) 
(XEN)    ESR_EL2: 93830006
(XEN)  HPFAR_EL2: 00000000001c4810
(XEN)      HDFAR: c8800004
(XEN)      HIFAR: 9f7ffee6
(XEN) 
(XEN) No stack trace for 32-bit guest kernel-mode
(XEN) mm.c:1250:d0 gnttab_mark_dirty not implemented yet

(1), lr in:
(XEN) SVC: SP: c0345f40 LR: c032d0d0 SPSR:000001d3

c032d028 T gic_of_init
c032d11c t gpiolib_debugfs_init

(2), 
actual crash in 37c:
 374:   e1a03008        mov     r3, r8
 378:   ebfffffe        bl      48 <gic_init_bases>
                        378: R_ARM_CALL gic_init_bases

        if (parent) {
 37c:   e3570000        cmp     r7, #0
 380:   0a000005        beq     39c <gic_of_init+0xc8>

so, it fail in gic_init_bases.

(3), add hypercall console_io for debug

diff --git a/kernel/printk.c b/kernel/printk.c
index 0b31715..826c2a9 100644
--- a/kernel/printk.c
+++ b/kernel/printk.c
@@ -1674,10 +1674,13 @@ EXPORT_SYMBOL(printk_emit);
  *
  * See the vsnprintf() documentation for format string extensions over C99.
  */
+#include <xen/interface/xen.h> // for CONSOLEIO_write
+#include <asm/xen/hypercall.h>
 asmlinkage int printk(const char *fmt, ...)
 {
 	va_list args;
 	int r;
+	char buf[256];
 
 #ifdef CONFIG_KGDB_KDB
 	if (unlikely(kdb_trap_printk)) {
@@ -1688,6 +1691,11 @@ asmlinkage int printk(const char *fmt, ...)
 	}
 #endif
 	va_start(args, fmt);
+	vsnprintf(buf, sizeof(buf), fmt, args);
+	va_end(args);
+	HYPERVISOR_console_io(CONSOLEIO_write, sizeof(buf), buf);
+
+	va_start(args, fmt);
 	r = vprintk_emit(0, -1, NULL, 0, fmt, args);
 	va_end(args);
 
(XEN) Guest data abort: Translation fault at level 2
(XEN)     gva=c8800004
(XEN)     gpa=000000001c481004
(XEN)     size=2 sign=0 write=0 reg=3
(XEN)     eat=0 cm=0 s1ptw=0 dfsc=6
(XEN) dom2 IPA 0x000000001c481004
(XEN) P2M @ 02338e00 mfn:0x59c70
(XEN) 1ST[0x0] = 0x00000000719c66ff
(XEN) 2ND[0xe2] = 0x0000000000000000
(XEN) ----[ Xen-4.4-unstable  arm32  debug=y  Tainted:    C ]----
(XEN) CPU:    0
(XEN) PC:     c032ce1c
(XEN) CPSR:   600001d3 MODE:32-bit Guest SVC
(XEN)      R0: 00000000 R1: ffffffff R2: c034cd84 R3: 00000008
(XEN)      R4: ffffffff R5: c034c7f0 R6: 00000010 R7: c8800000
(XEN)      R8: c0487a38 R9: 00100100 R10:00200200 R11:c0345f88 R12:00000063
(XEN) USR: SP: 00000000 LR: 00000000
(XEN) SVC: SP: c0345f40 LR: c032d0d0 SPSR:000001d3
(XEN) ABT: SP: c036508c LR: c036508c SPSR:00000000
(XEN) UND: SP: c0365098 LR: c0365098 SPSR:00000000
(XEN) IRQ: SP: c0365080 LR: c0365080 SPSR:00000000
(XEN) FIQ: SP: 00000000 LR: ffffffff SPSR:00000000
(XEN) FIQ: R8: 00000000 R9: 00000000 R10:00000000 R11:00000000 R12:00000000
(XEN) 
(XEN)      SCTLR: 10c53c7d
(XEN)        TCR: 00000000
(XEN)      TTBR0: 000000008000406a
(XEN)      TTBR1: 000000008000406a
(XEN)       IFAR: 00000000, IFSR: 00000000
(XEN)       DFAR: 00000000, DFSR: 00000000
(XEN) 
(XEN)   VTCR_EL2: 80002558
(XEN)  VTTBR_EL2: 0002000059c70000
(XEN) 
(XEN)  SCTLR_EL2: 30cd187f
(XEN)    HCR_EL2: 0000000000282835
(XEN)  TTBR0_EL2: 000000007fedf000
(XEN) 
(XEN)    ESR_EL2: 93830006
(XEN)  HPFAR_EL2: 00000000001c4810
(XEN)      HDFAR: c8800004
(XEN)      HIFAR: 9f7ffee6
(XEN) 
(XEN) No stack trace for 32-bit guest kernel-mode
(XEN) domain_crash_sync called from traps.c:1385
(XEN) Domain 2 (vcpu#0) crashed on cpu#0:
(XEN) ----[ Xen-4.4-unstable  arm32  debug=y  Tainted:    C ]----
(XEN) CPU:    0
(XEN) PC:     c032ce1c
(XEN) CPSR:   600001d3 MODE:32-bit Guest SVC
(XEN)      R0: 00000000 R1: ffffffff R2: c034cd84 R3: 00000008
(XEN)      R4: ffffffff R5: c034c7f0 R6: 00000010 R7: c8800000
(XEN)      R8: c0487a38 R9: 00100100 R10:00200200 R11:c0345f88 R12:00000063
(XEN) USR: SP: 00000000 LR: 00000000
(XEN) SVC: SP: c0345f40 LR: c032d0d0 SPSR:000001d3
(XEN) ABT: SP: c036508c LR: c036508c SPSR:00000000
(XEN) UND: SP: c0365098 LR: c0365098 SPSR:00000000
(XEN) IRQ: SP: c0365080 LR: c0365080 SPSR:00000000
(XEN) FIQ: SP: 00000000 LR: ffffffff SPSR:00000000
(XEN) FIQ: R8: 00000000 R9: 00000000 R10:00000000 R11:00000000 R12:00000000
(XEN) 
(XEN)      SCTLR: 10c53c7d
(XEN)        TCR: 00000000
(XEN)      TTBR0: 000000008000406a
(XEN)      TTBR1: 000000008000406a
(XEN)       IFAR: 00000000, IFSR: 00000000
(XEN)       DFAR: 00000000, DFSR: 00000000
(XEN) 
(XEN)   VTCR_EL2: 80002558
(XEN)  VTTBR_EL2: 0002000059c70000
(XEN) 
(XEN)  SCTLR_EL2: 30cd187f
(XEN)    HCR_EL2: 0000000000282835
(XEN)  TTBR0_EL2: 000000007fedf000
(XEN) 
(XEN)    ESR_EL2: 93830006
(XEN)  HPFAR_EL2: 00000000001c4810
(XEN)      HDFAR: c8800004
(XEN)      HIFAR: 9f7ffee6
(XEN) 
(XEN) No stack trace for 32-bit guest kernel-mode


14:19 2013-10-15
virtualization, domain configuration, libvirt, xl
the running xml is saved in /var/lib/xen with userdata-d.domain_id.uuid.suffix: 
/var/lib/xen/userdata-d.domain_id.uuid.xl
/var/lib/xen/userdata-d.domain_id.uuid.libvirt-xml

